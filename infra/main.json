{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.38.33.27573",
      "templateHash": "12308035288966534474"
    }
  },
  "parameters": {
    "environmentName": {
      "type": "string",
      "minLength": 1,
      "maxLength": 64,
      "metadata": {
        "description": "Name of the the environment which is used to generate a short unique hash used in all resources."
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "usgovvirginia",
      "allowedValues": [
        "uaenorth",
        "southafricanorth",
        "westeurope",
        "southcentralus",
        "australiaeast",
        "canadaeast",
        "eastus",
        "eastus2",
        "francecentral",
        "japaneast",
        "northcentralus",
        "swedencentral",
        "switzerlandnorth",
        "uksouth",
        "usgovvirginia",
        "usgovarizona"
      ],
      "minLength": 1,
      "metadata": {
        "description": "Primary location for all resources (filtered on available regions for Azure Open AI Service)."
      }
    },
    "tags": {
      "type": "object",
      "defaultValue": {
        "azd-env-name": "[parameters('environmentName')]",
        "SecurityControl": "Ignore"
      },
      "metadata": {
        "description": "Tags to be applied to resources."
      }
    },
    "resourceGroupName": {
      "type": "string",
      "metadata": {
        "description": "Name of the resource group. Leave blank to use default naming conventions."
      }
    },
    "identityName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the managed identity. Leave blank to use default naming conventions."
      }
    },
    "apimServiceName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the API Management service. Leave blank to use default naming conventions."
      }
    },
    "logAnalyticsName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Log Analytics workspace. Leave blank to use default naming conventions."
      }
    },
    "applicationInsightsDashboardName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Application Insights dashboard for APIM. Leave blank to use default naming conventions."
      }
    },
    "funcAplicationInsightsDashboardName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Application Insights dashboard for Function/Logic App. Leave blank to use default naming conventions."
      }
    },
    "applicationInsightsName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Application Insights for APIM resource. Leave blank to use default naming conventions."
      }
    },
    "funcApplicationInsightsName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Application Insights for Function/Logic App resource. Leave blank to use default naming conventions."
      }
    },
    "eventHubNamespaceName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Event Hub Namespace resource. Leave blank to use default naming conventions."
      }
    },
    "cosmosDbAccountName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Cosmos DB account resource. Leave blank to use default naming conventions."
      }
    },
    "usageProcessingFunctionAppName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Function App resource for usage processing. Leave blank to use default naming conventions."
      }
    },
    "usageProcessingLogicAppName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Logic App resource for usage processing. Leave blank to use default naming conventions."
      }
    },
    "storageAccountName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Storage Account. Leave blank to use default naming conventions."
      }
    },
    "languageServiceName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Azure Language service. Leave blank to use default naming conventions."
      }
    },
    "aiContentSafetyName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Azure Content Safety service. Leave blank to use default naming conventions."
      }
    },
    "vnetName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Virtual Network. Leave blank to use default naming conventions."
      }
    },
    "useExistingVnet": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Use an existing Virtual Network instead of creating a new one."
      }
    },
    "existingVnetRG": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Resource group containing the existing VNet (only used when useExistingVnet is true)."
      }
    },
    "apimSubnetName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Subnet name for API Management in the VNet. Leave blank to use default naming conventions."
      }
    },
    "privateEndpointSubnetName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Subnet name for Private Endpoints in the VNet. Leave blank to use default naming conventions."
      }
    },
    "functionAppSubnetName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Subnet name for Function App in the VNet. Leave blank to use default naming conventions."
      }
    },
    "apimNsgName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "NSG name for API Management subnet. Leave blank to use default naming conventions."
      }
    },
    "privateEndpointNsgName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "NSG name for Private Endpoint subnet. Leave blank to use default naming conventions."
      }
    },
    "functionAppNsgName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "NSG name for Function App subnet. Leave blank to use default naming conventions."
      }
    },
    "apimRouteTableName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Route Table name for API Management subnet. Leave blank to use default naming conventions."
      }
    },
    "vnetAddressPrefix": {
      "type": "string",
      "defaultValue": "10.170.0.0/24",
      "metadata": {
        "description": "Virtual Network address space."
      }
    },
    "apimSubnetPrefix": {
      "type": "string",
      "defaultValue": "10.170.0.0/26",
      "metadata": {
        "description": "API Management subnet address range."
      }
    },
    "privateEndpointSubnetPrefix": {
      "type": "string",
      "defaultValue": "10.170.0.64/26",
      "metadata": {
        "description": "Private Endpoint subnet address range."
      }
    },
    "functionAppSubnetPrefix": {
      "type": "string",
      "defaultValue": "10.170.0.128/26",
      "metadata": {
        "description": "Function App subnet address range."
      }
    },
    "dnsZoneRG": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Resource group containing the DNS zones (only used with existing VNet)."
      }
    },
    "dnsSubscriptionId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Subscription ID containing the DNS zones (only used with existing VNet)."
      }
    },
    "storageBlobPrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Storage Blob private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "storageFilePrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Storage File private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "storageTablePrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Storage Table private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "storageQueuePrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Storage Queue private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "cosmosDbPrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Cosmos DB private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "eventHubPrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Event Hub private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "openAiPrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Azure OpenAI private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "languageServicePrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Azure Language service private endpoint. Leave blank to use default naming conventions."
      }
    },
    "aiContentSafetyPrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Name of the Azure Content Safety service private endpoint. Leave blank to use default naming conventions."
      }
    },
    "apimV2PrivateEndpointName": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "API Management V2 private endpoint name. Leave blank to use default naming conventions."
      }
    },
    "apimNetworkType": {
      "type": "string",
      "defaultValue": "External",
      "allowedValues": [
        "External",
        "Internal"
      ],
      "metadata": {
        "description": "Network type for API Management service. Applies only to Premium and Developer SKUs."
      }
    },
    "apimV2UsePrivateEndpoint": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Use private endpoint for API Management service. Applies only to StandardV2 and PremiumV2 SKUs."
      }
    },
    "apimV2PublicNetworkAccess": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "API Management service external network access. When false, APIM must have private endpoint."
      }
    },
    "openAIExternalNetworkAccess": {
      "type": "string",
      "defaultValue": "Disabled",
      "allowedValues": [
        "Enabled",
        "Disabled"
      ],
      "metadata": {
        "description": "Azure OpenAI service public network access."
      }
    },
    "cosmosDbPublicAccess": {
      "type": "string",
      "defaultValue": "Enabled",
      "allowedValues": [
        "Enabled",
        "Disabled"
      ],
      "metadata": {
        "description": "Cosmos DB public network access."
      }
    },
    "eventHubNetworkAccess": {
      "type": "string",
      "defaultValue": "Enabled",
      "allowedValues": [
        "Enabled",
        "Disabled"
      ],
      "metadata": {
        "description": "Event Hub public network access."
      }
    },
    "languageServiceExternalNetworkAccess": {
      "type": "string",
      "defaultValue": "Disabled",
      "allowedValues": [
        "Enabled",
        "Disabled"
      ],
      "metadata": {
        "description": "Azure Language service external network access."
      }
    },
    "aiContentSafetyExternalNetworkAccess": {
      "type": "string",
      "defaultValue": "Disabled",
      "allowedValues": [
        "Enabled",
        "Disabled"
      ],
      "metadata": {
        "description": "Azure Content Safety external network access."
      }
    },
    "useAzureMonitorPrivateLinkScope": {
      "type": "bool",
      "defaultValue": "[not(parameters('useExistingVnet'))]",
      "metadata": {
        "description": "Use Azure Monitor Private Link Scope for Log Analytics and Application Insights."
      }
    },
    "createAppInsightsDashboard": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Create Application Insights dashboard."
      }
    },
    "provisionFunctionApp": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Deploy Azure Function App for processing usage data."
      }
    },
    "enableAIModelInference": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable AI Model Inference in API Management."
      }
    },
    "enableDocumentIntelligence": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable Document Intelligence in API Management."
      }
    },
    "enableAzureAISearch": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable Azure AI Search integration."
      }
    },
    "enableAIGatewayPiiRedaction": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable PII redaction in AI Gateway"
      }
    },
    "enableOpenAIRealtime": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Enable OpenAI realtime capabilities"
      }
    },
    "provisionLogicApp": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Provision the usage processing Logic App (requires WorkflowStandard VM quota)"
      }
    },
    "entraAuth": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Microsoft Entra ID authentication for API Management."
      }
    },
    "apimSku": {
      "type": "string",
      "defaultValue": "Developer",
      "allowedValues": [
        "Developer",
        "Premium",
        "StandardV2",
        "PremiumV2"
      ],
      "metadata": {
        "description": "API Management service SKU. Only Developer and Premium are supported."
      }
    },
    "apimSkuUnits": {
      "type": "int",
      "defaultValue": 1,
      "metadata": {
        "description": "API Management service SKU units."
      }
    },
    "openAiSkuName": {
      "type": "string",
      "defaultValue": "S0",
      "metadata": {
        "description": "SKU name for OpenAI services."
      }
    },
    "deploymentCapacity": {
      "type": "int",
      "defaultValue": 20,
      "metadata": {
        "description": "OpenAI deployment capacity (in thousands of tokens per minute)."
      }
    },
    "eventHubCapacityUnits": {
      "type": "int",
      "defaultValue": 1,
      "metadata": {
        "description": "Event Hub capacity units."
      }
    },
    "cosmosDbRUs": {
      "type": "int",
      "defaultValue": 400,
      "metadata": {
        "description": "Cosmos DB throughput in Request Units (RUs)."
      }
    },
    "logicAppsSkuCapacityUnits": {
      "type": "int",
      "defaultValue": 1,
      "metadata": {
        "description": "Logic Apps SKU capacity units."
      }
    },
    "languageServiceSkuName": {
      "type": "string",
      "defaultValue": "S",
      "metadata": {
        "description": "Azure Language service SKU name."
      }
    },
    "aiContentSafetySkuName": {
      "type": "string",
      "defaultValue": "S0",
      "metadata": {
        "description": "Azure Content Safety service SKU name."
      }
    },
    "functionContentShareName": {
      "type": "string",
      "defaultValue": "usage-function-content",
      "metadata": {
        "description": "Name of the Storage Account file share for Azure Function content."
      }
    },
    "logicContentShareName": {
      "type": "string",
      "defaultValue": "usage-logic-content",
      "metadata": {
        "description": "Name of the Storage Account file share for Logic App content."
      }
    },
    "openAiInstances": {
      "type": "object",
      "defaultValue": {
        "openAi1": {
          "name": "openai1",
          "location": "[parameters('location')]",
          "deployments": [
            {
              "name": "chat",
              "model": {
                "format": "OpenAI",
                "name": "gpt-4.1-mini",
                "version": "2025-04-14"
              },
              "sku": {
                "name": "Standard",
                "capacity": "[parameters('deploymentCapacity')]"
              }
            },
            {
              "name": "embedding",
              "model": {
                "format": "OpenAI",
                "name": "text-embedding-ada-002",
                "version": "2"
              },
              "sku": {
                "name": "Standard",
                "capacity": "[parameters('deploymentCapacity')]"
              }
            }
          ]
        },
        "openAi2": {
          "name": "openai2",
          "location": "[parameters('location')]",
          "deployments": [
            {
              "name": "chat",
              "model": {
                "format": "OpenAI",
                "name": "gpt-4.1-mini",
                "version": "2025-04-14"
              },
              "sku": {
                "name": "Standard",
                "capacity": "[parameters('deploymentCapacity')]"
              }
            }
          ]
        },
        "openAi3": {
          "name": "openai3",
          "location": "[parameters('location')]",
          "deployments": [
            {
              "name": "chat",
              "model": {
                "format": "OpenAI",
                "name": "gpt-4.1-mini",
                "version": "2025-04-14"
              },
              "sku": {
                "name": "Standard",
                "capacity": "[parameters('deploymentCapacity')]"
              }
            },
            {
              "name": "embedding",
              "model": {
                "format": "OpenAI",
                "name": "text-embedding-ada-002",
                "version": "2"
              },
              "sku": {
                "name": "Standard",
                "capacity": "[parameters('deploymentCapacity')]"
              }
            }
          ]
        }
      },
      "metadata": {
        "description": "OpenAI instances configuration - add more instances by modifying this object."
      }
    },
    "aiSearchInstances": {
      "type": "array",
      "defaultValue": [
        {
          "name": "ai-search-01",
          "url": "https://REPLACE1.search.windows.net/",
          "description": "AI Search Instance 1"
        },
        {
          "name": "ai-search-02",
          "url": "https://REPLACE2.search.windows.net/",
          "description": "AI Search Instance 2"
        }
      ],
      "metadata": {
        "description": "AI Search instances configuration - add more instances by adding to this array."
      }
    },
    "entraTenantId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Microsoft Entra ID tenant ID for authentication (only used when entraAuth is true)."
      }
    },
    "entraClientId": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Microsoft Entra ID client ID for authentication (only used when entraAuth is true)."
      }
    },
    "entraAudience": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "Audience value for Microsoft Entra ID authentication (only used when entraAuth is true)."
      }
    }
  },
  "variables": {
    "$fxv#0": {
      "analysisServicesServers": "as",
      "apiManagementService": "apim-",
      "appConfigurationConfigurationStores": "appcs-",
      "appManagedEnvironments": "cae-",
      "appContainerApps": "ca-",
      "authorizationPolicyDefinitions": "policy-",
      "automationAutomationAccounts": "aa-",
      "blueprintBlueprints": "bp-",
      "blueprintBlueprintsArtifacts": "bpa-",
      "cacheRedis": "redis-",
      "cdnProfiles": "cdnp-",
      "cdnProfilesEndpoints": "cdne-",
      "cognitiveServicesAccounts": "cog-",
      "cognitiveServicesFormRecognizer": "cog-fr-",
      "cognitiveServicesTextAnalytics": "cog-ta-",
      "computeAvailabilitySets": "avail-",
      "computeCloudServices": "cld-",
      "computeDiskEncryptionSets": "des",
      "computeDisks": "disk",
      "computeDisksOs": "osdisk",
      "computeGalleries": "gal",
      "computeSnapshots": "snap-",
      "computeVirtualMachines": "vm",
      "computeVirtualMachineScaleSets": "vmss-",
      "containerInstanceContainerGroups": "ci",
      "containerRegistryRegistries": "cr",
      "containerServiceManagedClusters": "aks-",
      "databricksWorkspaces": "dbw-",
      "dataFactoryFactories": "adf-",
      "dataLakeAnalyticsAccounts": "dla",
      "dataLakeStoreAccounts": "dls",
      "dataMigrationServices": "dms-",
      "dBforMySQLServers": "mysql-",
      "dBforPostgreSQLServers": "psql-",
      "devicesIotHubs": "iot-",
      "devicesProvisioningServices": "provs-",
      "devicesProvisioningServicesCertificates": "pcert-",
      "documentDBDatabaseAccounts": "cosmos-",
      "eventGridDomains": "evgd-",
      "eventGridDomainsTopics": "evgt-",
      "eventGridEventSubscriptions": "evgs-",
      "eventHubNamespaces": "evhns-",
      "eventHubNamespacesEventHubs": "evh-",
      "hdInsightClustersHadoop": "hadoop-",
      "hdInsightClustersHbase": "hbase-",
      "hdInsightClustersKafka": "kafka-",
      "hdInsightClustersMl": "mls-",
      "hdInsightClustersSpark": "spark-",
      "hdInsightClustersStorm": "storm-",
      "hybridComputeMachines": "arcs-",
      "insightsActionGroups": "ag-",
      "insightsComponents": "appi-",
      "keyVaultVaults": "kv-",
      "kubernetesConnectedClusters": "arck",
      "kustoClusters": "dec",
      "kustoClustersDatabases": "dedb",
      "logicIntegrationAccounts": "ia-",
      "logicWorkflows": "logic-",
      "machineLearningServicesWorkspaces": "mlw-",
      "managedIdentityUserAssignedIdentities": "id-",
      "managementManagementGroups": "mg-",
      "migrateAssessmentProjects": "migr-",
      "networkApplicationGateways": "agw-",
      "networkApplicationSecurityGroups": "asg-",
      "networkAzureFirewalls": "afw-",
      "networkBastionHosts": "bas-",
      "networkConnections": "con-",
      "networkDnsZones": "dnsz-",
      "networkExpressRouteCircuits": "erc-",
      "networkFirewallPolicies": "afwp-",
      "networkFirewallPoliciesWebApplication": "waf",
      "networkFirewallPoliciesRuleGroups": "wafrg",
      "networkFrontDoors": "fd-",
      "networkFrontdoorWebApplicationFirewallPolicies": "fdfp-",
      "networkLoadBalancersExternal": "lbe-",
      "networkLoadBalancersInternal": "lbi-",
      "networkLoadBalancersInboundNatRules": "rule-",
      "networkLocalNetworkGateways": "lgw-",
      "networkNatGateways": "ng-",
      "networkNetworkInterfaces": "nic-",
      "networkNetworkSecurityGroups": "nsg-",
      "networkNetworkSecurityGroupsSecurityRules": "nsgsr-",
      "networkNetworkWatchers": "nw-",
      "networkPrivateDnsZones": "pdnsz-",
      "networkPrivateLinkServices": "pl-",
      "networkPublicIPAddresses": "pip-",
      "networkPublicIPPrefixes": "ippre-",
      "networkRouteFilters": "rf-",
      "networkRouteTables": "rt-",
      "networkRouteTablesRoutes": "udr-",
      "networkTrafficManagerProfiles": "traf-",
      "networkVirtualNetworkGateways": "vgw-",
      "networkVirtualNetworks": "vnet-",
      "networkVirtualNetworksSubnets": "snet-",
      "networkVirtualNetworksVirtualNetworkPeerings": "peer-",
      "networkVirtualWans": "vwan-",
      "networkVpnGateways": "vpng-",
      "networkVpnGatewaysVpnConnections": "vcn-",
      "networkVpnGatewaysVpnSites": "vst-",
      "notificationHubsNamespaces": "ntfns-",
      "notificationHubsNamespacesNotificationHubs": "ntf-",
      "operationalInsightsWorkspaces": "log-",
      "portalDashboards": "dash-",
      "powerBIDedicatedCapacities": "pbi-",
      "purviewAccounts": "pview-",
      "privateEndpoints": "pe-",
      "recoveryServicesVaults": "rsv-",
      "resourcesResourceGroups": "rg-",
      "searchSearchServices": "srch-",
      "serviceBusNamespaces": "sb-",
      "serviceBusNamespacesQueues": "sbq-",
      "serviceBusNamespacesTopics": "sbt-",
      "serviceEndPointPolicies": "se-",
      "serviceFabricClusters": "sf-",
      "signalRServiceSignalR": "sigr",
      "sqlManagedInstances": "sqlmi-",
      "sqlServers": "sql-",
      "sqlServersDataWarehouse": "sqldw-",
      "sqlServersDatabases": "sqldb-",
      "sqlServersDatabasesStretch": "sqlstrdb-",
      "storageStorageAccounts": "st",
      "storageStorageAccountsVm": "stvm",
      "storSimpleManagers": "ssimp",
      "streamAnalyticsCluster": "asa-",
      "synapseWorkspaces": "syn",
      "synapseWorkspacesAnalyticsWorkspaces": "synw",
      "synapseWorkspacesSqlPoolsDedicated": "syndp",
      "synapseWorkspacesSqlPoolsSpark": "synsp",
      "timeSeriesInsightsEnvironments": "tsi-",
      "webServerFarms": "plan-",
      "webSitesAppService": "app-",
      "webSitesAppServiceEnvironment": "ase-",
      "webSitesFunctions": "func-",
      "webStaticSites": "stapp-"
    },
    "abbrs": "[variables('$fxv#0')]",
    "resourceToken": "[toLower(uniqueString(subscription().id, parameters('environmentName'), parameters('location')))]",
    "isGov": "[equals(environment().name, 'AzureUSGovernment')]",
    "dnsZoneNames": {
      "openai": "[if(variables('isGov'), '', 'privatelink.openai.azure.com')]",
      "cognitiveservices": "[if(variables('isGov'), 'privatelink.cognitiveservices.azure.us', 'privatelink.cognitiveservices.azure.com')]",
      "vaultcore": "[if(variables('isGov'), 'privatelink.vaultcore.usgovcloudapi.net', 'privatelink.vaultcore.azure.net')]",
      "monitor": "[if(variables('isGov'), 'privatelink.monitor.azure.us', 'privatelink.monitor.azure.com')]",
      "servicebus": "[if(variables('isGov'), 'privatelink.servicebus.usgovcloudapi.net', 'privatelink.servicebus.windows.net')]",
      "documents": "[if(variables('isGov'), 'privatelink.documents.azure.us', 'privatelink.documents.azure.com')]",
      "blob": "[if(variables('isGov'), 'privatelink.blob.core.usgovcloudapi.net', 'privatelink.blob.core.windows.net')]",
      "file": "[if(variables('isGov'), 'privatelink.file.core.usgovcloudapi.net', 'privatelink.file.core.windows.net')]",
      "table": "[if(variables('isGov'), 'privatelink.table.core.usgovcloudapi.net', 'privatelink.table.core.windows.net')]",
      "queue": "[if(variables('isGov'), 'privatelink.queue.core.usgovcloudapi.net', 'privatelink.queue.core.windows.net')]",
      "azureApi": "[if(variables('isGov'), 'privatelink.azure-api.us', 'privatelink.azure-api.net')]"
    },
    "cognitiveServicesAudience": "[if(variables('isGov'), 'https://cognitiveservices.azure.us', 'https://cognitiveservices.azure.com')]",
    "storageEndpointSuffix": "[if(variables('isGov'), 'core.usgovcloudapi.net', 'core.windows.net')]",
    "serviceBusSuffix": "[if(variables('isGov'), 'servicebus.usgovcloudapi.net', 'servicebus.windows.net')]",
    "portalUrl": "[if(variables('isGov'), 'https://portal.azure.us', 'https://portal.azure.com')]",
    "openAiPrivateDnsZoneName": "[variables('dnsZoneNames').openai]",
    "monitorPrivateDnsZoneName": "[variables('dnsZoneNames').monitor]",
    "eventHubPrivateDnsZoneName": "[variables('dnsZoneNames').servicebus]",
    "cosmosDbPrivateDnsZoneName": "[variables('dnsZoneNames').documents]",
    "storageBlobPrivateDnsZoneName": "[variables('dnsZoneNames').blob]",
    "storageFilePrivateDnsZoneName": "[variables('dnsZoneNames').file]",
    "storageTablePrivateDnsZoneName": "[variables('dnsZoneNames').table]",
    "storageQueuePrivateDnsZoneName": "[variables('dnsZoneNames').queue]",
    "aiCogntiveServicesDnsZoneName": "[variables('dnsZoneNames').cognitiveservices]",
    "allDnsZoneNames": [
      "[variables('dnsZoneNames').openai]",
      "[variables('dnsZoneNames').cognitiveservices]",
      "[variables('dnsZoneNames').vaultcore]",
      "[variables('dnsZoneNames').monitor]",
      "[variables('dnsZoneNames').servicebus]",
      "[variables('dnsZoneNames').documents]",
      "[variables('dnsZoneNames').blob]",
      "[variables('dnsZoneNames').file]",
      "[variables('dnsZoneNames').table]",
      "[variables('dnsZoneNames').queue]",
      "[variables('dnsZoneNames').azureApi]"
    ],
    "privateDnsZoneNames": "[filter(variables('allDnsZoneNames'), lambda('zoneName', not(empty(lambdaVariables('zoneName')))))]"
  },
  "resources": [
    {
      "type": "Microsoft.Resources/resourceGroups",
      "apiVersion": "2021-04-01",
      "name": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "location": "[parameters('location')]",
      "tags": "[parameters('tags')]"
    },
    {
      "copy": {
        "name": "dnsDeployment",
        "count": "[length(variables('privateDnsZoneNames'))]"
      },
      "condition": "[not(parameters('useExistingVnet'))]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "[format('dns-deployment-{0}', variables('privateDnsZoneNames')[copyIndex()])]",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": {
            "value": "[variables('privateDnsZoneNames')[copyIndex()]]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "61010896164197302"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            }
          },
          "resources": [
            {
              "type": "Microsoft.Network/privateDnsZones",
              "apiVersion": "2020-06-01",
              "name": "[parameters('name')]",
              "location": "global",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]"
            }
          ],
          "outputs": {
            "privateDnsZoneName": {
              "type": "string",
              "value": "[parameters('name')]"
            }
          }
        }
      },
      "dependsOn": [
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]"
      ]
    },
    {
      "condition": "[not(parameters('useExistingVnet'))]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "vnet",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('vnetName'))), createObject('value', parameters('vnetName')), createObject('value', format('vnet-{0}', variables('resourceToken'))))]",
          "apimSubnetName": "[if(not(empty(parameters('apimSubnetName'))), createObject('value', parameters('apimSubnetName')), createObject('value', 'snet-apim'))]",
          "apimNsgName": "[if(not(empty(parameters('apimNsgName'))), createObject('value', parameters('apimNsgName')), createObject('value', format('nsg-apim-{0}', variables('resourceToken'))))]",
          "privateEndpointSubnetName": "[if(not(empty(parameters('privateEndpointSubnetName'))), createObject('value', parameters('privateEndpointSubnetName')), createObject('value', 'snet-private-endpoint'))]",
          "privateEndpointNsgName": "[if(not(empty(parameters('privateEndpointNsgName'))), createObject('value', parameters('privateEndpointNsgName')), createObject('value', format('nsg-pe-{0}', variables('resourceToken'))))]",
          "functionAppSubnetName": "[if(not(empty(parameters('functionAppSubnetName'))), createObject('value', parameters('functionAppSubnetName')), createObject('value', 'snet-functionapp'))]",
          "functionAppNsgName": "[if(not(empty(parameters('functionAppNsgName'))), createObject('value', parameters('functionAppNsgName')), createObject('value', format('nsg-functionapp-{0}', variables('resourceToken'))))]",
          "vnetAddressPrefix": {
            "value": "[parameters('vnetAddressPrefix')]"
          },
          "apimSubnetAddressPrefix": {
            "value": "[parameters('apimSubnetPrefix')]"
          },
          "isAPIMV2SKU": {
            "value": "[or(equals(parameters('apimSku'), 'StandardV2'), equals(parameters('apimSku'), 'PremiumV2'))]"
          },
          "privateEndpointSubnetAddressPrefix": {
            "value": "[parameters('privateEndpointSubnetPrefix')]"
          },
          "functionAppSubnetAddressPrefix": {
            "value": "[parameters('functionAppSubnetPrefix')]"
          },
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "privateDnsZoneNames": {
            "value": "[variables('privateDnsZoneNames')]"
          },
          "apimRouteTableName": "[if(not(empty(parameters('apimRouteTableName'))), createObject('value', parameters('apimRouteTableName')), createObject('value', format('rt-apim-{0}', variables('resourceToken'))))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "10130140641403709188"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "apimSubnetName": {
              "type": "string"
            },
            "apimNsgName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "privateEndpointNsgName": {
              "type": "string"
            },
            "functionAppSubnetName": {
              "type": "string"
            },
            "functionAppNsgName": {
              "type": "string"
            },
            "apimRouteTableName": {
              "type": "string"
            },
            "privateDnsZoneNames": {
              "type": "array"
            },
            "vnetAddressPrefix": {
              "type": "string"
            },
            "apimSubnetAddressPrefix": {
              "type": "string"
            },
            "privateEndpointSubnetAddressPrefix": {
              "type": "string"
            },
            "functionAppSubnetAddressPrefix": {
              "type": "string"
            },
            "isAPIMV2SKU": {
              "type": "bool"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "enableServiceEndpointsForAPIM": {
              "type": "bool",
              "defaultValue": true
            }
          },
          "resources": [
            {
              "type": "Microsoft.Network/networkSecurityGroups",
              "apiVersion": "2020-07-01",
              "name": "[parameters('apimNsgName')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('apimNsgName')))]",
              "properties": {
                "securityRules": [
                  {
                    "name": "AllowPublicAccess",
                    "properties": {
                      "protocol": "Tcp",
                      "sourcePortRange": "*",
                      "destinationPortRange": "443",
                      "sourceAddressPrefix": "Internet",
                      "destinationAddressPrefix": "VirtualNetwork",
                      "access": "Allow",
                      "priority": 3000,
                      "direction": "Inbound"
                    }
                  },
                  {
                    "name": "AllowAPIMManagement",
                    "properties": {
                      "protocol": "Tcp",
                      "sourcePortRange": "*",
                      "destinationPortRange": "3443",
                      "sourceAddressPrefix": "ApiManagement",
                      "destinationAddressPrefix": "VirtualNetwork",
                      "access": "Allow",
                      "priority": 3010,
                      "direction": "Inbound"
                    }
                  },
                  {
                    "name": "AllowAPIMLoadBalancer",
                    "properties": {
                      "protocol": "*",
                      "sourcePortRange": "*",
                      "destinationPortRange": "6390",
                      "sourceAddressPrefix": "AzureLoadBalancer",
                      "destinationAddressPrefix": "VirtualNetwork",
                      "access": "Allow",
                      "priority": 3020,
                      "direction": "Inbound"
                    }
                  },
                  {
                    "name": "AllowAzureTrafficManager",
                    "properties": {
                      "protocol": "Tcp",
                      "sourcePortRange": "*",
                      "destinationPortRange": "443",
                      "sourceAddressPrefix": "AzureTrafficManager",
                      "destinationAddressPrefix": "VirtualNetwork",
                      "access": "Allow",
                      "priority": 3030,
                      "direction": "Inbound"
                    }
                  },
                  {
                    "name": "AllowStorage",
                    "properties": {
                      "protocol": "Tcp",
                      "sourcePortRange": "*",
                      "destinationPortRange": "443",
                      "sourceAddressPrefix": "VirtualNetwork",
                      "destinationAddressPrefix": "Storage",
                      "access": "Allow",
                      "priority": 3000,
                      "direction": "Outbound"
                    }
                  },
                  {
                    "name": "AllowSql",
                    "properties": {
                      "protocol": "Tcp",
                      "sourcePortRange": "*",
                      "destinationPortRange": "1433",
                      "sourceAddressPrefix": "VirtualNetwork",
                      "destinationAddressPrefix": "Sql",
                      "access": "Allow",
                      "priority": 3010,
                      "direction": "Outbound"
                    }
                  },
                  {
                    "name": "AllowKeyVault",
                    "properties": {
                      "protocol": "Tcp",
                      "sourcePortRange": "*",
                      "destinationPortRange": "443",
                      "sourceAddressPrefix": "VirtualNetwork",
                      "destinationAddressPrefix": "AzureKeyVault",
                      "access": "Allow",
                      "priority": 3020,
                      "direction": "Outbound"
                    }
                  },
                  {
                    "name": "AllowMonitor",
                    "properties": {
                      "protocol": "Tcp",
                      "sourcePortRange": "*",
                      "destinationPortRanges": [
                        "1886",
                        "443"
                      ],
                      "sourceAddressPrefix": "VirtualNetwork",
                      "destinationAddressPrefix": "AzureMonitor",
                      "access": "Allow",
                      "priority": 3030,
                      "direction": "Outbound"
                    }
                  }
                ]
              }
            },
            {
              "type": "Microsoft.Network/networkSecurityGroups",
              "apiVersion": "2020-07-01",
              "name": "[parameters('privateEndpointNsgName')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('privateEndpointNsgName')))]",
              "properties": {
                "securityRules": []
              }
            },
            {
              "type": "Microsoft.Network/networkSecurityGroups",
              "apiVersion": "2020-07-01",
              "name": "[parameters('functionAppNsgName')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('functionAppNsgName')))]",
              "properties": {
                "securityRules": []
              }
            },
            {
              "type": "Microsoft.Network/routeTables",
              "apiVersion": "2023-11-01",
              "name": "[parameters('apimRouteTableName')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('apimRouteTableName')))]",
              "properties": {
                "routes": [
                  {
                    "name": "apim-management",
                    "properties": {
                      "addressPrefix": "ApiManagement",
                      "nextHopType": "Internet"
                    }
                  }
                ]
              }
            },
            {
              "type": "Microsoft.Network/virtualNetworks",
              "apiVersion": "2019-11-01",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "properties": {
                "addressSpace": {
                  "addressPrefixes": [
                    "[parameters('vnetAddressPrefix')]"
                  ]
                },
                "subnets": [
                  {
                    "name": "[parameters('apimSubnetName')]",
                    "properties": {
                      "addressPrefix": "[parameters('apimSubnetAddressPrefix')]",
                      "networkSecurityGroup": "[if(equals(resourceId('Microsoft.Network/networkSecurityGroups', parameters('apimNsgName')), ''), null(), createObject('id', resourceId('Microsoft.Network/networkSecurityGroups', parameters('apimNsgName'))))]",
                      "routeTable": {
                        "id": "[resourceId('Microsoft.Network/routeTables', parameters('apimRouteTableName'))]"
                      },
                      "serviceEndpoints": "[if(parameters('enableServiceEndpointsForAPIM'), createArray(createObject('service', 'Microsoft.AzureActiveDirectory'), createObject('service', 'Microsoft.EventHub'), createObject('service', 'Microsoft.KeyVault'), createObject('service', 'Microsoft.ServiceBus'), createObject('service', 'Microsoft.Sql'), createObject('service', 'Microsoft.Storage')), createArray())]",
                      "privateEndpointNetworkPolicies": "Enabled",
                      "privateLinkServiceNetworkPolicies": "Enabled",
                      "delegations": "[if(parameters('isAPIMV2SKU'), createArray(createObject('name', 'Microsoft.Web/serverFarms', 'properties', createObject('serviceName', 'Microsoft.Web/serverFarms'))), createArray())]"
                    }
                  },
                  {
                    "name": "[parameters('privateEndpointSubnetName')]",
                    "properties": {
                      "addressPrefix": "[parameters('privateEndpointSubnetAddressPrefix')]",
                      "networkSecurityGroup": "[if(equals(resourceId('Microsoft.Network/networkSecurityGroups', parameters('privateEndpointNsgName')), ''), null(), createObject('id', resourceId('Microsoft.Network/networkSecurityGroups', parameters('privateEndpointNsgName'))))]",
                      "privateEndpointNetworkPolicies": "Disabled",
                      "privateLinkServiceNetworkPolicies": "Enabled"
                    }
                  },
                  {
                    "name": "[parameters('functionAppSubnetName')]",
                    "properties": {
                      "addressPrefix": "[parameters('functionAppSubnetAddressPrefix')]",
                      "networkSecurityGroup": "[if(equals(resourceId('Microsoft.Network/networkSecurityGroups', parameters('functionAppNsgName')), ''), null(), createObject('id', resourceId('Microsoft.Network/networkSecurityGroups', parameters('functionAppNsgName'))))]",
                      "privateEndpointNetworkPolicies": "Enabled",
                      "privateLinkServiceNetworkPolicies": "Enabled",
                      "delegations": [
                        {
                          "name": "Microsoft.Web/serverFarms",
                          "properties": {
                            "serviceName": "Microsoft.Web/serverFarms"
                          }
                        }
                      ]
                    }
                  }
                ]
              },
              "dependsOn": [
                "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('apimNsgName'))]",
                "[resourceId('Microsoft.Network/routeTables', parameters('apimRouteTableName'))]",
                "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('functionAppNsgName'))]",
                "[resourceId('Microsoft.Network/networkSecurityGroups', parameters('privateEndpointNsgName'))]"
              ]
            },
            {
              "copy": {
                "name": "privateDnsZoneLink",
                "count": "[length(parameters('privateDnsZoneNames'))]"
              },
              "type": "Microsoft.Network/privateDnsZones/virtualNetworkLinks",
              "apiVersion": "2020-06-01",
              "name": "[format('{0}/privateDnsZoneLink', parameters('privateDnsZoneNames')[copyIndex()])]",
              "location": "global",
              "properties": {
                "virtualNetwork": {
                  "id": "[resourceId('Microsoft.Network/virtualNetworks', parameters('name'))]"
                },
                "registrationEnabled": false
              },
              "dependsOn": [
                "[resourceId('Microsoft.Network/virtualNetworks', parameters('name'))]"
              ]
            }
          ],
          "outputs": {
            "virtualNetworkId": {
              "type": "string",
              "value": "[resourceId('Microsoft.Network/virtualNetworks', parameters('name'))]"
            },
            "vnetName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "apimSubnetName": {
              "type": "string",
              "value": "[parameters('apimSubnetName')]"
            },
            "apimSubnetId": {
              "type": "string",
              "value": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('name'), parameters('apimSubnetName'))]"
            },
            "privateEndpointSubnetName": {
              "type": "string",
              "value": "[parameters('privateEndpointSubnetName')]"
            },
            "privateEndpointSubnetId": {
              "type": "string",
              "value": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('name'), parameters('privateEndpointSubnetName'))]"
            },
            "functionAppSubnetName": {
              "type": "string",
              "value": "[parameters('functionAppSubnetName')]"
            },
            "functionAppSubnetId": {
              "type": "string",
              "value": "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('name'), parameters('functionAppSubnetName'))]"
            },
            "location": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Network/virtualNetworks', parameters('name')), '2019-11-01', 'full').location]"
            },
            "vnetRG": {
              "type": "string",
              "value": "[resourceGroup().name]"
            }
          }
        }
      },
      "dependsOn": [
        "dnsDeployment",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]"
      ]
    },
    {
      "condition": "[parameters('useExistingVnet')]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "vnetExisting",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": {
            "value": "[parameters('vnetName')]"
          },
          "apimSubnetName": "[if(not(empty(parameters('apimSubnetName'))), createObject('value', parameters('apimSubnetName')), createObject('value', 'snet-apim'))]",
          "privateEndpointSubnetName": "[if(not(empty(parameters('privateEndpointSubnetName'))), createObject('value', parameters('privateEndpointSubnetName')), createObject('value', 'snet-private-endpoint'))]",
          "functionAppSubnetName": "[if(not(empty(parameters('functionAppSubnetName'))), createObject('value', parameters('functionAppSubnetName')), createObject('value', 'snet-functionapp'))]",
          "vnetRG": {
            "value": "[parameters('existingVnetRG')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "15934099452249957660"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "vnetRG": {
              "type": "string"
            },
            "apimSubnetName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "functionAppSubnetName": {
              "type": "string"
            }
          },
          "resources": [],
          "outputs": {
            "virtualNetworkId": {
              "type": "string",
              "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name'))]"
            },
            "vnetName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "apimSubnetName": {
              "type": "string",
              "value": "[parameters('apimSubnetName')]"
            },
            "apimSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('apimSubnetName'))]"
            },
            "privateEndpointSubnetName": {
              "type": "string",
              "value": "[parameters('privateEndpointSubnetName')]"
            },
            "privateEndpointSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('privateEndpointSubnetName'))]"
            },
            "functionAppSubnetName": {
              "type": "string",
              "value": "[parameters('functionAppSubnetName')]"
            },
            "functionAppSubnetId": {
              "type": "string",
              "value": "[format('{0}/subnets/{1}', extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), parameters('functionAppSubnetName'))]"
            },
            "location": {
              "type": "string",
              "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vnetRG')), 'Microsoft.Network/virtualNetworks', parameters('name')), '2019-11-01', 'full').location]"
            },
            "vnetRG": {
              "type": "string",
              "value": "[parameters('vnetRG')]"
            }
          }
        }
      },
      "dependsOn": [
        "dnsDeployment",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]"
      ]
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "apim-managed-identity",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('identityName'))), createObject('value', parameters('identityName')), createObject('value', format('{0}apim-{1}', variables('abbrs').managedIdentityUserAssignedIdentities, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "11427205026053764321"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            }
          },
          "variables": {
            "cognitiveServicesOpenAIUserRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', '5e0bd9bd-7b93-4f28-af87-19fc36ad61bd')]",
            "cognitiveServicesUserRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', 'a97b65f3-24c7-4388-baec-2e87135dc908')]",
            "eventHubsDataSenderRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', '2b629674-e913-4c01-ae53-ef4638d8f975')]"
          },
          "resources": [
            {
              "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
              "apiVersion": "2018-11-30",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]"
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), variables('cognitiveServicesUserRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('cognitiveServicesUserRoleDefinitionId')]",
                "principalId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), '2018-11-30').principalId]",
                "principalType": "ServicePrincipal"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), variables('cognitiveServicesOpenAIUserRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('cognitiveServicesOpenAIUserRoleDefinitionId')]",
                "principalId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), '2018-11-30').principalId]",
                "principalType": "ServicePrincipal"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), variables('eventHubsDataSenderRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('eventHubsDataSenderRoleDefinitionId')]",
                "principalId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), '2018-11-30').principalId]",
                "principalType": "ServicePrincipal"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name'))]"
              ]
            }
          ],
          "outputs": {
            "managedIdentityName": {
              "type": "string",
              "value": "[parameters('name')]"
            }
          }
        }
      },
      "dependsOn": [
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]"
      ]
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "usage-managed-identity",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('identityName'))), createObject('value', parameters('identityName')), createObject('value', format('{0}usage-{1}', variables('abbrs').managedIdentityUserAssignedIdentities, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "cosmosDbAccountName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db'), '2025-04-01').outputs.cosmosDbAccountName.value]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "4251787061900522236"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "cosmosDbAccountName": {
              "type": "string"
            }
          },
          "variables": {
            "docDbAccNativeContributorRoleDefinitionId": "00000000-0000-0000-0000-000000000002",
            "eventHubsDataOwnerRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', 'f526a384-b230-433a-b45c-95f59c4a2dec')]"
          },
          "resources": [
            {
              "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
              "apiVersion": "2018-11-30",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]"
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlRoleAssignments",
              "apiVersion": "2023-04-15",
              "name": "[format('{0}/{1}', parameters('cosmosDbAccountName'), guid(variables('docDbAccNativeContributorRoleDefinitionId'), resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName'))))]",
              "properties": {
                "principalId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), '2018-11-30').principalId]",
                "roleDefinitionId": "[format('/{0}/sqlRoleDefinitions/{1}', resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName')), variables('docDbAccNativeContributorRoleDefinitionId'))]",
                "scope": "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName'))]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), variables('eventHubsDataOwnerRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('eventHubsDataOwnerRoleDefinitionId')]",
                "principalId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name')), '2018-11-30').principalId]",
                "principalType": "ServicePrincipal"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('name'))]"
              ]
            }
          ],
          "outputs": {
            "managedIdentityName": {
              "type": "string",
              "value": "[parameters('name')]"
            }
          }
        }
      },
      "dependsOn": [
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db')]",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]"
      ]
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "monitoring",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "logAnalyticsName": "[if(not(empty(parameters('logAnalyticsName'))), createObject('value', parameters('logAnalyticsName')), createObject('value', format('{0}{1}', variables('abbrs').operationalInsightsWorkspaces, variables('resourceToken'))))]",
          "apimApplicationInsightsName": "[if(not(empty(parameters('applicationInsightsName'))), createObject('value', parameters('applicationInsightsName')), createObject('value', format('{0}apim-{1}', variables('abbrs').insightsComponents, variables('resourceToken'))))]",
          "apimApplicationInsightsDashboardName": "[if(not(empty(parameters('applicationInsightsDashboardName'))), createObject('value', parameters('applicationInsightsDashboardName')), createObject('value', format('{0}apim-{1}', variables('abbrs').portalDashboards, variables('resourceToken'))))]",
          "functionApplicationInsightsName": "[if(not(empty(parameters('funcApplicationInsightsName'))), createObject('value', parameters('funcApplicationInsightsName')), createObject('value', format('{0}func-{1}', variables('abbrs').insightsComponents, variables('resourceToken'))))]",
          "functionApplicationInsightsDashboardName": "[if(not(empty(parameters('funcAplicationInsightsDashboardName'))), createObject('value', parameters('funcAplicationInsightsDashboardName')), createObject('value', format('{0}func-{1}', variables('abbrs').portalDashboards, variables('resourceToken'))))]",
          "vNetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetName.value))]",
          "vNetRG": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetRG.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetRG.value))]",
          "privateEndpointSubnetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.privateEndpointSubnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.privateEndpointSubnetName.value))]",
          "applicationInsightsDnsZoneName": {
            "value": "[variables('monitorPrivateDnsZoneName')]"
          },
          "createDashboard": {
            "value": "[parameters('createAppInsightsDashboard')]"
          },
          "dnsZoneRG": "[if(not(parameters('useExistingVnet')), createObject('value', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), createObject('value', parameters('dnsZoneRG')))]",
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]",
          "usePrivateLinkScope": {
            "value": "[parameters('useAzureMonitorPrivateLinkScope')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "4020378498437004423"
            }
          },
          "parameters": {
            "logAnalyticsName": {
              "type": "string"
            },
            "apimApplicationInsightsName": {
              "type": "string"
            },
            "apimApplicationInsightsDashboardName": {
              "type": "string"
            },
            "functionApplicationInsightsName": {
              "type": "string"
            },
            "functionApplicationInsightsDashboardName": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "createDashboard": {
              "type": "bool"
            },
            "usePrivateLinkScope": {
              "type": "bool",
              "defaultValue": true
            },
            "vNetName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "applicationInsightsDnsZoneName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            }
          },
          "variables": {
            "privateLinkScopeName": "ampls-monitoring"
          },
          "resources": [
            {
              "condition": "[parameters('usePrivateLinkScope')]",
              "type": "microsoft.insights/privateLinkScopes",
              "apiVersion": "2021-07-01-preview",
              "name": "[variables('privateLinkScopeName')]",
              "location": "global",
              "properties": {
                "accessModeSettings": {
                  "ingestionAccessMode": "Open",
                  "queryAccessMode": "Open"
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "log-analytics",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "name": {
                    "value": "[parameters('logAnalyticsName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "tags": {
                    "value": "[parameters('tags')]"
                  },
                  "privateLinkScopeName": "[if(parameters('usePrivateLinkScope'), createObject('value', variables('privateLinkScopeName')), createObject('value', ''))]"
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "14585681518257859503"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]"
                    },
                    "tags": {
                      "type": "object",
                      "defaultValue": {}
                    },
                    "privateLinkScopeName": {
                      "type": "string"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.OperationalInsights/workspaces",
                      "apiVersion": "2021-12-01-preview",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
                      "properties": {
                        "retentionInDays": 30,
                        "features": {
                          "searchVersion": 1
                        },
                        "sku": {
                          "name": "PerGB2018"
                        },
                        "publicNetworkAccessForIngestion": "[if(not(equals(parameters('privateLinkScopeName'), '')), 'Disabled', 'Enabled')]",
                        "publicNetworkAccessForQuery": "[if(not(equals(parameters('privateLinkScopeName'), '')), 'Enabled', 'Enabled')]"
                      }
                    },
                    {
                      "condition": "[not(equals(parameters('privateLinkScopeName'), ''))]",
                      "type": "Microsoft.Insights/privateLinkScopes/scopedResources",
                      "apiVersion": "2021-07-01-preview",
                      "name": "[format('{0}/{1}', parameters('privateLinkScopeName'), format('{0}-connection', parameters('name')))]",
                      "properties": {
                        "linkedResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('name'))]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[resourceId('Microsoft.OperationalInsights/workspaces', parameters('name'))]"
                    },
                    "name": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "application-insights",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "name": {
                    "value": "[parameters('apimApplicationInsightsName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "tags": {
                    "value": "[parameters('tags')]"
                  },
                  "dashboardName": {
                    "value": "[parameters('apimApplicationInsightsDashboardName')]"
                  },
                  "logAnalyticsWorkspaceId": {
                    "value": "[reference(resourceId('Microsoft.Resources/deployments', 'log-analytics'), '2025-04-01').outputs.id.value]"
                  },
                  "privateLinkScopeName": "[if(parameters('usePrivateLinkScope'), createObject('value', variables('privateLinkScopeName')), createObject('value', ''))]",
                  "createDashboard": {
                    "value": "[parameters('createDashboard')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "17030468979445812209"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "dashboardName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]"
                    },
                    "tags": {
                      "type": "object",
                      "defaultValue": {}
                    },
                    "logAnalyticsWorkspaceId": {
                      "type": "string"
                    },
                    "createDashboard": {
                      "type": "bool"
                    },
                    "privateLinkScopeName": {
                      "type": "string"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Insights/components",
                      "apiVersion": "2020-02-02",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
                      "kind": "web",
                      "properties": {
                        "Application_Type": "web",
                        "WorkspaceResourceId": "[parameters('logAnalyticsWorkspaceId')]",
                        "publicNetworkAccessForIngestion": "[if(not(equals(parameters('privateLinkScopeName'), '')), 'Disabled', 'Enabled')]",
                        "publicNetworkAccessForQuery": "[if(not(equals(parameters('privateLinkScopeName'), '')), 'Enabled', 'Enabled')]",
                        "CustomMetricsOptedInType": "WithDimensions"
                      }
                    },
                    {
                      "condition": "[not(equals(parameters('privateLinkScopeName'), ''))]",
                      "type": "Microsoft.Insights/privateLinkScopes/scopedResources",
                      "apiVersion": "2021-07-01-preview",
                      "name": "[format('{0}/{1}', parameters('privateLinkScopeName'), format('{0}-connection', parameters('name')))]",
                      "properties": {
                        "linkedResourceId": "[resourceId('Microsoft.Insights/components', parameters('name'))]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Insights/components', parameters('name'))]"
                      ]
                    },
                    {
                      "condition": "[parameters('createDashboard')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "application-insights-dashboard",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[parameters('dashboardName')]"
                          },
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "applicationInsightsName": {
                            "value": "[parameters('name')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.38.33.27573",
                              "templateHash": "16038805693566858573"
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string"
                            },
                            "applicationInsightsName": {
                              "type": "string"
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]"
                            },
                            "tags": {
                              "type": "object",
                              "defaultValue": {}
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Portal/dashboards",
                              "apiVersion": "2020-09-01-preview",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "lenses": [
                                  {
                                    "order": 0,
                                    "parts": [
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 0,
                                          "colSpan": 2,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "id",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/AspNetOverviewPinnedPart",
                                          "asset": {
                                            "idInputName": "id",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "overview"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 2,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/ProactiveDetectionAsyncPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "ProactiveDetection"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 3,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "ResourceId",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/QuickPulseButtonSmallPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "endTime": null,
                                                "createdTime": "2018-05-04T01:20:33.345Z",
                                                "isInitialTime": true,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/AvailabilityNavButtonPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 5,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "endTime": null,
                                                "createdTime": "2018-05-08T18:47:35.237Z",
                                                "isInitialTime": true,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            },
                                            {
                                              "name": "ConfigurationId",
                                              "value": "78ce933e-e864-4b05-a27b-71fd55a6afad"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/AppMapButtonPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Usage",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 3,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "endTime": null,
                                                "createdTime": "2018-05-04T01:22:35.782Z",
                                                "isInitialTime": true,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/UsageUsersOverviewPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Reliability",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 7,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ResourceId",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            },
                                            {
                                              "name": "DataModel",
                                              "value": {
                                                "version": "1.0.0",
                                                "timeContext": {
                                                  "durationMs": 86400000,
                                                  "createdTime": "2018-05-04T23:42:40.072Z",
                                                  "isInitialTime": false,
                                                  "grain": 1,
                                                  "useDashboardTimeRange": false
                                                }
                                              },
                                              "isOptional": true
                                            },
                                            {
                                              "name": "ConfigurationId",
                                              "value": "8a02f7bf-ac0f-40e1-afe9-f0e72cfee77f",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/CuratedBladeFailuresPinnedPart",
                                          "isAdapter": true,
                                          "asset": {
                                            "idInputName": "ResourceId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "failures"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Responsiveness\r\n",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 11,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ResourceId",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            },
                                            {
                                              "name": "DataModel",
                                              "value": {
                                                "version": "1.0.0",
                                                "timeContext": {
                                                  "durationMs": 86400000,
                                                  "createdTime": "2018-05-04T23:43:37.804Z",
                                                  "isInitialTime": false,
                                                  "grain": 1,
                                                  "useDashboardTimeRange": false
                                                }
                                              },
                                              "isOptional": true
                                            },
                                            {
                                              "name": "ConfigurationId",
                                              "value": "2a8ede4f-2bee-4b9c-aed9-2db0e8a01865",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/CuratedBladePerformancePinnedPart",
                                          "isAdapter": true,
                                          "asset": {
                                            "idInputName": "ResourceId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "performance"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 12,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Browser",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 15,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "MetricsExplorerJsonDefinitionId",
                                              "value": "BrowserPerformanceTimelineMetrics"
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "createdTime": "2018-05-08T12:16:27.534Z",
                                                "isInitialTime": false,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            },
                                            {
                                              "name": "CurrentFilter",
                                              "value": {
                                                "eventTypes": [
                                                  4,
                                                  1,
                                                  3,
                                                  5,
                                                  2,
                                                  6,
                                                  13
                                                ],
                                                "typeFacets": {},
                                                "isPermissive": false
                                              }
                                            },
                                            {
                                              "name": "id",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/MetricsExplorerBladePinnedPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "browser"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "sessions/count",
                                                      "aggregationType": 5,
                                                      "namespace": "microsoft.insights/components/kusto",
                                                      "metricVisualization": {
                                                        "displayName": "Sessions",
                                                        "color": "#47BDF5"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "users/count",
                                                      "aggregationType": 5,
                                                      "namespace": "microsoft.insights/components/kusto",
                                                      "metricVisualization": {
                                                        "displayName": "Users",
                                                        "color": "#7E58FF"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Unique sessions and users",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "segmentationUsers"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "requests/failed",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Failed requests",
                                                        "color": "#EC008C"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Failed requests",
                                                  "visualization": {
                                                    "chartType": 3,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "failures"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "requests/duration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Server response time",
                                                        "color": "#00BCF2"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Server response time",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "performance"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 12,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/networkDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Page load network connect time",
                                                        "color": "#7E58FF"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/processingDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Client processing time",
                                                        "color": "#44F1C8"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/sendDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Send request time",
                                                        "color": "#EB9371"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/receiveDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Receiving response time",
                                                        "color": "#0672F1"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average page load time breakdown",
                                                  "visualization": {
                                                    "chartType": 3,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "availabilityResults/availabilityPercentage",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Availability",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average availability",
                                                  "visualization": {
                                                    "chartType": 3,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "availability"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "exceptions/server",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Server exceptions",
                                                        "color": "#47BDF5"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "dependencies/failed",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Dependency failures",
                                                        "color": "#7E58FF"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Server exceptions and Dependency failures",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/processorCpuPercentage",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Processor time",
                                                        "color": "#47BDF5"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/processCpuPercentage",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Process CPU",
                                                        "color": "#7E58FF"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average processor and process CPU utilization",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 12,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "exceptions/browser",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Browser exceptions",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Browser exceptions",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 8,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "availabilityResults/count",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Availability test results count",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Availability test results count",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 8,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/processIOBytesPerSecond",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Process IO rate",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average process I/O rate",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 8,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/memoryAvailableBytes",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Available memory",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average available memory",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      }
                                    ]
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Insights/components', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "connectionString": {
                      "type": "string",
                      "value": "[reference(resourceId('Microsoft.Insights/components', parameters('name')), '2020-02-02').ConnectionString]"
                    },
                    "instrumentationKey": {
                      "type": "string",
                      "value": "[reference(resourceId('Microsoft.Insights/components', parameters('name')), '2020-02-02').InstrumentationKey]"
                    },
                    "name": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'log-analytics')]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "func-application-insights",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "name": {
                    "value": "[parameters('functionApplicationInsightsName')]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "tags": {
                    "value": "[parameters('tags')]"
                  },
                  "dashboardName": {
                    "value": "[parameters('functionApplicationInsightsDashboardName')]"
                  },
                  "logAnalyticsWorkspaceId": {
                    "value": "[reference(resourceId('Microsoft.Resources/deployments', 'log-analytics'), '2025-04-01').outputs.id.value]"
                  },
                  "privateLinkScopeName": "[if(parameters('usePrivateLinkScope'), createObject('value', variables('privateLinkScopeName')), createObject('value', ''))]",
                  "createDashboard": {
                    "value": "[parameters('createDashboard')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "17030468979445812209"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "dashboardName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]"
                    },
                    "tags": {
                      "type": "object",
                      "defaultValue": {}
                    },
                    "logAnalyticsWorkspaceId": {
                      "type": "string"
                    },
                    "createDashboard": {
                      "type": "bool"
                    },
                    "privateLinkScopeName": {
                      "type": "string"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Insights/components",
                      "apiVersion": "2020-02-02",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
                      "kind": "web",
                      "properties": {
                        "Application_Type": "web",
                        "WorkspaceResourceId": "[parameters('logAnalyticsWorkspaceId')]",
                        "publicNetworkAccessForIngestion": "[if(not(equals(parameters('privateLinkScopeName'), '')), 'Disabled', 'Enabled')]",
                        "publicNetworkAccessForQuery": "[if(not(equals(parameters('privateLinkScopeName'), '')), 'Enabled', 'Enabled')]",
                        "CustomMetricsOptedInType": "WithDimensions"
                      }
                    },
                    {
                      "condition": "[not(equals(parameters('privateLinkScopeName'), ''))]",
                      "type": "Microsoft.Insights/privateLinkScopes/scopedResources",
                      "apiVersion": "2021-07-01-preview",
                      "name": "[format('{0}/{1}', parameters('privateLinkScopeName'), format('{0}-connection', parameters('name')))]",
                      "properties": {
                        "linkedResourceId": "[resourceId('Microsoft.Insights/components', parameters('name'))]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Insights/components', parameters('name'))]"
                      ]
                    },
                    {
                      "condition": "[parameters('createDashboard')]",
                      "type": "Microsoft.Resources/deployments",
                      "apiVersion": "2025-04-01",
                      "name": "application-insights-dashboard",
                      "properties": {
                        "expressionEvaluationOptions": {
                          "scope": "inner"
                        },
                        "mode": "Incremental",
                        "parameters": {
                          "name": {
                            "value": "[parameters('dashboardName')]"
                          },
                          "location": {
                            "value": "[parameters('location')]"
                          },
                          "applicationInsightsName": {
                            "value": "[parameters('name')]"
                          }
                        },
                        "template": {
                          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                          "contentVersion": "1.0.0.0",
                          "metadata": {
                            "_generator": {
                              "name": "bicep",
                              "version": "0.38.33.27573",
                              "templateHash": "16038805693566858573"
                            }
                          },
                          "parameters": {
                            "name": {
                              "type": "string"
                            },
                            "applicationInsightsName": {
                              "type": "string"
                            },
                            "location": {
                              "type": "string",
                              "defaultValue": "[resourceGroup().location]"
                            },
                            "tags": {
                              "type": "object",
                              "defaultValue": {}
                            }
                          },
                          "resources": [
                            {
                              "type": "Microsoft.Portal/dashboards",
                              "apiVersion": "2020-09-01-preview",
                              "name": "[parameters('name')]",
                              "location": "[parameters('location')]",
                              "tags": "[parameters('tags')]",
                              "properties": {
                                "lenses": [
                                  {
                                    "order": 0,
                                    "parts": [
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 0,
                                          "colSpan": 2,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "id",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/AspNetOverviewPinnedPart",
                                          "asset": {
                                            "idInputName": "id",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "overview"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 2,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/ProactiveDetectionAsyncPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "ProactiveDetection"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 3,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "ResourceId",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/QuickPulseButtonSmallPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "endTime": null,
                                                "createdTime": "2018-05-04T01:20:33.345Z",
                                                "isInitialTime": true,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/AvailabilityNavButtonPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 5,
                                          "y": 0,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "endTime": null,
                                                "createdTime": "2018-05-08T18:47:35.237Z",
                                                "isInitialTime": true,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            },
                                            {
                                              "name": "ConfigurationId",
                                              "value": "78ce933e-e864-4b05-a27b-71fd55a6afad"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/AppMapButtonPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Usage",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 3,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "endTime": null,
                                                "createdTime": "2018-05-04T01:22:35.782Z",
                                                "isInitialTime": true,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/UsageUsersOverviewPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Reliability",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 7,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ResourceId",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            },
                                            {
                                              "name": "DataModel",
                                              "value": {
                                                "version": "1.0.0",
                                                "timeContext": {
                                                  "durationMs": 86400000,
                                                  "createdTime": "2018-05-04T23:42:40.072Z",
                                                  "isInitialTime": false,
                                                  "grain": 1,
                                                  "useDashboardTimeRange": false
                                                }
                                              },
                                              "isOptional": true
                                            },
                                            {
                                              "name": "ConfigurationId",
                                              "value": "8a02f7bf-ac0f-40e1-afe9-f0e72cfee77f",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/CuratedBladeFailuresPinnedPart",
                                          "isAdapter": true,
                                          "asset": {
                                            "idInputName": "ResourceId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "failures"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Responsiveness\r\n",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 11,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ResourceId",
                                              "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                            },
                                            {
                                              "name": "DataModel",
                                              "value": {
                                                "version": "1.0.0",
                                                "timeContext": {
                                                  "durationMs": 86400000,
                                                  "createdTime": "2018-05-04T23:43:37.804Z",
                                                  "isInitialTime": false,
                                                  "grain": 1,
                                                  "useDashboardTimeRange": false
                                                }
                                              },
                                              "isOptional": true
                                            },
                                            {
                                              "name": "ConfigurationId",
                                              "value": "2a8ede4f-2bee-4b9c-aed9-2db0e8a01865",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/CuratedBladePerformancePinnedPart",
                                          "isAdapter": true,
                                          "asset": {
                                            "idInputName": "ResourceId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "performance"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 12,
                                          "y": 1,
                                          "colSpan": 3,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [],
                                          "type": "Extension/HubsExtension/PartType/MarkdownPart",
                                          "settings": {
                                            "content": {
                                              "settings": {
                                                "content": "# Browser",
                                                "title": "",
                                                "subtitle": ""
                                              }
                                            }
                                          }
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 15,
                                          "y": 1,
                                          "colSpan": 1,
                                          "rowSpan": 1
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "ComponentId",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "MetricsExplorerJsonDefinitionId",
                                              "value": "BrowserPerformanceTimelineMetrics"
                                            },
                                            {
                                              "name": "TimeContext",
                                              "value": {
                                                "durationMs": 86400000,
                                                "createdTime": "2018-05-08T12:16:27.534Z",
                                                "isInitialTime": false,
                                                "grain": 1,
                                                "useDashboardTimeRange": false
                                              }
                                            },
                                            {
                                              "name": "CurrentFilter",
                                              "value": {
                                                "eventTypes": [
                                                  4,
                                                  1,
                                                  3,
                                                  5,
                                                  2,
                                                  6,
                                                  13
                                                ],
                                                "typeFacets": {},
                                                "isPermissive": false
                                              }
                                            },
                                            {
                                              "name": "id",
                                              "value": {
                                                "Name": "[parameters('applicationInsightsName')]",
                                                "SubscriptionId": "[subscription().subscriptionId]",
                                                "ResourceGroup": "[resourceGroup().name]"
                                              }
                                            },
                                            {
                                              "name": "Version",
                                              "value": "1.0"
                                            }
                                          ],
                                          "type": "Extension/AppInsightsExtension/PartType/MetricsExplorerBladePinnedPart",
                                          "asset": {
                                            "idInputName": "ComponentId",
                                            "type": "ApplicationInsights"
                                          },
                                          "defaultMenuItemId": "browser"
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "sessions/count",
                                                      "aggregationType": 5,
                                                      "namespace": "microsoft.insights/components/kusto",
                                                      "metricVisualization": {
                                                        "displayName": "Sessions",
                                                        "color": "#47BDF5"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "users/count",
                                                      "aggregationType": 5,
                                                      "namespace": "microsoft.insights/components/kusto",
                                                      "metricVisualization": {
                                                        "displayName": "Users",
                                                        "color": "#7E58FF"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Unique sessions and users",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "segmentationUsers"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "requests/failed",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Failed requests",
                                                        "color": "#EC008C"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Failed requests",
                                                  "visualization": {
                                                    "chartType": 3,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "failures"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "requests/duration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Server response time",
                                                        "color": "#00BCF2"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Server response time",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "performance"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 12,
                                          "y": 2,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/networkDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Page load network connect time",
                                                        "color": "#7E58FF"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/processingDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Client processing time",
                                                        "color": "#44F1C8"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/sendDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Send request time",
                                                        "color": "#EB9371"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "browserTimings/receiveDuration",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Receiving response time",
                                                        "color": "#0672F1"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average page load time breakdown",
                                                  "visualization": {
                                                    "chartType": 3,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "availabilityResults/availabilityPercentage",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Availability",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average availability",
                                                  "visualization": {
                                                    "chartType": 3,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  },
                                                  "openBladeOnClick": {
                                                    "openBlade": true,
                                                    "destinationBlade": {
                                                      "extensionName": "HubsExtension",
                                                      "bladeName": "ResourceMenuBlade",
                                                      "parameters": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]",
                                                        "menuid": "availability"
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "exceptions/server",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Server exceptions",
                                                        "color": "#47BDF5"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "dependencies/failed",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Dependency failures",
                                                        "color": "#7E58FF"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Server exceptions and Dependency failures",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/processorCpuPercentage",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Processor time",
                                                        "color": "#47BDF5"
                                                      }
                                                    },
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/processCpuPercentage",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Process CPU",
                                                        "color": "#7E58FF"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average processor and process CPU utilization",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 12,
                                          "y": 5,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "exceptions/browser",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Browser exceptions",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Browser exceptions",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 0,
                                          "y": 8,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "availabilityResults/count",
                                                      "aggregationType": 7,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Availability test results count",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Availability test results count",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 4,
                                          "y": 8,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/processIOBytesPerSecond",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Process IO rate",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average process I/O rate",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      },
                                      {
                                        "position": {
                                          "x": 8,
                                          "y": 8,
                                          "colSpan": 4,
                                          "rowSpan": 3
                                        },
                                        "metadata": {
                                          "inputs": [
                                            {
                                              "name": "options",
                                              "value": {
                                                "chart": {
                                                  "metrics": [
                                                    {
                                                      "resourceMetadata": {
                                                        "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, parameters('applicationInsightsName'))]"
                                                      },
                                                      "name": "performanceCounters/memoryAvailableBytes",
                                                      "aggregationType": 4,
                                                      "namespace": "microsoft.insights/components",
                                                      "metricVisualization": {
                                                        "displayName": "Available memory",
                                                        "color": "#47BDF5"
                                                      }
                                                    }
                                                  ],
                                                  "title": "Average available memory",
                                                  "visualization": {
                                                    "chartType": 2,
                                                    "legendVisualization": {
                                                      "isVisible": true,
                                                      "position": 2,
                                                      "hideSubtitle": false
                                                    },
                                                    "axisVisualization": {
                                                      "x": {
                                                        "isVisible": true,
                                                        "axisType": 2
                                                      },
                                                      "y": {
                                                        "isVisible": true,
                                                        "axisType": 1
                                                      }
                                                    }
                                                  }
                                                }
                                              }
                                            },
                                            {
                                              "name": "sharedTimeRange",
                                              "isOptional": true
                                            }
                                          ],
                                          "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                                          "settings": {}
                                        }
                                      }
                                    ]
                                  }
                                ]
                              }
                            }
                          ]
                        }
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Insights/components', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "connectionString": {
                      "type": "string",
                      "value": "[reference(resourceId('Microsoft.Insights/components', parameters('name')), '2020-02-02').ConnectionString]"
                    },
                    "instrumentationKey": {
                      "type": "string",
                      "value": "[reference(resourceId('Microsoft.Insights/components', parameters('name')), '2020-02-02').InstrumentationKey]"
                    },
                    "name": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'log-analytics')]"
              ]
            },
            {
              "condition": "[parameters('usePrivateLinkScope')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', variables('privateLinkScopeName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "azuremonitor"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('applicationInsightsDnsZoneName')]"
                  },
                  "name": {
                    "value": "[format('{0}-pe', variables('privateLinkScopeName'))]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('microsoft.insights/privateLinkScopes', variables('privateLinkScopeName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  },
                  "enableDnsIntegration": {
                    "value": "[parameters('usePrivateLinkScope')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'application-insights')]",
                "[resourceId('Microsoft.Resources/deployments', 'func-application-insights')]",
                "[resourceId('Microsoft.Resources/deployments', 'log-analytics')]",
                "[resourceId('microsoft.insights/privateLinkScopes', variables('privateLinkScopeName'))]"
              ]
            }
          ],
          "outputs": {
            "applicationInsightsName": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'application-insights'), '2025-04-01').outputs.name.value]"
            },
            "applicationInsightsConnectionString": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'application-insights'), '2025-04-01').outputs.connectionString.value]"
            },
            "applicationInsightsInstrumentationKey": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'application-insights'), '2025-04-01').outputs.instrumentationKey.value]"
            },
            "funcApplicationInsightsName": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'func-application-insights'), '2025-04-01').outputs.name.value]"
            },
            "funcApplicationInsightsConnectionString": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'func-application-insights'), '2025-04-01').outputs.connectionString.value]"
            },
            "funcApplicationInsightsInstrumentationKey": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'func-application-insights'), '2025-04-01').outputs.instrumentationKey.value]"
            },
            "logAnalyticsWorkspaceId": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'log-analytics'), '2025-04-01').outputs.id.value]"
            },
            "logAnalyticsWorkspaceName": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'log-analytics'), '2025-04-01').outputs.name.value]"
            }
          }
        }
      },
      "dependsOn": [
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    },
    {
      "copy": {
        "name": "openAis",
        "count": "[length(items(parameters('openAiInstances')))]",
        "mode": "serial",
        "batchSize": 1
      },
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "[format('{0}-{1}', items(parameters('openAiInstances'))[copyIndex()].value.name, variables('resourceToken'))]",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": {
            "value": "[format('{0}-{1}', items(parameters('openAiInstances'))[copyIndex()].value.name, variables('resourceToken'))]"
          },
          "location": {
            "value": "[items(parameters('openAiInstances'))[copyIndex()].value.location]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "managedIdentityName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim-managed-identity'), '2025-04-01').outputs.managedIdentityName.value]"
          },
          "vNetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetName.value))]",
          "vNetLocation": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.location.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.location.value))]",
          "privateEndpointSubnetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.privateEndpointSubnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.privateEndpointSubnetName.value))]",
          "aiPrivateEndpointName": "[if(not(empty(parameters('openAiPrivateEndpointName'))), createObject('value', format('{0}-{1}', parameters('openAiPrivateEndpointName'), copyIndex())), createObject('value', format('{0}openai-pe-{1}-{2}', variables('abbrs').cognitiveServicesAccounts, copyIndex(), variables('resourceToken'))))]",
          "publicNetworkAccess": {
            "value": "[parameters('openAIExternalNetworkAccess')]"
          },
          "openAiDnsZoneName": {
            "value": "[variables('openAiPrivateDnsZoneName')]"
          },
          "sku": {
            "value": {
              "name": "[parameters('openAiSkuName')]"
            }
          },
          "deploymentCapacity": {
            "value": "[parameters('deploymentCapacity')]"
          },
          "deployments": {
            "value": "[items(parameters('openAiInstances'))[copyIndex()].value.deployments]"
          },
          "vNetRG": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetRG.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetRG.value))]",
          "dnsZoneRG": "[if(not(parameters('useExistingVnet')), createObject('value', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), createObject('value', parameters('dnsZoneRG')))]",
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "3595356772281439807"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "managedIdentityName": {
              "type": "string",
              "defaultValue": ""
            },
            "deployments": {
              "type": "array",
              "defaultValue": []
            },
            "kind": {
              "type": "string",
              "defaultValue": "OpenAI"
            },
            "sku": {
              "type": "object",
              "defaultValue": {
                "name": "S0"
              }
            },
            "deploymentCapacity": {
              "type": "int",
              "defaultValue": 1
            },
            "publicNetworkAccess": {
              "type": "string",
              "defaultValue": "Disabled"
            },
            "aiPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "vNetLocation": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "openAiDnsZoneName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            }
          },
          "resources": [
            {
              "type": "Microsoft.CognitiveServices/accounts",
              "apiVersion": "2023-05-01",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "kind": "[parameters('kind')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "customSubDomainName": "[toLower(parameters('name'))]",
                "publicNetworkAccess": "[parameters('publicNetworkAccess')]",
                "networkAcls": {
                  "defaultAction": "Deny",
                  "ipRules": [],
                  "virtualNetworkRules": []
                }
              },
              "sku": "[parameters('sku')]"
            },
            {
              "copy": {
                "name": "deployment",
                "count": "[length(parameters('deployments'))]",
                "mode": "serial",
                "batchSize": 1
              },
              "type": "Microsoft.CognitiveServices/accounts/deployments",
              "apiVersion": "2023-05-01",
              "name": "[format('{0}/{1}', parameters('name'), parameters('deployments')[copyIndex()].name)]",
              "properties": {
                "model": "[parameters('deployments')[copyIndex()].model]",
                "raiPolicyName": "[if(contains(parameters('deployments')[copyIndex()], 'raiPolicyName'), parameters('deployments')[copyIndex()].raiPolicyName, null())]"
              },
              "sku": "[if(contains(parameters('deployments')[copyIndex()], 'sku'), parameters('deployments')[copyIndex()].sku, createObject('name', 'Standard', 'capacity', parameters('deploymentCapacity')))]",
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('name'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "account"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('openAiDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('aiPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
                  },
                  "location": {
                    "value": "[parameters('vNetLocation')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]",
                "deployment"
              ]
            }
          ],
          "outputs": {
            "openAiName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "openAiEndpointUri": {
              "type": "string",
              "value": "[format('{0}openai/', reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint)]"
            },
            "aiServiceName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "aiServiceEndpoint": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint]"
            }
          }
        }
      },
      "dependsOn": [
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim-managed-identity')]",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "ai-content-safety",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('aiContentSafetyName'))), createObject('value', parameters('aiContentSafetyName')), createObject('value', format('{0}consafety-{1}', variables('abbrs').cognitiveServicesAccounts, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "kind": {
            "value": "ContentSafety"
          },
          "managedIdentityName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim-managed-identity'), '2025-04-01').outputs.managedIdentityName.value]"
          },
          "vNetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetName.value))]",
          "vNetLocation": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.location.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.location.value))]",
          "privateEndpointSubnetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.privateEndpointSubnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.privateEndpointSubnetName.value))]",
          "aiPrivateEndpointName": "[if(not(empty(parameters('aiContentSafetyPrivateEndpointName'))), createObject('value', parameters('aiContentSafetyPrivateEndpointName')), createObject('value', format('{0}consafety-pe-{1}', variables('abbrs').cognitiveServicesAccounts, variables('resourceToken'))))]",
          "publicNetworkAccess": {
            "value": "[parameters('aiContentSafetyExternalNetworkAccess')]"
          },
          "openAiDnsZoneName": {
            "value": "[variables('aiCogntiveServicesDnsZoneName')]"
          },
          "sku": {
            "value": {
              "name": "[parameters('aiContentSafetySkuName')]"
            }
          },
          "vNetRG": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetRG.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetRG.value))]",
          "dnsZoneRG": "[if(not(parameters('useExistingVnet')), createObject('value', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), createObject('value', parameters('dnsZoneRG')))]",
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "3595356772281439807"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "managedIdentityName": {
              "type": "string",
              "defaultValue": ""
            },
            "deployments": {
              "type": "array",
              "defaultValue": []
            },
            "kind": {
              "type": "string",
              "defaultValue": "OpenAI"
            },
            "sku": {
              "type": "object",
              "defaultValue": {
                "name": "S0"
              }
            },
            "deploymentCapacity": {
              "type": "int",
              "defaultValue": 1
            },
            "publicNetworkAccess": {
              "type": "string",
              "defaultValue": "Disabled"
            },
            "aiPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "vNetLocation": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "openAiDnsZoneName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            }
          },
          "resources": [
            {
              "type": "Microsoft.CognitiveServices/accounts",
              "apiVersion": "2023-05-01",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "kind": "[parameters('kind')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "customSubDomainName": "[toLower(parameters('name'))]",
                "publicNetworkAccess": "[parameters('publicNetworkAccess')]",
                "networkAcls": {
                  "defaultAction": "Deny",
                  "ipRules": [],
                  "virtualNetworkRules": []
                }
              },
              "sku": "[parameters('sku')]"
            },
            {
              "copy": {
                "name": "deployment",
                "count": "[length(parameters('deployments'))]",
                "mode": "serial",
                "batchSize": 1
              },
              "type": "Microsoft.CognitiveServices/accounts/deployments",
              "apiVersion": "2023-05-01",
              "name": "[format('{0}/{1}', parameters('name'), parameters('deployments')[copyIndex()].name)]",
              "properties": {
                "model": "[parameters('deployments')[copyIndex()].model]",
                "raiPolicyName": "[if(contains(parameters('deployments')[copyIndex()], 'raiPolicyName'), parameters('deployments')[copyIndex()].raiPolicyName, null())]"
              },
              "sku": "[if(contains(parameters('deployments')[copyIndex()], 'sku'), parameters('deployments')[copyIndex()].sku, createObject('name', 'Standard', 'capacity', parameters('deploymentCapacity')))]",
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('name'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "account"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('openAiDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('aiPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
                  },
                  "location": {
                    "value": "[parameters('vNetLocation')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]",
                "deployment"
              ]
            }
          ],
          "outputs": {
            "openAiName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "openAiEndpointUri": {
              "type": "string",
              "value": "[format('{0}openai/', reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint)]"
            },
            "aiServiceName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "aiServiceEndpoint": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint]"
            }
          }
        }
      },
      "dependsOn": [
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim-managed-identity')]",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "ai-language-service",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('languageServiceName'))), createObject('value', parameters('languageServiceName')), createObject('value', format('{0}language-{1}', variables('abbrs').cognitiveServicesAccounts, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "kind": {
            "value": "TextAnalytics"
          },
          "managedIdentityName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim-managed-identity'), '2025-04-01').outputs.managedIdentityName.value]"
          },
          "vNetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetName.value))]",
          "vNetLocation": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.location.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.location.value))]",
          "privateEndpointSubnetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.privateEndpointSubnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.privateEndpointSubnetName.value))]",
          "aiPrivateEndpointName": "[if(not(empty(parameters('languageServicePrivateEndpointName'))), createObject('value', parameters('languageServicePrivateEndpointName')), createObject('value', format('{0}language-pe-{1}', variables('abbrs').cognitiveServicesAccounts, variables('resourceToken'))))]",
          "publicNetworkAccess": {
            "value": "[parameters('languageServiceExternalNetworkAccess')]"
          },
          "openAiDnsZoneName": {
            "value": "[variables('aiCogntiveServicesDnsZoneName')]"
          },
          "sku": {
            "value": {
              "name": "[parameters('languageServiceSkuName')]"
            }
          },
          "vNetRG": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetRG.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetRG.value))]",
          "dnsZoneRG": "[if(not(parameters('useExistingVnet')), createObject('value', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), createObject('value', parameters('dnsZoneRG')))]",
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "3595356772281439807"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "managedIdentityName": {
              "type": "string",
              "defaultValue": ""
            },
            "deployments": {
              "type": "array",
              "defaultValue": []
            },
            "kind": {
              "type": "string",
              "defaultValue": "OpenAI"
            },
            "sku": {
              "type": "object",
              "defaultValue": {
                "name": "S0"
              }
            },
            "deploymentCapacity": {
              "type": "int",
              "defaultValue": 1
            },
            "publicNetworkAccess": {
              "type": "string",
              "defaultValue": "Disabled"
            },
            "aiPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "vNetLocation": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "openAiDnsZoneName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            }
          },
          "resources": [
            {
              "type": "Microsoft.CognitiveServices/accounts",
              "apiVersion": "2023-05-01",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "kind": "[parameters('kind')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "customSubDomainName": "[toLower(parameters('name'))]",
                "publicNetworkAccess": "[parameters('publicNetworkAccess')]",
                "networkAcls": {
                  "defaultAction": "Deny",
                  "ipRules": [],
                  "virtualNetworkRules": []
                }
              },
              "sku": "[parameters('sku')]"
            },
            {
              "copy": {
                "name": "deployment",
                "count": "[length(parameters('deployments'))]",
                "mode": "serial",
                "batchSize": 1
              },
              "type": "Microsoft.CognitiveServices/accounts/deployments",
              "apiVersion": "2023-05-01",
              "name": "[format('{0}/{1}', parameters('name'), parameters('deployments')[copyIndex()].name)]",
              "properties": {
                "model": "[parameters('deployments')[copyIndex()].model]",
                "raiPolicyName": "[if(contains(parameters('deployments')[copyIndex()], 'raiPolicyName'), parameters('deployments')[copyIndex()].raiPolicyName, null())]"
              },
              "sku": "[if(contains(parameters('deployments')[copyIndex()], 'sku'), parameters('deployments')[copyIndex()].sku, createObject('name', 'Standard', 'capacity', parameters('deploymentCapacity')))]",
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('name'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "account"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('openAiDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('aiPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]"
                  },
                  "location": {
                    "value": "[parameters('vNetLocation')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.CognitiveServices/accounts', parameters('name'))]",
                "deployment"
              ]
            }
          ],
          "outputs": {
            "openAiName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "openAiEndpointUri": {
              "type": "string",
              "value": "[format('{0}openai/', reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint)]"
            },
            "aiServiceName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "aiServiceEndpoint": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.CognitiveServices/accounts', parameters('name')), '2023-05-01').endpoint]"
            }
          }
        }
      },
      "dependsOn": [
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim-managed-identity')]",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "event-hub",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('eventHubNamespaceName'))), createObject('value', parameters('eventHubNamespaceName')), createObject('value', format('{0}{1}', variables('abbrs').eventHubNamespaces, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "eventHubPrivateEndpointName": "[if(not(empty(parameters('eventHubPrivateEndpointName'))), createObject('value', parameters('eventHubPrivateEndpointName')), createObject('value', format('{0}pe-{1}', variables('abbrs').eventHubNamespaces, variables('resourceToken'))))]",
          "vNetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetName.value))]",
          "privateEndpointSubnetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.privateEndpointSubnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.privateEndpointSubnetName.value))]",
          "eventHubDnsZoneName": {
            "value": "[variables('eventHubPrivateDnsZoneName')]"
          },
          "publicNetworkAccess": {
            "value": "[parameters('eventHubNetworkAccess')]"
          },
          "vNetRG": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetRG.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetRG.value))]",
          "dnsZoneRG": "[if(not(parameters('useExistingVnet')), createObject('value', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), createObject('value', parameters('dnsZoneRG')))]",
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]",
          "capacity": {
            "value": "[parameters('eventHubCapacityUnits')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "16593084817885273468"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "sku": {
              "type": "string",
              "defaultValue": "Standard"
            },
            "capacity": {
              "type": "int",
              "defaultValue": 1
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "eventHubName": {
              "type": "string",
              "defaultValue": "ai-usage"
            },
            "isPIIEnabled": {
              "type": "bool",
              "defaultValue": true
            },
            "eventHubNamePII": {
              "type": "string",
              "defaultValue": "pii-usage"
            },
            "eventHubPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "eventHubDnsZoneName": {
              "type": "string"
            },
            "publicNetworkAccess": {
              "type": "string",
              "defaultValue": "Enabled"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            },
            "zoneRedundant": {
              "type": "bool",
              "defaultValue": true
            },
            "disasterRecoveryConfig": {
              "type": "object",
              "defaultValue": {}
            },
            "messageRetentionInDays": {
              "type": "int",
              "defaultValue": 7
            },
            "autoInflateEnabled": {
              "type": "bool",
              "defaultValue": true
            },
            "maximumThroughputUnits": {
              "type": "int",
              "defaultValue": 20
            },
            "kafkaEnabled": {
              "type": "bool",
              "defaultValue": false
            }
          },
          "resources": [
            {
              "type": "Microsoft.EventHub/namespaces",
              "apiVersion": "2024-05-01-preview",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "sku": {
                "name": "[parameters('sku')]",
                "tier": "[parameters('sku')]",
                "capacity": "[parameters('capacity')]"
              },
              "properties": {
                "isAutoInflateEnabled": "[parameters('autoInflateEnabled')]",
                "maximumThroughputUnits": "[parameters('maximumThroughputUnits')]",
                "publicNetworkAccess": "[parameters('publicNetworkAccess')]",
                "zoneRedundant": "[parameters('zoneRedundant')]",
                "kafkaEnabled": "[parameters('kafkaEnabled')]"
              }
            },
            {
              "type": "Microsoft.EventHub/namespaces/eventhubs",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}', parameters('name'), parameters('eventHubName'))]",
              "properties": {
                "messageRetentionInDays": "[parameters('messageRetentionInDays')]",
                "partitionCount": 4,
                "status": "Active"
              },
              "dependsOn": [
                "[resourceId('Microsoft.EventHub/namespaces', parameters('name'))]"
              ]
            },
            {
              "condition": "[parameters('isPIIEnabled')]",
              "type": "Microsoft.EventHub/namespaces/eventhubs",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}', parameters('name'), parameters('eventHubNamePII'))]",
              "properties": {
                "messageRetentionInDays": "[parameters('messageRetentionInDays')]",
                "partitionCount": 2,
                "status": "Active"
              },
              "dependsOn": [
                "[resourceId('Microsoft.EventHub/namespaces', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.EventHub/namespaces/eventhubs/consumergroups",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), parameters('eventHubName'), '$Default')]",
              "dependsOn": [
                "[resourceId('Microsoft.EventHub/namespaces/eventhubs', parameters('name'), parameters('eventHubName'))]"
              ]
            },
            {
              "type": "Microsoft.EventHub/namespaces/eventhubs/consumergroups",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), parameters('eventHubName'), 'aiUsageIngestion')]",
              "dependsOn": [
                "[resourceId('Microsoft.EventHub/namespaces/eventhubs', parameters('name'), parameters('eventHubName'))]"
              ]
            },
            {
              "type": "Microsoft.EventHub/namespaces/eventhubs/consumergroups",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), parameters('eventHubNamePII'), '$Default')]",
              "dependsOn": [
                "[resourceId('Microsoft.EventHub/namespaces/eventhubs', parameters('name'), parameters('eventHubNamePII'))]"
              ]
            },
            {
              "type": "Microsoft.EventHub/namespaces/eventhubs/consumergroups",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), parameters('eventHubNamePII'), 'piiUsageIngestion')]",
              "dependsOn": [
                "[resourceId('Microsoft.EventHub/namespaces/eventhubs', parameters('name'), parameters('eventHubNamePII'))]"
              ]
            },
            {
              "condition": "[not(empty(parameters('disasterRecoveryConfig')))]",
              "type": "Microsoft.EventHub/namespaces/disasterRecoveryConfigs",
              "apiVersion": "2024-05-01-preview",
              "name": "[format('{0}/{1}', parameters('name'), 'default')]",
              "properties": "[parameters('disasterRecoveryConfig')]",
              "dependsOn": [
                "[resourceId('Microsoft.EventHub/namespaces', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('eventHubName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "namespace"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('eventHubDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('eventHubPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.EventHub/namespaces', parameters('name'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.EventHub/namespaces', parameters('name'))]"
              ]
            }
          ],
          "outputs": {
            "eventHubNamespaceName": {
              "type": "string",
              "value": "[parameters('name')]"
            },
            "eventHubName": {
              "type": "string",
              "value": "[parameters('eventHubName')]"
            },
            "eventHubEndpoint": {
              "type": "string",
              "value": "[reference(resourceId('Microsoft.EventHub/namespaces', parameters('name')), '2024-05-01-preview').serviceBusEndpoint]"
            },
            "eventHubPIIName": {
              "type": "string",
              "value": "[coalesce(parameters('eventHubNamePII'), '')]"
            },
            "eventHubResourceId": {
              "type": "string",
              "value": "[resourceId('Microsoft.EventHub/namespaces', parameters('name'))]"
            }
          }
        }
      },
      "dependsOn": [
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "apim",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "name": "[if(not(empty(parameters('apimServiceName'))), createObject('value', parameters('apimServiceName')), createObject('value', format('{0}{1}', variables('abbrs').apiManagementService, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "applicationInsightsName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'monitoring'), '2025-04-01').outputs.applicationInsightsName.value]"
          },
          "openAiUris": {
            "copy": [
              {
                "name": "value",
                "count": "[length(range(0, length(parameters('openAiInstances'))))]",
                "input": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', format('{0}-{1}', items(parameters('openAiInstances'))[range(0, length(parameters('openAiInstances')))[copyIndex('value')]].value.name, variables('resourceToken'))), '2025-04-01').outputs.openAiEndpointUri.value]"
              }
            ]
          },
          "managedIdentityName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim-managed-identity'), '2025-04-01').outputs.managedIdentityName.value]"
          },
          "entraAuth": {
            "value": "[parameters('entraAuth')]"
          },
          "clientAppId": "[if(parameters('entraAuth'), createObject('value', parameters('entraClientId')), createObject('value', null()))]",
          "tenantId": "[if(parameters('entraAuth'), createObject('value', parameters('entraTenantId')), createObject('value', null()))]",
          "audience": "[if(parameters('entraAuth'), createObject('value', parameters('entraAudience')), createObject('value', null()))]",
          "eventHubName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub'), '2025-04-01').outputs.eventHubName.value]"
          },
          "eventHubEndpoint": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub'), '2025-04-01').outputs.eventHubEndpoint.value]"
          },
          "eventHubPIIName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub'), '2025-04-01').outputs.eventHubPIIName.value]"
          },
          "eventHubPIIEndpoint": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub'), '2025-04-01').outputs.eventHubEndpoint.value]"
          },
          "apimSubnetId": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.apimSubnetId.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.apimSubnetId.value))]",
          "aiLanguageServiceUrl": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'ai-language-service'), '2025-04-01').outputs.aiServiceEndpoint.value]"
          },
          "contentSafetyServiceUrl": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'ai-content-safety'), '2025-04-01').outputs.aiServiceEndpoint.value]"
          },
          "apimNetworkType": {
            "value": "[parameters('apimNetworkType')]"
          },
          "enablePIIAnonymization": {
            "value": "[parameters('enableAIGatewayPiiRedaction')]"
          },
          "enableAIModelInference": {
            "value": "[parameters('enableAIModelInference')]"
          },
          "enableDocumentIntelligence": {
            "value": "[parameters('enableDocumentIntelligence')]"
          },
          "enableOpenAIRealtime": {
            "value": "[parameters('enableOpenAIRealtime')]"
          },
          "enableAzureAISearch": {
            "value": "[parameters('enableAzureAISearch')]"
          },
          "aiSearchInstances": {
            "value": "[parameters('aiSearchInstances')]"
          },
          "sku": {
            "value": "[parameters('apimSku')]"
          },
          "skuCount": {
            "value": "[parameters('apimSkuUnits')]"
          },
          "usePrivateEndpoint": {
            "value": "[parameters('apimV2UsePrivateEndpoint')]"
          },
          "apimV2PrivateEndpointName": "[if(not(empty(parameters('apimV2PrivateEndpointName'))), createObject('value', parameters('apimV2PrivateEndpointName')), createObject('value', format('{0}pe-{1}', variables('abbrs').apiManagementService, variables('resourceToken'))))]",
          "apimV2PublicNetworkAccess": {
            "value": "[parameters('apimV2PublicNetworkAccess')]"
          },
          "privateEndpointSubnetId": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.privateEndpointSubnetId.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.privateEndpointSubnetId.value))]",
          "dnsZoneRG": "[if(not(parameters('useExistingVnet')), createObject('value', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), createObject('value', parameters('dnsZoneRG')))]",
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]",
          "cognitiveServicesAudience": {
            "value": "[variables('cognitiveServicesAudience')]"
          },
          "apimPrivateDnsZoneName": {
            "value": "[variables('dnsZoneNames').azureApi]"
          },
          "searchServiceAudience": "[if(variables('isGov'), createObject('value', 'https://search.azure.us'), createObject('value', 'https://search.azure.com'))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "17374069792624304125"
            }
          },
          "parameters": {
            "name": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "entraAuth": {
              "type": "bool",
              "defaultValue": false
            },
            "publisherEmail": {
              "type": "string",
              "defaultValue": "noreply@microsoft.com",
              "minLength": 1
            },
            "publisherName": {
              "type": "string",
              "defaultValue": "n/a",
              "minLength": 1
            },
            "sku": {
              "type": "string",
              "defaultValue": "Developer"
            },
            "skuCount": {
              "type": "int",
              "defaultValue": 1
            },
            "applicationInsightsName": {
              "type": "string"
            },
            "openAiUris": {
              "type": "array"
            },
            "managedIdentityName": {
              "type": "string"
            },
            "clientAppId": {
              "type": "string",
              "defaultValue": " "
            },
            "tenantId": {
              "type": "string",
              "defaultValue": "[tenant().tenantId]"
            },
            "cognitiveServicesAudience": {
              "type": "string",
              "defaultValue": "https://cognitiveservices.azure.com",
              "metadata": {
                "description": "Cognitive Services token audience URL (differs between commercial and Gov)"
              }
            },
            "searchServiceAudience": {
              "type": "string",
              "defaultValue": "https://search.azure.com",
              "metadata": {
                "description": "Azure Search token audience URL (differs between commercial and Gov)"
              }
            },
            "audience": {
              "type": "string",
              "defaultValue": "[format('{0}/.default', parameters('cognitiveServicesAudience'))]"
            },
            "eventHubName": {
              "type": "string"
            },
            "eventHubEndpoint": {
              "type": "string"
            },
            "eventHubPIIName": {
              "type": "string"
            },
            "eventHubPIIEndpoint": {
              "type": "string"
            },
            "enableAzureAISearch": {
              "type": "bool",
              "defaultValue": false
            },
            "aiSearchInstances": {
              "type": "array"
            },
            "enableAIModelInference": {
              "type": "bool",
              "defaultValue": true
            },
            "enableOpenAIRealtime": {
              "type": "bool",
              "defaultValue": true
            },
            "enableDocumentIntelligence": {
              "type": "bool",
              "defaultValue": true
            },
            "enablePIIAnonymization": {
              "type": "bool",
              "defaultValue": true
            },
            "contentSafetyServiceUrl": {
              "type": "string"
            },
            "aiLanguageServiceUrl": {
              "type": "string"
            },
            "apimNetworkType": {
              "type": "string",
              "defaultValue": "External"
            },
            "apimSubnetId": {
              "type": "string"
            },
            "apimPrivateDnsZoneName": {
              "type": "string",
              "defaultValue": "privatelink.azure-api.net",
              "metadata": {
                "description": "Private DNS zone name for APIM gateway"
              }
            },
            "apimV2PrivateDnsZoneName": {
              "type": "string",
              "defaultValue": "[parameters('apimPrivateDnsZoneName')]"
            },
            "apimV2PrivateEndpointName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string",
              "defaultValue": "[resourceGroup().name]"
            },
            "dnsSubscriptionId": {
              "type": "string",
              "defaultValue": "[subscription().subscriptionId]"
            },
            "privateEndpointSubnetId": {
              "type": "string"
            },
            "usePrivateEndpoint": {
              "type": "bool",
              "defaultValue": false
            },
            "apimV2PublicNetworkAccess": {
              "type": "bool",
              "defaultValue": true
            }
          },
          "variables": {
            "$fxv#0": {
              "openapi": "3.0.0",
              "info": {
                "title": "Azure OpenAI Service API",
                "description": "Azure OpenAI APIs for completions and search",
                "version": "2024-10-21"
              },
              "servers": [
                {
                  "url": "https://REPLACEBYPOLICY/openai",
                  "variables": {
                    "endpoint": {
                      "default": "your-resource-name.openai.azure.com"
                    }
                  }
                }
              ],
              "security": [
                {
                  "bearer": [
                    "api.read"
                  ]
                },
                {
                  "apiKey": []
                }
              ],
              "paths": {
                "/deployments/{deployment-id}/completions": {
                  "post": {
                    "summary": "Creates a completion for the provided prompt, parameters and chosen model.",
                    "operationId": "Completions_Create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "davinci",
                          "description": "Deployment id of the model which was deployed."
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "application/json": {
                          "schema": {
                            "$ref": "#/components/schemas/createCompletionRequest"
                          },
                          "example": {
                            "prompt": "Negate the following sentence.The price for bubblegum increased on thursday.\n\n Negated Sentence:",
                            "max_tokens": 50
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/createCompletionResponse"
                            },
                            "example": {
                              "model": "davinci",
                              "object": "text_completion",
                              "id": "cmpl-4509KAos68kxOqpE2uYGw81j6m7uo",
                              "created": 1637097562,
                              "choices": [
                                {
                                  "index": 0,
                                  "text": "The price for bubblegum decreased on thursday.",
                                  "logprobs": null,
                                  "finish_reason": "stop"
                                }
                              ]
                            }
                          }
                        },
                        "headers": {
                          "apim-request-id": {
                            "description": "Request ID for troubleshooting purposes",
                            "schema": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "default": {
                        "description": "Service unavailable",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/errorResponse"
                            }
                          }
                        },
                        "headers": {
                          "apim-request-id": {
                            "description": "Request ID for troubleshooting purposes",
                            "schema": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/embeddings": {
                  "post": {
                    "summary": "Get a vector representation of a given input that can be easily consumed by machine learning models and algorithms.",
                    "operationId": "embeddings_create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "enum": [
                            "embedding"
                          ],
                          "type": "string",
                          "example": "ada-search-index-v1",
                          "default": "embedding"
                        },
                        "description": "The deployment id of the model which was deployed."
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "enum": [
                            "2024-10-21"
                          ],
                          "example": "2024-10-21",
                          "default": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "application/json": {
                          "schema": {
                            "type": "object",
                            "additionalProperties": true,
                            "properties": {
                              "input": {
                                "description": "Input text to get embeddings for, encoded as a string. To get embeddings for multiple inputs in a single request, pass an array of strings. Each input must not exceed 2048 tokens in length.\nUnless you are embedding code, we suggest replacing newlines (\\n) in your input with a single space, as we have observed inferior results when newlines are present.",
                                "oneOf": [
                                  {
                                    "type": "string",
                                    "default": "",
                                    "example": "This is a test.",
                                    "nullable": true
                                  },
                                  {
                                    "type": "array",
                                    "minItems": 1,
                                    "maxItems": 2048,
                                    "items": {
                                      "type": "string",
                                      "minLength": 1,
                                      "example": "This is a test.",
                                      "nullable": false
                                    }
                                  }
                                ]
                              },
                              "user": {
                                "description": "A unique identifier representing your end-user, which can help monitoring and detecting abuse.",
                                "type": "string",
                                "nullable": false
                              },
                              "input_type": {
                                "description": "input type of embedding search to use",
                                "type": "string",
                                "example": "query"
                              },
                              "encoding_format": {
                                "description": "The format to return the embeddings in. Can be either `float` or `base64`. Defaults to `float`.",
                                "type": "string",
                                "example": "base64",
                                "nullable": true
                              },
                              "dimensions": {
                                "description": "The number of dimensions the resulting output embeddings should have. Only supported in `text-embedding-3` and later models.",
                                "type": "integer",
                                "example": 1,
                                "nullable": true
                              }
                            },
                            "required": [
                              "input"
                            ]
                          },
                          "example": {
                            "input": "APIM love OpenAI"
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "type": "object",
                              "properties": {
                                "object": {
                                  "type": "string"
                                },
                                "model": {
                                  "type": "string"
                                },
                                "data": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "properties": {
                                      "index": {
                                        "type": "integer"
                                      },
                                      "object": {
                                        "type": "string"
                                      },
                                      "embedding": {
                                        "type": "array",
                                        "items": {
                                          "type": "number"
                                        }
                                      }
                                    },
                                    "required": [
                                      "index",
                                      "object",
                                      "embedding"
                                    ]
                                  }
                                },
                                "usage": {
                                  "type": "object",
                                  "properties": {
                                    "prompt_tokens": {
                                      "type": "integer"
                                    },
                                    "total_tokens": {
                                      "type": "integer"
                                    }
                                  },
                                  "required": [
                                    "prompt_tokens",
                                    "total_tokens"
                                  ]
                                }
                              },
                              "required": [
                                "object",
                                "model",
                                "data",
                                "usage"
                              ]
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create a embeddings.": {
                        "$ref": "./examples/embeddings.yaml"
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/chat/completions": {
                  "post": {
                    "summary": "Creates a completion for the chat message",
                    "operationId": "ChatCompletions_Create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "default": "chat",
                          "description": "Deployment id of the model which was deployed.",
                          "enum": [
                            "chat",
                            "gpt-4o"
                          ]
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "enum": [
                            "2024-10-21"
                          ],
                          "type": "string",
                          "default": "2024-10-21",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "application/json": {
                          "schema": {
                            "$ref": "#/components/schemas/createChatCompletionRequest"
                          },
                          "example": {
                            "model": "chat",
                            "messages": [
                              {
                                "role": "system",
                                "content": "You are a helpful assistant that responds in Markdown. Help me with my math homework!"
                              },
                              {
                                "role": "user",
                                "content": "How to calculate the distance between earth and moon?"
                              }
                            ]
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "oneOf": [
                                {
                                  "$ref": "#/components/schemas/createChatCompletionResponse"
                                },
                                {
                                  "$ref": "#/components/schemas/createChatCompletionStreamResponse"
                                }
                              ]
                            }
                          }
                        },
                        "headers": {
                          "apim-request-id": {
                            "description": "Request ID for troubleshooting purposes",
                            "schema": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "default": {
                        "description": "Service unavailable",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/errorResponse"
                            }
                          }
                        },
                        "headers": {
                          "apim-request-id": {
                            "description": "Request ID for troubleshooting purposes",
                            "schema": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create a chat completion.": {
                        "$ref": "./examples/chat_completions.yaml"
                      },
                      "Creates a completion based on Azure Search data and system-assigned managed identity.": {
                        "$ref": "./examples/chat_completions_azure_search_minimum.yaml"
                      },
                      "Creates a completion based on Azure Search vector data, previous assistant message and user-assigned managed identity.": {
                        "$ref": "./examples/chat_completions_azure_search_advanced.yaml"
                      },
                      "Creates a completion for the provided Azure Cosmos DB.": {
                        "$ref": "./examples/chat_completions_cosmos_db.yaml"
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/audio/transcriptions": {
                  "post": {
                    "summary": "Transcribes audio into the input language.",
                    "operationId": "Transcriptions_Create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "whisper",
                          "description": "Deployment id of the whisper model."
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "multipart/form-data": {
                          "schema": {
                            "$ref": "#/components/schemas/createTranscriptionRequest"
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "oneOf": [
                                {
                                  "$ref": "#/components/schemas/audioResponse"
                                },
                                {
                                  "$ref": "#/components/schemas/audioVerboseResponse"
                                }
                              ]
                            }
                          },
                          "text/plain": {
                            "schema": {
                              "type": "string",
                              "description": "Transcribed text in the output format (when response_format was one of text, vtt or srt)."
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create an audio transcription with json response format.": {
                        "$ref": "./examples/audio_transcription_object.yaml"
                      },
                      "Create an audio transcription with text response format.": {
                        "$ref": "./examples/audio_transcription_text.yaml"
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/audio/translations": {
                  "post": {
                    "summary": "Transcribes and translates input audio into English text.",
                    "operationId": "Translations_Create",
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "whisper",
                          "description": "Deployment id of the whisper model which was deployed."
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "requestBody": {
                      "required": true,
                      "content": {
                        "multipart/form-data": {
                          "schema": {
                            "$ref": "#/components/schemas/createTranslationRequest"
                          }
                        }
                      }
                    },
                    "responses": {
                      "200": {
                        "description": "OK",
                        "content": {
                          "application/json": {
                            "schema": {
                              "oneOf": [
                                {
                                  "$ref": "#/components/schemas/audioResponse"
                                },
                                {
                                  "$ref": "#/components/schemas/audioVerboseResponse"
                                }
                              ]
                            }
                          },
                          "text/plain": {
                            "schema": {
                              "type": "string",
                              "description": "Transcribed text in the output format (when response_format was one of text, vtt or srt)."
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create an audio translation with json response format.": {
                        "$ref": "./examples/audio_translation_object.yaml"
                      },
                      "Create an audio translation with text response format.": {
                        "$ref": "./examples/audio_translation_text.yaml"
                      }
                    }
                  }
                },
                "/deployments/{deployment-id}/images/generations": {
                  "post": {
                    "summary": "Generates a batch of images from a text caption on a given DALLE model deployment",
                    "operationId": "ImageGenerations_Create",
                    "requestBody": {
                      "required": true,
                      "content": {
                        "application/json": {
                          "schema": {
                            "$ref": "#/components/schemas/imageGenerationsRequest"
                          }
                        }
                      }
                    },
                    "parameters": [
                      {
                        "in": "path",
                        "name": "deployment-id",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "dalle-deployment",
                          "description": "Deployment id of the dalle model which was deployed."
                        }
                      },
                      {
                        "in": "query",
                        "name": "api-version",
                        "required": true,
                        "schema": {
                          "type": "string",
                          "example": "2024-10-21",
                          "description": "api version"
                        }
                      }
                    ],
                    "responses": {
                      "200": {
                        "description": "Ok",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/generateImagesResponse"
                            }
                          }
                        }
                      },
                      "default": {
                        "description": "An error occurred.",
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/dalleErrorResponse"
                            }
                          }
                        }
                      }
                    },
                    "x-ms-examples": {
                      "Create an image.": {
                        "$ref": "./examples/image_generation.yaml"
                      }
                    }
                  }
                }
              },
              "components": {
                "schemas": {
                  "errorResponse": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "$ref": "#/components/schemas/error"
                      }
                    }
                  },
                  "errorBase": {
                    "type": "object",
                    "properties": {
                      "code": {
                        "type": "string"
                      },
                      "message": {
                        "type": "string"
                      }
                    }
                  },
                  "error": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/errorBase"
                      }
                    ],
                    "properties": {
                      "param": {
                        "type": "string"
                      },
                      "type": {
                        "type": "string"
                      },
                      "inner_error": {
                        "$ref": "#/components/schemas/innerError"
                      }
                    }
                  },
                  "innerError": {
                    "description": "Inner error with additional details.",
                    "type": "object",
                    "properties": {
                      "code": {
                        "$ref": "#/components/schemas/innerErrorCode"
                      },
                      "content_filter_results": {
                        "$ref": "#/components/schemas/contentFilterPromptResults"
                      }
                    }
                  },
                  "innerErrorCode": {
                    "description": "Error codes for the inner error object.",
                    "enum": [
                      "ResponsibleAIPolicyViolation"
                    ],
                    "type": "string",
                    "x-ms-enum": {
                      "name": "InnerErrorCode",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "ResponsibleAIPolicyViolation",
                          "description": "The prompt violated one of more content filter rules."
                        }
                      ]
                    }
                  },
                  "dalleErrorResponse": {
                    "type": "object",
                    "properties": {
                      "error": {
                        "$ref": "#/components/schemas/dalleError"
                      }
                    }
                  },
                  "dalleError": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/errorBase"
                      }
                    ],
                    "properties": {
                      "param": {
                        "type": "string"
                      },
                      "type": {
                        "type": "string"
                      },
                      "inner_error": {
                        "$ref": "#/components/schemas/dalleInnerError"
                      }
                    }
                  },
                  "dalleInnerError": {
                    "description": "Inner error with additional details.",
                    "type": "object",
                    "properties": {
                      "code": {
                        "$ref": "#/components/schemas/innerErrorCode"
                      },
                      "content_filter_results": {
                        "$ref": "#/components/schemas/dalleFilterResults"
                      },
                      "revised_prompt": {
                        "type": "string",
                        "description": "The prompt that was used to generate the image, if there was any revision to the prompt."
                      }
                    }
                  },
                  "contentFilterResultBase": {
                    "type": "object",
                    "properties": {
                      "filtered": {
                        "type": "boolean"
                      }
                    },
                    "required": [
                      "filtered"
                    ]
                  },
                  "contentFilterSeverityResult": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterResultBase"
                      },
                      {
                        "properties": {
                          "severity": {
                            "type": "string",
                            "enum": [
                              "safe",
                              "low",
                              "medium",
                              "high"
                            ],
                            "x-ms-enum": {
                              "name": "ContentFilterSeverity",
                              "modelAsString": true,
                              "values": [
                                {
                                  "value": "safe",
                                  "description": "General content or related content in generic or non-harmful contexts."
                                },
                                {
                                  "value": "low",
                                  "description": "Harmful content at a low intensity and risk level."
                                },
                                {
                                  "value": "medium",
                                  "description": "Harmful content at a medium intensity and risk level."
                                },
                                {
                                  "value": "high",
                                  "description": "Harmful content at a high intensity and risk level."
                                }
                              ]
                            }
                          }
                        }
                      }
                    ],
                    "required": [
                      "severity",
                      "filtered"
                    ]
                  },
                  "contentFilterDetectedResult": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterResultBase"
                      },
                      {
                        "properties": {
                          "detected": {
                            "type": "boolean"
                          }
                        }
                      }
                    ],
                    "required": [
                      "detected",
                      "filtered"
                    ]
                  },
                  "contentFilterDetectedWithCitationResult": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterDetectedResult"
                      },
                      {
                        "properties": {
                          "citation": {
                            "type": "object",
                            "properties": {
                              "URL": {
                                "type": "string"
                              },
                              "license": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    ],
                    "required": [
                      "detected",
                      "filtered"
                    ]
                  },
                  "contentFilterResultsBase": {
                    "type": "object",
                    "description": "Information about the content filtering results.",
                    "properties": {
                      "sexual": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "violence": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "hate": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "self_harm": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "profanity": {
                        "$ref": "#/components/schemas/contentFilterDetectedResult"
                      },
                      "error": {
                        "$ref": "#/components/schemas/errorBase"
                      }
                    }
                  },
                  "contentFilterPromptResults": {
                    "type": "object",
                    "description": "Information about the content filtering category (hate, sexual, violence, self_harm), if it has been detected, as well as the severity level (very_low, low, medium, high-scale that determines the intensity and risk level of harmful content) and if it has been filtered or not. Information about jailbreak content and profanity, if it has been detected, and if it has been filtered or not. And information about customer block list, if it has been filtered and its id.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterResultsBase"
                      },
                      {
                        "properties": {
                          "jailbreak": {
                            "$ref": "#/components/schemas/contentFilterDetectedResult"
                          }
                        }
                      }
                    ]
                  },
                  "contentFilterChoiceResults": {
                    "type": "object",
                    "description": "Information about the content filtering category (hate, sexual, violence, self_harm), if it has been detected, as well as the severity level (very_low, low, medium, high-scale that determines the intensity and risk level of harmful content) and if it has been filtered or not. Information about third party text and profanity, if it has been detected, and if it has been filtered or not. And information about customer block list, if it has been filtered and its id.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/contentFilterResultsBase"
                      },
                      {
                        "properties": {
                          "protected_material_text": {
                            "$ref": "#/components/schemas/contentFilterDetectedResult"
                          }
                        }
                      },
                      {
                        "properties": {
                          "protected_material_code": {
                            "$ref": "#/components/schemas/contentFilterDetectedWithCitationResult"
                          }
                        }
                      }
                    ]
                  },
                  "promptFilterResult": {
                    "type": "object",
                    "description": "Content filtering results for a single prompt in the request.",
                    "properties": {
                      "prompt_index": {
                        "type": "integer"
                      },
                      "content_filter_results": {
                        "$ref": "#/components/schemas/contentFilterPromptResults"
                      }
                    }
                  },
                  "promptFilterResults": {
                    "type": "array",
                    "description": "Content filtering results for zero or more prompts in the request. In a streaming request, results for different prompts may arrive at different times or in different orders.",
                    "items": {
                      "$ref": "#/components/schemas/promptFilterResult"
                    }
                  },
                  "dalleContentFilterResults": {
                    "type": "object",
                    "description": "Information about the content filtering results.",
                    "properties": {
                      "sexual": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "violence": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "hate": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      },
                      "self_harm": {
                        "$ref": "#/components/schemas/contentFilterSeverityResult"
                      }
                    }
                  },
                  "dalleFilterResults": {
                    "type": "object",
                    "description": "Information about the content filtering category (hate, sexual, violence, self_harm), if it has been detected, as well as the severity level (very_low, low, medium, high-scale that determines the intensity and risk level of harmful content) and if it has been filtered or not. Information about jailbreak content and profanity, if it has been detected, and if it has been filtered or not. And information about customer block list, if it has been filtered and its id.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/dalleContentFilterResults"
                      },
                      {
                        "properties": {
                          "profanity": {
                            "$ref": "#/components/schemas/contentFilterDetectedResult"
                          },
                          "jailbreak": {
                            "$ref": "#/components/schemas/contentFilterDetectedResult"
                          }
                        }
                      }
                    ]
                  },
                  "chatCompletionsRequestCommon": {
                    "type": "object",
                    "properties": {
                      "temperature": {
                        "description": "What sampling temperature to use, between 0 and 2. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.\nWe generally recommend altering this or `top_p` but not both.",
                        "type": "number",
                        "minimum": 0,
                        "maximum": 2,
                        "default": 1,
                        "example": 1,
                        "nullable": true
                      },
                      "top_p": {
                        "description": "An alternative to sampling with temperature, called nucleus sampling, where the model considers the results of the tokens with top_p probability mass. So 0.1 means only the tokens comprising the top 10% probability mass are considered.\nWe generally recommend altering this or `temperature` but not both.",
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1,
                        "default": 1,
                        "example": 1,
                        "nullable": true
                      },
                      "stream": {
                        "description": "If set, partial message deltas will be sent, like in ChatGPT. Tokens will be sent as data-only server-sent events as they become available, with the stream terminated by a `data: [DONE]` message.",
                        "type": "boolean",
                        "nullable": true,
                        "default": false
                      },
                      "stop": {
                        "description": "Up to 4 sequences where the API will stop generating further tokens.",
                        "oneOf": [
                          {
                            "type": "string",
                            "nullable": true
                          },
                          {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "nullable": false
                            },
                            "minItems": 1,
                            "maxItems": 4,
                            "description": "Array minimum size of 1 and maximum of 4"
                          }
                        ],
                        "default": null
                      },
                      "max_tokens": {
                        "description": "The maximum number of tokens allowed for the generated answer. By default, the number of tokens the model can return will be (4096 - prompt tokens).\n\nThis value is now deprecated in favor of `max_completion_tokens`, and is not compatible with o1 series models.\n",
                        "type": "integer",
                        "default": 4096
                      },
                      "max_completion_tokens": {
                        "description": "An upper bound for the number of tokens that can be generated for a completion, including visible output tokens and reasoning tokens.\n",
                        "type": "integer",
                        "nullable": true
                      },
                      "presence_penalty": {
                        "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on whether they appear in the text so far, increasing the model's likelihood to talk about new topics.",
                        "type": "number",
                        "default": 0,
                        "minimum": -2,
                        "maximum": 2
                      },
                      "frequency_penalty": {
                        "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on their existing frequency in the text so far, decreasing the model's likelihood to repeat the same line verbatim.",
                        "type": "number",
                        "default": 0,
                        "minimum": -2,
                        "maximum": 2
                      },
                      "logit_bias": {
                        "description": "Modify the likelihood of specified tokens appearing in the completion. Accepts a json object that maps tokens (specified by their token ID in the tokenizer) to an associated bias value from -100 to 100. Mathematically, the bias is added to the logits generated by the model prior to sampling. The exact effect will vary per model, but values between -1 and 1 should decrease or increase likelihood of selection; values like -100 or 100 should result in a ban or exclusive selection of the relevant token.",
                        "type": "object",
                        "nullable": true
                      },
                      "user": {
                        "description": "A unique identifier representing your end-user, which can help Azure OpenAI to monitor and detect abuse.",
                        "type": "string",
                        "example": "user-1234",
                        "nullable": false
                      }
                    }
                  },
                  "createCompletionRequest": {
                    "type": "object",
                    "properties": {
                      "prompt": {
                        "description": "The prompt(s) to generate completions for, encoded as a string, array of strings, array of tokens, or array of token arrays.\n\nNote that <|endoftext|> is the document separator that the model sees during training, so if a prompt is not specified the model will generate as if from the beginning of a new document.\n",
                        "default": "<|endoftext|>",
                        "nullable": true,
                        "oneOf": [
                          {
                            "type": "string",
                            "default": "",
                            "example": "This is a test."
                          },
                          {
                            "type": "array",
                            "items": {
                              "type": "string",
                              "default": "",
                              "example": "This is a test."
                            }
                          }
                        ]
                      },
                      "best_of": {
                        "type": "integer",
                        "default": 1,
                        "minimum": 0,
                        "maximum": 20,
                        "nullable": true,
                        "description": "Generates `best_of` completions server-side and returns the \"best\" (the one with the highest log probability per token). Results cannot be streamed.\n\nWhen used with `n`, `best_of` controls the number of candidate completions and `n` specifies how many to return  `best_of` must be greater than `n`.\n\n**Note:** Because this parameter generates many completions, it can quickly consume your token quota. Use carefully and ensure that you have reasonable settings for `max_tokens` and `stop`.\n"
                      },
                      "echo": {
                        "type": "boolean",
                        "default": false,
                        "nullable": true,
                        "description": "Echo back the prompt in addition to the completion\n"
                      },
                      "frequency_penalty": {
                        "type": "number",
                        "default": 0,
                        "minimum": -2,
                        "maximum": 2,
                        "nullable": true,
                        "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on their existing frequency in the text so far, decreasing the model's likelihood to repeat the same line verbatim.\n"
                      },
                      "logit_bias": {
                        "type": "object",
                        "x-oaiTypeLabel": "map",
                        "default": null,
                        "nullable": true,
                        "additionalProperties": {
                          "type": "integer"
                        },
                        "description": "Modify the likelihood of specified tokens appearing in the completion.\n\nAccepts a JSON object that maps tokens (specified by their token ID in the GPT tokenizer) to an associated bias value from -100 to 100. You can use this [tokenizer tool](https://platform.openai.com/tokenizer?view=bpe) to convert text to token IDs. Mathematically, the bias is added to the logits generated by the model prior to sampling. The exact effect will vary per model, but values between -1 and 1 should decrease or increase likelihood of selection; values like -100 or 100 should result in a ban or exclusive selection of the relevant token.\n\nAs an example, you can pass `{\"50256\": -100}` to prevent the <|endoftext|> token from being generated.\n"
                      },
                      "logprobs": {
                        "type": "integer",
                        "minimum": 0,
                        "maximum": 5,
                        "default": null,
                        "nullable": true,
                        "description": "Include the log probabilities on the `logprobs` most likely output tokens, as well the chosen tokens. For example, if `logprobs` is 5, the API will return a list of the 5 most likely tokens. The API will always return the `logprob` of the sampled token, so there may be up to `logprobs+1` elements in the response.\n\nThe maximum value for `logprobs` is 5.\n"
                      },
                      "max_tokens": {
                        "type": "integer",
                        "minimum": 0,
                        "default": 16,
                        "example": 16,
                        "nullable": true,
                        "description": "The maximum number of [tokens](https://platform.openai.com/tokenizer) that can be generated in the completion.\n\nThe token count of your prompt plus `max_tokens` cannot exceed the model's context length. [Example Python code](https://cookbook.openai.com/examples/how_to_count_tokens_with_tiktoken) for counting tokens.\n"
                      },
                      "n": {
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 128,
                        "default": 1,
                        "example": 1,
                        "nullable": true,
                        "description": "How many completions to generate for each prompt.\n\n**Note:** Because this parameter generates many completions, it can quickly consume your token quota. Use carefully and ensure that you have reasonable settings for `max_tokens` and `stop`.\n"
                      },
                      "presence_penalty": {
                        "type": "number",
                        "default": 0,
                        "minimum": -2,
                        "maximum": 2,
                        "nullable": true,
                        "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on whether they appear in the text so far, increasing the model's likelihood to talk about new topics.\n"
                      },
                      "seed": {
                        "type": "integer",
                        "minimum": -9223372036854775808,
                        "maximum": 9223372036854775807,
                        "nullable": true,
                        "description": "If specified, our system will make a best effort to sample deterministically, such that repeated requests with the same `seed` and parameters should return the same result.\n\nDeterminism is not guaranteed, and you should refer to the `system_fingerprint` response parameter to monitor changes in the backend.\n"
                      },
                      "stop": {
                        "description": "Up to 4 sequences where the API will stop generating further tokens. The returned text will not contain the stop sequence.\n",
                        "default": null,
                        "nullable": true,
                        "oneOf": [
                          {
                            "type": "string",
                            "default": "<|endoftext|>",
                            "example": "\n",
                            "nullable": true
                          },
                          {
                            "type": "array",
                            "minItems": 1,
                            "maxItems": 4,
                            "items": {
                              "type": "string",
                              "example": "[[\"\\n\"]"
                            }
                          }
                        ]
                      },
                      "stream": {
                        "description": "Whether to stream back partial progress. If set, tokens will be sent as data-only [server-sent events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format) as they become available, with the stream terminated by a `data: [DONE]` message. [Example Python code](https://cookbook.openai.com/examples/how_to_stream_completions).\n",
                        "type": "boolean",
                        "nullable": true,
                        "default": false
                      },
                      "suffix": {
                        "description": "The suffix that comes after a completion of inserted text.\n\nThis parameter is only supported for `gpt-3.5-turbo-instruct`.\n",
                        "default": null,
                        "nullable": true,
                        "type": "string",
                        "example": "test."
                      },
                      "stream_options": {
                        "$ref": "#/components/schemas/chatCompletionStreamOptions"
                      },
                      "temperature": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 2,
                        "default": 1,
                        "example": 1,
                        "nullable": true,
                        "description": "What sampling temperature to use, between 0 and 2. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.\n\nWe generally recommend altering this or `top_p` but not both.\n"
                      },
                      "top_p": {
                        "type": "number",
                        "minimum": 0,
                        "maximum": 1,
                        "default": 1,
                        "example": 1,
                        "nullable": true,
                        "description": "An alternative to sampling with temperature, called nucleus sampling, where the model considers the results of the tokens with top_p probability mass. So 0.1 means only the tokens comprising the top 10% probability mass are considered.\n\nWe generally recommend altering this or `temperature` but not both.\n"
                      },
                      "user": {
                        "type": "string",
                        "example": "user-1234",
                        "description": "A unique identifier representing your end-user, which can help to monitor and detect abuse.\n"
                      }
                    },
                    "required": [
                      "prompt"
                    ]
                  },
                  "createCompletionResponse": {
                    "type": "object",
                    "description": "Represents a completion response from the API. Note: both the streamed and non-streamed response objects share the same shape (unlike the chat endpoint).\n",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "A unique identifier for the completion."
                      },
                      "choices": {
                        "type": "array",
                        "description": "The list of completion choices the model generated for the input prompt.",
                        "items": {
                          "type": "object",
                          "required": [
                            "finish_reason",
                            "index",
                            "logprobs",
                            "text"
                          ],
                          "properties": {
                            "finish_reason": {
                              "type": "string",
                              "description": "The reason the model stopped generating tokens. This will be `stop` if the model hit a natural stop point or a provided stop sequence,\n`length` if the maximum number of tokens specified in the request was reached,\nor `content_filter` if content was omitted due to a flag from our content filters.\n",
                              "enum": [
                                "stop",
                                "length",
                                "content_filter"
                              ]
                            },
                            "index": {
                              "type": "integer"
                            },
                            "logprobs": {
                              "type": "object",
                              "nullable": true,
                              "properties": {
                                "text_offset": {
                                  "type": "array",
                                  "items": {
                                    "type": "integer"
                                  }
                                },
                                "token_logprobs": {
                                  "type": "array",
                                  "items": {
                                    "type": "number"
                                  }
                                },
                                "tokens": {
                                  "type": "array",
                                  "items": {
                                    "type": "string"
                                  }
                                },
                                "top_logprobs": {
                                  "type": "array",
                                  "items": {
                                    "type": "object",
                                    "additionalProperties": {
                                      "type": "number"
                                    }
                                  }
                                }
                              }
                            },
                            "text": {
                              "type": "string"
                            },
                            "content_filter_results": {
                              "$ref": "#/components/schemas/contentFilterChoiceResults"
                            }
                          }
                        }
                      },
                      "created": {
                        "type": "integer",
                        "description": "The Unix timestamp (in seconds) of when the completion was created."
                      },
                      "model": {
                        "type": "string",
                        "description": "The model used for completion."
                      },
                      "prompt_filter_results": {
                        "$ref": "#/components/schemas/promptFilterResults"
                      },
                      "system_fingerprint": {
                        "type": "string",
                        "description": "This fingerprint represents the backend configuration that the model runs with.\n\nCan be used in conjunction with the `seed` request parameter to understand when backend changes have been made that might impact determinism.\n"
                      },
                      "object": {
                        "type": "string",
                        "description": "The object type, which is always \"text_completion\"",
                        "enum": [
                          "text_completion"
                        ]
                      },
                      "usage": {
                        "$ref": "#/components/schemas/completionUsage"
                      }
                    },
                    "required": [
                      "id",
                      "object",
                      "created",
                      "model",
                      "choices"
                    ]
                  },
                  "createChatCompletionRequest": {
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionsRequestCommon"
                      },
                      {
                        "properties": {
                          "messages": {
                            "description": "A list of messages comprising the conversation so far. [Example Python code](https://github.com/openai/openai-cookbook/blob/main/examples/How_to_format_inputs_to_ChatGPT_models.ipynb).",
                            "type": "array",
                            "minItems": 1,
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestMessage"
                            }
                          },
                          "data_sources": {
                            "type": "array",
                            "description": "  The configuration entries for Azure OpenAI chat extensions that use them.\n  This additional specification is only compatible with Azure OpenAI.",
                            "items": {
                              "$ref": "#/components/schemas/azureChatExtensionConfiguration"
                            }
                          },
                          "frequency_penalty": {
                            "type": "number",
                            "default": 0,
                            "minimum": -2,
                            "maximum": 2,
                            "nullable": true,
                            "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on their existing frequency in the text so far, decreasing the model's likelihood to repeat the same line verbatim.\n"
                          },
                          "logit_bias": {
                            "type": "object",
                            "default": null,
                            "nullable": true,
                            "additionalProperties": {
                              "type": "integer"
                            },
                            "description": "Modify the likelihood of specified tokens appearing in the completion.\n\nAccepts a JSON object that maps tokens (specified by their token ID in the tokenizer) to an associated bias value from -100 to 100. Mathematically, the bias is added to the logits generated by the model prior to sampling. The exact effect will vary per model, but values between -1 and 1 should decrease or increase likelihood of selection; values like -100 or 100 should result in a ban or exclusive selection of the relevant token.\n"
                          },
                          "logprobs": {
                            "description": "Whether to return log probabilities of the output tokens or not. If true, returns the log probabilities of each output token returned in the `content` of `message`.",
                            "type": "boolean",
                            "default": false,
                            "nullable": true
                          },
                          "top_logprobs": {
                            "description": "An integer between 0 and 20 specifying the number of most likely tokens to return at each token position, each with an associated log probability. `logprobs` must be set to `true` if this parameter is used.",
                            "type": "integer",
                            "minimum": 0,
                            "maximum": 20,
                            "nullable": true
                          },
                          "max_tokens": {
                            "description": "The maximum number of [tokens](/tokenizer) that can be generated in the chat completion.\n\nThe total length of input tokens and generated tokens is limited by the model's context length. [Example Python code](https://cookbook.openai.com/examples/how_to_count_tokens_with_tiktoken) for counting tokens.\n",
                            "type": "integer",
                            "nullable": true
                          },
                          "n": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 128,
                            "default": 1,
                            "example": 1,
                            "nullable": true,
                            "description": "How many chat completion choices to generate for each input message. Note that you will be charged based on the number of generated tokens across all of the choices. Keep `n` as `1` to minimize costs."
                          },
                          "parallel_tool_calls": {
                            "$ref": "#/components/schemas/ParallelToolCalls"
                          },
                          "presence_penalty": {
                            "type": "number",
                            "default": 0,
                            "minimum": -2,
                            "maximum": 2,
                            "nullable": true,
                            "description": "Number between -2.0 and 2.0. Positive values penalize new tokens based on whether they appear in the text so far, increasing the model's likelihood to talk about new topics.\n"
                          },
                          "response_format": {
                            "description": "An object specifying the format that the model must output. Compatible with [GPT-4o](https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-4-and-gpt-4-turbo-models), [GPT-4o mini](https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-4-and-gpt-4-turbo-models), [GPT-4 Turbo](https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-4-and-gpt-4-turbo-models) and all [GPT-3.5](https://learn.microsoft.com/en-us/azure/ai-services/openai/concepts/models#gpt-35) Turbo models newer than `gpt-3.5-turbo-1106`.\n\nSetting to `{ \"type\": \"json_schema\", \"json_schema\": {...} }` enables Structured Outputs which guarantees the model will match your supplied JSON schema.\n\nSetting to `{ \"type\": \"json_object\" }` enables JSON mode, which guarantees the message the model generates is valid JSON.\n\n**Important:** when using JSON mode, you **must** also instruct the model to produce JSON yourself via a system or user message. Without this, the model may generate an unending stream of whitespace until the generation reaches the token limit, resulting in a long-running and seemingly \"stuck\" request. Also note that the message content may be partially cut off if `finish_reason=\"length\"`, which indicates the generation exceeded `max_tokens` or the conversation exceeded the max context length.\n",
                            "oneOf": [
                              {
                                "$ref": "#/components/schemas/ResponseFormatText"
                              },
                              {
                                "$ref": "#/components/schemas/ResponseFormatJsonObject"
                              },
                              {
                                "$ref": "#/components/schemas/ResponseFormatJsonSchema"
                              }
                            ],
                            "x-oaiExpandable": true
                          },
                          "seed": {
                            "type": "integer",
                            "minimum": -9223372036854775808,
                            "maximum": 9223372036854775807,
                            "nullable": true,
                            "description": "This feature is in Beta.\nIf specified, our system will make a best effort to sample deterministically, such that repeated requests with the same `seed` and parameters should return the same result.\nDeterminism is not guaranteed, and you should refer to the `system_fingerprint` response parameter to monitor changes in the backend.\n"
                          },
                          "stop": {
                            "description": "Up to 4 sequences where the API will stop generating further tokens.\n",
                            "default": null,
                            "oneOf": [
                              {
                                "type": "string",
                                "nullable": true
                              },
                              {
                                "type": "array",
                                "minItems": 1,
                                "maxItems": 4,
                                "items": {
                                  "type": "string"
                                }
                              }
                            ]
                          },
                          "stream": {
                            "description": "If set, partial message deltas will be sent, like in ChatGPT. Tokens will be sent as data-only [server-sent events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events#Event_stream_format) as they become available, with the stream terminated by a `data: [DONE]` message. [Example Python code](https://cookbook.openai.com/examples/how_to_stream_completions).\n",
                            "type": "boolean",
                            "nullable": true,
                            "default": false
                          },
                          "stream_options": {
                            "$ref": "#/components/schemas/chatCompletionStreamOptions"
                          },
                          "temperature": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 2,
                            "default": 1,
                            "example": 1,
                            "nullable": true,
                            "description": "What sampling temperature to use, between 0 and 2. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.\n\nWe generally recommend altering this or `top_p` but not both.\n"
                          },
                          "top_p": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "default": 1,
                            "example": 1,
                            "nullable": true,
                            "description": "An alternative to sampling with temperature, called nucleus sampling, where the model considers the results of the tokens with top_p probability mass. So 0.1 means only the tokens comprising the top 10% probability mass are considered.\n\nWe generally recommend altering this or `temperature` but not both.\n"
                          },
                          "tools": {
                            "type": "array",
                            "description": "A list of tools the model may call. Currently, only functions are supported as a tool. Use this to provide a list of functions the model may generate JSON inputs for. A max of 128 functions are supported.\n",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionTool"
                            }
                          },
                          "tool_choice": {
                            "$ref": "#/components/schemas/chatCompletionToolChoiceOption"
                          },
                          "function_call": {
                            "deprecated": true,
                            "description": "Deprecated in favor of `tool_choice`.\n\nControls which (if any) function is called by the model.\n`none` means the model will not call a function and instead generates a message.\n`auto` means the model can pick between generating a message or calling a function.\nSpecifying a particular function via `{\"name\": \"my_function\"}` forces the model to call that function.\n\n`none` is the default when no functions are present. `auto` is the default if functions are present.\n",
                            "oneOf": [
                              {
                                "type": "string",
                                "description": "`none` means the model will not call a function and instead generates a message. `auto` means the model can pick between generating a message or calling a function.\n",
                                "enum": [
                                  "none",
                                  "auto"
                                ]
                              },
                              {
                                "$ref": "#/components/schemas/chatCompletionFunctionCallOption"
                              }
                            ],
                            "x-oaiExpandable": true
                          },
                          "functions": {
                            "deprecated": true,
                            "description": "Deprecated in favor of `tools`.\n\nA list of functions the model may generate JSON inputs for.\n",
                            "type": "array",
                            "minItems": 1,
                            "maxItems": 128,
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionFunctions"
                            }
                          },
                          "user": {
                            "type": "string",
                            "example": "user-1234",
                            "description": "A unique identifier representing your end-user, which can help to monitor and detect abuse.\n"
                          }
                        },
                        "required": [
                          "messages"
                        ]
                      }
                    ]
                  },
                  "chatCompletionFunctions": {
                    "type": "object",
                    "deprecated": true,
                    "properties": {
                      "description": {
                        "type": "string",
                        "description": "A description of what the function does, used by the model to choose when and how to call the function."
                      },
                      "name": {
                        "type": "string",
                        "description": "The name of the function to be called. Must be a-z, A-Z, 0-9, or contain underscores and dashes, with a maximum length of 64."
                      },
                      "parameters": {
                        "$ref": "#/components/schemas/FunctionParameters"
                      }
                    },
                    "required": [
                      "name"
                    ]
                  },
                  "chatCompletionFunctionCallOption": {
                    "type": "object",
                    "description": "Specifying a particular function via `{\"name\": \"my_function\"}` forces the model to call that function.\n",
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "The name of the function to call."
                      }
                    },
                    "required": [
                      "name"
                    ]
                  },
                  "chatCompletionRequestMessage": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestSystemMessage"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestUserMessage"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestAssistantMessage"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestToolMessage"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestFunctionMessage"
                      }
                    ]
                  },
                  "chatCompletionRequestSystemMessage": {
                    "type": "object",
                    "title": "System message",
                    "properties": {
                      "content": {
                        "description": "The contents of the system message.",
                        "oneOf": [
                          {
                            "type": "string",
                            "description": "The contents of the system message.",
                            "title": "Text content"
                          },
                          {
                            "type": "array",
                            "description": "An array of content parts with a defined type. For system messages, only type `text` is supported.",
                            "title": "Array of content parts",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestSystemMessageContentPart"
                            },
                            "minItems": 1
                          }
                        ]
                      },
                      "role": {
                        "type": "string",
                        "enum": [
                          "system"
                        ],
                        "description": "The role of the messages author, in this case `system`."
                      },
                      "name": {
                        "type": "string",
                        "description": "An optional name for the participant. Provides the model information to differentiate between participants of the same role."
                      }
                    },
                    "required": [
                      "content",
                      "role"
                    ]
                  },
                  "chatCompletionRequestUserMessage": {
                    "type": "object",
                    "title": "User message",
                    "properties": {
                      "content": {
                        "description": "The contents of the user message.\n",
                        "oneOf": [
                          {
                            "type": "string",
                            "description": "The text contents of the message.",
                            "title": "Text content"
                          },
                          {
                            "type": "array",
                            "description": "An array of content parts with a defined type, each can be of type `text` or `image_url` when passing in images. You can pass multiple images by adding multiple `image_url` content parts. Image input is only supported when using the `gpt-4o` model.",
                            "title": "Array of content parts",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestUserMessageContentPart"
                            },
                            "minItems": 1
                          }
                        ],
                        "x-oaiExpandable": true
                      },
                      "role": {
                        "type": "string",
                        "enum": [
                          "user"
                        ],
                        "description": "The role of the messages author, in this case `user`."
                      },
                      "name": {
                        "type": "string",
                        "description": "An optional name for the participant. Provides the model information to differentiate between participants of the same role."
                      }
                    },
                    "required": [
                      "content",
                      "role"
                    ]
                  },
                  "chatCompletionRequestAssistantMessage": {
                    "type": "object",
                    "title": "Assistant message",
                    "properties": {
                      "content": {
                        "nullable": true,
                        "oneOf": [
                          {
                            "type": "string",
                            "description": "The contents of the assistant message.",
                            "title": "Text content"
                          },
                          {
                            "type": "array",
                            "description": "An array of content parts with a defined type. Can be one or more of type `text`, or exactly one of type `refusal`.",
                            "title": "Array of content parts",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestAssistantMessageContentPart"
                            },
                            "minItems": 1
                          }
                        ],
                        "description": "The contents of the assistant message. Required unless `tool_calls` or `function_call` is specified.\n"
                      },
                      "refusal": {
                        "nullable": true,
                        "type": "string",
                        "description": "The refusal message by the assistant."
                      },
                      "role": {
                        "type": "string",
                        "enum": [
                          "assistant"
                        ],
                        "description": "The role of the messages author, in this case `assistant`."
                      },
                      "name": {
                        "type": "string",
                        "description": "An optional name for the participant. Provides the model information to differentiate between participants of the same role."
                      },
                      "tool_calls": {
                        "$ref": "#/components/schemas/chatCompletionMessageToolCalls"
                      },
                      "function_call": {
                        "type": "object",
                        "deprecated": true,
                        "description": "Deprecated and replaced by `tool_calls`. The name and arguments of a function that should be called, as generated by the model.",
                        "nullable": true,
                        "properties": {
                          "arguments": {
                            "type": "string",
                            "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                          },
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          }
                        },
                        "required": [
                          "arguments",
                          "name"
                        ]
                      }
                    },
                    "required": [
                      "role"
                    ]
                  },
                  "chatCompletionRequestToolMessage": {
                    "type": "object",
                    "title": "Tool message",
                    "properties": {
                      "role": {
                        "type": "string",
                        "enum": [
                          "tool"
                        ],
                        "description": "The role of the messages author, in this case `tool`."
                      },
                      "content": {
                        "oneOf": [
                          {
                            "type": "string",
                            "description": "The contents of the tool message.",
                            "title": "Text content"
                          },
                          {
                            "type": "array",
                            "description": "An array of content parts with a defined type. For tool messages, only type `text` is supported.",
                            "title": "Array of content parts",
                            "items": {
                              "$ref": "#/components/schemas/chatCompletionRequestToolMessageContentPart"
                            },
                            "minItems": 1
                          }
                        ],
                        "description": "The contents of the tool message."
                      },
                      "tool_call_id": {
                        "type": "string",
                        "description": "Tool call that this message is responding to."
                      }
                    },
                    "required": [
                      "role",
                      "content",
                      "tool_call_id"
                    ]
                  },
                  "chatCompletionRequestFunctionMessage": {
                    "type": "object",
                    "title": "Function message",
                    "deprecated": true,
                    "properties": {
                      "role": {
                        "type": "string",
                        "enum": [
                          "function"
                        ],
                        "description": "The role of the messages author, in this case `function`."
                      },
                      "content": {
                        "nullable": true,
                        "type": "string",
                        "description": "The contents of the function message."
                      },
                      "name": {
                        "type": "string",
                        "description": "The name of the function to call."
                      }
                    },
                    "required": [
                      "role",
                      "content",
                      "name"
                    ]
                  },
                  "chatCompletionRequestSystemMessageContentPart": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartText"
                      }
                    ]
                  },
                  "chatCompletionRequestUserMessageContentPart": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartText"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartImage"
                      }
                    ]
                  },
                  "chatCompletionRequestAssistantMessageContentPart": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartText"
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartRefusal"
                      }
                    ]
                  },
                  "chatCompletionRequestToolMessageContentPart": {
                    "oneOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessageContentPartText"
                      }
                    ]
                  },
                  "chatCompletionRequestMessageContentPartText": {
                    "type": "object",
                    "title": "Text content part",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "text"
                        ],
                        "description": "The type of the content part."
                      },
                      "text": {
                        "type": "string",
                        "description": "The text content."
                      }
                    },
                    "required": [
                      "type",
                      "text"
                    ]
                  },
                  "chatCompletionRequestMessageContentPartImage": {
                    "type": "object",
                    "title": "Image content part",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "image_url"
                        ],
                        "description": "The type of the content part."
                      },
                      "image_url": {
                        "type": "object",
                        "properties": {
                          "url": {
                            "type": "string",
                            "description": "Either a URL of the image or the base64 encoded image data.",
                            "format": "uri"
                          },
                          "detail": {
                            "type": "string",
                            "description": "Specifies the detail level of the image. Learn more in the [Vision guide](https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/gpt-with-vision?tabs=rest%2Csystem-assigned%2Cresource#detail-parameter-settings-in-image-processing-low-high-auto).",
                            "enum": [
                              "auto",
                              "low",
                              "high"
                            ],
                            "default": "auto"
                          }
                        },
                        "required": [
                          "url"
                        ]
                      }
                    },
                    "required": [
                      "type",
                      "image_url"
                    ]
                  },
                  "chatCompletionRequestMessageContentPartRefusal": {
                    "type": "object",
                    "title": "Refusal content part",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "refusal"
                        ],
                        "description": "The type of the content part."
                      },
                      "refusal": {
                        "type": "string",
                        "description": "The refusal message generated by the model."
                      }
                    },
                    "required": [
                      "type",
                      "refusal"
                    ]
                  },
                  "azureChatExtensionConfiguration": {
                    "required": [
                      "type"
                    ],
                    "type": "object",
                    "properties": {
                      "type": {
                        "$ref": "#/components/schemas/azureChatExtensionType"
                      }
                    },
                    "description": "  A representation of configuration data for a single Azure OpenAI chat extension. This will be used by a chat\n  completions request that should use Azure OpenAI chat extensions to augment the response behavior.\n  The use of this configuration is compatible only with Azure OpenAI.",
                    "discriminator": {
                      "propertyName": "type",
                      "mapping": {
                        "azure_search": "#/components/schemas/azureSearchChatExtensionConfiguration",
                        "azure_cosmos_db": "#/components/schemas/azureCosmosDBChatExtensionConfiguration"
                      }
                    }
                  },
                  "azureChatExtensionType": {
                    "type": "string",
                    "description": "  A representation of configuration data for a single Azure OpenAI chat extension. This will be used by a chat\n  completions request that should use Azure OpenAI chat extensions to augment the response behavior.\n  The use of this configuration is compatible only with Azure OpenAI.",
                    "enum": [
                      "azure_search",
                      "azure_cosmos_db"
                    ],
                    "x-ms-enum": {
                      "name": "AzureChatExtensionType",
                      "modelAsString": true,
                      "values": [
                        {
                          "name": "azureSearch",
                          "value": "azure_search",
                          "description": "Represents the use of Azure Search as an Azure OpenAI chat extension."
                        },
                        {
                          "name": "azureCosmosDB",
                          "value": "azure_cosmos_db",
                          "description": "Represents the use of Azure Cosmos DB as an Azure OpenAI chat extension."
                        }
                      ]
                    }
                  },
                  "azureSearchChatExtensionConfiguration": {
                    "required": [
                      "parameters"
                    ],
                    "description": "A specific representation of configurable options for Azure Search when using it as an Azure OpenAI chat\nextension.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/azureChatExtensionConfiguration"
                      },
                      {
                        "properties": {
                          "parameters": {
                            "$ref": "#/components/schemas/azureSearchChatExtensionParameters"
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "azure_search"
                  },
                  "azureSearchChatExtensionParameters": {
                    "required": [
                      "authentication",
                      "endpoint",
                      "index_name"
                    ],
                    "type": "object",
                    "properties": {
                      "authentication": {
                        "oneOf": [
                          {
                            "$ref": "#/components/schemas/onYourDataApiKeyAuthenticationOptions"
                          },
                          {
                            "$ref": "#/components/schemas/onYourDataSystemAssignedManagedIdentityAuthenticationOptions"
                          },
                          {
                            "$ref": "#/components/schemas/onYourDataUserAssignedManagedIdentityAuthenticationOptions"
                          }
                        ]
                      },
                      "top_n_documents": {
                        "type": "integer",
                        "description": "The configured top number of documents to feature for the configured query.",
                        "format": "int32"
                      },
                      "in_scope": {
                        "type": "boolean",
                        "description": "Whether queries should be restricted to use of indexed data."
                      },
                      "strictness": {
                        "maximum": 5,
                        "minimum": 1,
                        "type": "integer",
                        "description": "The configured strictness of the search relevance filtering. The higher of strictness, the higher of the precision but lower recall of the answer.",
                        "format": "int32"
                      },
                      "role_information": {
                        "type": "string",
                        "description": "Give the model instructions about how it should behave and any context it should reference when generating a response. You can describe the assistant's personality and tell it how to format responses. There's a 100 token limit for it, and it counts against the overall token limit."
                      },
                      "endpoint": {
                        "type": "string",
                        "description": "The absolute endpoint path for the Azure Search resource to use.",
                        "format": "uri"
                      },
                      "index_name": {
                        "type": "string",
                        "description": "The name of the index to use as available in the referenced Azure Search resource."
                      },
                      "fields_mapping": {
                        "$ref": "#/components/schemas/azureSearchIndexFieldMappingOptions"
                      },
                      "query_type": {
                        "$ref": "#/components/schemas/azureSearchQueryType"
                      },
                      "semantic_configuration": {
                        "type": "string",
                        "description": "The additional semantic configuration for the query."
                      },
                      "filter": {
                        "type": "string",
                        "description": "Search filter."
                      },
                      "embedding_dependency": {
                        "oneOf": [
                          {
                            "$ref": "#/components/schemas/onYourDataEndpointVectorizationSource"
                          },
                          {
                            "$ref": "#/components/schemas/onYourDataDeploymentNameVectorizationSource"
                          }
                        ]
                      }
                    },
                    "description": "Parameters for Azure Search when used as an Azure OpenAI chat extension."
                  },
                  "azureSearchIndexFieldMappingOptions": {
                    "type": "object",
                    "properties": {
                      "title_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a title."
                      },
                      "url_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a URL."
                      },
                      "filepath_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a filepath."
                      },
                      "content_fields": {
                        "type": "array",
                        "description": "The names of index fields that should be treated as content.",
                        "items": {
                          "type": "string"
                        }
                      },
                      "content_fields_separator": {
                        "type": "string",
                        "description": "The separator pattern that content fields should use."
                      },
                      "vector_fields": {
                        "type": "array",
                        "description": "The names of fields that represent vector data.",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "description": "Optional settings to control how fields are processed when using a configured Azure Search resource."
                  },
                  "azureSearchQueryType": {
                    "type": "string",
                    "description": "The type of Azure Search retrieval query that should be executed when using it as an Azure OpenAI chat extension.",
                    "enum": [
                      "simple",
                      "semantic",
                      "vector",
                      "vector_simple_hybrid",
                      "vector_semantic_hybrid"
                    ],
                    "x-ms-enum": {
                      "name": "AzureSearchQueryType",
                      "modelAsString": true,
                      "values": [
                        {
                          "name": "simple",
                          "value": "simple",
                          "description": "Represents the default, simple query parser."
                        },
                        {
                          "name": "semantic",
                          "value": "semantic",
                          "description": "Represents the semantic query parser for advanced semantic modeling."
                        },
                        {
                          "name": "vector",
                          "value": "vector",
                          "description": "Represents vector search over computed data."
                        },
                        {
                          "name": "vectorSimpleHybrid",
                          "value": "vector_simple_hybrid",
                          "description": "Represents a combination of the simple query strategy with vector data."
                        },
                        {
                          "name": "vectorSemanticHybrid",
                          "value": "vector_semantic_hybrid",
                          "description": "Represents a combination of semantic search and vector data querying."
                        }
                      ]
                    }
                  },
                  "azureCosmosDBChatExtensionConfiguration": {
                    "required": [
                      "parameters"
                    ],
                    "description": "A specific representation of configurable options for Azure Cosmos DB when using it as an Azure OpenAI chat\nextension.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/azureChatExtensionConfiguration"
                      },
                      {
                        "properties": {
                          "parameters": {
                            "$ref": "#/components/schemas/azureCosmosDBChatExtensionParameters"
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "azure_cosmos_db"
                  },
                  "azureCosmosDBChatExtensionParameters": {
                    "required": [
                      "authentication",
                      "container_name",
                      "database_name",
                      "embedding_dependency",
                      "fields_mapping",
                      "index_name"
                    ],
                    "type": "object",
                    "properties": {
                      "authentication": {
                        "$ref": "#/components/schemas/onYourDataConnectionStringAuthenticationOptions"
                      },
                      "top_n_documents": {
                        "type": "integer",
                        "description": "The configured top number of documents to feature for the configured query.",
                        "format": "int32"
                      },
                      "in_scope": {
                        "type": "boolean",
                        "description": "Whether queries should be restricted to use of indexed data."
                      },
                      "strictness": {
                        "maximum": 5,
                        "minimum": 1,
                        "type": "integer",
                        "description": "The configured strictness of the search relevance filtering. The higher of strictness, the higher of the precision but lower recall of the answer.",
                        "format": "int32"
                      },
                      "role_information": {
                        "type": "string",
                        "description": "Give the model instructions about how it should behave and any context it should reference when generating a response. You can describe the assistant's personality and tell it how to format responses. There's a 100 token limit for it, and it counts against the overall token limit."
                      },
                      "database_name": {
                        "type": "string",
                        "description": "The MongoDB vCore database name to use with Azure Cosmos DB."
                      },
                      "container_name": {
                        "type": "string",
                        "description": "The name of the Azure Cosmos DB resource container."
                      },
                      "index_name": {
                        "type": "string",
                        "description": "The MongoDB vCore index name to use with Azure Cosmos DB."
                      },
                      "fields_mapping": {
                        "$ref": "#/components/schemas/azureCosmosDBFieldMappingOptions"
                      },
                      "embedding_dependency": {
                        "oneOf": [
                          {
                            "$ref": "#/components/schemas/onYourDataEndpointVectorizationSource"
                          },
                          {
                            "$ref": "#/components/schemas/onYourDataDeploymentNameVectorizationSource"
                          }
                        ]
                      }
                    },
                    "description": "Parameters to use when configuring Azure OpenAI On Your Data chat extensions when using Azure Cosmos DB for\nMongoDB vCore."
                  },
                  "azureCosmosDBFieldMappingOptions": {
                    "required": [
                      "content_fields",
                      "vector_fields"
                    ],
                    "type": "object",
                    "properties": {
                      "title_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a title."
                      },
                      "url_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a URL."
                      },
                      "filepath_field": {
                        "type": "string",
                        "description": "The name of the index field to use as a filepath."
                      },
                      "content_fields": {
                        "type": "array",
                        "description": "The names of index fields that should be treated as content.",
                        "items": {
                          "type": "string"
                        }
                      },
                      "content_fields_separator": {
                        "type": "string",
                        "description": "The separator pattern that content fields should use."
                      },
                      "vector_fields": {
                        "type": "array",
                        "description": "The names of fields that represent vector data.",
                        "items": {
                          "type": "string"
                        }
                      }
                    },
                    "description": "Optional settings to control how fields are processed when using a configured Azure Cosmos DB resource."
                  },
                  "onYourDataAuthenticationOptions": {
                    "required": [
                      "type"
                    ],
                    "type": "object",
                    "properties": {
                      "type": {
                        "$ref": "#/components/schemas/onYourDataAuthenticationType"
                      }
                    },
                    "description": "The authentication options for Azure OpenAI On Your Data.",
                    "discriminator": {
                      "propertyName": "type",
                      "mapping": {
                        "api_key": "#/components/schemas/onYourDataApiKeyAuthenticationOptions",
                        "connection_string": "#/components/schemas/onYourDataConnectionStringAuthenticationOptions",
                        "system_assigned_managed_identity": "#/components/schemas/onYourDataSystemAssignedManagedIdentityAuthenticationOptions",
                        "user_assigned_managed_identity": "#/components/schemas/onYourDataUserAssignedManagedIdentityAuthenticationOptions"
                      }
                    }
                  },
                  "onYourDataAuthenticationType": {
                    "type": "string",
                    "description": "The authentication types supported with Azure OpenAI On Your Data.",
                    "enum": [
                      "api_key",
                      "connection_string",
                      "system_assigned_managed_identity",
                      "user_assigned_managed_identity"
                    ],
                    "x-ms-enum": {
                      "name": "OnYourDataAuthenticationType",
                      "modelAsString": true,
                      "values": [
                        {
                          "name": "apiKey",
                          "value": "api_key",
                          "description": "Authentication via API key."
                        },
                        {
                          "name": "connectionString",
                          "value": "connection_string",
                          "description": "Authentication via connection string."
                        },
                        {
                          "name": "systemAssignedManagedIdentity",
                          "value": "system_assigned_managed_identity",
                          "description": "Authentication via system-assigned managed identity."
                        },
                        {
                          "name": "userAssignedManagedIdentity",
                          "value": "user_assigned_managed_identity",
                          "description": "Authentication via user-assigned managed identity."
                        }
                      ]
                    }
                  },
                  "onYourDataApiKeyAuthenticationOptions": {
                    "required": [
                      "key"
                    ],
                    "description": "The authentication options for Azure OpenAI On Your Data when using an API key.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataAuthenticationOptions"
                      },
                      {
                        "properties": {
                          "key": {
                            "type": "string",
                            "description": "The API key to use for authentication."
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "api_key"
                  },
                  "onYourDataConnectionStringAuthenticationOptions": {
                    "required": [
                      "connection_string"
                    ],
                    "description": "The authentication options for Azure OpenAI On Your Data when using a connection string.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataAuthenticationOptions"
                      },
                      {
                        "properties": {
                          "connection_string": {
                            "type": "string",
                            "description": "The connection string to use for authentication."
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "connection_string"
                  },
                  "onYourDataSystemAssignedManagedIdentityAuthenticationOptions": {
                    "description": "The authentication options for Azure OpenAI On Your Data when using a system-assigned managed identity.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataAuthenticationOptions"
                      }
                    ],
                    "x-ms-discriminator-value": "system_assigned_managed_identity"
                  },
                  "onYourDataUserAssignedManagedIdentityAuthenticationOptions": {
                    "required": [
                      "managed_identity_resource_id"
                    ],
                    "description": "The authentication options for Azure OpenAI On Your Data when using a user-assigned managed identity.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataAuthenticationOptions"
                      },
                      {
                        "properties": {
                          "managed_identity_resource_id": {
                            "type": "string",
                            "description": "The resource ID of the user-assigned managed identity to use for authentication."
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "user_assigned_managed_identity"
                  },
                  "onYourDataVectorizationSource": {
                    "required": [
                      "type"
                    ],
                    "type": "object",
                    "properties": {
                      "type": {
                        "$ref": "#/components/schemas/onYourDataVectorizationSourceType"
                      }
                    },
                    "description": "An abstract representation of a vectorization source for Azure OpenAI On Your Data with vector search.",
                    "discriminator": {
                      "propertyName": "type",
                      "mapping": {
                        "endpoint": "#/components/schemas/onYourDataEndpointVectorizationSource",
                        "deployment_name": "#/components/schemas/onYourDataDeploymentNameVectorizationSource"
                      }
                    }
                  },
                  "onYourDataVectorizationSourceType": {
                    "type": "string",
                    "description": "Represents the available sources Azure OpenAI On Your Data can use to configure vectorization of data for use with\nvector search.",
                    "enum": [
                      "endpoint",
                      "deployment_name"
                    ],
                    "x-ms-enum": {
                      "name": "OnYourDataVectorizationSourceType",
                      "modelAsString": true,
                      "values": [
                        {
                          "name": "endpoint",
                          "value": "endpoint",
                          "description": "Represents vectorization performed by public service calls to an Azure OpenAI embedding model."
                        },
                        {
                          "name": "deploymentName",
                          "value": "deployment_name",
                          "description": "Represents an Ada model deployment name to use. This model deployment must be in the same Azure OpenAI resource, but\nOn Your Data will use this model deployment via an internal call rather than a public one, which enables vector\nsearch even in private networks."
                        }
                      ]
                    }
                  },
                  "onYourDataDeploymentNameVectorizationSource": {
                    "required": [
                      "deployment_name"
                    ],
                    "description": "The details of a a vectorization source, used by Azure OpenAI On Your Data when applying vector search, that is based\non an internal embeddings model deployment name in the same Azure OpenAI resource.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataVectorizationSource"
                      },
                      {
                        "properties": {
                          "deployment_name": {
                            "type": "string",
                            "description": "Specifies the name of the model deployment to use for vectorization. This model deployment must be in the same Azure OpenAI resource, but On Your Data will use this model deployment via an internal call rather than a public one, which enables vector search even in private networks."
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "deployment_name"
                  },
                  "onYourDataEndpointVectorizationSource": {
                    "required": [
                      "authentication",
                      "endpoint"
                    ],
                    "description": "The details of a a vectorization source, used by Azure OpenAI On Your Data when applying vector search, that is based\non a public Azure OpenAI endpoint call for embeddings.",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/onYourDataVectorizationSource"
                      },
                      {
                        "properties": {
                          "authentication": {
                            "$ref": "#/components/schemas/onYourDataApiKeyAuthenticationOptions"
                          },
                          "endpoint": {
                            "type": "string",
                            "description": "Specifies the endpoint to use for vectorization. This endpoint must be in the same Azure OpenAI resource, but On Your Data will use this endpoint via an internal call rather than a public one, which enables vector search even in private networks.",
                            "format": "uri"
                          }
                        }
                      }
                    ],
                    "x-ms-discriminator-value": "endpoint"
                  },
                  "azureChatExtensionsMessageContext": {
                    "type": "object",
                    "properties": {
                      "citations": {
                        "type": "array",
                        "description": "The data source retrieval result, used to generate the assistant message in the response.",
                        "items": {
                          "$ref": "#/components/schemas/citation"
                        },
                        "x-ms-identifiers": []
                      },
                      "intent": {
                        "type": "string",
                        "description": "The detected intent from the chat history, used to pass to the next turn to carry over the context."
                      }
                    },
                    "description": "  A representation of the additional context information available when Azure OpenAI chat extensions are involved\n  in the generation of a corresponding chat completions response. This context information is only populated when\n  using an Azure OpenAI request configured to use a matching extension."
                  },
                  "citation": {
                    "required": [
                      "content"
                    ],
                    "type": "object",
                    "properties": {
                      "content": {
                        "type": "string",
                        "description": "The content of the citation."
                      },
                      "title": {
                        "type": "string",
                        "description": "The title of the citation."
                      },
                      "url": {
                        "type": "string",
                        "description": "The URL of the citation."
                      },
                      "filepath": {
                        "type": "string",
                        "description": "The file path of the citation."
                      },
                      "chunk_id": {
                        "type": "string",
                        "description": "The chunk ID of the citation."
                      }
                    },
                    "description": "citation information for a chat completions response message."
                  },
                  "chatCompletionMessageToolCall": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "The ID of the tool call."
                      },
                      "type": {
                        "$ref": "#/components/schemas/toolCallType"
                      },
                      "function": {
                        "type": "object",
                        "description": "The function that the model called.",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          },
                          "arguments": {
                            "type": "string",
                            "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                          }
                        },
                        "required": [
                          "name",
                          "arguments"
                        ]
                      }
                    },
                    "required": [
                      "id",
                      "type",
                      "function"
                    ]
                  },
                  "toolCallType": {
                    "type": "string",
                    "enum": [
                      "function"
                    ],
                    "description": "The type of the tool call, in this case `function`.",
                    "x-ms-enum": {
                      "name": "ToolCallType",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "function",
                          "description": "The tool call type is function."
                        }
                      ]
                    }
                  },
                  "chatCompletionRequestMessageTool": {
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessage"
                      },
                      {
                        "type": "object",
                        "nullable": true,
                        "properties": {
                          "tool_call_id": {
                            "type": "string",
                            "description": "Tool call that this message is responding to."
                          },
                          "content": {
                            "type": "string",
                            "description": "The contents of the message.",
                            "nullable": true
                          }
                        }
                      }
                    ],
                    "required": [
                      "tool_call_id",
                      "content"
                    ]
                  },
                  "chatCompletionRequestMessageFunction": {
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/chatCompletionRequestMessage"
                      },
                      {
                        "type": "object",
                        "description": "Deprecated. Message that represents a function.",
                        "nullable": true,
                        "properties": {
                          "role": {
                            "type": "string",
                            "enum": [
                              "function"
                            ],
                            "description": "The role of the messages author, in this case `function`."
                          },
                          "name": {
                            "type": "string",
                            "description": "The contents of the message."
                          },
                          "content": {
                            "type": "string",
                            "description": "The contents of the message.",
                            "nullable": true
                          }
                        }
                      }
                    ],
                    "required": [
                      "function_call_id",
                      "content"
                    ]
                  },
                  "createChatCompletionResponse": {
                    "type": "object",
                    "description": "Represents a chat completion response returned by model, based on the provided input.",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "A unique identifier for the chat completion."
                      },
                      "prompt_filter_results": {
                        "$ref": "#/components/schemas/promptFilterResults"
                      },
                      "choices": {
                        "type": "array",
                        "description": "A list of chat completion choices. Can be more than one if `n` is greater than 1.",
                        "items": {
                          "type": "object",
                          "required": [
                            "finish_reason",
                            "index",
                            "message",
                            "logprobs"
                          ],
                          "properties": {
                            "finish_reason": {
                              "type": "string",
                              "description": "The reason the model stopped generating tokens. This will be `stop` if the model hit a natural stop point or a provided stop sequence,\n`length` if the maximum number of tokens specified in the request was reached,\n`content_filter` if content was omitted due to a flag from our content filters,\n`tool_calls` if the model called a tool, or `function_call` (deprecated) if the model called a function.\n",
                              "enum": [
                                "stop",
                                "length",
                                "tool_calls",
                                "content_filter",
                                "function_call"
                              ]
                            },
                            "index": {
                              "type": "integer",
                              "description": "The index of the choice in the list of choices."
                            },
                            "message": {
                              "$ref": "#/components/schemas/chatCompletionResponseMessage"
                            },
                            "content_filter_results": {
                              "$ref": "#/components/schemas/contentFilterChoiceResults"
                            },
                            "logprobs": {
                              "description": "Log probability information for the choice.",
                              "type": "object",
                              "nullable": true,
                              "properties": {
                                "content": {
                                  "description": "A list of message content tokens with log probability information.",
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                                  },
                                  "nullable": true
                                },
                                "refusal": {
                                  "description": "A list of message refusal tokens with log probability information.",
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                                  },
                                  "nullable": true
                                }
                              },
                              "required": [
                                "content",
                                "refusal"
                              ]
                            }
                          }
                        }
                      },
                      "created": {
                        "type": "integer",
                        "description": "The Unix timestamp (in seconds) of when the chat completion was created."
                      },
                      "model": {
                        "type": "string",
                        "description": "The model used for the chat completion."
                      },
                      "system_fingerprint": {
                        "type": "string",
                        "description": "This fingerprint represents the backend configuration that the model runs with.\n\nCan be used in conjunction with the `seed` request parameter to understand when backend changes have been made that might impact determinism.\n"
                      },
                      "object": {
                        "type": "string",
                        "description": "The object type, which is always `chat.completion`.",
                        "enum": [
                          "chat.completion"
                        ]
                      },
                      "usage": {
                        "$ref": "#/components/schemas/completionUsage"
                      }
                    },
                    "required": [
                      "choices",
                      "created",
                      "id",
                      "model",
                      "object"
                    ]
                  },
                  "createChatCompletionStreamResponse": {
                    "type": "object",
                    "description": "Represents a streamed chunk of a chat completion response returned by model, based on the provided input.",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "A unique identifier for the chat completion. Each chunk has the same ID."
                      },
                      "choices": {
                        "type": "array",
                        "description": "A list of chat completion choices. Can contain more than one elements if `n` is greater than 1.\n",
                        "items": {
                          "type": "object",
                          "required": [
                            "delta",
                            "finish_reason",
                            "index"
                          ],
                          "properties": {
                            "delta": {
                              "$ref": "#/components/schemas/chatCompletionStreamResponseDelta"
                            },
                            "logprobs": {
                              "description": "Log probability information for the choice.",
                              "type": "object",
                              "nullable": true,
                              "properties": {
                                "content": {
                                  "description": "A list of message content tokens with log probability information.",
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                                  },
                                  "nullable": true
                                },
                                "refusal": {
                                  "description": "A list of message refusal tokens with log probability information.",
                                  "type": "array",
                                  "items": {
                                    "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                                  },
                                  "nullable": true
                                }
                              },
                              "required": [
                                "content",
                                "refusal"
                              ]
                            },
                            "finish_reason": {
                              "type": "string",
                              "description": "The reason the model stopped generating tokens. This will be `stop` if the model hit a natural stop point or a provided stop sequence,\n`length` if the maximum number of tokens specified in the request was reached,\n`content_filter` if content was omitted due to a flag from our content filters,\n`tool_calls` if the model called a tool, or `function_call` (deprecated) if the model called a function.\n",
                              "enum": [
                                "stop",
                                "length",
                                "tool_calls",
                                "content_filter",
                                "function_call"
                              ],
                              "nullable": true
                            },
                            "index": {
                              "type": "integer",
                              "description": "The index of the choice in the list of choices."
                            }
                          }
                        }
                      },
                      "created": {
                        "type": "integer",
                        "description": "The Unix timestamp (in seconds) of when the chat completion was created. Each chunk has the same timestamp."
                      },
                      "model": {
                        "type": "string",
                        "description": "The model to generate the completion."
                      },
                      "system_fingerprint": {
                        "type": "string",
                        "description": "This fingerprint represents the backend configuration that the model runs with.\nCan be used in conjunction with the `seed` request parameter to understand when backend changes have been made that might impact determinism.\n"
                      },
                      "object": {
                        "type": "string",
                        "description": "The object type, which is always `chat.completion.chunk`.",
                        "enum": [
                          "chat.completion.chunk"
                        ],
                        "required": [
                          "prompt_tokens",
                          "completion_tokens",
                          "total_tokens"
                        ]
                      }
                    },
                    "required": [
                      "choices",
                      "created",
                      "id",
                      "model",
                      "object"
                    ]
                  },
                  "chatCompletionStreamResponseDelta": {
                    "type": "object",
                    "description": "A chat completion delta generated by streamed model responses.",
                    "properties": {
                      "content": {
                        "type": "string",
                        "description": "The contents of the chunk message.",
                        "nullable": true
                      },
                      "function_call": {
                        "deprecated": true,
                        "type": "object",
                        "description": "Deprecated and replaced by `tool_calls`. The name and arguments of a function that should be called, as generated by the model.",
                        "properties": {
                          "arguments": {
                            "type": "string",
                            "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                          },
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          }
                        }
                      },
                      "tool_calls": {
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/chatCompletionMessageToolCallChunk"
                        }
                      },
                      "role": {
                        "type": "string",
                        "enum": [
                          "system",
                          "user",
                          "assistant",
                          "tool"
                        ],
                        "description": "The role of the author of this message."
                      },
                      "refusal": {
                        "type": "string",
                        "description": "The refusal message generated by the model.",
                        "nullable": true
                      }
                    }
                  },
                  "chatCompletionMessageToolCallChunk": {
                    "type": "object",
                    "properties": {
                      "index": {
                        "type": "integer"
                      },
                      "id": {
                        "type": "string",
                        "description": "The ID of the tool call."
                      },
                      "type": {
                        "type": "string",
                        "enum": [
                          "function"
                        ],
                        "description": "The type of the tool. Currently, only `function` is supported."
                      },
                      "function": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          },
                          "arguments": {
                            "type": "string",
                            "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                          }
                        }
                      }
                    },
                    "required": [
                      "index"
                    ]
                  },
                  "chatCompletionStreamOptions": {
                    "description": "Options for streaming response. Only set this when you set `stream: true`.\n",
                    "type": "object",
                    "nullable": true,
                    "default": null,
                    "properties": {
                      "include_usage": {
                        "type": "boolean",
                        "description": "If set, an additional chunk will be streamed before the `data: [DONE]` message. The `usage` field on this chunk shows the token usage statistics for the entire request, and the `choices` field will always be an empty array. All other chunks will also include a `usage` field, but with a null value.\n"
                      }
                    }
                  },
                  "chatCompletionChoiceLogProbs": {
                    "description": "Log probability information for the choice.",
                    "type": "object",
                    "nullable": true,
                    "properties": {
                      "content": {
                        "description": "A list of message content tokens with log probability information.",
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                        },
                        "nullable": true
                      },
                      "refusal": {
                        "description": "A list of message refusal tokens with log probability information.",
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/chatCompletionTokenLogprob"
                        },
                        "nullable": true
                      }
                    },
                    "required": [
                      "content"
                    ]
                  },
                  "chatCompletionTokenLogprob": {
                    "type": "object",
                    "properties": {
                      "token": {
                        "description": "The token.",
                        "type": "string"
                      },
                      "logprob": {
                        "description": "The log probability of this token.",
                        "type": "number"
                      },
                      "bytes": {
                        "description": "A list of integers representing the UTF-8 bytes representation of the token. Useful in instances where characters are represented by multiple tokens and their byte representations must be combined to generate the correct text representation. Can be `null` if there is no bytes representation for the token.",
                        "type": "array",
                        "items": {
                          "type": "integer"
                        },
                        "nullable": true
                      },
                      "top_logprobs": {
                        "description": "List of the most likely tokens and their log probability, at this token position. In rare cases, there may be fewer than the number of requested `top_logprobs` returned.",
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "token": {
                              "description": "The token.",
                              "type": "string"
                            },
                            "logprob": {
                              "description": "The log probability of this token.",
                              "type": "number"
                            },
                            "bytes": {
                              "description": "A list of integers representing the UTF-8 bytes representation of the token. Useful in instances where characters are represented by multiple tokens and their byte representations must be combined to generate the correct text representation. Can be `null` if there is no bytes representation for the token.",
                              "type": "array",
                              "items": {
                                "type": "integer"
                              },
                              "nullable": true
                            }
                          },
                          "required": [
                            "token",
                            "logprob",
                            "bytes"
                          ]
                        }
                      }
                    },
                    "required": [
                      "token",
                      "logprob",
                      "bytes",
                      "top_logprobs"
                    ]
                  },
                  "chatCompletionResponseMessage": {
                    "type": "object",
                    "description": "A chat completion message generated by the model.",
                    "properties": {
                      "role": {
                        "$ref": "#/components/schemas/chatCompletionResponseMessageRole"
                      },
                      "refusal": {
                        "type": "string",
                        "description": "The refusal message generated by the model.",
                        "nullable": true
                      },
                      "content": {
                        "type": "string",
                        "description": "The contents of the message.",
                        "nullable": true
                      },
                      "tool_calls": {
                        "type": "array",
                        "description": "The tool calls generated by the model, such as function calls.",
                        "items": {
                          "$ref": "#/components/schemas/chatCompletionMessageToolCall"
                        }
                      },
                      "function_call": {
                        "$ref": "#/components/schemas/chatCompletionFunctionCall"
                      },
                      "context": {
                        "$ref": "#/components/schemas/azureChatExtensionsMessageContext"
                      }
                    },
                    "required": [
                      "role",
                      "content",
                      "refusal"
                    ]
                  },
                  "chatCompletionResponseMessageRole": {
                    "type": "string",
                    "enum": [
                      "assistant"
                    ],
                    "description": "The role of the author of the response message."
                  },
                  "chatCompletionToolChoiceOption": {
                    "description": "Controls which (if any) tool is called by the model.\n`none` means the model will not call any tool and instead generates a message.\n`auto` means the model can pick between generating a message or calling one or more tools.\n`required` means the model must call one or more tools.\nSpecifying a particular tool via `{\"type\": \"function\", \"function\": {\"name\": \"my_function\"}}` forces the model to call that tool.\n`none` is the default when no tools are present. `auto` is the default if tools are present.\n",
                    "oneOf": [
                      {
                        "type": "string",
                        "description": "`none` means the model will not call any tool and instead generates a message. `auto` means the model can pick between generating a message or calling one or more tools. `required` means the model must call one or more tools.\n",
                        "enum": [
                          "none",
                          "auto",
                          "required"
                        ]
                      },
                      {
                        "$ref": "#/components/schemas/chatCompletionNamedToolChoice"
                      }
                    ]
                  },
                  "chatCompletionNamedToolChoice": {
                    "type": "object",
                    "description": "Specifies a tool the model should use. Use to force the model to call a specific function.",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "function"
                        ],
                        "description": "The type of the tool. Currently, only `function` is supported."
                      },
                      "function": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string",
                            "description": "The name of the function to call."
                          }
                        },
                        "required": [
                          "name"
                        ]
                      }
                    },
                    "required": [
                      "type",
                      "function"
                    ]
                  },
                  "ParallelToolCalls": {
                    "description": "Whether to enable parallel function calling during tool use.",
                    "type": "boolean",
                    "default": true
                  },
                  "chatCompletionMessageToolCalls": {
                    "type": "array",
                    "description": "The tool calls generated by the model, such as function calls.",
                    "items": {
                      "$ref": "#/components/schemas/chatCompletionMessageToolCall"
                    }
                  },
                  "chatCompletionFunctionCall": {
                    "type": "object",
                    "description": "Deprecated and replaced by `tool_calls`. The name and arguments of a function that should be called, as generated by the model.",
                    "properties": {
                      "name": {
                        "type": "string",
                        "description": "The name of the function to call."
                      },
                      "arguments": {
                        "type": "string",
                        "description": "The arguments to call the function with, as generated by the model in JSON format. Note that the model does not always generate valid JSON, and may hallucinate parameters not defined by your function schema. Validate the arguments in your code before calling your function."
                      }
                    },
                    "required": [
                      "name",
                      "arguments"
                    ]
                  },
                  "completionUsage": {
                    "type": "object",
                    "description": "Usage statistics for the completion request.",
                    "properties": {
                      "prompt_tokens": {
                        "type": "integer",
                        "description": "Number of tokens in the prompt."
                      },
                      "completion_tokens": {
                        "type": "integer",
                        "description": "Number of tokens in the generated completion."
                      },
                      "total_tokens": {
                        "type": "integer",
                        "description": "Total number of tokens used in the request (prompt + completion)."
                      },
                      "completion_tokens_details": {
                        "type": "object",
                        "description": "Breakdown of tokens used in a completion.",
                        "properties": {
                          "reasoning_tokens": {
                            "type": "integer",
                            "description": "Tokens generated by the model for reasoning."
                          }
                        }
                      }
                    },
                    "required": [
                      "prompt_tokens",
                      "completion_tokens",
                      "total_tokens"
                    ]
                  },
                  "chatCompletionTool": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "enum": [
                          "function"
                        ],
                        "description": "The type of the tool. Currently, only `function` is supported."
                      },
                      "function": {
                        "$ref": "#/components/schemas/FunctionObject"
                      }
                    },
                    "required": [
                      "type",
                      "function"
                    ]
                  },
                  "FunctionParameters": {
                    "type": "object",
                    "description": "The parameters the functions accepts, described as a JSON Schema object. See the guide](https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling) for examples, and the [JSON Schema reference](https://json-schema.org/understanding-json-schema/) for documentation about the format. \n\nOmitting `parameters` defines a function with an empty parameter list.",
                    "additionalProperties": true
                  },
                  "FunctionObject": {
                    "type": "object",
                    "properties": {
                      "description": {
                        "type": "string",
                        "description": "A description of what the function does, used by the model to choose when and how to call the function."
                      },
                      "name": {
                        "type": "string",
                        "description": "The name of the function to be called. Must be a-z, A-Z, 0-9, or contain underscores and dashes, with a maximum length of 64."
                      },
                      "parameters": {
                        "$ref": "#/components/schemas/FunctionParameters"
                      },
                      "strict": {
                        "type": "boolean",
                        "nullable": true,
                        "default": false,
                        "description": "Whether to enable strict schema adherence when generating the function call. If set to true, the model will follow the exact schema defined in the `parameters` field. Only a subset of JSON Schema is supported when `strict` is `true`. Learn more about Structured Outputs in the [function calling guide](docs/guides/function-calling)."
                      }
                    },
                    "required": [
                      "name"
                    ]
                  },
                  "ResponseFormatText": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "description": "The type of response format being defined: `text`",
                        "enum": [
                          "text"
                        ]
                      }
                    },
                    "required": [
                      "type"
                    ]
                  },
                  "ResponseFormatJsonObject": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "description": "The type of response format being defined: `json_object`",
                        "enum": [
                          "json_object"
                        ]
                      }
                    },
                    "required": [
                      "type"
                    ]
                  },
                  "ResponseFormatJsonSchemaSchema": {
                    "type": "object",
                    "description": "The schema for the response format, described as a JSON Schema object.",
                    "additionalProperties": true
                  },
                  "ResponseFormatJsonSchema": {
                    "type": "object",
                    "properties": {
                      "type": {
                        "type": "string",
                        "description": "The type of response format being defined: `json_schema`",
                        "enum": [
                          "json_schema"
                        ]
                      },
                      "json_schema": {
                        "type": "object",
                        "properties": {
                          "description": {
                            "type": "string",
                            "description": "A description of what the response format is for, used by the model to determine how to respond in the format."
                          },
                          "name": {
                            "type": "string",
                            "description": "The name of the response format. Must be a-z, A-Z, 0-9, or contain underscores and dashes, with a maximum length of 64."
                          },
                          "schema": {
                            "$ref": "#/components/schemas/ResponseFormatJsonSchemaSchema"
                          },
                          "strict": {
                            "type": "boolean",
                            "nullable": true,
                            "default": false,
                            "description": "Whether to enable strict schema adherence when generating the output. If set to true, the model will always follow the exact schema defined in the `schema` field. Only a subset of JSON Schema is supported when `strict` is `true`."
                          }
                        },
                        "required": [
                          "type",
                          "name"
                        ]
                      }
                    },
                    "required": [
                      "type",
                      "json_schema"
                    ]
                  },
                  "chatCompletionChoiceCommon": {
                    "type": "object",
                    "properties": {
                      "index": {
                        "type": "integer"
                      },
                      "finish_reason": {
                        "type": "string"
                      }
                    }
                  },
                  "createTranslationRequest": {
                    "type": "object",
                    "description": "Translation request.",
                    "properties": {
                      "file": {
                        "type": "string",
                        "description": "The audio file to translate.",
                        "format": "binary"
                      },
                      "prompt": {
                        "type": "string",
                        "description": "An optional text to guide the model's style or continue a previous audio segment. The prompt should be in English."
                      },
                      "response_format": {
                        "$ref": "#/components/schemas/audioResponseFormat"
                      },
                      "temperature": {
                        "type": "number",
                        "default": 0,
                        "description": "The sampling temperature, between 0 and 1. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic. If set to 0, the model will use log probability to automatically increase the temperature until certain thresholds are hit."
                      }
                    },
                    "required": [
                      "file"
                    ]
                  },
                  "audioResponse": {
                    "description": "Translation or transcription response when response_format was json",
                    "type": "object",
                    "properties": {
                      "text": {
                        "type": "string",
                        "description": "Translated or transcribed text."
                      }
                    },
                    "required": [
                      "text"
                    ]
                  },
                  "audioVerboseResponse": {
                    "description": "Translation or transcription response when response_format was verbose_json",
                    "type": "object",
                    "allOf": [
                      {
                        "$ref": "#/components/schemas/audioResponse"
                      },
                      {
                        "properties": {
                          "task": {
                            "type": "string",
                            "description": "Type of audio task.",
                            "enum": [
                              "transcribe",
                              "translate"
                            ],
                            "x-ms-enum": {
                              "modelAsString": true
                            }
                          },
                          "language": {
                            "type": "string",
                            "description": "Language."
                          },
                          "duration": {
                            "type": "number",
                            "description": "Duration."
                          },
                          "segments": {
                            "type": "array",
                            "items": {
                              "$ref": "#/components/schemas/audioSegment"
                            }
                          }
                        }
                      }
                    ],
                    "required": [
                      "text"
                    ]
                  },
                  "audioResponseFormat": {
                    "title": "AudioResponseFormat",
                    "description": "Defines the format of the output.",
                    "enum": [
                      "json",
                      "text",
                      "srt",
                      "verbose_json",
                      "vtt"
                    ],
                    "type": "string",
                    "x-ms-enum": {
                      "modelAsString": true
                    }
                  },
                  "createTranscriptionRequest": {
                    "type": "object",
                    "description": "Transcription request.",
                    "properties": {
                      "file": {
                        "type": "string",
                        "description": "The audio file object to transcribe.",
                        "format": "binary"
                      },
                      "prompt": {
                        "type": "string",
                        "description": "An optional text to guide the model's style or continue a previous audio segment. The prompt should match the audio language."
                      },
                      "response_format": {
                        "$ref": "#/components/schemas/audioResponseFormat"
                      },
                      "temperature": {
                        "type": "number",
                        "default": 0,
                        "description": "The sampling temperature, between 0 and 1. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic. If set to 0, the model will use log probability to automatically increase the temperature until certain thresholds are hit."
                      },
                      "language": {
                        "type": "string",
                        "description": "The language of the input audio. Supplying the input language in ISO-639-1 format will improve accuracy and latency."
                      }
                    },
                    "required": [
                      "file"
                    ]
                  },
                  "audioSegment": {
                    "type": "object",
                    "description": "Transcription or translation segment.",
                    "properties": {
                      "id": {
                        "type": "integer",
                        "description": "Segment identifier."
                      },
                      "seek": {
                        "type": "number",
                        "description": "Offset of the segment."
                      },
                      "start": {
                        "type": "number",
                        "description": "Segment start offset."
                      },
                      "end": {
                        "type": "number",
                        "description": "Segment end offset."
                      },
                      "text": {
                        "type": "string",
                        "description": "Segment text."
                      },
                      "tokens": {
                        "type": "array",
                        "items": {
                          "type": "number",
                          "nullable": false
                        },
                        "description": "Tokens of the text."
                      },
                      "temperature": {
                        "type": "number",
                        "description": "Temperature."
                      },
                      "avg_logprob": {
                        "type": "number",
                        "description": "Average log probability."
                      },
                      "compression_ratio": {
                        "type": "number",
                        "description": "Compression ratio."
                      },
                      "no_speech_prob": {
                        "type": "number",
                        "description": "Probability of 'no speech'."
                      }
                    }
                  },
                  "imageQuality": {
                    "description": "The quality of the image that will be generated.",
                    "type": "string",
                    "enum": [
                      "standard",
                      "hd"
                    ],
                    "default": "standard",
                    "x-ms-enum": {
                      "name": "Quality",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "standard",
                          "description": "Standard quality creates images with standard quality.",
                          "name": "Standard"
                        },
                        {
                          "value": "hd",
                          "description": "HD quality creates images with finer details and greater consistency across the image.",
                          "name": "HD"
                        }
                      ]
                    }
                  },
                  "imagesResponseFormat": {
                    "description": "The format in which the generated images are returned.",
                    "type": "string",
                    "enum": [
                      "url",
                      "b64_json"
                    ],
                    "default": "url",
                    "x-ms-enum": {
                      "name": "ImagesResponseFormat",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "url",
                          "description": "The URL that provides temporary access to download the generated images.",
                          "name": "Url"
                        },
                        {
                          "value": "b64_json",
                          "description": "The generated images are returned as base64 encoded string.",
                          "name": "Base64Json"
                        }
                      ]
                    }
                  },
                  "imageSize": {
                    "description": "The size of the generated images.",
                    "type": "string",
                    "enum": [
                      "1792x1024",
                      "1024x1792",
                      "1024x1024"
                    ],
                    "default": "1024x1024",
                    "x-ms-enum": {
                      "name": "Size",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "1792x1024",
                          "description": "The desired size of the generated image is 1792x1024 pixels.",
                          "name": "Size1792x1024"
                        },
                        {
                          "value": "1024x1792",
                          "description": "The desired size of the generated image is 1024x1792 pixels.",
                          "name": "Size1024x1792"
                        },
                        {
                          "value": "1024x1024",
                          "description": "The desired size of the generated image is 1024x1024 pixels.",
                          "name": "Size1024x1024"
                        }
                      ]
                    }
                  },
                  "imageStyle": {
                    "description": "The style of the generated images.",
                    "type": "string",
                    "enum": [
                      "vivid",
                      "natural"
                    ],
                    "default": "vivid",
                    "x-ms-enum": {
                      "name": "Style",
                      "modelAsString": true,
                      "values": [
                        {
                          "value": "vivid",
                          "description": "Vivid creates images that are hyper-realistic and dramatic.",
                          "name": "Vivid"
                        },
                        {
                          "value": "natural",
                          "description": "Natural creates images that are more natural and less hyper-realistic.",
                          "name": "Natural"
                        }
                      ]
                    }
                  },
                  "imageGenerationsRequest": {
                    "type": "object",
                    "properties": {
                      "prompt": {
                        "description": "A text description of the desired image(s). The maximum length is 4000 characters.",
                        "type": "string",
                        "format": "string",
                        "example": "a corgi in a field",
                        "minLength": 1
                      },
                      "n": {
                        "description": "The number of images to generate.",
                        "type": "integer",
                        "minimum": 1,
                        "maximum": 1,
                        "default": 1
                      },
                      "size": {
                        "$ref": "#/components/schemas/imageSize"
                      },
                      "response_format": {
                        "$ref": "#/components/schemas/imagesResponseFormat"
                      },
                      "user": {
                        "description": "A unique identifier representing your end-user, which can help to monitor and detect abuse.",
                        "type": "string",
                        "format": "string",
                        "example": "user123456"
                      },
                      "quality": {
                        "$ref": "#/components/schemas/imageQuality"
                      },
                      "style": {
                        "$ref": "#/components/schemas/imageStyle"
                      }
                    },
                    "required": [
                      "prompt"
                    ]
                  },
                  "generateImagesResponse": {
                    "type": "object",
                    "properties": {
                      "created": {
                        "type": "integer",
                        "format": "unixtime",
                        "description": "The unix timestamp when the operation was created.",
                        "example": "1676540381"
                      },
                      "data": {
                        "type": "array",
                        "description": "The result data of the operation, if successful",
                        "items": {
                          "$ref": "#/components/schemas/imageResult"
                        }
                      }
                    },
                    "required": [
                      "created",
                      "data"
                    ]
                  },
                  "imageResult": {
                    "type": "object",
                    "description": "The image url or encoded image if successful, and an error otherwise.",
                    "properties": {
                      "url": {
                        "type": "string",
                        "description": "The image url.",
                        "example": "https://www.contoso.com"
                      },
                      "b64_json": {
                        "type": "string",
                        "description": "The base64 encoded image"
                      },
                      "content_filter_results": {
                        "$ref": "#/components/schemas/dalleContentFilterResults"
                      },
                      "revised_prompt": {
                        "type": "string",
                        "description": "The prompt that was used to generate the image, if there was any revision to the prompt."
                      },
                      "prompt_filter_results": {
                        "$ref": "#/components/schemas/dalleFilterResults"
                      }
                    }
                  }
                },
                "securitySchemes": {
                  "bearer": {
                    "type": "oauth2",
                    "flows": {
                      "implicit": {
                        "authorizationUrl": "https://login.microsoftonline.com/common/oauth2/v2.0/authorize",
                        "scopes": {}
                      }
                    },
                    "x-tokenInfoFunc": "api.middleware.auth.bearer_auth",
                    "x-scopeValidateFunc": "api.middleware.auth.validate_scopes"
                  },
                  "apiKey": {
                    "type": "apiKey",
                    "name": "api-key",
                    "in": "header"
                  }
                }
              }
            },
            "$fxv#1": "<policies>\r\n    <inbound>\r\n        <base />\r\n        <!-- AAD Authorization -->\r\n        <!-- Enabled if entra-validate named value is set to true -->\r\n        <include-fragment fragment-id=\"aad-auth\" />\r\n        \r\n        <!-- Detecting streaming request to adjust token calculations -->\r\n        <choose>\r\n            <when condition=\"@{\r\n                try \r\n                {\r\n                    var body = context.Request.Body.As<JObject>(true);\r\n                    return body != null && \r\n                        body[\"stream\"] != null && \r\n                        body[\"stream\"].Type != JTokenType.Null;\r\n                }\r\n                catch\r\n                {\r\n                    return false;\r\n                }\r\n            }\">\r\n                <set-variable name=\"isStream\" value=\"@{\r\n                var content = (context.Request.Body?.As<JObject>(true));\r\n                string streamValue = content[\"stream\"].ToString().ToLower();\r\n                return streamValue;\r\n            }\" />\r\n            </when>\r\n            <otherwise>\r\n                <set-variable name=\"isStream\" value=\"false\" />\r\n            </otherwise>\r\n        </choose>\r\n        \r\n        <!-- Deleting api-key header to it is not passed to OpenAI endpoint-->\r\n        <set-header name=\"api-key\" exists-action=\"delete\" />\r\n        \r\n        <!-- Setting cache keys -->\r\n        <set-variable name=\"deployment-id\" value=\"@((string)context.Request.MatchedParameters[\"deployment-id\"])\" />\r\n        <set-variable name=\"routesCacheKey\" value=\"@((string)context.Variables[\"deployment-id\"] + \"Routes\" + context.Deployment.Region + context.Api.Revision)\" />\r\n        <set-variable name=\"oaClustersCacheKey\" value=\"@(\"oaClusters\" + context.Deployment.Region + context.Api.Revision)\" />\r\n\r\n        <!-- RBAC: Set allowed backends (comma-separated backend-ids, empty means all are allowed) -->\r\n        <set-variable name=\"allowedBackend\" value=\"\" />\r\n\r\n        <!-- Getting OpenAI clusters configuration -->\r\n        <cache-lookup-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-CLUSTERS\"))\" variable-name=\"oaClusters\" />\r\n        <!-- If we can't find the configuration cached, it will be loaded -->\r\n        <choose>\r\n            <when condition=\"@(context.Variables.ContainsKey(\"oaClusters\") == false)\">\r\n                <set-variable name=\"oaClusters\" value=\"@{\r\n                        // route is an Azure OpenAI API endpoints\r\n                        JArray routes = new JArray();\r\n                        // cluster is a group of routes that are capable of serving a specific deployment name (model and version)\r\n                        JArray clusters = new JArray();\r\n                        // Update the below if condition when using multiple APIM gateway regions/SHGW to get different configuartions for each region\r\n                        if(context.Deployment.Region == \"West Europe\" || true)\r\n                        {\r\n                            // Adding all Azure OpenAI endpoints routes (which are set as APIM Backend)\r\n                            routes.Add(new JObject()\r\n                            {\r\n                                { \"name\", \"OpenAI 1\" },\r\n                                { \"location\", \"East US\" },\r\n                                { \"backend-id\", \"openai-backend-0\" },\r\n                                { \"priority\", 1},\r\n                                { \"isThrottling\", false }, \r\n                                { \"retryAfter\", DateTime.MinValue } \r\n                            });\r\n\r\n                            routes.Add(new JObject()\r\n                            {\r\n                                { \"name\", \"OpenAI 2\" },\r\n                                { \"location\", \"North Central US\" },\r\n                                { \"backend-id\", \"openai-backend-1\" },\r\n                                { \"priority\", 2},\r\n                                { \"isThrottling\", false },\r\n                                { \"retryAfter\", DateTime.MinValue }\r\n                            });\r\n\r\n                            routes.Add(new JObject()\r\n                            {\r\n                                { \"name\", \"OpenAI 3\" },\r\n                                { \"location\", \"East US 2\" },\r\n                                { \"backend-id\", \"openai-backend-2\" },\r\n                                { \"priority\", 2},\r\n                                { \"isThrottling\", false },\r\n                                { \"retryAfter\", DateTime.MinValue }\r\n                            });\r\n\r\n                            // For each deployment name, create a cluster with the routes that can serve it\r\n                            // It is important in you OpenAI deployments to use the same name across instances\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"chat\" },\r\n                                { \"routes\", new JArray(routes[0], routes[1], routes[2]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"embedding\" },\r\n                                { \"routes\", new JArray(routes[0], routes[2]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"gpt-4o\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n                            \r\n                        }\r\n                        else\r\n                        {\r\n                            //No clusters found for selected region, either return error (defult behavior) or set default cluster in the else section\r\n                        }\r\n                        \r\n                        return clusters;   \r\n                    }\" />\r\n                <!-- Add cluster configurations to cache -->\r\n                <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-CLUSTERS\"))\" value=\"@((JArray)context.Variables[\"oaClusters\"])\" duration=\"86400\" />\r\n            </when>\r\n        </choose>\r\n        <include-fragment fragment-id=\"validate-routes\" />\r\n        <!-- Backend Managed Identity -->\r\n        <authentication-managed-identity resource=\"{{cognitiveServicesAudience}}\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\r\n        <set-header name=\"Authorization\" exists-action=\"override\">\r\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\r\n        </set-header>\r\n\r\n        <!-- Setting gobal TPM limit to collect usage for streaming requests -->\r\n        <azure-openai-token-limit counter-key=\"APIMOpenAI\" tokens-per-minute=\"50000000\" estimate-prompt-tokens=\"false\" tokens-consumed-variable-name=\"TotalConsumedTokens\" remaining-tokens-variable-name=\"TotalRemainingTokens\" />\r\n        \r\n        <!-- Handling usage for streaming requests -->\r\n        <include-fragment fragment-id=\"openai-usage-streaming\" />\r\n    </inbound>\r\n    <backend>\r\n        <include-fragment fragment-id=\"backend-routing\" />\r\n    </backend>\r\n    <outbound>\r\n        <base />\r\n\r\n        <!-- Handling usage for non-streaming requests -->\r\n        <include-fragment fragment-id=\"openai-usage\" />\r\n    </outbound>\r\n    <on-error>\r\n        <base />\r\n        <!-- This is used to push custom metrics related to 429 throttleing errors -->\r\n        <!-- It is designed to premit setting up Azure Monitor Alerts notifying the team of potential service degredation -->\r\n        <set-variable name=\"service-name\" value=\"Azure Open AI\" />\r\n        <set-variable name=\"target-deployment\" value=\"@((string)context.Request.MatchedParameters[\"deployment-id\"])\" />\r\n        <include-fragment fragment-id=\"throttling-events\" />\r\n    </on-error>\r\n</policies>",
            "$fxv#10": "<policies>\r\n    <inbound>\r\n        <base />\r\n        <!-- AAD Authorization -->\r\n        <!-- Enabled if entra-validate named value is set to true -->\r\n        <include-fragment fragment-id=\"aad-auth\" />\r\n\r\n        <set-header name=\"api-key\" exists-action=\"delete\" />\r\n        \r\n        <!-- Setting cache keys -->\r\n        <set-variable name=\"deployment-id\" value=\"@{\r\n            var modelId = context.Request.MatchedParameters.GetValueOrDefault(\"modelId\", \"\");\r\n            var classifierId = context.Request.MatchedParameters.GetValueOrDefault(\"classifierId\", \"\");\r\n            \r\n            if (!string.IsNullOrEmpty(modelId))\r\n            {\r\n                return modelId;\r\n            }\r\n            else if (!string.IsNullOrEmpty(classifierId))\r\n            {\r\n                return classifierId;\r\n            }\r\n            else\r\n            {\r\n                return \"Document-Intelligence\";\r\n            }\r\n        }\" />\r\n        \r\n        <set-variable name=\"routesCacheKey\" value=\"@((string)context.Variables[\"deployment-id\"] + \"Routes\" + context.Deployment.Region + context.Api.Revision)\" />\r\n        <set-variable name=\"oaClustersCacheKey\" value=\"@(\"aiDocIntelInstance\" + context.Deployment.Region + context.Api.Revision)\" />\r\n        <cache-lookup-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-DOCINTELL\"))\" variable-name=\"oaClusters\" />\r\n        <!-- If we can't find the configuration cached, it will be loaded -->\r\n        <choose>\r\n            <when condition=\"@(context.Variables.ContainsKey(\"oaClusters\") == false)\">\r\n                <set-variable name=\"oaClusters\" value=\"@{\r\n                        // route is an Azure Document Intelligence endpoint\r\n                        JArray routes = new JArray();\r\n\r\n                        // cluster is a group of routes that are capable of serving a specific model name\r\n                        JArray clusters = new JArray();\r\n\r\n                        // Update the below if condition when using multiple APIM gateway regions/SHGW to get different configurations for each region\r\n                        if(context.Deployment.Region == \"ALL\" || true)\r\n                        {\r\n                            // Adding all Azure Document Intelligence endpoints routes (which are set as APIM Backend)\r\n                            routes.Add(new JObject()\r\n                            {\r\n                                { \"name\", \"Doc-Intelligence-EUS\" },\r\n                                { \"location\", \"East US\" },\r\n                                { \"backend-id\", \"REPLACE-BACKEND-ID\" },\r\n                                { \"priority\", 1},\r\n                                { \"isThrottling\", false }, \r\n                                { \"retryAfter\", DateTime.MinValue } \r\n                            });\r\n\r\n                            // For each model, create a cluster with the routes that can serve it\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-read\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-layout\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-healthInsuranceCard.us\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-invoice\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-receipt\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-idDocument\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n                        }\r\n                        else\r\n                        {\r\n                            //No clusters found for selected region, either return error (default behavior) or set default cluster in the else section\r\n                        }\r\n                        \r\n                        return clusters;   \r\n                    }\" />\r\n                <!-- Add cluster configurations to cache -->\r\n                <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-DOCINTELL\"))\" value=\"@((JArray)context.Variables[\"oaClusters\"])\" duration=\"86400\" />\r\n            </when>\r\n        </choose>\r\n        <include-fragment fragment-id=\"validate-routes\" />\r\n        <authentication-managed-identity resource=\"{{cognitiveServicesAudience}}\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\r\n        <set-header name=\"Authorization\" exists-action=\"override\">\r\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\r\n        </set-header>\r\n    </inbound>\r\n    <backend>\r\n        <include-fragment fragment-id=\"backend-routing\" />\r\n    </backend>\r\n    <outbound>\r\n        <base />\r\n        <set-variable name=\"idPrefix\" value=\"doc-Intel\" />\r\n        <set-variable name=\"targetService\" value=\"AI-Document-Intelligence\" />\r\n        <set-variable name=\"model\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-Document-Intelligence-Model\"))\" />\r\n        <set-variable name=\"deploymentName\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-DOCUMENT-INTELLIGENCE\"))\" />\r\n\r\n        <!-- Store original response body -->\r\n        <set-variable name=\"responseBody\" value=\"@(context.Response.Body.As<string>())\" />\r\n\r\n        <!-- Attempt to parse JSON and set variables -->\r\n        <set-variable name=\"isValidJson\" value=\"@{\r\n            try \r\n            {\r\n                var responseJson = JObject.Parse((string)context.Variables[\"responseBody\"]);\r\n                return true;\r\n            }\r\n            catch\r\n            {\r\n                return false;\r\n            }\r\n        }\" />\r\n\r\n        <choose>\r\n            <when condition=\"@((bool)context.Variables[\"isValidJson\"])\">\r\n                <set-variable name=\"numberOfPages\" value=\"@{\r\n                    try \r\n                    {\r\n                        var parsedBody = (JObject)context.Variables[\"parsedBody\"];\r\n                        var pages = parsedBody.SelectToken(\"analyzeResult.pages\");\r\n                        return pages != null ? pages.Count() : 1;\r\n                    }\r\n                    catch\r\n                    {\r\n                        return 1;\r\n                    }\r\n                }\" />\r\n\r\n                <set-variable name=\"modelId\" value=\"@{\r\n                    try \r\n                    {\r\n                        var parsedBody = (JObject)context.Variables[\"parsedBody\"];\r\n                        var modelId = parsedBody.SelectToken(\"analyzeResult.modelId\");\r\n                        return modelId != null ? modelId.ToString() : \"Document-Intelligence\";\r\n                    }\r\n                    catch\r\n                    {\r\n                        return \"Document-Intelligence\";\r\n                    }\r\n                }\" />\r\n            </when>\r\n        </choose>\r\n\r\n        <!-- Add dynamic header transformation -->\r\n        <set-header name=\"operation-location\" exists-action=\"override\">\r\n            <value>@{\r\n                var originalLocation = context.Response.Headers.GetValueOrDefault(\"operation-location\",\"\");\r\n                if (!string.IsNullOrEmpty(originalLocation)) {\r\n                    var uri = new Uri(originalLocation);\r\n                    return originalLocation.Replace(\r\n                        uri.Host,\r\n                        context.Request.OriginalUrl.Host\r\n                    );\r\n                }\r\n                return originalLocation;\r\n            }</value>\r\n        </set-header>\r\n\r\n        <include-fragment fragment-id=\"ai-usage\" />\r\n\r\n        <!-- Return response body -->\r\n        <set-body>@((string)context.Variables[\"responseBody\"])</set-body>\r\n    </outbound>\r\n    <on-error>\r\n        <base />\r\n        <set-variable name=\"service-name\" value=\"Azure Document Intelligence\" />\r\n        <set-variable name=\"target-deployment\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-Document-Intelligence-Model\"))\" />\r\n        \r\n        <!-- <include-fragment fragment-id=\"throttling-events\" /> -->\r\n    </on-error>\r\n</policies>",
            "$fxv#11": "<policies>\r\n    <inbound>\r\n        <base />\r\n        <!-- Restrict access for this product to specific models -->\r\n        <choose>\r\n            <when condition=\"@(!new [] { \"gpt-4o\", \"chat\", \"embedding\" }.Contains(context.Request.MatchedParameters[\"deployment-id\"] ?? String.Empty))\">\r\n                <return-response>\r\n                    <set-status code=\"401\" reason=\"Unauthorized model access\" />\r\n                </return-response>\r\n            </when>\r\n        </choose>\r\n\r\n        <!-- Capacity management: allow only assigned tpm for each Retail use case subscritpion -->\r\n        <azure-openai-token-limit counter-key=\"@(context.Subscription.Id)\" \r\n            tokens-per-minute=\"10000\" \r\n            estimate-prompt-tokens=\"true\" \r\n            tokens-consumed-header-name=\"consumed-tokens\" \r\n            remaining-tokens-header-name=\"remaining-tokens\" \r\n            retry-after-header-name=\"retry-after\" />\r\n\r\n    </inbound>\r\n    <backend>\r\n        <base />\r\n    </backend>\r\n    <outbound>\r\n        <base />\r\n    </outbound>\r\n    <on-error>\r\n        <base />\r\n    </on-error>\r\n</policies>",
            "$fxv#12": "<policies>\r\n    <inbound>\r\n        <base />\r\n        <!-- Capacity management - Subscription Level: allow only assigned tpm for each HR use case subscription -->\r\n        <set-variable name=\"target-deployment\" value=\"@((string)context.Request.MatchedParameters[\"deployment-id\"])\" />\r\n        <choose>\r\n            <when condition=\"@((string)context.Variables[\"target-deployment\"] == \"gpt-4o\")\">\r\n                <azure-openai-token-limit \r\n                    counter-key=\"@(context.Subscription.Id + \"-\" + context.Variables[\"target-deployment\"])\" \r\n                    tokens-per-minute=\"10000\" \r\n                    estimate-prompt-tokens=\"false\" \r\n                    tokens-consumed-header-name=\"consumed-tokens\" \r\n                    remaining-tokens-header-name=\"remaining-tokens\" \r\n                    token-quota=\"100000\"\r\n                    token-quota-period=\"Monthly\"\r\n                    retry-after-header-name=\"retry-after\" />\r\n            </when>\r\n            <when condition=\"@((string)context.Variables[\"target-deployment\"] == \"chat\")\">\r\n                <azure-openai-token-limit \r\n                    counter-key=\"@(context.Subscription.Id + \"-\" + context.Variables[\"target-deployment\"])\" \r\n                    tokens-per-minute=\"2000\" \r\n                    estimate-prompt-tokens=\"false\" \r\n                    tokens-consumed-header-name=\"consumed-tokens\" \r\n                    remaining-tokens-header-name=\"remaining-tokens\" \r\n                    token-quota=\"10000\"\r\n                    token-quota-period=\"Weekly\"\r\n                    retry-after-header-name=\"retry-after\" />\r\n            </when>\r\n            <otherwise>\r\n                <azure-openai-token-limit \r\n                    counter-key=\"@(context.Subscription.Id + \"-default\")\" \r\n                    tokens-per-minute=\"1000\" \r\n                    estimate-prompt-tokens=\"false\" \r\n                    tokens-consumed-header-name=\"consumed-tokens\" \r\n                    remaining-tokens-header-name=\"remaining-tokens\" \r\n                    token-quota=\"5000\"\r\n                    token-quota-period=\"Monthly\"\r\n                    retry-after-header-name=\"retry-after\" />\r\n            </otherwise>\r\n        </choose>\r\n        \r\n        <!-- Capacity management: Product Level (across all OpenAI models -->\r\n        <azure-openai-token-limit \r\n                    counter-key=\"@(context.Product?.Name?.ToString() ?? \"Portal-Admin\")\" \r\n                    tokens-per-minute=\"15000\" \r\n                    estimate-prompt-tokens=\"false\" \r\n                    tokens-consumed-header-name=\"consumed-tokens\" \r\n                    remaining-tokens-header-name=\"remaining-tokens\" \r\n                    token-quota=\"150000\"\r\n                    token-quota-period=\"Monthly\"\r\n                    retry-after-header-name=\"retry-after\" />\r\n\r\n        <!-- Defining allowed backends to be used by this product (used to restrict traffic to certain regions) -->\r\n        <!-- Backend RBAC: Set allowed backends (comma-separated backend-ids, empty means all are allowed) -->\r\n        <set-variable name=\"allowedBackend\" value=\"openai-backend-0\" />\r\n\r\n        <!-- Restrict access for this product to specific models -->\r\n        <choose>\r\n            <when condition=\"@(!new [] { \"chat\", \"embedding\" }.Contains(context.Request.MatchedParameters[\"deployment-id\"] ?? String.Empty))\">\r\n                <return-response>\r\n                    <set-status code=\"401\" reason=\"Unauthorized model access\" />\r\n                </return-response>\r\n            </when>\r\n        </choose>\r\n\r\n        <!-- Set variables for OpenAI usage logging -->\r\n        <set-variable name=\"endUserId\" value=\"@(context.Request.Headers.GetValueOrDefault(\"endUserId\", \"NA-HEADER\"))\" />\r\n        <set-variable name=\"sessionId\" value=\"@(context.Request.Headers.GetValueOrDefault(\"sessionId\", \"NA-HEADER\"))\" />\r\n        <set-variable name=\"appId\" value=\"@(context.Request.Headers.GetValueOrDefault(\"appId\", \"NA-HEADER\"))\" />\r\n    </inbound>\r\n    <backend>\r\n        <base />\r\n    </backend>\r\n    <outbound>\r\n        <base />\r\n    </outbound>\r\n    <on-error>\r\n        <base />\r\n    </on-error>\r\n</policies>",
            "$fxv#13": "<policies>\r\n    <inbound>\r\n        <base />\r\n\r\n        <!-- Defining allowed backends to be used by this product (used to restrict traffic to certain regions) -->\r\n        <!-- Backend RBAC: Set allowed backends (comma-separated backend-ids, empty means all are allowed) -->\r\n        <set-variable name=\"allowedBackend\" value=\"openai-backend-0\" />\r\n\r\n        <!-- Restrict access for this product to specific models -->\r\n        <choose>\r\n            <when condition=\"@(!new [] { \"gpt-4o\", \"embedding\" }.Contains(context.Request.MatchedParameters[\"deployment-id\"] ?? String.Empty))\">\r\n                <return-response>\r\n                    <set-status code=\"401\" reason=\"Unauthorized model access\" />\r\n                </return-response>\r\n            </when>\r\n        </choose>\r\n\r\n        <!-- Adding content safety with customized option for the product -->\r\n        <!-- Only enforce content safety for specific deployments that handle user-generated content -->\r\n        <choose>\r\n            <when condition=\"@(new [] { \"gpt-4o\" }.Contains(context.Request.MatchedParameters[\"deployment-id\"] ?? String.Empty))\">\r\n                <!-- Failure to pass content safety will result in 403 error -->\r\n                <llm-content-safety backend-id=\"content-safety-backend\" shield-prompt=\"true\">\r\n                    <categories output-type=\"EightSeverityLevels\">\r\n                        <category name=\"Hate\" threshold=\"4\" />\r\n                        <category name=\"Violence\" threshold=\"4\" />\r\n                    </categories>\r\n                </llm-content-safety>\r\n            </when>\r\n        </choose>\r\n\r\n        <!-- Capacity management - Subscription Level: allow only assigned tpm for each HR use case subscription -->\r\n        <set-variable name=\"target-deployment\" value=\"@((string)context.Request.MatchedParameters[\"deployment-id\"])\" />\r\n        <choose>\r\n            <when condition=\"@((string)context.Variables[\"target-deployment\"] == \"gpt-4o\")\">\r\n                <azure-openai-token-limit \r\n                    counter-key=\"@(context.Subscription.Id + \"-\" + context.Variables[\"target-deployment\"])\" \r\n                    tokens-per-minute=\"10000\" \r\n                    estimate-prompt-tokens=\"false\" \r\n                    tokens-consumed-header-name=\"consumed-tokens\" \r\n                    remaining-tokens-header-name=\"remaining-tokens\" \r\n                    token-quota=\"100000\"\r\n                    token-quota-period=\"Monthly\"\r\n                    retry-after-header-name=\"retry-after\" />\r\n            </when>\r\n            <when condition=\"@((string)context.Variables[\"target-deployment\"] == \"chat\")\">\r\n                <azure-openai-token-limit \r\n                    counter-key=\"@(context.Subscription.Id + \"-\" + context.Variables[\"target-deployment\"])\" \r\n                    tokens-per-minute=\"2000\" \r\n                    estimate-prompt-tokens=\"false\" \r\n                    tokens-consumed-header-name=\"consumed-tokens\" \r\n                    remaining-tokens-header-name=\"remaining-tokens\" \r\n                    token-quota=\"10000\"\r\n                    token-quota-period=\"Weekly\"\r\n                    retry-after-header-name=\"retry-after\" />\r\n            </when>\r\n            <otherwise>\r\n                <azure-openai-token-limit \r\n                    counter-key=\"@(context.Subscription.Id + \"-default\")\" \r\n                    tokens-per-minute=\"1000\" \r\n                    estimate-prompt-tokens=\"false\" \r\n                    tokens-consumed-header-name=\"consumed-tokens\" \r\n                    remaining-tokens-header-name=\"remaining-tokens\" \r\n                    token-quota=\"5000\"\r\n                    token-quota-period=\"Monthly\"\r\n                    retry-after-header-name=\"retry-after\" />\r\n            </otherwise>\r\n        </choose>\r\n        \r\n        <!-- Capacity management: Product Level (across all OpenAI models -->\r\n        <azure-openai-token-limit \r\n                    counter-key=\"@(context.Product?.Name?.ToString() ?? \"Portal-Admin\")\" \r\n                    tokens-per-minute=\"15000\" \r\n                    estimate-prompt-tokens=\"false\" \r\n                    tokens-consumed-header-name=\"consumed-tokens\" \r\n                    remaining-tokens-header-name=\"remaining-tokens\" \r\n                    token-quota=\"150000\"\r\n                    token-quota-period=\"Monthly\"\r\n                    retry-after-header-name=\"retry-after\" />\r\n\r\n        <!-- PII Detection and Anonymization -->\r\n        <set-variable name=\"piiAnonymizationEnabled\" value=\"true\" />\r\n        <!-- Variables required by pii-anonymization fragment -->\r\n        <choose>\r\n            <when condition=\"@(context.Variables.GetValueOrDefault<string>(\"piiAnonymizationEnabled\") == \"true\")\">\r\n                <!-- Configure PII detection settings -->\r\n                <set-variable name=\"piiConfidenceThreshold\" value=\"0.75\" />\r\n                <set-variable name=\"piiEntityCategoryExclusions\" value=\"PersonType,CADriversLicenseNumber\" />\r\n                <set-variable name=\"piiDetectionLanguage\" value=\"en\" /> <!-- Use 'auto' if context have multiple languages -->\r\n\r\n                <!-- Configure regex patterns for custom PII detection -->\r\n                <set-variable name=\"piiRegexPatterns\" value=\"@{\r\n                    var patterns = new JArray {\r\n                        new JObject {\r\n                            [\"pattern\"] = @\"\\b\\d{4}[- ]?\\d{4}[- ]?\\d{4}[- ]?\\d{4}\\b\",\r\n                            [\"category\"] = \"CREDIT_CARD\"\r\n                        },\r\n                        new JObject {\r\n                            [\"pattern\"] = @\"\\b[A-Z]{2}\\d{6}[A-Z]\\b\",\r\n                            [\"category\"] = \"PASSPORT_NUMBER\"\r\n                        },\r\n                        new JObject {\r\n                            [\"pattern\"] = @\"\\b\\d{3}[-]?\\d{4}[-]?\\d{7}[-]?\\d{1}\\b\",\r\n                            [\"category\"] = \"NATIONAL_ID\"\r\n                        }\r\n                    };\r\n                    return patterns.ToString();\r\n                }\" />\r\n                <set-variable name=\"piiInputContent\" value=\"@(context.Request.Body.As<string>(preserveContent: true))\" />\r\n                <!-- Include the PII anonymization fragment -->\r\n                <include-fragment fragment-id=\"pii-anonymization\" />\r\n                <!-- Replace the request body with anonymized content -->\r\n                <set-body>@(context.Variables.GetValueOrDefault<string>(\"piiAnonymizedContent\"))</set-body>\r\n            </when>\r\n        </choose>\r\n    \r\n    </inbound>\r\n    <backend>\r\n        <base />\r\n    </backend>\r\n    <outbound>\r\n        <base />\r\n        <!-- PII Deanonymization -->\r\n        <set-variable name=\"responseBodyContent\" value=\"@(context.Response.Body.As<string>(preserveContent: true))\" />\r\n        <choose>\r\n            <when condition=\"@(context.Variables.GetValueOrDefault<string>(\"piiAnonymizationEnabled\") == \"true\" && \r\n                            context.Variables.ContainsKey(\"piiMappings\"))\">\r\n                <!-- Use stored response body for deanonymization -->\r\n                <set-variable name=\"piiDeanonymizeContentInput\" value=\"@(context.Variables.GetValueOrDefault<string>(\"responseBodyContent\"))\" />\r\n                <include-fragment fragment-id=\"pii-deanonymization\" />\r\n                <!-- Variables required by pii-state-saving fragment -->\r\n                <set-variable name=\"piiStateSavingEnabled\" value=\"true\" />\r\n                <set-variable name=\"originalRequest\" value=\"@(context.Variables.GetValueOrDefault<string>(\"piiInputContent\"))\" />\r\n                <set-variable name=\"originalResponse\" value=\"@(context.Variables.GetValueOrDefault<string>(\"responseBodyContent\"))\" />\r\n                \r\n                <!-- Include the PII state saving fragment to push pii detection results to event hub -->\r\n                <include-fragment fragment-id=\"pii-state-saving\" />\r\n                \r\n                <!-- Replace response with deanonymized content -->\r\n                <set-body>@(context.Variables.GetValueOrDefault<string>(\"piiDeanonymizedContentOutput\"))</set-body>\r\n            </when>\r\n            <otherwise>\r\n                <!-- Pass through original response using stored content -->\r\n                <set-body>@(context.Variables.GetValueOrDefault<string>(\"responseBodyContent\"))</set-body>\r\n            </otherwise>\r\n        </choose>\r\n    </outbound>\r\n    <on-error>\r\n        <base />\r\n    </on-error>\r\n</policies>",
            "$fxv#14": "<!--\r\n    - Policies are applied in the order they appear.\r\n    - Position <base/> inside a section to inherit policies from the outer scope.\r\n    - Comments within policies are not preserved.\r\n-->\r\n<!-- Add policies as children to the <inbound>, <outbound>, <backend>, and <on-error> elements -->\r\n<policies>\r\n    <!-- Throttle, authorize, validate, cache, or transform the requests -->\r\n    <inbound>\r\n        <base />\r\n        <choose>\r\n            <when condition=\"@(!new [] { \"product-info\" }.Contains(context.Request.MatchedParameters[\"index-name\"] ?? String.Empty))\">\r\n                <return-response>\r\n                    <set-status code=\"401\" reason=\"Unauthorized index access\" />\r\n                </return-response>\r\n            </when>\r\n        </choose>\r\n    </inbound>\r\n    <!-- Control if and how the requests are forwarded to services  -->\r\n    <backend>\r\n        <base />\r\n    </backend>\r\n    <!-- Customize the responses -->\r\n    <outbound>\r\n        <base />\r\n    </outbound>\r\n    <!-- Handle exceptions and customize error responses  -->\r\n    <on-error>\r\n        <base />\r\n    </on-error>\r\n</policies>",
            "$fxv#15": "<fragment>\r\n    <!-- AAD Authorization -->\r\n    <!-- Enable AAD is named value set to true -->\r\n    <set-variable name=\"entra-validate\" value=\"{{entra-auth}}\" />\r\n    <choose>\r\n        <when condition=\"@(context.Variables.GetValueOrDefault(\"entra-auth\") == \"true\")\">\r\n            <validate-jwt header-name=\"Authorization\" failed-validation-httpcode=\"401\"\r\n                failed-validation-error-message=\"Unauthorized\" require-expiration-time=\"true\"\r\n                require-scheme=\"Bearer\" require-signed-tokens=\"true\">\r\n                <openid-config\r\n                    url=\"https://login.microsoftonline.com/{{tenant-id}}/v2.0/.well-known/openid-configuration\" />\r\n                <audiences>\r\n                    <audience>{{audience}}</audience>\r\n                </audiences>\r\n                <issuers>\r\n                    <issuer>https://sts.windows.net/{{tenant-id}}/</issuer>\r\n                </issuers>\r\n                <required-claims>\r\n                    <claim name=\"appid\">\r\n                        <value>{{client-id}}</value>\r\n                    </claim>\r\n                </required-claims>\r\n            </validate-jwt>\r\n        </when>\r\n    </choose>\r\n</fragment>",
            "$fxv#16": "<fragment>\r\n    <!-- Getting OpenAI routes configuration based on deployment name, region and api revision -->\r\n    <cache-lookup-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" variable-name=\"routes\" />\r\n    <!-- If we can't find the configuration, it will be loaded -->\r\n    <choose>\r\n        <when condition=\"@(context.Variables.ContainsKey(\"routes\") == false)\">\r\n            <set-variable name=\"routes\" value=\"@{\r\n                    string deploymentName = (string)context.Variables[\"deployment-id\"];\r\n                    JArray clusters = (JArray)context.Variables[\"oaClusters\"];\r\n                    JObject cluster = (JObject)clusters.FirstOrDefault(o => o[\"deploymentName\"]?.Value<string>() == deploymentName);\r\n                    if(cluster == null)\r\n                    {\r\n                        //Error: No cluster matched the requested deployment name\r\n                        return new JArray() { new JObject()\r\n                            {\r\n                                { \"name\", deploymentName },\r\n                                { \"location\", \"NA\" },\r\n                                { \"url\", \"No routes found for the deployment (\" + deploymentName + \") in the region (\" + context.Deployment.Region + \")\" }\r\n                            }\r\n                        };\r\n                    }\r\n                    JArray routes = (JArray)cluster[\"routes\"];\r\n                    return routes;\r\n                }\" />\r\n            <!-- If no routes found for deployment, return bad request with content of routes variable -->\r\n            <choose>\r\n                <when condition=\"@(((JArray)context.Variables[\"routes\"]).ToString().Contains(\"No routes\"))\">\r\n                    <return-response>\r\n                        <set-status code=\"400\" reason=\"No routes\" />\r\n                        <set-body>@(((JArray)context.Variables[\"routes\"]).ToString())</set-body>\r\n                    </return-response>\r\n                </when>\r\n            </choose>\r\n            <!-- Add cluster configurations to cache -->\r\n            <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" value=\"@((JArray)context.Variables[\"routes\"])\" duration=\"86400\" />\r\n        </when>\r\n    </choose>\r\n    <set-variable name=\"routeIndex\" value=\"-1\" />\r\n    <set-variable name=\"remainingRoutes\" value=\"1\" />\r\n</fragment>",
            "$fxv#17": "<fragment>\r\n    <retry condition=\"@(context.Response != null && (context.Response.StatusCode == 429 || context.Response.StatusCode >= 500) && ((Int32)context.Variables[\"remainingRoutes\"]) > 0)\" count=\"3\" interval=\"0\">\r\n        <!-- Before picking the route, let's verify if there is any that should be set to not throttling anymore -->\r\n        <set-variable name=\"routes\" value=\"@{\r\n                JArray routes = (JArray)context.Variables[\"routes\"];\r\n                \r\n                for (int i = 0; i < routes.Count; i++)\r\n                {\r\n                    JObject route = (JObject)routes[i];\r\n\r\n                    if (route.Value<bool>(\"isThrottling\") && DateTime.Now >= route.Value<DateTime>(\"retryAfter\"))\r\n                    {\r\n                        route[\"isThrottling\"] = false;\r\n                        route[\"retryAfter\"] = DateTime.MinValue;\r\n                    }\r\n                }\r\n\r\n                return routes; \r\n            }\" />\r\n        <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" value=\"@((JArray)context.Variables[\"routes\"])\" duration=\"86400\" />\r\n        <!-- This is the main logic to pick the route to be used with RBAC validation -->\r\n        <set-variable name=\"routeIndex\" value=\"@{\r\n                JArray routes = (JArray)context.Variables[\"routes\"];\r\n                string allowedBackend = (string)context.Variables.GetValueOrDefault(\"allowedBackend\", \"\");\r\n                string[] allowedBackends = string.IsNullOrEmpty(allowedBackend) ? new string[0] : allowedBackend.Split(',');\r\n                int selectedPriority = Int32.MaxValue;\r\n                List<int> availableRoutesIndexes = new List<int>();\r\n\r\n                for (int i = 0; i < routes.Count; i++)\r\n                {\r\n                    JObject route = (JObject)routes[i];\r\n                    string backendId = route.Value<string>(\"backend-id\");\r\n\r\n                    // Check if backend is allowed (empty allowedBackend means all are allowed)\r\n                    bool isBackendAllowed = string.IsNullOrEmpty(allowedBackend) || \r\n                                          allowedBackends.Contains(backendId.Trim());\r\n\r\n                    if (!route.Value<bool>(\"isThrottling\") && isBackendAllowed)\r\n                    {\r\n                        int routePriority = route.Value<int>(\"priority\");\r\n\r\n                        if (routePriority < selectedPriority)\r\n                        {\r\n                            selectedPriority = routePriority;\r\n                            availableRoutesIndexes.Clear();\r\n                            availableRoutesIndexes.Add(i);\r\n                        } \r\n                        else if (routePriority == selectedPriority)\r\n                        {\r\n                            availableRoutesIndexes.Add(i);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (availableRoutesIndexes.Count == 1)\r\n                {\r\n                    return availableRoutesIndexes[0];\r\n                }\r\n            \r\n                if (availableRoutesIndexes.Count > 0)\r\n                {\r\n                    //Returns a random route from the list if we have more than one available with the same priority\r\n                    return availableRoutesIndexes[new Random().Next(0, availableRoutesIndexes.Count)];\r\n                }\r\n                else\r\n                {\r\n                    //If there are no available allowed routes, return -1 to indicate failure\r\n                    return -1;    \r\n                }\r\n                }\" />\r\n\r\n        <!-- Check if no allowed backend is available and return appropriate error -->\r\n        <choose>\r\n            <when condition=\"@((Int32)context.Variables[\"routeIndex\"] == -1)\">\r\n                <!-- Find the last error from allowed backends to return meaningful error -->\r\n                <set-variable name=\"lastAllowedBackendError\" value=\"@{\r\n                        JArray routes = (JArray)context.Variables[\"routes\"];\r\n                        string allowedBackend = (string)context.Variables.GetValueOrDefault(\"allowedBackend\", \"\");\r\n                        \r\n                        // If no specific backends are allowed, return generic error\r\n                        if (string.IsNullOrEmpty(allowedBackend))\r\n                        {\r\n                            return \"503|Service Unavailable|No backends are currently available\";\r\n                        }\r\n                        \r\n                        string[] allowedBackends = allowedBackend.Split(',');\r\n                        \r\n                        // Find the most recent error from allowed backends\r\n                        DateTime latestRetryAfter = DateTime.MinValue;\r\n                        string errorDetails = \"503|Service Unavailable|No allowed backends are currently available\";\r\n                        \r\n                        for (int i = 0; i < routes.Count; i++)\r\n                        {\r\n                            JObject route = (JObject)routes[i];\r\n                            string backendId = route.Value<string>(\"backend-id\");\r\n                            \r\n                            if (allowedBackends.Contains(backendId.Trim()) && route.Value<bool>(\"isThrottling\"))\r\n                            {\r\n                                DateTime retryAfter = route.Value<DateTime>(\"retryAfter\");\r\n                                if (retryAfter > latestRetryAfter)\r\n                                {\r\n                                    latestRetryAfter = retryAfter;\r\n                                    errorDetails = \"429|Too Many Requests|Rate limit exceeded for allowed backends\";\r\n                                }\r\n                            }\r\n                        }\r\n                        \r\n                        return errorDetails;\r\n                    }\" />\r\n                <set-variable name=\"errorCode\" value=\"@(((string)context.Variables[\"lastAllowedBackendError\"]).Split('|')[0])\" />\r\n                <set-variable name=\"errorReason\" value=\"@(((string)context.Variables[\"lastAllowedBackendError\"]).Split('|')[1])\" />\r\n                <set-variable name=\"errorMessage\" value=\"@(((string)context.Variables[\"lastAllowedBackendError\"]).Split('|')[2])\" />\r\n                <return-response>\r\n                    <set-status code=\"@(Convert.ToInt32((string)context.Variables[\"errorCode\"]))\" reason=\"@((string)context.Variables[\"errorReason\"])\" />\r\n                    <set-body>@((string)context.Variables[\"errorMessage\"])</set-body>\r\n                </return-response>\r\n            </when>\r\n        </choose>\r\n\r\n        <set-variable name=\"backendId\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"routeIndex\"]]).Value<string>(\"backend-id\"))\" />\r\n        <set-variable name=\"routeLocation\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"routeIndex\"]]).Value<string>(\"location\"))\" />\r\n        <set-variable name=\"routeName\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"routeIndex\"]]).Value<string>(\"name\"))\" />\r\n        <set-variable name=\"deploymentName\" value=\"@((string)context.Variables[\"deployment-id\"])\" />\r\n        <set-backend-service backend-id=\"@((string)context.Variables[\"backendId\"])\" />\r\n        <choose>\r\n            <when condition=\"@(context.Variables.GetValueOrDefault<string>(\"isStream\", \"false\") == \"true\")\">\r\n                <forward-request buffer-response=\"false\" />\r\n            </when>\r\n            <otherwise>\r\n                <forward-request buffer-response=\"true\" />\r\n            </otherwise>\r\n        </choose>\r\n        <choose>\r\n            <!-- In case we got 429 or 5xx from a route, update the list with its status -->\r\n            <when condition=\"@(context.Response != null && (context.Response.StatusCode == 429 || context.Response.StatusCode >= 500) )\">\r\n                <cache-lookup-value key=\"@(context.Request.MatchedParameters[\"deployment-id\"] + \"Routes\" + context.Deployment.Region + context.Api.Revision)\" variable-name=\"routes\" />\r\n                <set-variable name=\"routes\" value=\"@{\r\n                        JArray routes = (JArray)context.Variables[\"routes\"];\r\n                        int currentrouteIndex = context.Variables.GetValueOrDefault<int>(\"routeIndex\");\r\n                        int retryAfter = Convert.ToInt32(context.Response.Headers.GetValueOrDefault(\"Retry-After\", \"-1\"));\r\n\r\n                        if (retryAfter == -1)\r\n                        {\r\n                            retryAfter = Convert.ToInt32(context.Response.Headers.GetValueOrDefault(\"x-ratelimit-reset-requests\", \"-1\"));\r\n                        }\r\n\r\n                        if (retryAfter == -1)\r\n                        {\r\n                            retryAfter = Convert.ToInt32(context.Response.Headers.GetValueOrDefault(\"x-ratelimit-reset-tokens\", \"10\"));\r\n                        }\r\n\r\n                        JObject route = (JObject)routes[currentrouteIndex];\r\n                        route[\"isThrottling\"] = true;\r\n                        route[\"retryAfter\"] = DateTime.Now.AddSeconds(retryAfter);\r\n\r\n                        return routes;      \r\n                    }\" />\r\n                <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" value=\"@((JArray)context.Variables[\"routes\"])\" duration=\"86400\" />\r\n                <set-variable name=\"remainingRoutes\" value=\"@{\r\n                        JArray routes = (JArray)context.Variables[\"routes\"];\r\n                        string allowedBackend = (string)context.Variables.GetValueOrDefault(\"allowedBackend\", \"\");\r\n                        int remainingRoutes = 0;\r\n\r\n                        for (int i = 0; i < routes.Count; i++)\r\n                        {\r\n                            JObject route = (JObject)routes[i];\r\n                            string backendId = route.Value<string>(\"backend-id\");\r\n                            \r\n                            // Check if backend is allowed (empty allowedBackend means all are allowed)\r\n                            bool isBackendAllowed = string.IsNullOrEmpty(allowedBackend) || \r\n                                                  allowedBackend.Split(',').Contains(backendId.Trim());\r\n\r\n                            if (!route.Value<bool>(\"isThrottling\") && isBackendAllowed)\r\n                            {\r\n                                remainingRoutes++;\r\n                            }\r\n                        }\r\n\r\n                        return remainingRoutes;\r\n                    }\" />\r\n            </when>\r\n        </choose>\r\n    </retry>\r\n</fragment>",
            "$fxv#18": "<fragment>\r\n\t<!-- Usage logs for non-streaming requests only -->\r\n\t<choose>\r\n\t\t<when condition=\"@(context.Variables.GetValueOrDefault<string>(\"isStream\",\"false\").Equals(\"false\", StringComparison.OrdinalIgnoreCase))\">\r\n\t\t\t<!-- Set the response body as a variable to be used in various policies -->\r\n\t\t\t<set-variable name=\"responseBody\" value=\"@(context.Response.Body.As<JObject>())\" />\r\n\t\t\t<!-- Log OpenAI usage to EventHub -->\r\n\t\t\t<choose>\r\n\t\t\t\t<when condition=\"@(context.Response.StatusCode == 200)\">\r\n\t\t\t\t\t<log-to-eventhub logger-id=\"usage-eventhub-logger\">@{\r\n                    //Avoid reading response body as it can only be ready once, instead, before calling this fragement, a variable call responseBody will be set in the outbound policy\r\n                    //var responseBody = context.Response.Body?.As<JObject>(true); //Avoid this one\r\n                    var responseBody = (JObject)context.Variables[\"responseBody\"]; //It is set in the outbound policy before calling the fragment\r\n                    return new JObject(\r\n                        new JProperty(\"id\", responseBody?[\"id\"]?.ToString() ?? Guid.NewGuid().ToString()),\r\n                        new JProperty(\"timestamp\", DateTime.UtcNow.ToString()),\r\n                        new JProperty(\"appId\", (string)context.Variables.GetValueOrDefault<string>(\"appId\", \"NA\")),\r\n                        new JProperty(\"subscriptionId\", context.Subscription?.Id?.ToString() ?? \"Portal-Admin\"),\r\n                        new JProperty(\"productName\", context.Product?.Name?.ToString() ?? \"Portal-Admin\"),\r\n                        new JProperty(\"targetService\", responseBody?[\"object\"]?.ToString() ?? \"NA\"),\r\n                        new JProperty(\"model\", responseBody?[\"model\"]?.ToString() ?? \"NA\"),\r\n                        new JProperty(\"gatewayName\", context.Deployment?.ServiceName ?? \"NA\"),\r\n                        new JProperty(\"gatewayRegion\", context.Deployment?.Region ?? \"NA\"),\r\n                        new JProperty(\"aiGatewayId\", context.Deployment?.Gateway?.Id ?? \"NA\"),\r\n                        new JProperty(\"RequestIp\", context.Request?.IpAddress ?? \"NA\"),\r\n                        new JProperty(\"operationName\", context.Operation?.Name ?? \"NA\"),\r\n                        new JProperty(\"sessionId\", (string)context.Variables.GetValueOrDefault<string>(\"sessionId\", \"NA\")),\r\n                        new JProperty(\"endUserId\", (string)context.Variables.GetValueOrDefault<string>(\"endUserId\", \"NA\")),\r\n                        new JProperty(\"backendId\", (string)context.Variables.GetValueOrDefault<string>(\"backendId\", \"NA\")),\r\n                        new JProperty(\"routeLocation\", (string)context.Variables.GetValueOrDefault<string>(\"routeLocation\", \"NA\")),\r\n                        new JProperty(\"routeName\", (string)context.Variables.GetValueOrDefault<string>(\"routeName\", \"NA\")),\r\n                        new JProperty(\"deploymentName\", (string)context.Variables.GetValueOrDefault<string>(\"deploymentName\", \"NA\")),\r\n                        new JProperty(\"promptTokens\", responseBody?[\"usage\"]?[\"prompt_tokens\"]?.Value<int>() ?? 1),\r\n                        new JProperty(\"responseTokens\", responseBody?[\"usage\"]?[\"completion_tokens\"]?.Value<int>() ?? 0),\r\n                        new JProperty(\"totalTokens\", responseBody?[\"usage\"]?[\"total_tokens\"]?.Value<int>() ?? 1)\r\n                ).ToString();\r\n                }</log-to-eventhub>\r\n\t\t\t\t</when>\r\n\t\t\t</choose>\r\n\t\t\t<set-body>@{\r\n                    return ((JObject)context.Variables[\"responseBody\"]).ToString();\r\n            }</set-body>\r\n\t\t</when>\r\n\t</choose>\r\n</fragment>",
            "$fxv#19": "<fragment>\r\n\t<!-- Usage logs for \"streaming\" requests only -->\r\n\t<choose>\r\n\t\t<!-- Usage logs for streaming requests -->\r\n\t\t<when condition=\"@(context.Variables.GetValueOrDefault<string>(\"isStream\",\"false\").Equals(\"true\", StringComparison.OrdinalIgnoreCase))\">\r\n\t\t\t<set-variable name=\"potentialRouteIndex\" value=\"@{\r\n                JArray routes = (JArray)context.Variables[\"routes\"];\r\n                int selectedPriority = Int32.MaxValue;\r\n                List<int> availableRoutesIndexes = new List<int>();\r\n\r\n                for (int i = 0; i < routes.Count; i++)\r\n                {\r\n                    JObject route = (JObject)routes[i];\r\n\r\n                    if (!route.Value<bool>(\"isThrottling\"))\r\n                    {\r\n                        int routePriority = route.Value<int>(\"priority\");\r\n\r\n                        if (routePriority < selectedPriority)\r\n                        {\r\n                            selectedPriority = routePriority;\r\n                            availableRoutesIndexes.Clear();\r\n                            availableRoutesIndexes.Add(i);\r\n                        } \r\n                        else if (routePriority == selectedPriority)\r\n                        {\r\n                            availableRoutesIndexes.Add(i);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (availableRoutesIndexes.Count == 1)\r\n                {\r\n                    return availableRoutesIndexes[0];\r\n                }\r\n            \r\n                if (availableRoutesIndexes.Count > 0)\r\n                {\r\n                    //Returns a random route from the list if we have more than one available with the same priority\r\n                    return availableRoutesIndexes[new Random().Next(0, availableRoutesIndexes.Count)];\r\n                }\r\n                else\r\n                {\r\n                    //If there are no available routes, the request will be sent to the first one\r\n                    return 0;    \r\n                }\r\n                }\" />\r\n\t\t\t<set-variable name=\"backendId\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"potentialRouteIndex\"]]).Value<string>(\"backend-id\"))\" />\r\n\t\t\t<set-variable name=\"routeLocation\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"potentialRouteIndex\"]]).Value<string>(\"location\"))\" />\r\n\t\t\t<set-variable name=\"routeName\" value=\"@(((JObject)((JArray)context.Variables[\"routes\"])[(Int32)context.Variables[\"potentialRouteIndex\"]]).Value<string>(\"name\"))\" />\r\n\t\t\t<set-variable name=\"deploymentName\" value=\"@((string)context.Variables[\"deployment-id\"])\" />\r\n\t\t\t<!-- NOTE: azure-openai-emit-token-metric has limited support to custom dimensions -->\r\n            <azure-openai-emit-token-metric namespace=\"ai-streaming\">\r\n                <dimension name=\"SubscriptionId\" value=\"@(context.Subscription?.Id ?? \"Portal-Admin-Sub\")\" />\r\n\t\t\t\t<dimension name=\"productName\" value=\"@(context.Product?.Name?.ToString() ?? \"Portal-Admin\")\" />\r\n\t\t\t\t<dimension name=\"routeName\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"routeName\", \"Streaming\"))\" />\r\n                <dimension name=\"routeLocation\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"routeLocation\", \"DefaultStreaming\"))\" />\r\n\t\t\t\t<dimension name=\"deploymentName\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deploymentName\", \"Streaming\"))\" />\r\n\t\t\t\t<dimension name=\"backendId\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"backendId\", \"DefaultStreaming\"))\" />\r\n                <!-- <dimension name=\"operationName\" value=\"@(context.Operation?.Id ?? \"Streaming\")\" /> -->\r\n                <!-- <dimension name=\"sessionId\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"sessionId\", \"NA\"))\" /> -->\r\n                <!-- <dimension name=\"endUserId\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"endUserId\", \"NA\"))\" /> -->\r\n                <!-- <dimension name=\"appId\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"appId\", \"NA\"))\" /> -->\r\n                <!-- <dimension name=\"gatewayName\" value=\"@(context.Deployment?.ServiceName ?? \"NA\")\" /> -->\r\n\t\t\t</azure-openai-emit-token-metric>\r\n\t\t</when>\r\n\t</choose>\r\n</fragment>",
            "$fxv#2": "{\r\n  \"swagger\": \"2.0\",\r\n  \"info\": {\r\n    \"title\": \"SearchIndexClient\",\r\n    \"description\": \"Client that can be used to query an index and upload, merge, or delete documents.\",\r\n    \"version\": \"2024-07-01\",\r\n    \"x-ms-code-generation-settings\": {\r\n      \"useDateTimeOffset\": true,\r\n      \"syncMethods\": \"None\"\r\n    }\r\n  },\r\n  \"x-ms-parameterized-host\": {\r\n    \"hostTemplate\": \"{endpoint}/indexes('{indexName}')\",\r\n    \"useSchemePrefix\": false,\r\n    \"parameters\": [\r\n      {\r\n        \"$ref\": \"#/parameters/EndpointParameter\"\r\n      },\r\n      {\r\n        \"$ref\": \"#/parameters/IndexNameParameter\"\r\n      }\r\n    ]\r\n  },\r\n  \"consumes\": [\r\n    \"application/json\"\r\n  ],\r\n  \"produces\": [\r\n    \"application/json\"\r\n  ],\r\n  \"paths\": {\r\n    \"/docs/$count\": {\r\n      \"get\": {\r\n        \"tags\": [\r\n          \"Documents\"\r\n        ],\r\n        \"operationId\": \"Documents_Count\",\r\n        \"externalDocs\": {\r\n          \"url\": \"https://learn.microsoft.com/rest/api/searchservice/Count-Documents\"\r\n        },\r\n        \"x-ms-examples\": {\r\n          \"SearchIndexCountDocuments\": {\r\n            \"$ref\": \"./examples/SearchIndexCountDocuments.json\"\r\n          }\r\n        },\r\n        \"description\": \"Queries the number of documents in the index.\",\r\n        \"parameters\": [\r\n          {\r\n            \"$ref\": \"#/parameters/ClientRequestIdParameter\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ApiVersionParameter\"\r\n          }\r\n        ],\r\n        \"x-ms-request-id\": \"request-id\",\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"\",\r\n            \"schema\": {\r\n              \"type\": \"integer\",\r\n              \"format\": \"int64\"\r\n            }\r\n          },\r\n          \"default\": {\r\n            \"description\": \"Error response.\",\r\n            \"schema\": {\r\n              \"$ref\": \"../../../../../common-types/data-plane/v1/types.json#/definitions/ErrorResponse\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"/docs\": {\r\n      \"get\": {\r\n        \"tags\": [\r\n          \"Documents\"\r\n        ],\r\n        \"operationId\": \"Documents_SearchGet\",\r\n        \"externalDocs\": {\r\n          \"url\": \"https://learn.microsoft.com/rest/api/searchservice/Search-Documents\"\r\n        },\r\n        \"x-ms-examples\": {\r\n          \"SearchIndexSearchDocumentsGet\": {\r\n            \"$ref\": \"./examples/SearchIndexSearchDocumentsGet.json\"\r\n          },\r\n          \"SearchIndexSearchDocumentsSemanticGet\": {\r\n            \"$ref\": \"./examples/SearchIndexSearchDocumentsSemanticGet.json\"\r\n          }\r\n        },\r\n        \"description\": \"Searches for documents in the index.\",\r\n        \"parameters\": [\r\n          {\r\n            \"name\": \"search\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"A full-text search query expression; Use \\\"*\\\" or omit this parameter to match all documents.\",\r\n            \"x-ms-client-name\": \"SearchText\"\r\n          },\r\n          {\r\n            \"name\": \"$count\",\r\n            \"in\": \"query\",\r\n            \"type\": \"boolean\",\r\n            \"description\": \"A value that specifies whether to fetch the total count of results. Default is false. Setting this value to true may have a performance impact. Note that the count returned is an approximation.\",\r\n            \"x-nullable\": false,\r\n            \"x-ms-client-name\": \"IncludeTotalResultCount\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"facet\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"collectionFormat\": \"multi\",\r\n            \"description\": \"The list of facet expressions to apply to the search query. Each facet expression contains a field name, optionally followed by a comma-separated list of name:value pairs.\",\r\n            \"x-ms-client-name\": \"Facets\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$filter\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"The OData $filter expression to apply to the search query.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"highlight\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"description\": \"The list of field names to use for hit highlights. Only searchable fields can be used for hit highlighting.\",\r\n            \"x-ms-client-name\": \"HighlightFields\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"highlightPostTag\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"A string tag that is appended to hit highlights. Must be set with highlightPreTag. Default is &lt;/em&gt;.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"highlightPreTag\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"A string tag that is prepended to hit highlights. Must be set with highlightPostTag. Default is &lt;em&gt;.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"minimumCoverage\",\r\n            \"in\": \"query\",\r\n            \"type\": \"number\",\r\n            \"format\": \"double\",\r\n            \"description\": \"A number between 0 and 100 indicating the percentage of the index that must be covered by a search query in order for the query to be reported as a success. This parameter can be useful for ensuring search availability even for services with only one replica. The default is 100.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$orderby\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"description\": \"The list of OData $orderby expressions by which to sort the results. Each expression can be either a field name or a call to either the geo.distance() or the search.score() functions. Each expression can be followed by asc to indicate ascending, and desc to indicate descending. The default is ascending order. Ties will be broken by the match scores of documents. If no OrderBy is specified, the default sort order is descending by document match score. There can be at most 32 $orderby clauses.\",\r\n            \"x-ms-client-name\": \"OrderBy\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"queryType\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"enum\": [\r\n              \"simple\",\r\n              \"full\",\r\n              \"semantic\"\r\n            ],\r\n            \"x-ms-enum\": {\r\n              \"name\": \"QueryType\",\r\n              \"modelAsString\": false,\r\n              \"values\": [\r\n                {\r\n                  \"value\": \"simple\",\r\n                  \"name\": \"Simple\",\r\n                  \"description\": \"Uses the simple query syntax for searches. Search text is interpreted using a simple query language that allows for symbols such as +, * and \\\"\\\". Queries are evaluated across all searchable fields by default, unless the searchFields parameter is specified.\"\r\n                },\r\n                {\r\n                  \"value\": \"full\",\r\n                  \"name\": \"Full\",\r\n                  \"description\": \"Uses the full Lucene query syntax for searches. Search text is interpreted using the Lucene query language which allows field-specific and weighted searches, as well as other advanced features.\"\r\n                },\r\n                {\r\n                  \"value\": \"semantic\",\r\n                  \"name\": \"Semantic\",\r\n                  \"description\": \"Best suited for queries expressed in natural language as opposed to keywords. Improves precision of search results by re-ranking the top search results using a ranking model trained on the Web corpus.\"\r\n                }\r\n              ]\r\n            },\r\n            \"x-nullable\": false,\r\n            \"description\": \"A value that specifies the syntax of the search query. The default is 'simple'. Use 'full' if your query uses the Lucene query syntax.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"scoringParameter\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"collectionFormat\": \"multi\",\r\n            \"x-ms-client-name\": \"ScoringParameters\",\r\n            \"description\": \"The list of parameter values to be used in scoring functions (for example, referencePointParameter) using the format name-values. For example, if the scoring profile defines a function with a parameter called 'mylocation' the parameter string would be \\\"mylocation--122.2,44.8\\\" (without the quotes).\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"scoringProfile\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"The name of a scoring profile to evaluate match scores for matching documents in order to sort the results.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"searchFields\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"description\": \"The list of field names to which to scope the full-text search. When using fielded search (fieldName:searchExpression) in a full Lucene query, the field names of each fielded search expression take precedence over any field names listed in this parameter.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"searchMode\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"enum\": [\r\n              \"any\",\r\n              \"all\"\r\n            ],\r\n            \"x-ms-enum\": {\r\n              \"name\": \"SearchMode\",\r\n              \"modelAsString\": false,\r\n              \"values\": [\r\n                {\r\n                  \"value\": \"any\",\r\n                  \"name\": \"Any\",\r\n                  \"description\": \"Any of the search terms must be matched in order to count the document as a match.\"\r\n                },\r\n                {\r\n                  \"value\": \"all\",\r\n                  \"name\": \"All\",\r\n                  \"description\": \"All of the search terms must be matched in order to count the document as a match.\"\r\n                }\r\n              ]\r\n            },\r\n            \"x-nullable\": false,\r\n            \"description\": \"A value that specifies whether any or all of the search terms must be matched in order to count the document as a match.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"scoringStatistics\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"enum\": [\r\n              \"local\",\r\n              \"global\"\r\n            ],\r\n            \"x-ms-enum\": {\r\n              \"name\": \"ScoringStatistics\",\r\n              \"modelAsString\": false,\r\n              \"values\": [\r\n                {\r\n                  \"value\": \"local\",\r\n                  \"name\": \"Local\",\r\n                  \"description\": \"The scoring statistics will be calculated locally for lower latency.\"\r\n                },\r\n                {\r\n                  \"value\": \"global\",\r\n                  \"name\": \"Global\",\r\n                  \"description\": \"The scoring statistics will be calculated globally for more consistent scoring.\"\r\n                }\r\n              ]\r\n            },\r\n            \"x-nullable\": false,\r\n            \"description\": \"A value that specifies whether we want to calculate scoring statistics (such as document frequency) globally for more consistent scoring, or locally, for lower latency.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"sessionId\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"A value to be used to create a sticky session, which can help to get more consistent results. As long as the same sessionId is used, a best-effort attempt will be made to target the same replica set. Be wary that reusing the same sessionID values repeatedly can interfere with the load balancing of the requests across replicas and adversely affect the performance of the search service. The value used as sessionId cannot start with a '_' character.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$select\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"description\": \"The list of fields to retrieve. If unspecified, all fields marked as retrievable in the schema are included.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$skip\",\r\n            \"in\": \"query\",\r\n            \"type\": \"integer\",\r\n            \"format\": \"int32\",\r\n            \"description\": \"The number of search results to skip. This value cannot be greater than 100,000. If you need to scan documents in sequence, but cannot use $skip due to this limitation, consider using $orderby on a totally-ordered key and $filter with a range query instead.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$top\",\r\n            \"in\": \"query\",\r\n            \"type\": \"integer\",\r\n            \"format\": \"int32\",\r\n            \"description\": \"The number of search results to retrieve. This can be used in conjunction with $skip to implement client-side paging of search results. If results are truncated due to server-side paging, the response will include a continuation token that can be used to issue another Search request for the next page of results.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ApiVersionParameter\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ClientRequestIdParameter\"\r\n          },\r\n          {\r\n            \"name\": \"semanticConfiguration\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"The name of the semantic configuration that lists which fields should be used for semantic ranking, captions, highlights, and answers\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"semanticErrorHandling\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"enum\": [\r\n              \"partial\",\r\n              \"fail\"\r\n            ],\r\n            \"x-ms-enum\": {\r\n              \"name\": \"SemanticErrorMode\",\r\n              \"modelAsString\": true,\r\n              \"values\": [\r\n                {\r\n                  \"value\": \"partial\",\r\n                  \"name\": \"Partial\",\r\n                  \"description\": \"If the semantic processing fails, partial results still return. The definition of partial results depends on what semantic step failed and what was the reason for failure.\"\r\n                },\r\n                {\r\n                  \"value\": \"fail\",\r\n                  \"name\": \"Fail\",\r\n                  \"description\": \"If there is an exception during the semantic processing step, the query will fail and return the appropriate HTTP code depending on the error.\"\r\n                }\r\n              ]\r\n            },\r\n            \"description\": \"Allows the user to choose whether a semantic call should fail completely, or to return partial results (default).\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"semanticMaxWaitInMilliseconds\",\r\n            \"in\": \"query\",\r\n            \"type\": \"integer\",\r\n            \"format\": \"int32\",\r\n            \"minimum\": 700,\r\n            \"description\": \"Allows the user to set an upper bound on the amount of time it takes for semantic enrichment to finish processing before the request fails.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"answers\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"enum\": [\r\n              \"none\",\r\n              \"extractive\"\r\n            ],\r\n            \"x-ms-enum\": {\r\n              \"name\": \"QueryAnswerType\",\r\n              \"modelAsString\": true,\r\n              \"values\": [\r\n                {\r\n                  \"value\": \"none\",\r\n                  \"name\": \"None\",\r\n                  \"description\": \"Do not return answers for the query.\"\r\n                },\r\n                {\r\n                  \"value\": \"extractive\",\r\n                  \"name\": \"Extractive\",\r\n                  \"description\": \"Extracts answer candidates from the contents of the documents returned in response to a query expressed as a question in natural language.\"\r\n                }\r\n              ]\r\n            },\r\n            \"description\": \"This parameter is only valid if the query type is `semantic`. If set, the query returns answers extracted from key passages in the highest ranked documents. The number of answers returned can be configured by appending the pipe character `|` followed by the `count-<number of answers>` option after the answers parameter value, such as `extractive|count-3`. Default count is 1. The confidence threshold can be configured by appending the pipe character `|` followed by the `threshold-<confidence threshold>` option after the answers parameter value, such as `extractive|threshold-0.9`. Default threshold is 0.7.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"captions\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"enum\": [\r\n              \"none\",\r\n              \"extractive\"\r\n            ],\r\n            \"x-ms-enum\": {\r\n              \"name\": \"QueryCaptionType\",\r\n              \"modelAsString\": true,\r\n              \"values\": [\r\n                {\r\n                  \"value\": \"none\",\r\n                  \"name\": \"None\",\r\n                  \"description\": \"Do not return captions for the query.\"\r\n                },\r\n                {\r\n                  \"value\": \"extractive\",\r\n                  \"name\": \"Extractive\",\r\n                  \"description\": \"Extracts captions from the matching documents that contain passages relevant to the search query.\"\r\n                }\r\n              ]\r\n            },\r\n            \"description\": \"This parameter is only valid if the query type is `semantic`. If set, the query returns captions extracted from key passages in the highest ranked documents. When Captions is set to `extractive`, highlighting is enabled by default, and can be configured by appending the pipe character `|` followed by the `highlight-<true/false>` option, such as `extractive|highlight-true`. Defaults to `None`.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"semanticQuery\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"Allows setting a separate search query that will be solely used for semantic reranking, semantic captions and semantic answers. Is useful for scenarios where there is a need to use different queries between the base retrieval and ranking phase, and the L2 semantic phase.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SearchOptions\"\r\n            }\r\n          }\r\n        ],\r\n        \"x-ms-request-id\": \"request-id\",\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"Response containing documents that match the search criteria.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/SearchDocumentsResult\"\r\n            }\r\n          },\r\n          \"default\": {\r\n            \"description\": \"Error response.\",\r\n            \"schema\": {\r\n              \"$ref\": \"../../../../../common-types/data-plane/v1/types.json#/definitions/ErrorResponse\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"/docs/search.post.search\": {\r\n      \"post\": {\r\n        \"tags\": [\r\n          \"Documents\"\r\n        ],\r\n        \"operationId\": \"Documents_SearchPost\",\r\n        \"externalDocs\": {\r\n          \"url\": \"https://learn.microsoft.com/rest/api/searchservice/Search-Documents\"\r\n        },\r\n        \"x-ms-examples\": {\r\n          \"SearchIndexSearchDocumentsPost\": {\r\n            \"$ref\": \"./examples/SearchIndexSearchDocumentsPost.json\"\r\n          },\r\n          \"SearchIndexSearchDocumentsSemanticPost\": {\r\n            \"$ref\": \"./examples/SearchIndexSearchDocumentsSemanticPost.json\"\r\n          }\r\n        },\r\n        \"description\": \"Searches for documents in the index.\",\r\n        \"parameters\": [\r\n          {\r\n            \"name\": \"searchRequest\",\r\n            \"in\": \"body\",\r\n            \"required\": true,\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/SearchRequest\",\r\n              \"description\": \"The Search request.\"\r\n            },\r\n            \"description\": \"The definition of the Search request.\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ApiVersionParameter\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ClientRequestIdParameter\"\r\n          }\r\n        ],\r\n        \"x-ms-request-id\": \"request-id\",\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"Response containing documents that match the search criteria.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/SearchDocumentsResult\"\r\n            }\r\n          },\r\n          \"default\": {\r\n            \"description\": \"Error response.\",\r\n            \"schema\": {\r\n              \"$ref\": \"../../../../../common-types/data-plane/v1/types.json#/definitions/ErrorResponse\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"/docs('{key}')\": {\r\n      \"get\": {\r\n        \"tags\": [\r\n          \"Documents\"\r\n        ],\r\n        \"operationId\": \"Documents_Get\",\r\n        \"externalDocs\": {\r\n          \"url\": \"https://learn.microsoft.com/rest/api/searchservice/lookup-document\"\r\n        },\r\n        \"x-ms-examples\": {\r\n          \"SearchIndexGetDocument\": {\r\n            \"$ref\": \"./examples/SearchIndexGetDocument.json\"\r\n          }\r\n        },\r\n        \"description\": \"Retrieves a document from the index.\",\r\n        \"parameters\": [\r\n          {\r\n            \"name\": \"key\",\r\n            \"in\": \"path\",\r\n            \"required\": true,\r\n            \"description\": \"The key of the document to retrieve.\",\r\n            \"type\": \"string\"\r\n          },\r\n          {\r\n            \"name\": \"$select\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"description\": \"List of field names to retrieve for the document; Any field not retrieved will be missing from the returned document.\",\r\n            \"x-ms-client-name\": \"SelectedFields\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ApiVersionParameter\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ClientRequestIdParameter\"\r\n          }\r\n        ],\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"Response containing the requested document.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/LookupDocument\"\r\n            }\r\n          },\r\n          \"default\": {\r\n            \"description\": \"Error response.\",\r\n            \"schema\": {\r\n              \"$ref\": \"../../../../../common-types/data-plane/v1/types.json#/definitions/ErrorResponse\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"/docs/search.suggest\": {\r\n      \"get\": {\r\n        \"tags\": [\r\n          \"Documents\"\r\n        ],\r\n        \"operationId\": \"Documents_SuggestGet\",\r\n        \"externalDocs\": {\r\n          \"url\": \"https://learn.microsoft.com/rest/api/searchservice/suggestions\"\r\n        },\r\n        \"x-ms-examples\": {\r\n          \"SearchIndexSuggestDocumentsGet\": {\r\n            \"$ref\": \"./examples/SearchIndexSuggestDocumentsGet.json\"\r\n          }\r\n        },\r\n        \"description\": \"Suggests documents in the index that match the given partial query text.\",\r\n        \"parameters\": [\r\n          {\r\n            \"name\": \"search\",\r\n            \"in\": \"query\",\r\n            \"required\": true,\r\n            \"type\": \"string\",\r\n            \"description\": \"The search text to use to suggest documents. Must be at least 1 character, and no more than 100 characters.\",\r\n            \"x-ms-client-name\": \"SearchText\"\r\n          },\r\n          {\r\n            \"name\": \"suggesterName\",\r\n            \"in\": \"query\",\r\n            \"required\": true,\r\n            \"type\": \"string\",\r\n            \"description\": \"The name of the suggester as specified in the suggesters collection that's part of the index definition.\"\r\n          },\r\n          {\r\n            \"name\": \"$filter\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"An OData expression that filters the documents considered for suggestions.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SuggestOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"fuzzy\",\r\n            \"in\": \"query\",\r\n            \"type\": \"boolean\",\r\n            \"description\": \"A value indicating whether to use fuzzy matching for the suggestions query. Default is false. When set to true, the query will find terms even if there's a substituted or missing character in the search text. While this provides a better experience in some scenarios, it comes at a performance cost as fuzzy suggestions queries are slower and consume more resources.\",\r\n            \"x-ms-client-name\": \"UseFuzzyMatching\",\r\n            \"x-nullable\": false,\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SuggestOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"highlightPostTag\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"A string tag that is appended to hit highlights. Must be set with highlightPreTag. If omitted, hit highlighting of suggestions is disabled.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SuggestOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"highlightPreTag\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"A string tag that is prepended to hit highlights. Must be set with highlightPostTag. If omitted, hit highlighting of suggestions is disabled.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SuggestOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"minimumCoverage\",\r\n            \"in\": \"query\",\r\n            \"type\": \"number\",\r\n            \"format\": \"double\",\r\n            \"description\": \"A number between 0 and 100 indicating the percentage of the index that must be covered by a suggestions query in order for the query to be reported as a success. This parameter can be useful for ensuring search availability even for services with only one replica. The default is 80.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SuggestOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$orderby\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"x-ms-client-name\": \"OrderBy\",\r\n            \"description\": \"The list of OData $orderby expressions by which to sort the results. Each expression can be either a field name or a call to either the geo.distance() or the search.score() functions. Each expression can be followed by asc to indicate ascending, or desc to indicate descending. The default is ascending order. Ties will be broken by the match scores of documents. If no $orderby is specified, the default sort order is descending by document match score. There can be at most 32 $orderby clauses.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SuggestOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"searchFields\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"description\": \"The list of field names to search for the specified search text. Target fields must be included in the specified suggester.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SuggestOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$select\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"description\": \"The list of fields to retrieve. If unspecified, only the key field will be included in the results.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SuggestOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$top\",\r\n            \"in\": \"query\",\r\n            \"type\": \"integer\",\r\n            \"format\": \"int32\",\r\n            \"description\": \"The number of suggestions to retrieve. The value must be a number between 1 and 100. The default is 5.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"SuggestOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ApiVersionParameter\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ClientRequestIdParameter\"\r\n          }\r\n        ],\r\n        \"x-ms-request-id\": \"request-id\",\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"Response containing suggested documents that match the partial input.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/SuggestDocumentsResult\"\r\n            }\r\n          },\r\n          \"default\": {\r\n            \"description\": \"Error response.\",\r\n            \"schema\": {\r\n              \"$ref\": \"../../../../../common-types/data-plane/v1/types.json#/definitions/ErrorResponse\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"/docs/search.post.suggest\": {\r\n      \"post\": {\r\n        \"tags\": [\r\n          \"Documents\"\r\n        ],\r\n        \"operationId\": \"Documents_SuggestPost\",\r\n        \"externalDocs\": {\r\n          \"url\": \"https://learn.microsoft.com/rest/api/searchservice/suggestions\"\r\n        },\r\n        \"x-ms-examples\": {\r\n          \"SearchIndexSuggestDocumentsPost\": {\r\n            \"$ref\": \"./examples/SearchIndexSuggestDocumentsPost.json\"\r\n          }\r\n        },\r\n        \"description\": \"Suggests documents in the index that match the given partial query text.\",\r\n        \"parameters\": [\r\n          {\r\n            \"name\": \"suggestRequest\",\r\n            \"in\": \"body\",\r\n            \"required\": true,\r\n            \"description\": \"The Suggest request.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/SuggestRequest\"\r\n            }\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ApiVersionParameter\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ClientRequestIdParameter\"\r\n          }\r\n        ],\r\n        \"x-ms-request-id\": \"request-id\",\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"Response containing suggested documents that match the partial input.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/SuggestDocumentsResult\"\r\n            }\r\n          },\r\n          \"default\": {\r\n            \"description\": \"Error response.\",\r\n            \"schema\": {\r\n              \"$ref\": \"../../../../../common-types/data-plane/v1/types.json#/definitions/ErrorResponse\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"/docs/search.index\": {\r\n      \"post\": {\r\n        \"tags\": [\r\n          \"Documents\"\r\n        ],\r\n        \"operationId\": \"Documents_Index\",\r\n        \"externalDocs\": {\r\n          \"url\": \"https://learn.microsoft.com/rest/api/searchservice/addupdate-or-delete-documents\"\r\n        },\r\n        \"x-ms-examples\": {\r\n          \"SearchIndexIndexDocuments\": {\r\n            \"$ref\": \"./examples/SearchIndexIndexDocuments.json\"\r\n          }\r\n        },\r\n        \"description\": \"Sends a batch of document write actions to the index.\",\r\n        \"parameters\": [\r\n          {\r\n            \"name\": \"batch\",\r\n            \"in\": \"body\",\r\n            \"description\": \"The batch of index actions.\",\r\n            \"required\": true,\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/IndexBatch\"\r\n            }\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ApiVersionParameter\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ClientRequestIdParameter\"\r\n          }\r\n        ],\r\n        \"x-ms-request-id\": \"request-id\",\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"Response containing the status of operations for all actions in the batch.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/IndexDocumentsResult\"\r\n            }\r\n          },\r\n          \"207\": {\r\n            \"description\": \"Response containing the status of operations for all actions in the batch.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/IndexDocumentsResult\"\r\n            }\r\n          },\r\n          \"default\": {\r\n            \"description\": \"Error response.\",\r\n            \"schema\": {\r\n              \"$ref\": \"../../../../../common-types/data-plane/v1/types.json#/definitions/ErrorResponse\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"/docs/search.autocomplete\": {\r\n      \"get\": {\r\n        \"tags\": [\r\n          \"Documents\"\r\n        ],\r\n        \"operationId\": \"Documents_AutocompleteGet\",\r\n        \"externalDocs\": {\r\n          \"url\": \"https://learn.microsoft.com/rest/api/searchservice/autocomplete\"\r\n        },\r\n        \"x-ms-examples\": {\r\n          \"SearchIndexAutocompleteDocumentsGet\": {\r\n            \"$ref\": \"./examples/SearchIndexAutocompleteDocumentsGet.json\"\r\n          }\r\n        },\r\n        \"description\": \"Autocompletes incomplete query terms based on input text and matching terms in the index.\",\r\n        \"parameters\": [\r\n          {\r\n            \"$ref\": \"#/parameters/ClientRequestIdParameter\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ApiVersionParameter\"\r\n          },\r\n          {\r\n            \"name\": \"search\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"required\": true,\r\n            \"description\": \"The incomplete term which should be auto-completed.\",\r\n            \"x-ms-client-name\": \"SearchText\"\r\n          },\r\n          {\r\n            \"name\": \"suggesterName\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"required\": true,\r\n            \"description\": \"The name of the suggester as specified in the suggesters collection that's part of the index definition.\"\r\n          },\r\n          {\r\n            \"name\": \"autocompleteMode\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"x-nullable\": false,\r\n            \"enum\": [\r\n              \"oneTerm\",\r\n              \"twoTerms\",\r\n              \"oneTermWithContext\"\r\n            ],\r\n            \"x-ms-enum\": {\r\n              \"name\": \"AutocompleteMode\",\r\n              \"modelAsString\": false,\r\n              \"values\": [\r\n                {\r\n                  \"value\": \"oneTerm\",\r\n                  \"name\": \"OneTerm\",\r\n                  \"description\": \"Only one term is suggested. If the query has two terms, only the last term is completed. For example, if the input is 'washington medic', the suggested terms could include 'medicaid', 'medicare', and 'medicine'.\"\r\n                },\r\n                {\r\n                  \"value\": \"twoTerms\",\r\n                  \"name\": \"TwoTerms\",\r\n                  \"description\": \"Matching two-term phrases in the index will be suggested. For example, if the input is 'medic', the suggested terms could include 'medicare coverage' and 'medical assistant'.\"\r\n                },\r\n                {\r\n                  \"value\": \"oneTermWithContext\",\r\n                  \"name\": \"OneTermWithContext\",\r\n                  \"description\": \"Completes the last term in a query with two or more terms, where the last two terms are a phrase that exists in the index. For example, if the input is 'washington medic', the suggested terms could include 'washington medicaid' and 'washington medical'.\"\r\n                }\r\n              ]\r\n            },\r\n            \"description\": \"Specifies the mode for Autocomplete. The default is 'oneTerm'. Use 'twoTerms' to get shingles and 'oneTermWithContext' to use the current context while producing auto-completed terms.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"AutocompleteOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$filter\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"An OData expression that filters the documents used to produce completed terms for the Autocomplete result.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"AutocompleteOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"fuzzy\",\r\n            \"in\": \"query\",\r\n            \"type\": \"boolean\",\r\n            \"description\": \"A value indicating whether to use fuzzy matching for the autocomplete query. Default is false. When set to true, the query will find terms even if there's a substituted or missing character in the search text. While this provides a better experience in some scenarios, it comes at a performance cost as fuzzy autocomplete queries are slower and consume more resources.\",\r\n            \"x-ms-client-name\": \"UseFuzzyMatching\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"AutocompleteOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"highlightPostTag\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"A string tag that is appended to hit highlights. Must be set with highlightPreTag. If omitted, hit highlighting is disabled.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"AutocompleteOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"highlightPreTag\",\r\n            \"in\": \"query\",\r\n            \"type\": \"string\",\r\n            \"description\": \"A string tag that is prepended to hit highlights. Must be set with highlightPostTag. If omitted, hit highlighting is disabled.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"AutocompleteOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"minimumCoverage\",\r\n            \"in\": \"query\",\r\n            \"type\": \"number\",\r\n            \"format\": \"double\",\r\n            \"description\": \"A number between 0 and 100 indicating the percentage of the index that must be covered by an autocomplete query in order for the query to be reported as a success. This parameter can be useful for ensuring search availability even for services with only one replica. The default is 80.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"AutocompleteOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"searchFields\",\r\n            \"in\": \"query\",\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            },\r\n            \"description\": \"The list of field names to consider when querying for auto-completed terms. Target fields must be included in the specified suggester.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"AutocompleteOptions\"\r\n            }\r\n          },\r\n          {\r\n            \"name\": \"$top\",\r\n            \"in\": \"query\",\r\n            \"type\": \"integer\",\r\n            \"format\": \"int32\",\r\n            \"description\": \"The number of auto-completed terms to retrieve. This must be a value between 1 and 100. The default is 5.\",\r\n            \"x-ms-parameter-grouping\": {\r\n              \"name\": \"AutocompleteOptions\"\r\n            }\r\n          }\r\n        ],\r\n        \"x-ms-request-id\": \"request-id\",\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"Response containing suggested query terms that complete the partial input.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/AutocompleteResult\"\r\n            }\r\n          },\r\n          \"default\": {\r\n            \"description\": \"Error response.\",\r\n            \"schema\": {\r\n              \"$ref\": \"../../../../../common-types/data-plane/v1/types.json#/definitions/ErrorResponse\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    },\r\n    \"/docs/search.post.autocomplete\": {\r\n      \"post\": {\r\n        \"tags\": [\r\n          \"Documents\"\r\n        ],\r\n        \"operationId\": \"Documents_AutocompletePost\",\r\n        \"externalDocs\": {\r\n          \"url\": \"https://learn.microsoft.com/rest/api/searchservice/autocomplete\"\r\n        },\r\n        \"x-ms-examples\": {\r\n          \"SearchIndexAutocompleteDocumentsPost\": {\r\n            \"$ref\": \"./examples/SearchIndexAutocompleteDocumentsPost.json\"\r\n          }\r\n        },\r\n        \"description\": \"Autocompletes incomplete query terms based on input text and matching terms in the index.\",\r\n        \"parameters\": [\r\n          {\r\n            \"$ref\": \"#/parameters/ClientRequestIdParameter\"\r\n          },\r\n          {\r\n            \"$ref\": \"#/parameters/ApiVersionParameter\"\r\n          },\r\n          {\r\n            \"name\": \"autocompleteRequest\",\r\n            \"in\": \"body\",\r\n            \"required\": true,\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/AutocompleteRequest\"\r\n            },\r\n            \"description\": \"The definition of the Autocomplete request.\"\r\n          }\r\n        ],\r\n        \"x-ms-request-id\": \"request-id\",\r\n        \"responses\": {\r\n          \"200\": {\r\n            \"description\": \"Response containing suggested query terms that complete the partial input.\",\r\n            \"schema\": {\r\n              \"$ref\": \"#/definitions/AutocompleteResult\"\r\n            }\r\n          },\r\n          \"default\": {\r\n            \"description\": \"Error response.\",\r\n            \"schema\": {\r\n              \"$ref\": \"../../../../../common-types/data-plane/v1/types.json#/definitions/ErrorResponse\"\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"definitions\": {\r\n    \"SuggestDocumentsResult\": {\r\n      \"properties\": {\r\n        \"value\": {\r\n          \"type\": \"array\",\r\n          \"items\": {\r\n            \"$ref\": \"#/definitions/SuggestResult\"\r\n          },\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Results\",\r\n          \"description\": \"The sequence of results returned by the query.\"\r\n        },\r\n        \"@search.coverage\": {\r\n          \"type\": \"number\",\r\n          \"readOnly\": true,\r\n          \"format\": \"double\",\r\n          \"x-ms-client-name\": \"Coverage\",\r\n          \"description\": \"A value indicating the percentage of the index that was included in the query, or null if minimumCoverage was not set in the request.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"value\"\r\n      ],\r\n      \"description\": \"Response containing suggestion query results from an index.\"\r\n    },\r\n    \"SuggestResult\": {\r\n      \"properties\": {\r\n        \"@search.text\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"description\": \"The text of the suggestion result.\",\r\n          \"x-ms-client-name\": \"Text\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"@search.text\"\r\n      ],\r\n      \"additionalProperties\": true,\r\n      \"description\": \"A result containing a document found by a suggestion query, plus associated metadata.\"\r\n    },\r\n    \"FacetResult\": {\r\n      \"properties\": {\r\n        \"count\": {\r\n          \"type\": \"integer\",\r\n          \"format\": \"int64\",\r\n          \"readOnly\": true,\r\n          \"description\": \"The approximate count of documents falling within the bucket described by this facet.\"\r\n        }\r\n      },\r\n      \"additionalProperties\": true,\r\n      \"description\": \"A single bucket of a facet query result. Reports the number of documents with a field value falling within a particular range or having a particular value or interval.\"\r\n    },\r\n    \"SearchDocumentsResult\": {\r\n      \"properties\": {\r\n        \"@odata.count\": {\r\n          \"type\": \"integer\",\r\n          \"format\": \"int64\",\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Count\",\r\n          \"description\": \"The total count of results found by the search operation, or null if the count was not requested. If present, the count may be greater than the number of results in this response. This can happen if you use the $top or $skip parameters, or if the query can't return all the requested documents in a single response.\"\r\n        },\r\n        \"@search.coverage\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"double\",\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Coverage\",\r\n          \"description\": \"A value indicating the percentage of the index that was included in the query, or null if minimumCoverage was not specified in the request.\"\r\n        },\r\n        \"@search.facets\": {\r\n          \"type\": \"object\",\r\n          \"additionalProperties\": {\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"$ref\": \"#/definitions/FacetResult\"\r\n            }\r\n          },\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Facets\",\r\n          \"description\": \"The facet query results for the search operation, organized as a collection of buckets for each faceted field; null if the query did not include any facet expressions.\"\r\n        },\r\n        \"@search.answers\": {\r\n          \"type\": \"array\",\r\n          \"items\": {\r\n            \"$ref\": \"#/definitions/AnswerResult\"\r\n          },\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Answers\",\r\n          \"x-nullable\": true,\r\n          \"description\": \"The answers query results for the search operation; null if the answers query parameter was not specified or set to 'none'.\"\r\n        },\r\n        \"@search.nextPageParameters\": {\r\n          \"$ref\": \"#/definitions/SearchRequest\",\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"NextPageParameters\",\r\n          \"description\": \"Continuation JSON payload returned when the query can't return all the requested results in a single response. You can use this JSON along with @odata.nextLink to formulate another POST Search request to get the next part of the search response.\"\r\n        },\r\n        \"value\": {\r\n          \"type\": \"array\",\r\n          \"items\": {\r\n            \"$ref\": \"#/definitions/SearchResult\"\r\n          },\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Results\",\r\n          \"description\": \"The sequence of results returned by the query.\"\r\n        },\r\n        \"@odata.nextLink\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"NextLink\",\r\n          \"description\": \"Continuation URL returned when the query can't return all the requested results in a single response. You can use this URL to formulate another GET or POST Search request to get the next part of the search response. Make sure to use the same verb (GET or POST) as the request that produced this response.\"\r\n        },\r\n        \"@search.semanticPartialResponseReason\": {\r\n          \"$ref\": \"#/definitions/SemanticPartialResponseReason\",\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"SemanticPartialResponseReason\",\r\n          \"description\": \"Reason that a partial response was returned for a semantic ranking request.\"\r\n        },\r\n        \"@search.semanticPartialResponseType\": {\r\n          \"$ref\": \"#/definitions/SemanticPartialResponseType\",\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"SemanticPartialResponseType\",\r\n          \"description\": \"Type of partial response that was returned for a semantic ranking request.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"value\"\r\n      ],\r\n      \"description\": \"Response containing search results from an index.\"\r\n    },\r\n    \"SearchResult\": {\r\n      \"properties\": {\r\n        \"@search.score\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"double\",\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Score\",\r\n          \"x-nullable\": false,\r\n          \"description\": \"The relevance score of the document compared to other documents returned by the query.\"\r\n        },\r\n        \"@search.rerankerScore\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"double\",\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"RerankerScore\",\r\n          \"x-nullable\": true,\r\n          \"description\": \"The relevance score computed by the semantic ranker for the top search results. Search results are sorted by the RerankerScore first and then by the Score. RerankerScore is only returned for queries of type 'semantic'.\"\r\n        },\r\n        \"@search.highlights\": {\r\n          \"type\": \"object\",\r\n          \"additionalProperties\": {\r\n            \"type\": \"array\",\r\n            \"items\": {\r\n              \"type\": \"string\"\r\n            }\r\n          },\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Highlights\",\r\n          \"description\": \"Text fragments from the document that indicate the matching search terms, organized by each applicable field; null if hit highlighting was not enabled for the query.\"\r\n        },\r\n        \"@search.captions\": {\r\n          \"type\": \"array\",\r\n          \"items\": {\r\n            \"$ref\": \"#/definitions/CaptionResult\"\r\n          },\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Captions\",\r\n          \"x-nullable\": true,\r\n          \"description\": \"Captions are the most representative passages from the document relatively to the search query. They are often used as document summary. Captions are only returned for queries of type 'semantic'.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"@search.score\"\r\n      ],\r\n      \"additionalProperties\": true,\r\n      \"description\": \"Contains a document found by a search query, plus associated metadata.\"\r\n    },\r\n    \"LookupDocument\": {\r\n      \"type\": \"object\",\r\n      \"additionalProperties\": true,\r\n      \"description\": \"A document retrieved via a document lookup operation.\"\r\n    },\r\n    \"IndexBatch\": {\r\n      \"properties\": {\r\n        \"value\": {\r\n          \"type\": \"array\",\r\n          \"items\": {\r\n            \"$ref\": \"#/definitions/IndexAction\"\r\n          },\r\n          \"description\": \"The actions in the batch.\",\r\n          \"x-ms-client-name\": \"Actions\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"value\"\r\n      ],\r\n      \"description\": \"Contains a batch of document write actions to send to the index.\"\r\n    },\r\n    \"IndexAction\": {\r\n      \"properties\": {\r\n        \"@search.action\": {\r\n          \"type\": \"string\",\r\n          \"enum\": [\r\n            \"upload\",\r\n            \"merge\",\r\n            \"mergeOrUpload\",\r\n            \"delete\"\r\n          ],\r\n          \"x-ms-enum\": {\r\n            \"name\": \"IndexActionType\",\r\n            \"modelAsString\": false,\r\n            \"values\": [\r\n              {\r\n                \"value\": \"upload\",\r\n                \"name\": \"Upload\",\r\n                \"description\": \"Inserts the document into the index if it is new and updates it if it exists. All fields are replaced in the update case.\"\r\n              },\r\n              {\r\n                \"value\": \"merge\",\r\n                \"name\": \"Merge\",\r\n                \"description\": \"Merges the specified field values with an existing document. If the document does not exist, the merge will fail. Any field you specify in a merge will replace the existing field in the document. This also applies to collections of primitive and complex types.\"\r\n              },\r\n              {\r\n                \"value\": \"mergeOrUpload\",\r\n                \"name\": \"MergeOrUpload\",\r\n                \"description\": \"Behaves like merge if a document with the given key already exists in the index. If the document does not exist, it behaves like upload with a new document.\"\r\n              },\r\n              {\r\n                \"value\": \"delete\",\r\n                \"name\": \"Delete\",\r\n                \"description\": \"Removes the specified document from the index. Any field you specify in a delete operation other than the key field will be ignored. If you want to remove an individual field from a document, use merge instead and set the field explicitly to null.\"\r\n              }\r\n            ]\r\n          },\r\n          \"x-ms-client-name\": \"ActionType\",\r\n          \"x-nullable\": false,\r\n          \"description\": \"The operation to perform on a document in an indexing batch.\"\r\n        }\r\n      },\r\n      \"additionalProperties\": true,\r\n      \"description\": \"Represents an index action that operates on a document.\"\r\n    },\r\n    \"IndexingResult\": {\r\n      \"properties\": {\r\n        \"key\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"description\": \"The key of a document that was in the indexing request.\"\r\n        },\r\n        \"errorMessage\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"description\": \"The error message explaining why the indexing operation failed for the document identified by the key; null if indexing succeeded.\"\r\n        },\r\n        \"status\": {\r\n          \"x-ms-client-name\": \"Succeeded\",\r\n          \"type\": \"boolean\",\r\n          \"x-nullable\": false,\r\n          \"readOnly\": true,\r\n          \"description\": \"A value indicating whether the indexing operation succeeded for the document identified by the key.\"\r\n        },\r\n        \"statusCode\": {\r\n          \"type\": \"integer\",\r\n          \"format\": \"int32\",\r\n          \"x-nullable\": false,\r\n          \"readOnly\": true,\r\n          \"description\": \"The status code of the indexing operation. Possible values include: 200 for a successful update or delete, 201 for successful document creation, 400 for a malformed input document, 404 for document not found, 409 for a version conflict, 422 when the index is temporarily unavailable, or 503 for when the service is too busy.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"key\",\r\n        \"status\",\r\n        \"statusCode\"\r\n      ],\r\n      \"description\": \"Status of an indexing operation for a single document.\"\r\n    },\r\n    \"IndexDocumentsResult\": {\r\n      \"properties\": {\r\n        \"value\": {\r\n          \"x-ms-client-name\": \"Results\",\r\n          \"type\": \"array\",\r\n          \"readOnly\": true,\r\n          \"items\": {\r\n            \"$ref\": \"#/definitions/IndexingResult\"\r\n          },\r\n          \"description\": \"The list of status information for each document in the indexing request.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"value\"\r\n      ],\r\n      \"description\": \"Response containing the status of operations for all documents in the indexing request.\"\r\n    },\r\n    \"SearchMode\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"any\",\r\n        \"all\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"SearchMode\",\r\n        \"modelAsString\": false,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"any\",\r\n            \"name\": \"Any\",\r\n            \"description\": \"Any of the search terms must be matched in order to count the document as a match.\"\r\n          },\r\n          {\r\n            \"value\": \"all\",\r\n            \"name\": \"All\",\r\n            \"description\": \"All of the search terms must be matched in order to count the document as a match.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"Specifies whether any or all of the search terms must be matched in order to count the document as a match.\"\r\n    },\r\n    \"QueryType\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"simple\",\r\n        \"full\",\r\n        \"semantic\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"QueryType\",\r\n        \"modelAsString\": false,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"simple\",\r\n            \"name\": \"Simple\",\r\n            \"description\": \"Uses the simple query syntax for searches. Search text is interpreted using a simple query language that allows for symbols such as +, * and \\\"\\\". Queries are evaluated across all searchable fields by default, unless the searchFields parameter is specified.\"\r\n          },\r\n          {\r\n            \"value\": \"full\",\r\n            \"name\": \"Full\",\r\n            \"description\": \"Uses the full Lucene query syntax for searches. Search text is interpreted using the Lucene query language which allows field-specific and weighted searches, as well as other advanced features.\"\r\n          },\r\n          {\r\n            \"value\": \"semantic\",\r\n            \"name\": \"Semantic\",\r\n            \"description\": \"Best suited for queries expressed in natural language as opposed to keywords. Improves precision of search results by re-ranking the top search results using a ranking model trained on the Web corpus.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"Specifies the syntax of the search query. The default is 'simple'. Use 'full' if your query uses the Lucene query syntax.\"\r\n    },\r\n    \"VectorQuery\": {\r\n      \"type\": \"object\",\r\n      \"discriminator\": \"kind\",\r\n      \"properties\": {\r\n        \"kind\": {\r\n          \"$ref\": \"#/definitions/VectorQueryKind\",\r\n          \"description\": \"The kind of vector query being performed.\",\r\n          \"x-nullable\": false\r\n        },\r\n        \"k\": {\r\n          \"type\": \"integer\",\r\n          \"format\": \"int32\",\r\n          \"description\": \"Number of nearest neighbors to return as top hits.\"\r\n        },\r\n        \"fields\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"Vector Fields of type Collection(Edm.Single) to be included in the vector searched.\"\r\n        },\r\n        \"exhaustive\": {\r\n          \"type\": \"boolean\",\r\n          \"description\": \"When true, triggers an exhaustive k-nearest neighbor search across all vectors within the vector index. Useful for scenarios where exact matches are critical, such as determining ground truth values.\"\r\n        },\r\n        \"oversampling\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"double\",\r\n          \"description\": \"Oversampling factor. Minimum value is 1. It overrides the 'defaultOversampling' parameter configured in the index definition. It can be set only when 'rerankWithOriginalVectors' is true. This parameter is only permitted when a compression method is used on the underlying vector field.\"\r\n        },\r\n        \"weight\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"float\",\r\n          \"description\": \"Relative weight of the vector query when compared to other vector query and/or the text query within the same search request. This value is used when combining the results of multiple ranking lists produced by the different vector queries and/or the results retrieved through the text query. The higher the weight, the higher the documents that matched that query will be in the final ranking. Default is 1.0 and the value needs to be a positive number larger than zero. \"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"kind\"\r\n      ],\r\n      \"description\": \"The query parameters for vector and hybrid search queries.\"\r\n    },\r\n    \"RawVectorQuery\": {\r\n      \"type\": \"object\",\r\n      \"x-ms-client-name\": \"VectorizedQuery\",\r\n      \"x-ms-discriminator-value\": \"vector\",\r\n      \"allOf\": [\r\n        {\r\n          \"$ref\": \"#/definitions/VectorQuery\"\r\n        }\r\n      ],\r\n      \"properties\": {\r\n        \"vector\": {\r\n          \"type\": \"array\",\r\n          \"items\": {\r\n            \"type\": \"number\",\r\n            \"format\": \"float\"\r\n          },\r\n          \"description\": \"The vector representation of a search query.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"vector\"\r\n      ],\r\n      \"description\": \"The query parameters to use for vector search when a raw vector value is provided.\"\r\n    },\r\n    \"VectorizableTextQuery\": {\r\n      \"type\": \"object\",\r\n      \"x-ms-discriminator-value\": \"text\",\r\n      \"allOf\": [\r\n        {\r\n          \"$ref\": \"#/definitions/VectorQuery\"\r\n        }\r\n      ],\r\n      \"properties\": {\r\n        \"text\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The text to be vectorized to perform a vector search query.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"text\"\r\n      ],\r\n      \"description\": \"The query parameters to use for vector search when a text value that needs to be vectorized is provided.\"\r\n    },\r\n    \"VectorQueryKind\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"vector\",\r\n        \"text\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"VectorQueryKind\",\r\n        \"modelAsString\": true,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"vector\",\r\n            \"name\": \"Vector\",\r\n            \"description\": \"Vector query where a raw vector value is provided.\"\r\n          },\r\n          {\r\n            \"value\": \"text\",\r\n            \"name\": \"Text\",\r\n            \"description\": \"Vector query where a text value that needs to be vectorized is provided.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"The kind of vector query being performed.\"\r\n    },\r\n    \"VectorFilterMode\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"postFilter\",\r\n        \"preFilter\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"VectorFilterMode\",\r\n        \"modelAsString\": true,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"postFilter\",\r\n            \"name\": \"PostFilter\",\r\n            \"description\": \"The filter will be applied after the candidate set of vector results is returned. Depending on the filter selectivity, this can result in fewer results than requested by the parameter 'k'.\"\r\n          },\r\n          {\r\n            \"value\": \"preFilter\",\r\n            \"name\": \"PreFilter\",\r\n            \"description\": \"The filter will be applied before the search query.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"Determines whether or not filters are applied before or after the vector search is performed.\"\r\n    },\r\n    \"ScoringStatistics\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"local\",\r\n        \"global\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"ScoringStatistics\",\r\n        \"modelAsString\": false,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"local\",\r\n            \"name\": \"Local\",\r\n            \"description\": \"The scoring statistics will be calculated locally for lower latency.\"\r\n          },\r\n          {\r\n            \"value\": \"global\",\r\n            \"name\": \"Global\",\r\n            \"description\": \"The scoring statistics will be calculated globally for more consistent scoring.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"A value that specifies whether we want to calculate scoring statistics (such as document frequency) globally for more consistent scoring, or locally, for lower latency. The default is 'local'. Use 'global' to aggregate scoring statistics globally before scoring. Using global scoring statistics can increase latency of search queries.\"\r\n    },\r\n    \"AutocompleteMode\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"oneTerm\",\r\n        \"twoTerms\",\r\n        \"oneTermWithContext\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"AutocompleteMode\",\r\n        \"modelAsString\": false,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"oneTerm\",\r\n            \"name\": \"OneTerm\",\r\n            \"description\": \"Only one term is suggested. If the query has two terms, only the last term is completed. For example, if the input is 'washington medic', the suggested terms could include 'medicaid', 'medicare', and 'medicine'.\"\r\n          },\r\n          {\r\n            \"value\": \"twoTerms\",\r\n            \"name\": \"TwoTerms\",\r\n            \"description\": \"Matching two-term phrases in the index will be suggested. For example, if the input is 'medic', the suggested terms could include 'medicare coverage' and 'medical assistant'.\"\r\n          },\r\n          {\r\n            \"value\": \"oneTermWithContext\",\r\n            \"name\": \"OneTermWithContext\",\r\n            \"description\": \"Completes the last term in a query with two or more terms, where the last two terms are a phrase that exists in the index. For example, if the input is 'washington medic', the suggested terms could include 'washington medicaid' and 'washington medical'.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"Specifies the mode for Autocomplete. The default is 'oneTerm'. Use 'twoTerms' to get shingles and 'oneTermWithContext' to use the current context in producing autocomplete terms.\"\r\n    },\r\n    \"SearchRequest\": {\r\n      \"properties\": {\r\n        \"count\": {\r\n          \"type\": \"boolean\",\r\n          \"description\": \"A value that specifies whether to fetch the total count of results. Default is false. Setting this value to true may have a performance impact. Note that the count returned is an approximation.\",\r\n          \"x-ms-client-name\": \"IncludeTotalResultCount\"\r\n        },\r\n        \"facets\": {\r\n          \"externalDocs\": {\r\n            \"url\": \"https://learn.microsoft.com/rest/api/searchservice/Search-Documents\"\r\n          },\r\n          \"type\": \"array\",\r\n          \"items\": {\r\n            \"type\": \"string\"\r\n          },\r\n          \"description\": \"The list of facet expressions to apply to the search query. Each facet expression contains a field name, optionally followed by a comma-separated list of name:value pairs.\"\r\n        },\r\n        \"filter\": {\r\n          \"externalDocs\": {\r\n            \"url\": \"https://learn.microsoft.com/rest/api/searchservice/OData-Expression-Syntax-for-Azure-Search\"\r\n          },\r\n          \"type\": \"string\",\r\n          \"description\": \"The OData $filter expression to apply to the search query.\"\r\n        },\r\n        \"highlight\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The comma-separated list of field names to use for hit highlights. Only searchable fields can be used for hit highlighting.\",\r\n          \"x-ms-client-name\": \"HighlightFields\"\r\n        },\r\n        \"highlightPostTag\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"A string tag that is appended to hit highlights. Must be set with highlightPreTag. Default is &lt;/em&gt;.\"\r\n        },\r\n        \"highlightPreTag\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"A string tag that is prepended to hit highlights. Must be set with highlightPostTag. Default is &lt;em&gt;.\"\r\n        },\r\n        \"minimumCoverage\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"double\",\r\n          \"description\": \"A number between 0 and 100 indicating the percentage of the index that must be covered by a search query in order for the query to be reported as a success. This parameter can be useful for ensuring search availability even for services with only one replica. The default is 100.\"\r\n        },\r\n        \"orderby\": {\r\n          \"x-ms-client-name\": \"OrderBy\",\r\n          \"type\": \"string\",\r\n          \"description\": \"The comma-separated list of OData $orderby expressions by which to sort the results. Each expression can be either a field name or a call to either the geo.distance() or the search.score() functions. Each expression can be followed by asc to indicate ascending, or desc to indicate descending. The default is ascending order. Ties will be broken by the match scores of documents. If no $orderby is specified, the default sort order is descending by document match score. There can be at most 32 $orderby clauses.\"\r\n        },\r\n        \"queryType\": {\r\n          \"$ref\": \"#/definitions/QueryType\",\r\n          \"description\": \"A value that specifies the syntax of the search query. The default is 'simple'. Use 'full' if your query uses the Lucene query syntax.\"\r\n        },\r\n        \"scoringStatistics\": {\r\n          \"$ref\": \"#/definitions/ScoringStatistics\",\r\n          \"description\": \"A value that specifies whether we want to calculate scoring statistics (such as document frequency) globally for more consistent scoring, or locally, for lower latency. The default is 'local'. Use 'global' to aggregate scoring statistics globally before scoring. Using global scoring statistics can increase latency of search queries.\"\r\n        },\r\n        \"sessionId\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"A value to be used to create a sticky session, which can help getting more consistent results. As long as the same sessionId is used, a best-effort attempt will be made to target the same replica set. Be wary that reusing the same sessionID values repeatedly can interfere with the load balancing of the requests across replicas and adversely affect the performance of the search service. The value used as sessionId cannot start with a '_' character.\"\r\n        },\r\n        \"scoringParameters\": {\r\n          \"type\": \"array\",\r\n          \"items\": {\r\n            \"type\": \"string\"\r\n          },\r\n          \"description\": \"The list of parameter values to be used in scoring functions (for example, referencePointParameter) using the format name-values. For example, if the scoring profile defines a function with a parameter called 'mylocation' the parameter string would be \\\"mylocation--122.2,44.8\\\" (without the quotes).\"\r\n        },\r\n        \"scoringProfile\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The name of a scoring profile to evaluate match scores for matching documents in order to sort the results.\"\r\n        },\r\n        \"search\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"A full-text search query expression; Use \\\"*\\\" or omit this parameter to match all documents.\",\r\n          \"x-ms-client-name\": \"SearchText\"\r\n        },\r\n        \"searchFields\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The comma-separated list of field names to which to scope the full-text search. When using fielded search (fieldName:searchExpression) in a full Lucene query, the field names of each fielded search expression take precedence over any field names listed in this parameter.\"\r\n        },\r\n        \"searchMode\": {\r\n          \"$ref\": \"#/definitions/SearchMode\",\r\n          \"description\": \"A value that specifies whether any or all of the search terms must be matched in order to count the document as a match.\"\r\n        },\r\n        \"select\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The comma-separated list of fields to retrieve. If unspecified, all fields marked as retrievable in the schema are included.\"\r\n        },\r\n        \"skip\": {\r\n          \"type\": \"integer\",\r\n          \"format\": \"int32\",\r\n          \"description\": \"The number of search results to skip. This value cannot be greater than 100,000. If you need to scan documents in sequence, but cannot use skip due to this limitation, consider using orderby on a totally-ordered key and filter with a range query instead.\"\r\n        },\r\n        \"top\": {\r\n          \"type\": \"integer\",\r\n          \"format\": \"int32\",\r\n          \"description\": \"The number of search results to retrieve. This can be used in conjunction with $skip to implement client-side paging of search results. If results are truncated due to server-side paging, the response will include a continuation token that can be used to issue another Search request for the next page of results.\"\r\n        },\r\n        \"semanticConfiguration\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The name of a semantic configuration that will be used when processing documents for queries of type semantic.\"\r\n        },\r\n        \"semanticErrorHandling\": {\r\n          \"$ref\": \"#/definitions/SemanticErrorHandling\",\r\n          \"description\": \"Allows the user to choose whether a semantic call should fail completely (default / current behavior), or to return partial results.\"\r\n        },\r\n        \"semanticMaxWaitInMilliseconds\": {\r\n          \"type\": \"integer\",\r\n          \"format\": \"int32\",\r\n          \"x-nullable\": true,\r\n          \"minimum\": 700,\r\n          \"description\": \"Allows the user to set an upper bound on the amount of time it takes for semantic enrichment to finish processing before the request fails.\"\r\n        },\r\n        \"semanticQuery\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"Allows setting a separate search query that will be solely used for semantic reranking, semantic captions and semantic answers. Is useful for scenarios where there is a need to use different queries between the base retrieval and ranking phase, and the L2 semantic phase.\"\r\n        },\r\n        \"answers\": {\r\n          \"$ref\": \"#/definitions/Answers\",\r\n          \"description\": \"A value that specifies whether answers should be returned as part of the search response.\"\r\n        },\r\n        \"captions\": {\r\n          \"$ref\": \"#/definitions/Captions\",\r\n          \"description\": \"A value that specifies whether captions should be returned as part of the search response.\"\r\n        },\r\n        \"vectorQueries\": {\r\n          \"type\": \"array\",\r\n          \"items\": {\r\n            \"$ref\": \"#/definitions/VectorQuery\"\r\n          },\r\n          \"description\": \"The query parameters for vector and hybrid search queries.\"\r\n        },\r\n        \"vectorFilterMode\": {\r\n          \"$ref\": \"#/definitions/VectorFilterMode\",\r\n          \"description\": \"Determines whether or not filters are applied before or after the vector search is performed. Default is 'preFilter' for new indexes.\"\r\n        }\r\n      },\r\n      \"description\": \"Parameters for filtering, sorting, faceting, paging, and other search query behaviors.\"\r\n    },\r\n    \"SuggestRequest\": {\r\n      \"properties\": {\r\n        \"filter\": {\r\n          \"externalDocs\": {\r\n            \"url\": \"https://learn.microsoft.com/rest/api/searchservice/OData-Expression-Syntax-for-Azure-Search\"\r\n          },\r\n          \"type\": \"string\",\r\n          \"description\": \"An OData expression that filters the documents considered for suggestions.\"\r\n        },\r\n        \"fuzzy\": {\r\n          \"type\": \"boolean\",\r\n          \"description\": \"A value indicating whether to use fuzzy matching for the suggestion query. Default is false. When set to true, the query will find suggestions even if there's a substituted or missing character in the search text. While this provides a better experience in some scenarios, it comes at a performance cost as fuzzy suggestion searches are slower and consume more resources.\",\r\n          \"x-ms-client-name\": \"UseFuzzyMatching\"\r\n        },\r\n        \"highlightPostTag\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"A string tag that is appended to hit highlights. Must be set with highlightPreTag. If omitted, hit highlighting of suggestions is disabled.\"\r\n        },\r\n        \"highlightPreTag\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"A string tag that is prepended to hit highlights. Must be set with highlightPostTag. If omitted, hit highlighting of suggestions is disabled.\"\r\n        },\r\n        \"minimumCoverage\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"double\",\r\n          \"description\": \"A number between 0 and 100 indicating the percentage of the index that must be covered by a suggestion query in order for the query to be reported as a success. This parameter can be useful for ensuring search availability even for services with only one replica. The default is 80.\"\r\n        },\r\n        \"orderby\": {\r\n          \"x-ms-client-name\": \"OrderBy\",\r\n          \"type\": \"string\",\r\n          \"description\": \"The comma-separated list of OData $orderby expressions by which to sort the results. Each expression can be either a field name or a call to either the geo.distance() or the search.score() functions. Each expression can be followed by asc to indicate ascending, or desc to indicate descending. The default is ascending order. Ties will be broken by the match scores of documents. If no $orderby is specified, the default sort order is descending by document match score. There can be at most 32 $orderby clauses.\"\r\n        },\r\n        \"search\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The search text to use to suggest documents. Must be at least 1 character, and no more than 100 characters.\",\r\n          \"x-ms-client-name\": \"SearchText\"\r\n        },\r\n        \"searchFields\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The comma-separated list of field names to search for the specified search text. Target fields must be included in the specified suggester.\"\r\n        },\r\n        \"select\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The comma-separated list of fields to retrieve. If unspecified, only the key field will be included in the results.\"\r\n        },\r\n        \"suggesterName\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The name of the suggester as specified in the suggesters collection that's part of the index definition.\"\r\n        },\r\n        \"top\": {\r\n          \"type\": \"integer\",\r\n          \"format\": \"int32\",\r\n          \"description\": \"The number of suggestions to retrieve. This must be a value between 1 and 100. The default is 5.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"search\",\r\n        \"suggesterName\"\r\n      ],\r\n      \"description\": \"Parameters for filtering, sorting, fuzzy matching, and other suggestions query behaviors.\"\r\n    },\r\n    \"AutocompleteRequest\": {\r\n      \"properties\": {\r\n        \"search\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The search text on which to base autocomplete results.\",\r\n          \"x-ms-client-name\": \"SearchText\"\r\n        },\r\n        \"autocompleteMode\": {\r\n          \"$ref\": \"#/definitions/AutocompleteMode\",\r\n          \"description\": \"Specifies the mode for Autocomplete. The default is 'oneTerm'. Use 'twoTerms' to get shingles and 'oneTermWithContext' to use the current context while producing auto-completed terms.\"\r\n        },\r\n        \"filter\": {\r\n          \"externalDocs\": {\r\n            \"url\": \"https://learn.microsoft.com/rest/api/searchservice/OData-Expression-Syntax-for-Azure-Search\"\r\n          },\r\n          \"type\": \"string\",\r\n          \"description\": \"An OData expression that filters the documents used to produce completed terms for the Autocomplete result.\"\r\n        },\r\n        \"fuzzy\": {\r\n          \"type\": \"boolean\",\r\n          \"description\": \"A value indicating whether to use fuzzy matching for the autocomplete query. Default is false. When set to true, the query will autocomplete terms even if there's a substituted or missing character in the search text. While this provides a better experience in some scenarios, it comes at a performance cost as fuzzy autocomplete queries are slower and consume more resources.\",\r\n          \"x-ms-client-name\": \"UseFuzzyMatching\"\r\n        },\r\n        \"highlightPostTag\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"A string tag that is appended to hit highlights. Must be set with highlightPreTag. If omitted, hit highlighting is disabled.\"\r\n        },\r\n        \"highlightPreTag\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"A string tag that is prepended to hit highlights. Must be set with highlightPostTag. If omitted, hit highlighting is disabled.\"\r\n        },\r\n        \"minimumCoverage\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"double\",\r\n          \"description\": \"A number between 0 and 100 indicating the percentage of the index that must be covered by an autocomplete query in order for the query to be reported as a success. This parameter can be useful for ensuring search availability even for services with only one replica. The default is 80.\"\r\n        },\r\n        \"searchFields\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The comma-separated list of field names to consider when querying for auto-completed terms. Target fields must be included in the specified suggester.\"\r\n        },\r\n        \"suggesterName\": {\r\n          \"type\": \"string\",\r\n          \"description\": \"The name of the suggester as specified in the suggesters collection that's part of the index definition.\"\r\n        },\r\n        \"top\": {\r\n          \"type\": \"integer\",\r\n          \"format\": \"int32\",\r\n          \"description\": \"The number of auto-completed terms to retrieve. This must be a value between 1 and 100. The default is 5.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"search\",\r\n        \"suggesterName\"\r\n      ],\r\n      \"description\": \"Parameters for fuzzy matching, and other autocomplete query behaviors.\"\r\n    },\r\n    \"AutocompleteResult\": {\r\n      \"properties\": {\r\n        \"@search.coverage\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"double\",\r\n          \"readOnly\": true,\r\n          \"x-ms-client-name\": \"Coverage\",\r\n          \"description\": \"A value indicating the percentage of the index that was considered by the autocomplete request, or null if minimumCoverage was not specified in the request.\"\r\n        },\r\n        \"value\": {\r\n          \"type\": \"array\",\r\n          \"readOnly\": true,\r\n          \"items\": {\r\n            \"$ref\": \"#/definitions/AutocompleteItem\"\r\n          },\r\n          \"description\": \"The list of returned Autocompleted items.\",\r\n          \"x-ms-client-name\": \"Results\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"value\"\r\n      ],\r\n      \"description\": \"The result of Autocomplete query.\"\r\n    },\r\n    \"AutocompleteItem\": {\r\n      \"properties\": {\r\n        \"text\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"description\": \"The completed term.\"\r\n        },\r\n        \"queryPlusText\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"description\": \"The query along with the completed term.\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"text\",\r\n        \"queryPlusText\"\r\n      ],\r\n      \"description\": \"The result of Autocomplete requests.\"\r\n    },\r\n    \"AnswerResult\": {\r\n      \"x-ms-client-name\": \"QueryAnswerResult\",\r\n      \"properties\": {\r\n        \"score\": {\r\n          \"type\": \"number\",\r\n          \"format\": \"double\",\r\n          \"readOnly\": true,\r\n          \"description\": \"The score value represents how relevant the answer is to the query relative to other answers returned for the query.\"\r\n        },\r\n        \"key\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"description\": \"The key of the document the answer was extracted from.\"\r\n        },\r\n        \"text\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"description\": \"The text passage extracted from the document contents as the answer.\"\r\n        },\r\n        \"highlights\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"x-nullable\": true,\r\n          \"description\": \"Same text passage as in the Text property with highlighted text phrases most relevant to the query.\"\r\n        }\r\n      },\r\n      \"additionalProperties\": true,\r\n      \"description\": \"An answer is a text passage extracted from the contents of the most relevant documents that matched the query. Answers are extracted from the top search results. Answer candidates are scored and the top answers are selected.\"\r\n    },\r\n    \"CaptionResult\": {\r\n      \"x-ms-client-name\": \"QueryCaptionResult\",\r\n      \"properties\": {\r\n        \"text\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"description\": \"A representative text passage extracted from the document most relevant to the search query.\"\r\n        },\r\n        \"highlights\": {\r\n          \"type\": \"string\",\r\n          \"readOnly\": true,\r\n          \"x-nullable\": true,\r\n          \"description\": \"Same text passage as in the Text property with highlighted phrases most relevant to the query.\"\r\n        }\r\n      },\r\n      \"additionalProperties\": true,\r\n      \"description\": \"Captions are the most representative passages from the document relatively to the search query. They are often used as document summary. Captions are only returned for queries of type `semantic`.\"\r\n    },\r\n    \"SemanticPartialResponseReason\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"maxWaitExceeded\",\r\n        \"capacityOverloaded\",\r\n        \"transient\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"SemanticErrorReason\",\r\n        \"modelAsString\": true,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"maxWaitExceeded\",\r\n            \"name\": \"MaxWaitExceeded\",\r\n            \"description\": \"If `semanticMaxWaitInMilliseconds` was set and the semantic processing duration exceeded that value. Only the base results were returned.\"\r\n          },\r\n          {\r\n            \"value\": \"capacityOverloaded\",\r\n            \"name\": \"CapacityOverloaded\",\r\n            \"description\": \"The request was throttled. Only the base results were returned.\"\r\n          },\r\n          {\r\n            \"value\": \"transient\",\r\n            \"name\": \"Transient\",\r\n            \"description\": \"At least one step of the semantic process failed.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"Reason that a partial response was returned for a semantic ranking request.\"\r\n    },\r\n    \"SemanticPartialResponseType\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"baseResults\",\r\n        \"rerankedResults\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"SemanticSearchResultsType\",\r\n        \"modelAsString\": true,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"baseResults\",\r\n            \"name\": \"BaseResults\",\r\n            \"description\": \"Results without any semantic enrichment or reranking.\"\r\n          },\r\n          {\r\n            \"value\": \"rerankedResults\",\r\n            \"name\": \"RerankedResults\",\r\n            \"description\": \"Results have been reranked with the reranker model and will include semantic captions. They will not include any answers, answers highlights or caption highlights.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"Type of partial response that was returned for a semantic ranking request.\"\r\n    },\r\n    \"SemanticErrorHandling\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"partial\",\r\n        \"fail\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"SemanticErrorMode\",\r\n        \"modelAsString\": true,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"partial\",\r\n            \"name\": \"Partial\",\r\n            \"description\": \"If the semantic processing fails, partial results still return. The definition of partial results depends on what semantic step failed and what was the reason for failure.\"\r\n          },\r\n          {\r\n            \"value\": \"fail\",\r\n            \"name\": \"Fail\",\r\n            \"description\": \"If there is an exception during the semantic processing step, the query will fail and return the appropriate HTTP code depending on the error.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"Allows the user to choose whether a semantic call should fail completely, or to return partial results.\"\r\n    },\r\n    \"Answers\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"none\",\r\n        \"extractive\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"QueryAnswerType\",\r\n        \"modelAsString\": true,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"none\",\r\n            \"name\": \"None\",\r\n            \"description\": \"Do not return answers for the query.\"\r\n          },\r\n          {\r\n            \"value\": \"extractive\",\r\n            \"name\": \"Extractive\",\r\n            \"description\": \"Extracts answer candidates from the contents of the documents returned in response to a query expressed as a question in natural language.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"This parameter is only valid if the query type is `semantic`. If set, the query returns answers extracted from key passages in the highest ranked documents. The number of answers returned can be configured by appending the pipe character `|` followed by the `count-<number of answers>` option after the answers parameter value, such as `extractive|count-3`. Default count is 1. The confidence threshold can be configured by appending the pipe character `|` followed by the `threshold-<confidence threshold>` option after the answers parameter value, such as `extractive|threshold-0.9`. Default threshold is 0.7.\"\r\n    },\r\n    \"Captions\": {\r\n      \"type\": \"string\",\r\n      \"enum\": [\r\n        \"none\",\r\n        \"extractive\"\r\n      ],\r\n      \"x-ms-enum\": {\r\n        \"name\": \"QueryCaptionType\",\r\n        \"modelAsString\": true,\r\n        \"values\": [\r\n          {\r\n            \"value\": \"none\",\r\n            \"name\": \"None\",\r\n            \"description\": \"Do not return captions for the query.\"\r\n          },\r\n          {\r\n            \"value\": \"extractive\",\r\n            \"name\": \"Extractive\",\r\n            \"description\": \"Extracts captions from the matching documents that contain passages relevant to the search query.\"\r\n          }\r\n        ]\r\n      },\r\n      \"description\": \"This parameter is only valid if the query type is `semantic`. If set, the query returns captions extracted from key passages in the highest ranked documents. When Captions is set to `extractive`, highlighting is enabled by default, and can be configured by appending the pipe character `|` followed by the `highlight-<true/false>` option, such as `extractive|highlight-true`. Defaults to `None`.\"\r\n    }\r\n  },\r\n  \"parameters\": {\r\n    \"ApiVersionParameter\": {\r\n      \"name\": \"api-version\",\r\n      \"in\": \"query\",\r\n      \"required\": true,\r\n      \"type\": \"string\",\r\n      \"description\": \"Client Api Version.\"\r\n    },\r\n    \"ClientRequestIdParameter\": {\r\n      \"name\": \"x-ms-client-request-id\",\r\n      \"in\": \"header\",\r\n      \"required\": false,\r\n      \"type\": \"string\",\r\n      \"format\": \"uuid\",\r\n      \"description\": \"The tracking ID sent with the request to help with debugging.\",\r\n      \"x-ms-client-request-id\": true,\r\n      \"x-ms-parameter-grouping\": {\r\n        \"name\": \"request-options\"\r\n      },\r\n      \"x-ms-parameter-location\": \"method\"\r\n    },\r\n    \"EndpointParameter\": {\r\n      \"name\": \"endpoint\",\r\n      \"in\": \"path\",\r\n      \"required\": true,\r\n      \"type\": \"string\",\r\n      \"x-ms-skip-url-encoding\": true,\r\n      \"description\": \"The endpoint URL of the search service.\",\r\n      \"x-ms-parameter-location\": \"client\"\r\n    },\r\n    \"IndexNameParameter\": {\r\n      \"name\": \"indexName\",\r\n      \"in\": \"path\",\r\n      \"required\": true,\r\n      \"type\": \"string\",\r\n      \"x-ms-skip-url-encoding\": false,\r\n      \"description\": \"The name of the index.\",\r\n      \"x-ms-parameter-location\": \"client\"\r\n    }\r\n  }\r\n}",
            "$fxv#20": "<fragment>\r\n    <!-- Log OpenAI usage to EventHub -->\r\n    <choose>\r\n        <when condition=\"@(context.Response.StatusCode == 200)\">\r\n            <log-to-eventhub logger-id=\"usage-eventhub-logger\">@{\r\n            return new JObject(\r\n                new JProperty(\"id\", (string)context.Variables.GetValueOrDefault<string>(\"idPrefix\", \"ai\") + \"-\" + Guid.NewGuid().ToString()),\r\n                new JProperty(\"timestamp\", DateTime.UtcNow.ToString()),\r\n                new JProperty(\"appId\", (string)context.Variables.GetValueOrDefault<string>(\"appId\", \"NA\")),\r\n                new JProperty(\"subscriptionId\", context.Subscription?.Id?.ToString() ?? \"Portal-Admin\"),\r\n                new JProperty(\"productName\", context.Product?.Name?.ToString() ?? \"Portal-Admin\"),\r\n                new JProperty(\"targetService\", (string)context.Variables.GetValueOrDefault<string>(\"targetService\", \"NA\")),\r\n                new JProperty(\"model\", (string)context.Variables.GetValueOrDefault<string>(\"model\", \"NA\")),\r\n                new JProperty(\"gatewayName\", context.Deployment?.ServiceName ?? \"NA\"),\r\n                new JProperty(\"gatewayRegion\", context.Deployment?.Region ?? \"NA\"),\r\n                new JProperty(\"aiGatewayId\", context.Deployment?.Gateway?.Id ?? \"NA\"),\r\n                new JProperty(\"RequestIp\", context.Request?.IpAddress ?? \"NA\"),\r\n                new JProperty(\"operationName\", context.Operation?.Name ?? \"NA\"),\r\n                new JProperty(\"sessionId\", (string)context.Variables.GetValueOrDefault<string>(\"sessionId\", \"NA\")),\r\n                new JProperty(\"endUserId\", (string)context.Variables.GetValueOrDefault<string>(\"endUserId\", \"NA\")),\r\n                new JProperty(\"backendId\", (string)context.Variables.GetValueOrDefault<string>(\"backendId\", \"NA\")),\r\n                new JProperty(\"routeLocation\", (string)context.Variables.GetValueOrDefault<string>(\"routeLocation\", \"NA\")),\r\n                new JProperty(\"routeName\", (string)context.Variables.GetValueOrDefault<string>(\"routeName\", \"NA\")),\r\n                new JProperty(\"deploymentName\", (string)context.Variables.GetValueOrDefault<string>(\"deploymentName\", \"NA\")),\r\n                new JProperty(\"promptTokens\", (int)context.Variables.GetValueOrDefault<int>(\"promptTokens\", 1)),\r\n                new JProperty(\"responseTokens\", (int)context.Variables.GetValueOrDefault<int>(\"responseTokens\", 0)),\r\n                new JProperty(\"totalTokens\", (int)context.Variables.GetValueOrDefault<int>(\"totalTokens\", 1))\r\n        ).ToString();\r\n        }</log-to-eventhub>\r\n        </when>\r\n    </choose>\r\n</fragment>",
            "$fxv#21": "<fragment>\r\n    <choose>\r\n        <when condition=\"@(context.Response.StatusCode == 429)\">\r\n            <emit-metric name=\"AI Throttling\" value=\"1\" namespace=\"throttling-events\">\r\n                <dimension name=\"API ID\" />\r\n                <dimension name=\"Operation ID\" />\r\n                <!-- <dimension name=\"Subscription ID\" /> -->\r\n                <dimension name=\"Location\" />\r\n                <dimension name=\"Product Name\" value=\"@(context.Product?.Name?.ToString() ?? \"Portal-Admin\")\" />\r\n                <dimension name=\"Deployment Name\" value=\"@((string)context.Variables[\"target-deployment\"])\" />\r\n                <dimension name=\"Service Name\" value=\"@((string)context.Variables[\"service-name\"] ?? \"NA\")\" />\r\n            </emit-metric>\r\n        </when>\r\n    </choose>\r\n</fragment>",
            "$fxv#22": "<fragment>\r\n    <set-variable name=\"routes\" value=\"@{\r\n                JArray routes = (JArray)context.Variables[\"routes\"];\r\n                JArray outputRoutes = new JArray();\r\n                string activeBackendId = (string)context.Variables[\"backendId\"];\r\n                string targetDeployment = (string)context.Variables[\"deployment-id\"];\r\n                for (int i = 0; i < routes.Count; i++)\r\n                {\r\n                    JObject route = (JObject)routes[i];\r\n                    int targetTPMLimit = route.Value<int?>(\"targetTPMLimit\") ?? -1;\r\n                    int consumedTPM = route.Value<int?>(\"consumedTPM\") ?? 0;\r\n\r\n                    if (targetTPMLimit == -1)\r\n                    {\r\n                        outputRoutes.Add(route);\r\n                        continue;\r\n                    }\r\n\r\n                    string consumedTokensKey = route.Value<string>(\"backend-id\") + \"-\" + targetDeployment + \"-ConsumedTokens\";\r\n                    string remainingTokensKey = route.Value<string>(\"backend-id\") + \"-\" + targetDeployment + \"-RemainingTokens\";\r\n                    \r\n                    if (context.Variables.ContainsKey(consumedTokensKey) && route[\"backend-id\"].ToString() == activeBackendId)\r\n                    {\r\n                        int requestConsumedTokens = (int)context.Variables[consumedTokensKey];\r\n                        int remainingTokens = (int)context.Variables[remainingTokensKey];\r\n                        \r\n                        // Calcualting the total consumed tokens so far\r\n                        int consumedTokens = 1000000 - remainingTokens - requestConsumedTokens;\r\n\r\n                        double consumedPercentage = (double)consumedTokens / (double)targetTPMLimit;\r\n                        \r\n                        route[\"consumedPercentage\"] = consumedPercentage;\r\n\r\n                        if (consumedPercentage > 0.8)\r\n                        {\r\n                            if((bool)route[\"isThrottling\"] == false)\r\n                            {\r\n                                route[\"isThrottling\"] = true;\r\n                                route[\"retryAfter\"] = DateTime.Now.AddSeconds(30);\r\n                            }\r\n                        }\r\n                        else\r\n                        {\r\n                            route[\"isThrottling\"] = false;\r\n                            route[\"retryAfter\"] = DateTime.MinValue;\r\n                        }\r\n                    }\r\n                    \r\n                    outputRoutes.Add(route);\r\n                }\r\n\r\n                return outputRoutes; \r\n            }\" />\r\n    <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"routesCacheKey\", \"ALL-ROUTES\"))\" value=\"@((JArray)context.Variables[\"routes\"])\" duration=\"86400\" />\r\n</fragment>",
            "$fxv#23": "<fragment>\r\n    <choose>\r\n        <when condition=\"@(context.Variables.GetValueOrDefault<string>(\"piiAnonymizationEnabled\") == \"true\")\">\r\n            <!-- Get configuration values -->\r\n            <set-variable name=\"piiConfidenceThreshold\" value=\"@(double.Parse(context.Variables.GetValueOrDefault<string>(\"piiConfidenceThreshold\", \"0.8\")))\" />\r\n            <set-variable name=\"piiEntityCategoryExclusions\" value=\"@(context.Variables.GetValueOrDefault<string>(\"piiEntityCategoryExclusions\", \"\"))\" />\r\n            <set-variable name=\"piiDetectionLanguage\" value=\"@(context.Variables.GetValueOrDefault<string>(\"piiDetectionLanguage\", \"en\"))\" />\r\n            <authentication-managed-identity resource=\"{{cognitiveServicesAudience}}\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\r\n            \r\n            <!-- Process regex patterns if provided -->\r\n            <set-variable name=\"piiRegexMappings\" value=\"@{\r\n                var content = context.Variables.GetValueOrDefault<string>(\"piiInputContent\");\r\n                var regexPatterns = context.Variables.GetValueOrDefault<string>(\"piiRegexPatterns\");\r\n                var mappings = new JArray();\r\n                \r\n                if (!string.IsNullOrEmpty(regexPatterns))\r\n                {\r\n                    var patterns = JArray.Parse(regexPatterns);\r\n                    var categoryCounts = new Dictionary<string, int>();\r\n                    var processedTexts = new HashSet<string>(); // Track already processed texts\r\n                    \r\n                    foreach (var pattern in patterns)\r\n                    {\r\n                        var regex = new Regex(pattern[\"pattern\"].ToString());\r\n                        var category = pattern[\"category\"].ToString();\r\n                        \r\n                        if (!categoryCounts.ContainsKey(category))\r\n                        {\r\n                            categoryCounts[category] = 0;\r\n                        }\r\n                        \r\n                        var matches = regex.Matches(content);\r\n                        foreach (Match match in matches)\r\n                        {\r\n                            if (!string.IsNullOrEmpty(match.Value))\r\n                            {\r\n                                // Skip if we already have a mapping for this text\r\n                                if (processedTexts.Contains(match.Value))\r\n                                {\r\n                                    continue;\r\n                                }\r\n                                \r\n                                var placeholder = $\"<{category}_{categoryCounts[category]}>\";\r\n                                mappings.Add(new JObject {\r\n                                    [\"original\"] = match.Value,\r\n                                    [\"placeholder\"] = placeholder,\r\n                                    [\"source\"] = \"regex\"\r\n                                });\r\n                                categoryCounts[category]++;\r\n                                processedTexts.Add(match.Value); // Mark this text as processed\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                return mappings.ToString();\r\n            }\" />\r\n\r\n            <!-- Apply regex-based masking -->\r\n            <set-variable name=\"piiRegexProcessedContent\" value=\"@{\r\n                var content = context.Variables.GetValueOrDefault<string>(\"piiInputContent\");\r\n                var mappings = JArray.Parse(\r\n                    context.Variables.GetValueOrDefault<string>(\"piiRegexMappings\"));\r\n                \r\n                foreach (var mapping in mappings)\r\n                {\r\n                    content = content.Replace(\r\n                        mapping[\"original\"].ToString(),\r\n                        mapping[\"placeholder\"].ToString()\r\n                    );\r\n                }\r\n                return content;\r\n            }\" />\r\n\r\n            <!-- Update input content for API processing -->\r\n            <set-variable name=\"piiInputContent\" value=\"@(context.Variables.GetValueOrDefault<string>(\"piiRegexProcessedContent\"))\" />\r\n            \r\n            <!-- Call PII Anonymization API -->\r\n            <send-request mode=\"new\" response-variable-name=\"piiAnalysisResponse\" timeout=\"20\" ignore-error=\"true\">\r\n                <set-url>{{piiServiceUrl}}/language/:analyze-text?api-version=2022-05-01</set-url>\r\n                <set-method>POST</set-method>\r\n                <set-header name=\"Content-Type\" exists-action=\"override\">\r\n                    <value>application/json</value>\r\n                </set-header>\r\n                <set-header name=\"Authorization\" exists-action=\"override\">\r\n                    <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\r\n                </set-header>\r\n                <!-- <set-header name=\"Ocp-Apim-Subscription-Key\" exists-action=\"override\">\r\n                    <value>{{piiServiceKey}}</value>\r\n                </set-header> -->\r\n\r\n                <set-body>@{\r\n                    var request = new JObject();\r\n                    request[\"kind\"] = \"PiiEntityRecognition\";\r\n                    request[\"parameters\"] = new JObject{\r\n                        {\"modelVersion\", \"latest\"},\r\n                        {\"redactionPolicy\", new JObject{\r\n                            {\"policyKind\", \"CharacterMask\"},\r\n                            {\"redactionCharacter\", \"#\"}\r\n                        }}\r\n                    };\r\n                    request[\"analysisInput\"] = new JObject{\r\n                        {\"documents\", new JArray{\r\n                            new JObject{\r\n                                {\"text\", context.Variables.GetValueOrDefault<string>(\"piiInputContent\")},\r\n                                {\"id\", \"1\"},\r\n                                {\"language\", context.Variables.GetValueOrDefault<string>(\"piiDetectionLanguage\")}\r\n                            }\r\n                        }}\r\n                    };\r\n                    return request.ToString();\r\n                }</set-body>\r\n            </send-request>\r\n            <!-- Process PII Analysis Response and store mappings -->\r\n            <set-variable name=\"piiMappings\" value=\"@{\r\n                var response = context.Variables.GetValueOrDefault<IResponse>(\"piiAnalysisResponse\");\r\n                var confidenceThreshold = context.Variables.GetValueOrDefault<double>(\"piiConfidenceThreshold\");\r\n                var exclusions = context.Variables.GetValueOrDefault<string>(\"piiEntityCategoryExclusions\")\r\n                    .Split(new[] { ',' }, StringSplitOptions.RemoveEmptyEntries)\r\n                    .Select(c => c.Trim())\r\n                    .ToList();\r\n                \r\n                var entities = JObject.Parse(response.Body.As<string>())\r\n                    .SelectToken(\"$.results.documents[0].entities\")\r\n                    .ToObject<JArray>()\r\n                    .Where(e => e[\"confidenceScore\"].Value<double>() >= confidenceThreshold)\r\n                    .Where(e => !exclusions.Contains(e[\"category\"].ToString()))\r\n                    .OrderByDescending(e => e[\"text\"].ToString().Length);\r\n                \r\n                var mappings = new JArray();\r\n                var categoryCounts = new Dictionary<string, int>();\r\n                var processedTexts = new HashSet<string>(); // Track already processed texts\r\n                \r\n                foreach (var entity in entities) {\r\n                    var text = entity[\"text\"].ToString().TrimEnd('.', ',', ' ');\r\n                    \r\n                    // Skip if this text has already been processed\r\n                    if (processedTexts.Contains(text)) {\r\n                        continue;\r\n                    }\r\n                    \r\n                    var category = entity[\"category\"].ToString();\r\n                    \r\n                    if (!categoryCounts.ContainsKey(category)) {\r\n                        categoryCounts[category] = 0;\r\n                    }\r\n                    \r\n                    var placeholder = $\"<{category}_{categoryCounts[category]}>\";\r\n                    mappings.Add(new JObject {\r\n                        [\"original\"] = text,\r\n                        [\"placeholder\"] = placeholder\r\n                    });\r\n                    \r\n                    categoryCounts[category]++;\r\n                    processedTexts.Add(text); // Mark this text as processed\r\n                }\r\n                \r\n                return mappings.ToString();\r\n            }\" />\r\n\r\n            <!-- Merge API and regex mappings -->\r\n            <set-variable name=\"piiMappings\" value=\"@{\r\n                var apiMappings = JArray.Parse(context.Variables.GetValueOrDefault<string>(\"piiMappings\") ?? \"[]\");\r\n                var regexMappings = JArray.Parse(context.Variables.GetValueOrDefault<string>(\"piiRegexMappings\") ?? \"[]\");\r\n                \r\n                foreach (var mapping in regexMappings)\r\n                {\r\n                    apiMappings.Add(mapping);\r\n                }\r\n                \r\n                return apiMappings.ToString();\r\n            }\" />\r\n\r\n            <!-- Replace PII with placeholders and set output variable -->\r\n            <set-variable name=\"piiAnonymizedContent\" value=\"@{\r\n                var content = context.Variables.GetValueOrDefault<string>(\"piiInputContent\");\r\n                var mappings = JArray.Parse(\r\n                    context.Variables.GetValueOrDefault<string>(\"piiMappings\"));\r\n                    \r\n                foreach (var mapping in mappings) {\r\n                    var original = mapping[\"original\"].ToString();\r\n                    var placeholder = mapping[\"placeholder\"].ToString();\r\n                    content = content.Replace(original, placeholder);\r\n                }\r\n                \r\n                return content;\r\n            }\" />\r\n        </when>\r\n        <otherwise>\r\n            <!-- When PII anonymization is disabled, just pass through the original content -->\r\n            <set-variable name=\"piiAnonymizedContent\" value=\"@(context.Variables.GetValueOrDefault<string>(\"piiInputContent\"))\" />\r\n        </otherwise>\r\n    </choose>\r\n</fragment>",
            "$fxv#24": "<fragment>\r\n    <!-- Replace placeholders with original PII -->\r\n    <set-variable name=\"piiDeanonymizedContentOutput\" value=\"@{\r\n        var content = context.Variables.GetValueOrDefault<string>(\"piiDeanonymizeContentInput\");\r\n        \r\n        // Pre-process content to replace common encoded symbols\r\n        content = System.Text.RegularExpressions.Regex.Replace(content, @\"\\\\u003c\", \"<\");\r\n        content = System.Text.RegularExpressions.Regex.Replace(content, @\"\\\\u003e\", \">\");\r\n        \r\n        var mappings = JArray.Parse(\r\n            context.Variables.GetValueOrDefault<string>(\"piiMappings\"));\r\n        \r\n        foreach (var mapping in mappings) {\r\n            var original = mapping[\"original\"].ToString();\r\n            var placeholder = mapping[\"placeholder\"].ToString();\r\n            content = content.Replace(placeholder, original);\r\n        }\r\n        return content;\r\n    }\" />\r\n</fragment>",
            "$fxv#25": "<fragment>\r\n    <!-- Save PII anonymization/deanonymization state to Event Hub using native log-to-eventhub policy -->\r\n    <choose>\r\n        <when condition=\"@(context.Variables.GetValueOrDefault<string>(\"piiStateSavingEnabled\") == \"true\")\">\r\n            <!-- Capture context information -->\r\n            <set-variable name=\"piiOperationId\" value=\"@(Guid.NewGuid().ToString())\" />\r\n            <set-variable name=\"piiOperationTimestamp\" value=\"@(DateTime.UtcNow.ToString(\"o\"))\" />\r\n            <set-variable name=\"piiApiName\" value=\"@(context.Api.Name ?? \"unknown\")\" />\r\n            <set-variable name=\"piiApiId\" value=\"@(context.Api.Id ?? \"unknown\")\" />\r\n            <set-variable name=\"piiProductName\" value=\"@(context.Product?.Name ?? \"unknown\")\" />\r\n            <set-variable name=\"piiProductId\" value=\"@(context.Product?.Id ?? \"unknown\")\" />\r\n            <set-variable name=\"piiSubscriptionName\" value=\"@(context.Subscription?.Name ?? \"unknown\")\" />\r\n            <set-variable name=\"piiSubscriptionId\" value=\"@(context.Subscription?.Id ?? \"unknown\")\" />\r\n            <set-variable name=\"piiOperationName\" value=\"@(context.Operation.Name ?? \"unknown\")\" />\r\n            <set-variable name=\"targetDeployment\" value=\"@(context.Variables.GetValueOrDefault<string>(\"targetDeployment\") ?? \"unknown\")\" />\r\n            \r\n            <!-- Log to Event Hub using native policy -->\r\n            <log-to-eventhub logger-id=\"pii-usage-eventhub-logger\">@{\r\n                var eventData = new JObject();\r\n                \r\n                // Operation metadata\r\n                eventData[\"id\"] = context.Variables.GetValueOrDefault<string>(\"piiOperationId\");\r\n                eventData[\"timestamp\"] = context.Variables.GetValueOrDefault<string>(\"piiOperationTimestamp\");\r\n                eventData[\"type\"] = \"PII_Processing\";\r\n                eventData[\"targetDeployment\"] = context.Variables.GetValueOrDefault<string>(\"targetDeployment\");\r\n                // Enhanced API and subscription context with content\r\n                eventData[\"context\"] = new JObject {\r\n                    [\"api\"] = new JObject {\r\n                        [\"id\"] = context.Variables.GetValueOrDefault<string>(\"piiApiId\"),\r\n                        [\"name\"] = context.Variables.GetValueOrDefault<string>(\"piiApiName\"),\r\n                        [\"operation\"] = new JObject {\r\n                            [\"id\"] = context.Operation.Id ?? \"unknown\",\r\n                            [\"name\"] = context.Variables.GetValueOrDefault<string>(\"piiOperationName\"),\r\n                            [\"method\"] = context.Operation.Method ?? \"unknown\",\r\n                            [\"urlTemplate\"] = context.Operation.UrlTemplate ?? \"unknown\"\r\n                        },\r\n                        [\"content\"] = new JObject {\r\n                            [\"originalRequest\"] = context.Variables.GetValueOrDefault<string>(\"piiInputContent\"),\r\n                            [\"anonymizedRequest\"] = context.Variables.GetValueOrDefault<string>(\"piiAnonymizedContent\"),\r\n                            [\"originalResponse\"] = context.Variables.GetValueOrDefault<string>(\"originalResponse\"),\r\n                            [\"deanonymizedResponse\"] = context.Variables.GetValueOrDefault<string>(\"piiDeanonymizedContentOutput\")\r\n                        }\r\n                    },\r\n                    [\"product\"] = new JObject {\r\n                        [\"id\"] = context.Variables.GetValueOrDefault<string>(\"piiProductId\"),\r\n                        [\"name\"] = context.Variables.GetValueOrDefault<string>(\"piiProductName\")\r\n                    },\r\n                    [\"subscription\"] = new JObject {\r\n                        [\"id\"] = context.Variables.GetValueOrDefault<string>(\"piiSubscriptionId\"),\r\n                        [\"name\"] = context.Variables.GetValueOrDefault<string>(\"piiSubscriptionName\")\r\n                    }\r\n                };\r\n                \r\n                // Process information\r\n                eventData[\"process\"] = new JObject {\r\n                    [\"anonymizationEnabled\"] = context.Variables.GetValueOrDefault<string>(\"piiAnonymizationEnabled\") == \"true\",\r\n                    [\"confidenceThreshold\"] = context.Variables.GetValueOrDefault<double>(\"piiConfidenceThreshold\", 0.8),\r\n                    [\"entityCategoryExclusions\"] = context.Variables.GetValueOrDefault<string>(\"piiEntityCategoryExclusions\", \"\"),\r\n                    [\"deanonymizationPerformed\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\")\r\n                };\r\n                \r\n                // Results summary\r\n                var mappings = new JArray();\r\n                if (context.Variables.ContainsKey(\"piiMappings\")) {\r\n                    try {\r\n                        mappings = JArray.Parse(context.Variables.GetValueOrDefault<string>(\"piiMappings\"));\r\n                        eventData[\"entityCount\"] = mappings.Count;\r\n                        \r\n                        // Group entities by category for reporting\r\n                        var categories = new Dictionary<string, int>();\r\n                        foreach (var mapping in mappings) {\r\n                            var placeholder = mapping[\"placeholder\"].ToString();\r\n                            var category = placeholder.TrimStart('<').Split('_')[0];\r\n                            \r\n                            if (!categories.ContainsKey(category)) {\r\n                                categories[category] = 0;\r\n                            }\r\n                            categories[category]++;\r\n                        }\r\n                        \r\n                        var categoryDetails = new JObject();\r\n                        foreach (var category in categories) {\r\n                            categoryDetails[category.Key] = category.Value;\r\n                        }\r\n                        eventData[\"entityCategories\"] = categoryDetails;\r\n                        \r\n                        // Include mappings for detailed audit (can be removed if too verbose)\r\n                        eventData[\"mappings\"] = mappings;\r\n                    }\r\n                    catch (Exception ex) {\r\n                        eventData[\"error\"] = \"Failed to process mappings: \" + ex.Message;\r\n                    }\r\n                }\r\n                \r\n                // Content length metrics (not the actual content)\r\n                if (context.Variables.ContainsKey(\"piiInputContent\")) {\r\n                    eventData[\"metrics\"] = new JObject {\r\n                        [\"inputContentLength\"] = context.Variables.GetValueOrDefault<string>(\"piiInputContent\", \"\").Length\r\n                    };\r\n                    \r\n                    if (context.Variables.ContainsKey(\"piiAnonymizedContent\")) {\r\n                        eventData[\"metrics\"][\"anonymizedContentLength\"] = \r\n                            context.Variables.GetValueOrDefault<string>(\"piiAnonymizedContent\", \"\").Length;\r\n                    }\r\n                    \r\n                    // Add deanonymization metrics\r\n                    if (context.Variables.ContainsKey(\"piiDeanonymizeContentInput\")) {\r\n                        eventData[\"metrics\"][\"deanonymizeInputLength\"] = \r\n                            context.Variables.GetValueOrDefault<string>(\"piiDeanonymizeContentInput\", \"\").Length;\r\n                    }\r\n                    \r\n                    if (context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\")) {\r\n                        eventData[\"metrics\"][\"deanonymizedOutputLength\"] = \r\n                            context.Variables.GetValueOrDefault<string>(\"piiDeanonymizedContentOutput\", \"\").Length;\r\n                    }\r\n                }\r\n                \r\n                // Add deanonymization flow details\r\n                eventData[\"deanonymization\"] = new JObject {\r\n                    [\"performed\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\"),\r\n                    [\"inputSource\"] = context.Variables.ContainsKey(\"piiDeanonymizeContentInput\") ? \"present\" : \"missing\",\r\n                    [\"status\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\") ? \"completed\" : \"not_performed\",\r\n                    [\"timestamp\"] = DateTime.UtcNow.ToString(\"o\")\r\n                };\r\n                \r\n                // Track end-to-end flow\r\n                eventData[\"processingFlow\"] = new JObject {\r\n                    [\"anonymization\"] = new JObject {\r\n                        [\"performed\"] = context.Variables.ContainsKey(\"piiAnonymizedContent\"),\r\n                        [\"entityCount\"] = context.Variables.ContainsKey(\"piiMappings\") ? \r\n                            JArray.Parse(context.Variables.GetValueOrDefault<string>(\"piiMappings\")).Count : 0\r\n                    },\r\n                    [\"deanonymization\"] = new JObject {\r\n                        [\"performed\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\"),\r\n                        [\"success\"] = context.Variables.ContainsKey(\"piiDeanonymizedContentOutput\")\r\n                    }\r\n                };\r\n                \r\n                return eventData.ToString();\r\n            }</log-to-eventhub>\r\n        </when>\r\n    </choose>\r\n</fragment>\r\n",
            "$fxv#3": "<policies>\r\n    <inbound>\r\n        <base />\r\n        <!-- AAD Authorization -->\r\n        <!-- Enabled if entra-validate named value is set to true -->\r\n        <include-fragment fragment-id=\"aad-auth\" />\r\n        <set-header name=\"api-key\" exists-action=\"delete\" />\r\n        <!-- Setting cache keys -->\r\n        <set-variable name=\"deployment-id\" value=\"@((string)context.Request.MatchedParameters[\"index-name\"])\" />\r\n        <set-variable name=\"routesCacheKey\" value=\"@((string)context.Variables[\"deployment-id\"] + \"Routes\" + context.Deployment.Region + context.Api.Revision)\" />\r\n        <set-variable name=\"oaClustersCacheKey\" value=\"@(\"aiSearchInstance\" + context.Deployment.Region + context.Api.Revision)\" />\r\n        <cache-lookup-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-SEARCH\"))\" variable-name=\"oaClusters\" />\r\n        <!-- If we can't find the configuration cached, it will be loaded -->\r\n        <choose>\r\n            <when condition=\"@(context.Variables.ContainsKey(\"oaClusters\") == false)\">\r\n                <set-variable name=\"oaClusters\" value=\"@{\r\n                        // route is an Azure AI Search endpoint\r\n                        JArray routes = new JArray();\r\n                        // cluster is a group of routes that are capable of serving a specific index name\r\n                        JArray clusters = new JArray();\r\n                        // Update the below if condition when using multiple APIM gateway regions/SHGW to get different configurations for each region\r\n                        if(context.Deployment.Region == \"West Europe\" || true)\r\n                        {\r\n                            // Adding all Azure AI Search endpoints routes (which are set as APIM Backend)\r\n                            routes.Add(new JObject()\r\n                            {\r\n                                { \"name\", \"Contoso Insurance KB\" },\r\n                                { \"location\", \"Switzerland North\" },\r\n                                { \"backend-id\", \"ai-search-swn\" },\r\n                                { \"priority\", 1},\r\n                                { \"isThrottling\", false }, \r\n                                { \"retryAfter\", DateTime.MinValue } \r\n                            });\r\n\r\n                            routes.Add(new JObject()\r\n                            {\r\n                                { \"name\", \"Northwind Outdoor KB\" },\r\n                                { \"location\", \"Sweden Central\" },\r\n                                { \"backend-id\", \"ai-search-sec\" },\r\n                                { \"priority\", 1},\r\n                                { \"isThrottling\", false }, \r\n                                { \"retryAfter\", DateTime.MinValue } \r\n                            });\r\n\r\n                            // For each index, create a cluster with the routes that can serve it\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"gptkbindex\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"product-info\" },\r\n                                { \"routes\", new JArray(routes[1]) }\r\n                            });\r\n                        }\r\n                        else\r\n                        {\r\n                            //No clusters found for selected region, either return error (default behavior) or set default cluster in the else section\r\n                        }\r\n                        \r\n                        return clusters;   \r\n                    }\" />\r\n                <!-- Add cluster configurations to cache -->\r\n                <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-SEARCH\"))\" value=\"@((JArray)context.Variables[\"oaClusters\"])\" duration=\"86400\" />\r\n            </when>\r\n        </choose>\r\n        <include-fragment fragment-id=\"validate-routes\" />\r\n        <authentication-managed-identity resource=\"{{searchServiceAudience}}\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\r\n        <set-header name=\"Authorization\" exists-action=\"override\">\r\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\r\n        </set-header>\r\n    </inbound>\r\n    <backend>\r\n        <include-fragment fragment-id=\"backend-routing\" />\r\n    </backend>\r\n    <outbound>\r\n        <base />\r\n        <set-variable name=\"idPrefix\" value=\"search\" />\r\n        <set-variable name=\"targetService\" value=\"AI-Search\" />\r\n        <set-variable name=\"model\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-SEARCH-INDEX\"))\" />\r\n        <set-variable name=\"deploymentName\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-SEARCH-SERVICE\"))\" />\r\n        <include-fragment fragment-id=\"ai-usage\" />\r\n    </outbound>\r\n    <on-error>\r\n        <base />\r\n        <set-variable name=\"service-name\" value=\"Azure AI Search\" />\r\n        <set-variable name=\"target-deployment\" value=\"@((string)context.Request.MatchedParameters[\"index-name\"])\" />\r\n        <include-fragment fragment-id=\"throttling-events\" />\r\n    </on-error>\r\n</policies>",
            "$fxv#4": "openapi: 3.0.1\r\ninfo:\r\n  title: AI Model Inference API\r\n  description: Reference for Azure AI Model Inference API\r\n  license:\r\n    name: MIT\r\n    url: https://opensource.org/licenses/MIT\r\n  version: '1.0'\r\nservers:\r\n  - url: https://REPLACE.services.ai.azure.com/models\r\npaths:\r\n  /info:\r\n    get:\r\n      summary: Get model information\r\n      description: Returns the information about the model deployed under the endpoint.\r\n      operationId: get-info-api-version-api-version\r\n      parameters:\r\n        - name: api-version\r\n          in: query\r\n          description: The version of the API in the format \"YYYY-MM-DD\" or \"YYYY-MM-DD-preview\".\r\n          required: true\r\n          schema:\r\n            enum:\r\n              - 2024-05-01-preview\r\n            type: string\r\n            default: 2024-05-01-preview\r\n        - name: Authorization\r\n          in: header\r\n          schema:\r\n            enum:\r\n              - ''\r\n            type: ''\r\n        - name: azureml-model-deployment\r\n          in: header\r\n          schema:\r\n            enum:\r\n              - ''\r\n            type: ''\r\n            default: ''\r\n      responses:\r\n        '200':\r\n          description: OK\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/ModelInfo'\r\n              example:\r\n                model_name: string\r\n                model_provider_name: string\r\n                model_type: audio-generation\r\n  /chat/completions:\r\n    post:\r\n      summary: Create chat completion\r\n      description: Creates a model response for the given chat conversation.\r\n      operationId: post-chat-completions-api-version-api-version\r\n      parameters:\r\n        - name: api-version\r\n          in: query\r\n          description: The version of the API in the format \"YYYY-MM-DD\" or \"YYYY-MM-DD-preview\".\r\n          required: true\r\n          schema:\r\n            enum:\r\n              - 2024-05-01-preview\r\n            type: string\r\n            default: 2024-05-01-preview\r\n        - name: x-ms-model-mesh-model-name\r\n          in: header\r\n          description: Name of the target deployment model name (like phi-4)\r\n          required: true\r\n          schema:\r\n            enum:\r\n              - ''\r\n            type: ''\r\n            default: ''\r\n      requestBody:\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/CreateChatCompletionRequest'\r\n            example:\r\n              messages:\r\n                - role: system\r\n                  content: You are a helpful assistant\r\n                - role: user\r\n                  content: Explain how distance between earth and the moon is calculated.\r\n              frequency_penalty: 0\r\n              presence_penalty: 0\r\n              max_tokens: 256\r\n              seed: 42\r\n              stop: <|endoftext|>\r\n              stream: false\r\n              temperature: 0\r\n              top_p: 1\r\n              response_format:\r\n                type: text\r\n      responses:\r\n        '200':\r\n          description: OK\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/CreateChatCompletionResponse'\r\n              example:\r\n                choices:\r\n                  - finish_reason: stop\r\n                    index: 0\r\n                    message:\r\n                      content: string\r\n                      role: assistant\r\n                      tool_calls:\r\n                        - function:\r\n                            arguments: string\r\n                            name: string\r\n                          id: string\r\n                          type: function\r\n                created: 0\r\n                id: string\r\n                model: string\r\n                object: chat.completion\r\n                system_fingerprint: string\r\n                usage:\r\n                  completion_tokens: 0\r\n                  prompt_tokens: 0\r\n                  total_tokens: 0\r\n        '401':\r\n          description: Unauthorized\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/UnauthorizedError'\r\n              example:\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '404':\r\n          description: Not Found\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/NotFoundError'\r\n              example:\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '422':\r\n          description: Unprocessable Entity\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/UnprocessableContentError'\r\n              example:\r\n                code: string\r\n                detail:\r\n                  loc:\r\n                    - string\r\n                  value: string\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '429':\r\n          description: Too Many Requests\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/TooManyRequestsError'\r\n              example:\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '500':\r\n          description: Content Filter Error\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/ContentFilterError'\r\n              example:\r\n                code: string\r\n                error: string\r\n                message: string\r\n                param: string\r\n                status: 0\r\n  /embeddings:\r\n    post:\r\n      summary: Create text embeddings\r\n      description: Creates an embedding vector representing the input text.\r\n      operationId: post-embeddings-api-version-api-version\r\n      parameters:\r\n        - name: api-version\r\n          in: query\r\n          description: The version of the API in the format \"YYYY-MM-DD\" or \"YYYY-MM-DD-preview\".\r\n          required: true\r\n          schema:\r\n            enum:\r\n              - 2024-05-01-preview\r\n            type: string\r\n            default: 2024-05-01-preview\r\n        - name: x-ms-model-mesh-model-name\r\n          in: header\r\n          description: Name of the target AI deployment name\r\n          required: true\r\n          schema:\r\n            enum:\r\n              - ''\r\n            type: ''\r\n            default: ''\r\n      requestBody:\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/CreateEmbeddingRequest'\r\n            example:\r\n              input:\r\n                - This is a very good text\r\n              input_type: text\r\n              encoding_format: float\r\n              dimensions: 1024\r\n      responses:\r\n        '200':\r\n          description: OK\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/CreateEmbeddingResponse'\r\n              example:\r\n                data:\r\n                  - embedding:\r\n                      - 0\r\n                    index: 0\r\n                    object: embedding\r\n                model: string\r\n                object: list\r\n                usage:\r\n                  prompt_patches: 0\r\n                  prompt_tokens: 0\r\n                  total_patches: 0\r\n                  total_tokens: 0\r\n        '401':\r\n          description: Unauthorized\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/UnauthorizedError'\r\n              example:\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '404':\r\n          description: Not Found\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/NotFoundError'\r\n              example:\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '422':\r\n          description: Unprocessable Entity\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/UnprocessableContentError'\r\n              example:\r\n                code: string\r\n                detail:\r\n                  loc:\r\n                    - string\r\n                  value: string\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '429':\r\n          description: Too Many Requests\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/TooManyRequestsError'\r\n              example:\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '500':\r\n          description: Content Filter Error\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/ContentFilterError'\r\n              example:\r\n                code: string\r\n                error: string\r\n                message: string\r\n                param: string\r\n                status: 0\r\n  /images/embeddings:\r\n    post:\r\n      summary: Create image embeddings\r\n      description: Creates an embedding vector representing the input image and text pair.\r\n      operationId: post-images-embeddings-api-version-api-version\r\n      parameters:\r\n        - name: api-version\r\n          in: query\r\n          description: The version of the API in the format \"YYYY-MM-DD\" or \"YYYY-MM-DD-preview\".\r\n          required: true\r\n          schema:\r\n            enum:\r\n              - 2024-05-01-preview\r\n            type: string\r\n            default: 2024-05-01-preview\r\n        - name: x-ms-model-mesh-model-name\r\n          in: header\r\n          description: Target AI deployment name\r\n          required: true\r\n          schema:\r\n            enum:\r\n              - ''\r\n            type: ''\r\n      requestBody:\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/CreateImageEmbeddingRequest'\r\n            example:\r\n              input:\r\n                - image: string\r\n                  text: string\r\n              dimensions: 0\r\n              encoding_format: base64\r\n      responses:\r\n        '200':\r\n          description: OK\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/CreateEmbeddingResponse'\r\n              example:\r\n                data:\r\n                  - embedding:\r\n                      - 0\r\n                    index: 0\r\n                    object: embedding\r\n                model: string\r\n                object: list\r\n                usage:\r\n                  prompt_patches: 0\r\n                  prompt_tokens: 0\r\n                  total_patches: 0\r\n                  total_tokens: 0\r\n        '401':\r\n          description: Unauthorized\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/UnauthorizedError'\r\n              example:\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '404':\r\n          description: Not Found\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/NotFoundError'\r\n              example:\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '422':\r\n          description: Unprocessable Entity\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/UnprocessableContentError'\r\n              example:\r\n                code: string\r\n                detail:\r\n                  loc:\r\n                    - string\r\n                  value: string\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '429':\r\n          description: Too Many Requests\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/TooManyRequestsError'\r\n              example:\r\n                error: string\r\n                message: string\r\n                status: 0\r\n        '500':\r\n          description: Content Filter Error\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/ContentFilterError'\r\n              example:\r\n                code: string\r\n                error: string\r\n                message: string\r\n                param: string\r\n                status: 0\r\ncomponents:\r\n  schemas:\r\n    ModelInfo:\r\n      type: object\r\n      properties:\r\n        model_name:\r\n          type: string\r\n          description: The name of the model.\r\n        model_provider_name:\r\n          type: string\r\n          description: The provider of the model.\r\n        model_type:\r\n          $ref: '#/components/schemas/ModelType'\r\n    ModelType:\r\n      enum:\r\n        - audio-generation\r\n        - chat-completions\r\n        - embeddings\r\n        - image-embeddings\r\n        - image-generation\r\n        - text-generation\r\n      type: string\r\n    CreateChatCompletionRequest:\r\n      type: object\r\n      properties:\r\n        model:\r\n          type: string\r\n          description: The model name. This parameter is ignored if the endpoint serves only one model.\r\n        messages:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/ChatCompletionRequestMessage'\r\n          description: A list of messages comprising the conversation so far.\r\n        frequency_penalty:\r\n          type: number\r\n          description: Helps prevent word repetitions by reducing the chance of a word being selected if it has already been used.\r\n        max_tokens:\r\n          type: integer\r\n          description: The maximum number of tokens that can be generated in the chat completion.\r\n        presence_penalty:\r\n          type: number\r\n          description: Helps prevent the same topics from being repeated by penalizing a word if it exists in the completion already.\r\n        response_format:\r\n          $ref: '#/components/schemas/ChatCompletionResponseFormat'\r\n        seed:\r\n          type: integer\r\n          description: 'If specified, our system will make a best effort to sample deterministically.'\r\n        stop:\r\n          type: array\r\n          items:\r\n            type: string\r\n          description: Sequences where the API will stop generating further tokens.\r\n        stream:\r\n          type: boolean\r\n          description: 'If set, partial message deltas will be sent.'\r\n        temperature:\r\n          type: number\r\n          description: Non-negative number.\r\n        tool_choice:\r\n          $ref: '#/components/schemas/ChatCompletionToolChoiceOption'\r\n        tools:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/ChatCompletionTool'\r\n          description: A list of tools the model may call.\r\n        top_p:\r\n          type: number\r\n          description: 'An alternative to sampling with temperature, called nucleus sampling.'\r\n    ChatCompletionRequestMessage:\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: The contents of the message.\r\n        role:\r\n          $ref: '#/components/schemas/ChatMessageRole'\r\n        tool_calls:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/ChatCompletionMessageToolCall'\r\n    ChatMessageRole:\r\n      enum:\r\n        - assistant\r\n        - system\r\n        - tool\r\n        - user\r\n      type: string\r\n    ChatCompletionResponseFormat:\r\n      type: object\r\n      properties:\r\n        type:\r\n          $ref: '#/components/schemas/ChatCompletionResponseFormatType'\r\n    ChatCompletionResponseFormatType:\r\n      enum:\r\n        - json_object\r\n        - text\r\n      type: string\r\n    ChatCompletionToolChoiceOption:\r\n      enum:\r\n        - none\r\n        - auto\r\n        - required\r\n      type: string\r\n    ChatCompletionTool:\r\n      type: object\r\n      properties:\r\n        function:\r\n          $ref: '#/components/schemas/FunctionObject'\r\n        type:\r\n          $ref: '#/components/schemas/ToolType'\r\n    FunctionObject:\r\n      type: object\r\n      properties:\r\n        description:\r\n          type: string\r\n          description: A description of what the function does.\r\n        name:\r\n          type: string\r\n          description: The name of the function to be called.\r\n        parameters:\r\n          type: object\r\n          description: 'The parameters the functions accepts, described as a JSON Schema object.'\r\n    ToolType:\r\n      enum:\r\n        - function\r\n      type: string\r\n    CreateChatCompletionResponse:\r\n      type: object\r\n      properties:\r\n        choices:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/Choices'\r\n        created:\r\n          type: integer\r\n          description: The Unix timestamp (in seconds) of when the chat completion was created.\r\n        id:\r\n          type: string\r\n          description: A unique identifier for the chat completion.\r\n        model:\r\n          type: string\r\n          description: The model used for the chat completion.\r\n        object:\r\n          $ref: '#/components/schemas/ChatCompletionObject'\r\n        system_fingerprint:\r\n          type: string\r\n          description: This fingerprint represents the backend configuration that the model runs with.\r\n        usage:\r\n          $ref: '#/components/schemas/CompletionUsage'\r\n    Choices:\r\n      type: object\r\n      properties:\r\n        finish_reason:\r\n          $ref: '#/components/schemas/ChatCompletionFinishReason'\r\n        index:\r\n          type: integer\r\n          description: The index of the choice in the list of choices.\r\n        message:\r\n          $ref: '#/components/schemas/ChatCompletionResponseMessage'\r\n    ChatCompletionFinishReason:\r\n      enum:\r\n        - stop\r\n        - length\r\n        - content_filter\r\n        - tool_calls\r\n      type: string\r\n    ChatCompletionResponseMessage:\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: The contents of the message.\r\n        role:\r\n          $ref: '#/components/schemas/ChatMessageRole'\r\n        tool_calls:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/ChatCompletionMessageToolCall'\r\n    ChatCompletionMessageToolCall:\r\n      type: object\r\n      properties:\r\n        function:\r\n          $ref: '#/components/schemas/Function'\r\n        id:\r\n          type: string\r\n          description: The ID of the tool call.\r\n        type:\r\n          $ref: '#/components/schemas/ToolType'\r\n    Function:\r\n      type: object\r\n      properties:\r\n        arguments:\r\n          type: string\r\n          description: 'The arguments to call the function with, as generated by the model in JSON format.'\r\n        name:\r\n          type: string\r\n          description: The name of the function to call.\r\n    ChatCompletionObject:\r\n      enum:\r\n        - chat.completion\r\n      type: string\r\n    CompletionUsage:\r\n      type: object\r\n      properties:\r\n        completion_tokens:\r\n          type: integer\r\n          description: Number of tokens in the generated completion.\r\n        prompt_tokens:\r\n          type: integer\r\n          description: Number of tokens in the prompt.\r\n        total_tokens:\r\n          type: integer\r\n          description: Total number of tokens used in the request (prompt + completion).\r\n    CreateEmbeddingRequest:\r\n      type: object\r\n      properties:\r\n        model:\r\n          type: string\r\n          description: The model name. This parameter is ignored if the endpoint serves only one model.\r\n        input:\r\n          type: array\r\n          items:\r\n            type: string\r\n          description: 'Input text to embed, encoded as a string or array of tokens.'\r\n        dimensions:\r\n          type: integer\r\n          description: The number of dimensions the resulting output embeddings should have.\r\n        encoding_format:\r\n          $ref: '#/components/schemas/EmbeddingEncodingFormat'\r\n        input_type:\r\n          $ref: '#/components/schemas/EmbeddingInputType'\r\n    CreateEmbeddingResponse:\r\n      type: object\r\n      properties:\r\n        data:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/Embedding'\r\n        model:\r\n          type: string\r\n          description: The name of the model used to generate the embedding.\r\n        object:\r\n          $ref: '#/components/schemas/ListObject'\r\n        usage:\r\n          $ref: '#/components/schemas/Usage'\r\n    Embedding:\r\n      type: object\r\n      properties:\r\n        embedding:\r\n          type: array\r\n          items:\r\n            type: number\r\n          description: The embedding vector.\r\n        index:\r\n          type: integer\r\n          description: The index of the embedding in the list of embeddings.\r\n        object:\r\n          $ref: '#/components/schemas/EmbeddingObject'\r\n    EmbeddingEncodingFormat:\r\n      enum:\r\n        - base64\r\n        - float\r\n        - int8\r\n        - uint8\r\n        - binary\r\n        - ubinary\r\n      type: string\r\n    EmbeddingInputType:\r\n      enum:\r\n        - text\r\n        - query\r\n        - document\r\n      type: string\r\n    EmbeddingObject:\r\n      enum:\r\n        - embedding\r\n      type: string\r\n    ListObject:\r\n      enum:\r\n        - list\r\n      type: string\r\n    CreateImageEmbeddingRequest:\r\n      type: object\r\n      properties:\r\n        input:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/EmbeddingInput'\r\n          description: Input image to embed.\r\n        dimensions:\r\n          type: integer\r\n          description: The number of dimensions the resulting output embeddings should have.\r\n        encoding_format:\r\n          $ref: '#/components/schemas/EmbeddingEncodingFormat'\r\n    EmbeddingInput:\r\n      type: object\r\n      properties:\r\n        image:\r\n          type: string\r\n          description: The input image encoded in `base64` string as a data URL.\r\n        text:\r\n          type: string\r\n          description: Optional. The text input to feed into the model.\r\n    UnauthorizedError:\r\n      type: object\r\n      properties:\r\n        error:\r\n          type: string\r\n          description: The error description.\r\n        message:\r\n          type: string\r\n          description: The error message.\r\n        status:\r\n          type: integer\r\n          description: The HTTP status code.\r\n    NotFoundError:\r\n      type: object\r\n      properties:\r\n        error:\r\n          type: string\r\n          description: The error description.\r\n        message:\r\n          type: string\r\n          description: The error message.\r\n        status:\r\n          type: integer\r\n          description: The HTTP status code.\r\n    UnprocessableContentError:\r\n      type: object\r\n      properties:\r\n        code:\r\n          type: string\r\n          description: The error code.\r\n        detail:\r\n          $ref: '#/components/schemas/Detail'\r\n        error:\r\n          type: string\r\n          description: The error description.\r\n        message:\r\n          type: string\r\n          description: The error message.\r\n        status:\r\n          type: integer\r\n          description: The HTTP status code.\r\n    Detail:\r\n      type: object\r\n      properties:\r\n        loc:\r\n          type: array\r\n          items:\r\n            type: string\r\n          description: The parameter causing the issue.\r\n        value:\r\n          type: string\r\n          description: The value passed to the parameter causing issues.\r\n    TooManyRequestsError:\r\n      type: object\r\n      properties:\r\n        error:\r\n          type: string\r\n          description: The error description.\r\n        message:\r\n          type: string\r\n          description: The error message.\r\n        status:\r\n          type: integer\r\n          description: The HTTP status code.\r\n    ContentFilterError:\r\n      type: object\r\n      properties:\r\n        code:\r\n          type: string\r\n          description: The error code.\r\n        error:\r\n          type: string\r\n          description: The error description.\r\n        message:\r\n          type: string\r\n          description: The error message.\r\n        param:\r\n          type: string\r\n          description: The parameter that triggered the content filter.\r\n        status:\r\n          type: integer\r\n          description: The HTTP status code.\r\n    Usage:\r\n      type: object\r\n      properties:\r\n        prompt_patches:\r\n          type: integer\r\n          description: The number of image patches used by the image prompt.\r\n        prompt_tokens:\r\n          type: integer\r\n          description: The number of tokens used by the prompt.\r\n        total_patches:\r\n          type: integer\r\n          description: The total number of patches used by the request.\r\n        total_tokens:\r\n          type: integer\r\n          description: The total number of tokens used by the request.\r\n  securitySchemes:\r\n    apiKeyHeader:\r\n      type: apiKey\r\n      name: api-key\r\n      in: header\r\n    apiKeyQuery:\r\n      type: apiKey\r\n      name: subscription-key\r\n      in: query\r\nsecurity:\r\n  - apiKeyHeader: [ ]\r\n  - apiKeyQuery: [ ]",
            "$fxv#5": "<policies>\r\n    <inbound>\r\n        <base />\r\n        <set-header name=\"api-key\" exists-action=\"delete\" />\r\n        <authentication-managed-identity resource=\"{{cognitiveServicesAudience}}\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\r\n        <set-header name=\"Authorization\" exists-action=\"override\">\r\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\r\n        </set-header>\r\n    </inbound>\r\n    <backend>\r\n        <base />\r\n    </backend>\r\n    <outbound>\r\n        <base />\r\n    </outbound>\r\n    <on-error>\r\n        <base />\r\n    </on-error>\r\n</policies>",
            "$fxv#6": "<policies>\r\n    <inbound>\r\n        <base />\r\n        <!-- AAD Authorization -->\r\n        <!-- Enabled if entra-validate named value is set to true -->\r\n        <include-fragment fragment-id=\"aad-auth\" />\r\n        \r\n        <!-- Deleting api-key header to it is not passed to OpenAI endpoint-->\r\n        <set-header name=\"api-key\" exists-action=\"delete\" />\r\n        \r\n        <!-- Backend Managed Identity -->\r\n        <authentication-managed-identity resource=\"{{cognitiveServicesAudience}}\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\r\n        <set-header name=\"Authorization\" exists-action=\"override\">\r\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\r\n        </set-header>\r\n        \r\n        <!-- Set the backend service URL based on the product name -->\r\n        <choose>\r\n            <when condition=\"@(context.Product.Name == \"REPLACE1\")\">\r\n                <set-backend-service base-url=\"wss://REPLACE.openai.azure.com/openai/realtime\" />\r\n            </when>\r\n            <when condition=\"@(context.Product.Name == \"REPLACE2\")\">\r\n                <set-backend-service base-url=\"wss://REPLACE.openai.azure.com/openai/realtime\" />\r\n            </when>\r\n            <otherwise>\r\n                <set-backend-service base-url=\"wss://REPLACE.openai.azure.com/openai/realtime\" />\r\n            </otherwise>\r\n        </choose>\r\n\r\n        \r\n    </inbound>\r\n    <!-- Control if and how the requests are forwarded to services  -->\r\n    <backend>\r\n        <base />\r\n        <!--<include-fragment fragment-id=\"backend-routing\" />-->\r\n    </backend>\r\n    <!-- Customize the responses -->\r\n    <outbound>\r\n        <base />\r\n    </outbound>\r\n    <!-- Handle exceptions and customize error responses  -->\r\n    <on-error>\r\n        <base />\r\n    </on-error>\r\n</policies>",
            "$fxv#7": "openapi: 3.0.1\r\ninfo:\r\n  title: Azure Document Intelligence\r\n  description: 'Extracts content, layout, and structured data from documents.'\r\n  version: '1.0'\r\nservers:\r\n  - url: https://REPLACED-BY-POLICY/documentintelligence\r\npaths:\r\n  /documentClassifiers:\r\n    get:\r\n      summary: DocumentClassifiers_ListClassifiers\r\n      description: List all document classifiers.\r\n      operationId: DocumentClassifiers_ListClassifiers\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/PagedDocumentClassifierDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentClassifiers/{classifierId}':\r\n    get:\r\n      summary: DocumentClassifiers_GetClassifier\r\n      description: Gets detailed document classifier information.\r\n      operationId: DocumentClassifiers_GetClassifier\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentClassifierDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n    delete:\r\n      summary: DocumentClassifiers_DeleteClassifier\r\n      description: Deletes document classifier.\r\n      operationId: DocumentClassifiers_DeleteClassifier\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '204':\r\n          description: 'There is no content to send for this request, but the headers may be useful. '\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentClassifiers/{classifierId}:analyze':\r\n    post:\r\n      summary: DocumentClassifiers_ClassifyDocumentFromStream\r\n      description: \"Classifies document with document classifier. This operation can be used in two ways:\\n1. With a binary document stream in the request body (current endpoint)\\n2. With a ClassifyDocumentRequest object containing URL or base64-encoded document (add '_overload=classifyDocument' query parameter)\"\r\n      operationId: DocumentClassifiers_ClassifyDocumentFromStream\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\r\n        - $ref: '#/components/parameters/SplitParameter'\r\n        - $ref: '#/components/parameters/PagesParameter'\r\n        - name: _overload\r\n          in: query\r\n          description: Optional parameter to specify the operation variant. Use 'classifyDocument' for URL or base64 encoded document input.\r\n          schema:\r\n            enum:\r\n              - classifyDocument\r\n            type: string\r\n      requestBody:\r\n        description: Input content. Can be either a binary document stream or a ClassifyDocumentRequest object depending on the _overload parameter.\r\n        content:\r\n          application/octet-stream:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/pdf:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/jpeg:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/png:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/tiff:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/bmp:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/heif:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          text/html:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/vnd.openxmlformats-officedocument.wordprocessingml.document:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/vnd.openxmlformats-officedocument.presentationml.presentation:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of AnalyzeOperation\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentClassifiers/{classifierId}:copyTo':\r\n    post:\r\n      summary: DocumentClassifiers_CopyClassifierTo\r\n      description: 'Copies document classifier to the target resource, region, and classifierId.'\r\n      operationId: DocumentClassifiers_CopyClassifierTo\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Copy to request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/ClassifierCopyAuthorization'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentClassifierCopyToOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentClassifiers/{classifierId}/analyzeResults/{resultId}':\r\n    get:\r\n      summary: DocumentClassifiers_GetClassifyResult\r\n      description: Gets the result of document classifier.\r\n      operationId: DocumentClassifiers_GetClassifyResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/AnalyzeOperation'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentClassifiers:authorizeCopy:\r\n    post:\r\n      summary: DocumentClassifiers_AuthorizeClassifierCopy\r\n      description: \"Generates authorization to copy a document classifier to this location with\\nspecified classifierId and optional description.\"\r\n      operationId: DocumentClassifiers_AuthorizeClassifierCopy\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Authorize copy request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/AuthorizeClassifierCopyRequest'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/ClassifierCopyAuthorization'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentClassifiers:build:\r\n    post:\r\n      summary: DocumentClassifiers_BuildClassifier\r\n      description: Builds a custom document classifier.\r\n      operationId: DocumentClassifiers_BuildClassifier\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Build request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/BuildDocumentClassifierRequest'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentClassifierBuildOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentModels:\r\n    get:\r\n      summary: DocumentModels_ListModels\r\n      description: List all document models\r\n      operationId: DocumentModels_ListModels\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/PagedDocumentModelDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}:analyze':\r\n    post:\r\n      summary: DocumentModels_AnalyzeDocument\r\n      description: \"Analyzes document with document model. This operation can be used in two ways:\\n1. With a binary document stream in the request body (when _overload is not specified)\\n2. With an AnalyzeDocumentRequest object containing URL or base64-encoded document (add '_overload=analyzeDocument' query parameter)\"\r\n      operationId: DocumentModels_AnalyzeDocument\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/PagesParameter'\r\n        - $ref: '#/components/parameters/LocaleParameter'\r\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\r\n        - $ref: '#/components/parameters/FeaturesParameter'\r\n        - $ref: '#/components/parameters/QueryFieldsParameter'\r\n        - $ref: '#/components/parameters/OutputContentFormatParameter'\r\n        - $ref: '#/components/parameters/OutputParameter'\r\n        - name: _overload\r\n          in: query\r\n          description: Optional parameter to specify the operation variant. Use 'analyzeDocument' for URL or base64 encoded document input.\r\n          schema:\r\n            enum:\r\n              - analyzeDocument\r\n            type: string\r\n      requestBody:\r\n        description: Input content. Can be either a binary document stream or an AnalyzeDocumentRequest object depending on the _overload parameter.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of AnalyzeOperation\r\n              schema:\r\n                type: string\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}:analyzeBatch':\r\n    post:\r\n      summary: DocumentModels_AnalyzeBatchDocuments\r\n      description: Analyzes batch documents with document model.\r\n      operationId: DocumentModels_AnalyzeBatchDocuments\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/PagesParameter'\r\n        - $ref: '#/components/parameters/LocaleParameter'\r\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\r\n        - $ref: '#/components/parameters/FeaturesParameter'\r\n        - $ref: '#/components/parameters/QueryFieldsParameter'\r\n        - $ref: '#/components/parameters/OutputContentFormatParameter'\r\n        - $ref: '#/components/parameters/OutputParameter'\r\n      requestBody:\r\n        description: Analyze batch request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/AnalyzeBatchDocumentsRequest'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of AnalyzeBatchOperation\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}':\r\n    get:\r\n      summary: DocumentModels_GetModel\r\n      description: Gets detailed document model information.\r\n      operationId: DocumentModels_GetModel\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n    delete:\r\n      summary: DocumentModels_DeleteModel\r\n      description: Deletes document model.\r\n      operationId: DocumentModels_DeleteModel\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '204':\r\n          description: 'There is no content to send for this request, but the headers may be useful. '\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}:copyTo':\r\n    post:\r\n      summary: DocumentModels_CopyModelTo\r\n      description: 'Copies document model to the target resource, region, and modelId.'\r\n      operationId: DocumentModels_CopyModelTo\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Copy to request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/ModelCopyAuthorization'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentModelCopyToOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeBatchResults':\r\n    get:\r\n      summary: DocumentModels_ListAnalyzeBatchResults\r\n      description: List batch document analysis results.\r\n      operationId: DocumentModels_ListAnalyzeBatchResults\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/PagedAnalyzeBatchOperation'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeBatchResults/{resultId}':\r\n    get:\r\n      summary: DocumentModels_GetAnalyzeBatchResult\r\n      description: Gets the result of batch document analysis.\r\n      operationId: DocumentModels_GetAnalyzeBatchResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/AnalyzeBatchOperation'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n    delete:\r\n      summary: DocumentModels_DeleteAnalyzeBatchResult\r\n      description: Mark the batch document analysis result for deletion.\r\n      operationId: DocumentModels_DeleteAnalyzeBatchResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '204':\r\n          description: 'There is no content to send for this request, but the headers may be useful.'\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeResults/{resultId}':\r\n    get:\r\n      summary: DocumentModels_GetAnalyzeResult\r\n      description: Gets the result of document analysis.\r\n      operationId: DocumentModels_GetAnalyzeResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/AnalyzeOperation'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n    delete:\r\n      summary: DocumentModels_DeleteAnalyzeResult\r\n      description: Mark the result of document analysis for deletion.\r\n      operationId: DocumentModels_DeleteAnalyzeResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '204':\r\n          description: 'There is no content to send for this request, but the headers may be useful.'\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeResults/{resultId}/figures/{figureId}':\r\n    get:\r\n      summary: DocumentModels_GetAnalyzeResultFigure\r\n      description: Gets the generated cropped image of specified figure from document analysis.\r\n      operationId: DocumentModels_GetAnalyzeResultFigure\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/FigureIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            image/png:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ImagePngResp'\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ApplicationJ'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeResults/{resultId}/pdf':\r\n    get:\r\n      summary: DocumentModels_GetAnalyzeResultPdf\r\n      description: Gets the generated searchable PDF output from document analysis.\r\n      operationId: DocumentModels_GetAnalyzeResultPdf\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/pdf:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationPdfResponse'\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationJsonResponse'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentModels:authorizeCopy:\r\n    post:\r\n      summary: DocumentModels_AuthorizeModelCopy\r\n      description: \"Generates authorization to copy a document model to this location with\\nspecified modelId and optional description.\"\r\n      operationId: DocumentModels_AuthorizeModelCopy\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Authorize copy request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/AuthorizeCopyRequest'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/ModelCopyAuthorization'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentModels:build:\r\n    post:\r\n      summary: DocumentModels_BuildModel\r\n      description: Builds a custom document analysis model.\r\n      operationId: DocumentModels_BuildModel\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Build request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/BuildDocumentModelRequest'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentModelBuildOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentModels:compose:\r\n    post:\r\n      summary: DocumentModels_ComposeModel\r\n      description: Creates a new document model from document types of existing document models.\r\n      operationId: DocumentModels_ComposeModel\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Compose request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/ComposeDocumentModelRequest'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentModelComposeOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /info:\r\n    get:\r\n      summary: MiscellaneousOperations_GetResourceDetails\r\n      description: Return information about the current resource.\r\n      operationId: MiscellaneousOperations_GetResourceDetails\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentIntelligenceResourceDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /operations:\r\n    get:\r\n      summary: MiscellaneousOperations_ListOperations\r\n      description: Lists all operations.\r\n      operationId: MiscellaneousOperations_ListOperations\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/PagedDocumentIntelligenceOperationDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/operations/{operationId}':\r\n    get:\r\n      summary: MiscellaneousOperations_GetOperation\r\n      description: \"Gets operation info. Different operation types can be retrieved:\\n1. General operation: no _overload parameter needed\\n2. Document Model Build operation: use _overload=getDocumentModelBuildOperation\\n3. Document Model Compose operation: use _overload=getDocumentModelComposeOperation\\n4. Document Model Copy To operation: use _overload=getDocumentModelCopyToOperation\\n5. Document Classifier Copy To operation: use _overload=getDocumentClassifierCopyToOperation\\n6. Document Classifier Build operation: use _overload=getDocumentClassifierBuildOperation\"\r\n      operationId: MiscellaneousOperations_GetOperation\r\n      parameters:\r\n        - name: operationId\r\n          in: path\r\n          description: Operation ID\r\n          required: true\r\n          schema:\r\n            type: string\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - name: _overload\r\n          in: query\r\n          description: Optional parameter to specify the operation type to retrieve.\r\n          schema:\r\n            enum:\r\n              - getOperation\r\n              - getDocumentModelBuildOperation\r\n              - getDocumentModelComposeOperation\r\n              - getDocumentModelCopyToOperation\r\n              - getDocumentClassifierCopyToOperation\r\n              - getDocumentClassifierBuildOperation\r\n            type: string\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\ncomponents:\r\n  parameters:\r\n    ApiVersionParameter:\r\n      name: api-version\r\n      in: query\r\n      description: The API version to use for this operation.\r\n      required: true\r\n      schema:\r\n        minLength: 1\r\n        type: string\r\n    ClientRequestIdParameter:\r\n      name: x-ms-client-request-id\r\n      in: header\r\n      description: 'An opaque, globally-unique, client-generated string identifier for the request.'\r\n      schema:\r\n        type: string\r\n        format: uuid\r\n    ClassifierIdParameter:\r\n      name: classifierId\r\n      in: path\r\n      description: Unique document classifier name.\r\n      required: true\r\n      schema:\r\n        maxLength: 64\r\n        pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n        type: string\r\n    ModelIdParameter:\r\n      name: modelId\r\n      in: path\r\n      description: Unique document model name.\r\n      required: true\r\n      schema:\r\n        maxLength: 64\r\n        pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n        type: string\r\n    ResultIdParameter:\r\n      name: resultId\r\n      in: path\r\n      description: Operation result ID.\r\n      required: true\r\n      schema:\r\n        type: string\r\n        format: uuid\r\n    PagesParameter:\r\n      name: pages\r\n      in: query\r\n      description: '1-based page numbers to analyze. Ex. \"1-3,5,7-9\"'\r\n      schema:\r\n        pattern: '^(\\d+(-\\d+)?)(,\\s*(\\d+(-\\d+)?))*$'\r\n        type: string\r\n    StringIndexTypeParameter:\r\n      name: stringIndexType\r\n      in: query\r\n      description: Method used to compute string offset and length.\r\n      schema:\r\n        enum:\r\n          - textElements\r\n          - unicodeCodePoint\r\n          - utf16CodeUnit\r\n        type: string\r\n        default: textElements\r\n    SplitParameter:\r\n      name: split\r\n      in: query\r\n      description: Document splitting mode.\r\n      schema:\r\n        enum:\r\n          - auto\r\n          - none\r\n          - perPage\r\n        type: string\r\n        default: none\r\n    LocaleParameter:\r\n      name: locale\r\n      in: query\r\n      description: \"Locale hint for text recognition and document analysis.  Value may contain only\\nthe language code (ex. \\\"en\\\", \\\"fr\\\") or BCP 47 language tag (ex. \\\"en-US\\\").\"\r\n      schema:\r\n        type: string\r\n    FeaturesParameter:\r\n      name: features\r\n      in: query\r\n      description: List of optional analysis features.\r\n      schema:\r\n        type: array\r\n        items:\r\n          enum:\r\n            - ocrHighResolution\r\n            - languages\r\n            - barcodes\r\n            - formulas\r\n            - keyValuePairs\r\n            - styleFont\r\n            - queryFields\r\n          type: string\r\n          x-ms-enum:\r\n            name: DocumentAnalysisFeature\r\n            modelAsString: true\r\n            values:\r\n              - name: ocrHighResolution\r\n                value: ocrHighResolution\r\n                description: Perform OCR at a higher resolution to handle documents with fine print.\r\n              - name: languages\r\n                value: languages\r\n                description: Enable the detection of the text content language.\r\n              - name: barcodes\r\n                value: barcodes\r\n                description: Enable the detection of barcodes in the document.\r\n              - name: formulas\r\n                value: formulas\r\n                description: Enable the detection of mathematical expressions in the document.\r\n              - name: keyValuePairs\r\n                value: keyValuePairs\r\n                description: Enable the detection of general key value pairs (form fields) in the document.\r\n              - name: styleFont\r\n                value: styleFont\r\n                description: Enable the recognition of various font styles.\r\n              - name: queryFields\r\n                value: queryFields\r\n                description: Enable the extraction of additional fields via the queryFields query parameter.\r\n    QueryFieldsParameter:\r\n      name: queryFields\r\n      in: query\r\n      description: 'List of additional fields to extract.  Ex. \"NumberOfGuests,StoreNumber\"'\r\n      schema:\r\n        type: array\r\n        items:\r\n          type: string\r\n    OutputContentFormatParameter:\r\n      name: outputContentFormat\r\n      in: query\r\n      description: Format of the analyze result top-level content.\r\n      schema:\r\n        enum:\r\n          - text\r\n          - markdown\r\n        type: string\r\n        default: text\r\n    OutputParameter:\r\n      name: output\r\n      in: query\r\n      description: Additional outputs to generate during analysis.\r\n      schema:\r\n        type: array\r\n        items:\r\n          enum:\r\n            - pdf\r\n            - figures\r\n          type: string\r\n          x-ms-enum:\r\n            name: AnalyzeOutputOption\r\n            modelAsString: true\r\n            values:\r\n              - name: pdf\r\n                value: pdf\r\n                description: Generate searchable PDF output.\r\n              - name: figures\r\n                value: figures\r\n                description: Generate cropped images of detected figures.\r\n    FigureIdParameter:\r\n      name: figureId\r\n      in: path\r\n      description: Figure ID.\r\n      required: true\r\n      schema:\r\n        type: string\r\n  headers:\r\n    ClientRequestIdHeader:\r\n      description: 'An opaque, globally-unique, client-generated string identifier for the request.'\r\n      schema:\r\n        type: string\r\n        format: uuid\r\n  responses:\r\n    ErrorResponse:\r\n      description: An unexpected error response.\r\n      content:\r\n        application/json:\r\n          schema:\r\n            $ref: '#/components/schemas/DocumentIntelligenceErrorResponse'\r\n    NoContentResponse:\r\n      description: 'There is no content to send for this request, but the headers may be useful.'\r\n      headers:\r\n        x-ms-client-request-id:\r\n          $ref: '#/components/headers/ClientRequestIdHeader'\r\n      content:\r\n        application/json: {}\r\n    AcceptedResponse:\r\n      description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n      headers:\r\n        Operation-Location:\r\n          description: The location of an instance of the operation\r\n          schema:\r\n            type: string\r\n            format: uri\r\n        Retry-After:\r\n          description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n          schema:\r\n            type: integer\r\n            format: int32\r\n      content:\r\n        application/json: {}\r\n  schemas:\r\n    AddressValue:\r\n      type: object\r\n      properties:\r\n        houseNumber:\r\n          type: string\r\n          description: House or building number.\r\n        poBox:\r\n          type: string\r\n          description: Post office box number.\r\n        road:\r\n          type: string\r\n          description: Street name.\r\n        city:\r\n          type: string\r\n          description: 'Name of city, town, village, etc.'\r\n        state:\r\n          type: string\r\n          description: First-level administrative division.\r\n        postalCode:\r\n          type: string\r\n          description: Postal code used for mail sorting.\r\n        countryRegion:\r\n          type: string\r\n          description: Country/region.\r\n        streetAddress:\r\n          type: string\r\n          description: 'Street-level address, excluding city, state, countryRegion, and postalCode.'\r\n        unit:\r\n          type: string\r\n          description: Apartment or office number\r\n        cityDistrict:\r\n          type: string\r\n          description: \"Districts or boroughs within a city, such as Brooklyn in New York City or City\\nof Westminster in London.\"\r\n        stateDistrict:\r\n          type: string\r\n          description: Second-level administrative division used in certain locales.\r\n        suburb:\r\n          type: string\r\n          description: 'Unofficial neighborhood name, like Chinatown.'\r\n        house:\r\n          type: string\r\n          description: 'Build name, such as World Trade Center.'\r\n        level:\r\n          type: string\r\n          description: 'Floor number, such as 3F.'\r\n      description: Address field value.\r\n    AnalyzeBatchDocumentsRequest:\r\n      required:\r\n        - resultContainerUrl\r\n      type: object\r\n      properties:\r\n        azureBlobSource:\r\n          $ref: '#/components/schemas/AzureBlobContentSource'\r\n        azureBlobFileListSource:\r\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\r\n        resultContainerUrl:\r\n          type: string\r\n          description: Azure Blob Storage container URL where analyze result files will be stored.\r\n          format: uri\r\n        resultPrefix:\r\n          type: string\r\n          description: Blob name prefix of result files.\r\n        overwriteExisting:\r\n          type: boolean\r\n          description: Overwrite existing analyze result files?\r\n          default: false\r\n      description: Batch document analysis parameters.\r\n    AnalyzeBatchOperation:\r\n      required:\r\n        - status\r\n        - createdDateTime\r\n        - lastUpdatedDateTime\r\n      type: object\r\n      properties:\r\n        resultId:\r\n          $ref: '#/components/schemas/Azure.Core.uuid'\r\n        status:\r\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the operation was submitted.\r\n          format: date-time\r\n        lastUpdatedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the status was last updated.\r\n          format: date-time\r\n        percentCompleted:\r\n          maximum: 100\r\n          minimum: 0\r\n          type: integer\r\n          description: Operation progress (0-100).\r\n          format: int32\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n        result:\r\n          $ref: '#/components/schemas/AnalyzeBatchResult'\r\n      description: Status and result of the analyze batch operation.\r\n    AnalyzeBatchOperationDetail:\r\n      required:\r\n        - status\r\n        - sourceUrl\r\n      type: object\r\n      properties:\r\n        status:\r\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\r\n        sourceUrl:\r\n          type: string\r\n          description: URL of the source document.\r\n          format: uri\r\n        resultUrl:\r\n          type: string\r\n          description: URL of the analyze result JSON.\r\n          format: uri\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n      description: Operation detail for a document in a batch analysis.\r\n    AnalyzeBatchResult:\r\n      required:\r\n        - succeededCount\r\n        - failedCount\r\n        - skippedCount\r\n      type: object\r\n      properties:\r\n        succeededCount:\r\n          type: integer\r\n          description: Number of documents that completed with status succeeded.\r\n          format: int32\r\n        failedCount:\r\n          type: integer\r\n          description: Number of documents that completed with status failed.\r\n          format: int32\r\n        skippedCount:\r\n          type: integer\r\n          description: Number of documents that completed with status skipped.\r\n          format: int32\r\n        details:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/AnalyzeBatchOperationDetail'\r\n          description: Operation detail for each document in the batch.\r\n          x-ms-identifiers: [ ]\r\n      description: Batch document analysis result.\r\n    AnalyzeDocumentRequest:\r\n      type: object\r\n      properties:\r\n        urlSource:\r\n          type: string\r\n          description: Document URL to analyze.  Either urlSource or base64Source must be specified.\r\n          format: uri\r\n        base64Source:\r\n          type: string\r\n          description: \"Base64 encoding of the document to analyze.  Either urlSource or base64Source\\nmust be specified.\"\r\n          format: byte\r\n      description: Document analysis parameters.\r\n    AnalyzeOperation:\r\n      required:\r\n        - status\r\n        - createdDateTime\r\n        - lastUpdatedDateTime\r\n      type: object\r\n      properties:\r\n        status:\r\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the analyze operation was submitted.\r\n          format: date-time\r\n        lastUpdatedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the status was last updated.\r\n          format: date-time\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n        analyzeResult:\r\n          $ref: '#/components/schemas/AnalyzeResult'\r\n      description: Status and result of the analyze operation.\r\n    AnalyzeResult:\r\n      required:\r\n        - apiVersion\r\n        - modelId\r\n        - stringIndexType\r\n        - content\r\n        - pages\r\n      type: object\r\n      properties:\r\n        apiVersion:\r\n          type: string\r\n          description: API version used to produce this result.\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Document model ID used to produce this result.\r\n        stringIndexType:\r\n          $ref: '#/components/schemas/StringIndexType'\r\n        contentFormat:\r\n          $ref: '#/components/schemas/DocumentContentFormat'\r\n        content:\r\n          type: string\r\n          description: \"Concatenate string representation of all textual and visual elements in reading\\norder.\"\r\n        pages:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentPage'\r\n          description: Analyzed pages.\r\n          x-ms-identifiers: [ ]\r\n        paragraphs:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentParagraph'\r\n          description: Extracted paragraphs.\r\n          x-ms-identifiers: [ ]\r\n        tables:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentTable'\r\n          description: Extracted tables.\r\n          x-ms-identifiers: [ ]\r\n        figures:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentFigure'\r\n          description: Extracted figures.\r\n        sections:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSection'\r\n          description: Extracted sections.\r\n          x-ms-identifiers: [ ]\r\n        keyValuePairs:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentKeyValuePair'\r\n          description: Extracted key-value pairs.\r\n          x-ms-identifiers: [ ]\r\n        styles:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentStyle'\r\n          description: Extracted font styles.\r\n          x-ms-identifiers: [ ]\r\n        languages:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentLanguage'\r\n          description: Detected languages.\r\n          x-ms-identifiers: [ ]\r\n        documents:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/AnalyzedDocument'\r\n          description: Extracted documents.\r\n          x-ms-identifiers: [ ]\r\n        warnings:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\r\n          description: List of warnings encountered.\r\n          x-ms-identifiers: [ ]\r\n      description: Document analysis result.\r\n    AnalyzedDocument:\r\n      required:\r\n        - docType\r\n        - spans\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        docType:\r\n          maxLength: 64\r\n          minLength: 2\r\n          type: string\r\n          description: Document type.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the document.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the document in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        fields:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentField'\r\n          description: Dictionary of named field values.\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the document.\r\n          format: float\r\n      description: An object describing the location and semantic content of a document.\r\n    AuthorizeClassifierCopyRequest:\r\n      required:\r\n        - classifierId\r\n      type: object\r\n      properties:\r\n        classifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document classifier name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document classifier description.\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document classifier.\r\n      description: Request body to authorize document classifier copy.\r\n    AuthorizeCopyRequest:\r\n      required:\r\n        - modelId\r\n      type: object\r\n      properties:\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document model name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n      description: Request body to authorize document model copy.\r\n    Azure.Core.uuid:\r\n      type: string\r\n      description: Universally Unique Identifier\r\n      format: uuid\r\n    AzureBlobContentSource:\r\n      required:\r\n        - containerUrl\r\n      type: object\r\n      properties:\r\n        containerUrl:\r\n          type: string\r\n          description: Azure Blob Storage container URL.\r\n          format: uri\r\n        prefix:\r\n          type: string\r\n          description: Blob name prefix.\r\n      description: Azure Blob Storage content.\r\n    AzureBlobFileListContentSource:\r\n      required:\r\n        - containerUrl\r\n        - fileList\r\n      type: object\r\n      properties:\r\n        containerUrl:\r\n          type: string\r\n          description: Azure Blob Storage container URL.\r\n          format: uri\r\n        fileList:\r\n          type: string\r\n          description: Path to a JSONL file within the container specifying a subset of documents.\r\n      description: File list in Azure Blob Storage.\r\n    BoundingRegion:\r\n      required:\r\n        - pageNumber\r\n        - polygon\r\n      type: object\r\n      properties:\r\n        pageNumber:\r\n          minimum: 1\r\n          type: integer\r\n          description: 1-based page number of page containing the bounding region.\r\n          format: int32\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon on the page, or the entire page if not specified.\\nCoordinates specified relative to the top-left of the page. The numbers\\nrepresent the x, y values of the polygon vertices, clockwise from the left\\n(-180 degrees inclusive) relative to the element orientation.\"\r\n      description: Bounding polygon on a specific page of the input.\r\n    BuildDocumentClassifierRequest:\r\n      required:\r\n        - classifierId\r\n        - docTypes\r\n      type: object\r\n      properties:\r\n        classifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document classifier name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document classifier description.\r\n        baseClassifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Base classifierId on top of which to train the classifier.\r\n        docTypes:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/ClassifierDocumentTypeDetails'\r\n          description: List of document types to classify against.\r\n        allowOverwrite:\r\n          type: boolean\r\n          description: Allow overwriting an existing classifier with the same name.\r\n          default: false\r\n      description: Request body to build a new custom document classifier.\r\n    BuildDocumentModelRequest:\r\n      required:\r\n        - modelId\r\n        - buildMode\r\n      type: object\r\n      properties:\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document model name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        buildMode:\r\n          $ref: '#/components/schemas/DocumentBuildMode'\r\n        azureBlobSource:\r\n          $ref: '#/components/schemas/AzureBlobContentSource'\r\n        azureBlobFileListSource:\r\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n        maxTrainingHours:\r\n          type: number\r\n          description: Max number of V100-equivalent GPU hours to use for model training.  Default=0.5.\r\n          format: float\r\n          default: 0.5\r\n        allowOverwrite:\r\n          type: boolean\r\n          description: Allow overwriting an existing model with the same name.\r\n          default: false\r\n      description: Request body to build a new custom document model.\r\n    ClassifierCopyAuthorization:\r\n      required:\r\n        - targetResourceId\r\n        - targetResourceRegion\r\n        - targetClassifierId\r\n        - targetClassifierLocation\r\n        - accessToken\r\n        - expirationDateTime\r\n      type: object\r\n      properties:\r\n        targetResourceId:\r\n          type: string\r\n          description: ID of the target Azure resource where the document classifier should be copied to.\r\n        targetResourceRegion:\r\n          type: string\r\n          description: \"Location of the target Azure resource where the document classifier should be copied\\nto.\"\r\n        targetClassifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Identifier of the target document classifier.\r\n        targetClassifierLocation:\r\n          type: string\r\n          description: URL of the copied document classifier in the target account.\r\n          format: uri\r\n        accessToken:\r\n          type: string\r\n          description: Token used to authorize the request.\r\n        expirationDateTime:\r\n          type: string\r\n          description: Date/time when the access token expires.\r\n          format: date-time\r\n      description: \"Authorization to copy a document classifier to the specified target resource and\\nclassifierId.\"\r\n    ClassifierDocumentTypeDetails:\r\n      type: object\r\n      properties:\r\n        sourceKind:\r\n          $ref: '#/components/schemas/ContentSourceKind'\r\n        azureBlobSource:\r\n          $ref: '#/components/schemas/AzureBlobContentSource'\r\n        azureBlobFileListSource:\r\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\r\n      description: Classifier document type info.\r\n    ClassifyDocumentRequest:\r\n      type: object\r\n      properties:\r\n        urlSource:\r\n          type: string\r\n          description: Document URL to classify.  Either urlSource or base64Source must be specified.\r\n          format: uri\r\n        base64Source:\r\n          type: string\r\n          description: \"Base64 encoding of the document to classify.  Either urlSource or base64Source\\nmust be specified.\"\r\n          format: byte\r\n      description: Document classification parameters.\r\n    ComposeDocumentModelRequest:\r\n      required:\r\n        - modelId\r\n        - classifierId\r\n        - docTypes\r\n      type: object\r\n      properties:\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document model name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        classifierId:\r\n          type: string\r\n          description: Custom classifier to split and classify the input file.\r\n        split:\r\n          enum:\r\n            - auto\r\n            - none\r\n            - perPage\r\n          type: string\r\n          description: File splitting behavior.\r\n          default: none\r\n          x-ms-enum:\r\n            name: SplitMode\r\n            modelAsString: true\r\n            values:\r\n              - name: auto\r\n                value: auto\r\n                description: Automatically split file into documents.\r\n              - name: none\r\n                value: none\r\n                description: Treat the entire file as a single document.\r\n              - name: perPage\r\n                value: perPage\r\n                description: Treat each page in the file as a separate document.\r\n        docTypes:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentTypeDetails'\r\n          description: Dictionary mapping supported docTypes to the corresponding document models.\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n      description: Request body to create a composed document model from component document models.\r\n    ContentSourceKind:\r\n      enum:\r\n        - url\r\n        - base64\r\n        - azureBlob\r\n        - azureBlobFileList\r\n      type: string\r\n      description: Type of content source.\r\n      x-ms-enum:\r\n        name: ContentSourceKind\r\n        modelAsString: true\r\n        values:\r\n          - name: url\r\n            value: url\r\n            description: Content at a specific URL.\r\n          - name: base64\r\n            value: base64\r\n            description: Content represented via Base64 encoding.\r\n          - name: azureBlob\r\n            value: azureBlob\r\n            description: Files in a path within an Azure Blob Storage container.\r\n          - name: azureBlobFileList\r\n            value: azureBlobFileList\r\n            description: A file list specifying individual files in an Azure Blob Storage container.\r\n    CurrencyValue:\r\n      required:\r\n        - amount\r\n      type: object\r\n      properties:\r\n        amount:\r\n          type: number\r\n          description: Currency amount.\r\n          format: double\r\n        currencySymbol:\r\n          type: string\r\n          description: 'Currency symbol label, if any.'\r\n        currencyCode:\r\n          type: string\r\n          description: 'Resolved currency code (ISO 4217), if any.'\r\n      description: Currency field value.\r\n    CustomDocumentModelsDetails:\r\n      required:\r\n        - count\r\n        - limit\r\n      type: object\r\n      properties:\r\n        count:\r\n          type: integer\r\n          description: Number of custom document models in the current resource.\r\n          format: int32\r\n        limit:\r\n          type: integer\r\n          description: Maximum number of custom document models supported in the current resource.\r\n          format: int32\r\n      description: Details regarding custom document models.\r\n    DocumentAnalysisFeature:\r\n      enum:\r\n        - ocrHighResolution\r\n        - languages\r\n        - barcodes\r\n        - formulas\r\n        - keyValuePairs\r\n        - styleFont\r\n        - queryFields\r\n      type: string\r\n      description: Document analysis features to enable.\r\n      x-ms-enum:\r\n        name: DocumentAnalysisFeature\r\n        modelAsString: true\r\n        values:\r\n          - name: ocrHighResolution\r\n            value: ocrHighResolution\r\n            description: Perform OCR at a higher resolution to handle documents with fine print.\r\n          - name: languages\r\n            value: languages\r\n            description: Enable the detection of the text content language.\r\n          - name: barcodes\r\n            value: barcodes\r\n            description: Enable the detection of barcodes in the document.\r\n          - name: formulas\r\n            value: formulas\r\n            description: Enable the detection of mathematical expressions in the document.\r\n          - name: keyValuePairs\r\n            value: keyValuePairs\r\n            description: Enable the detection of general key value pairs (form fields) in the document.\r\n          - name: styleFont\r\n            value: styleFont\r\n            description: Enable the recognition of various font styles.\r\n          - name: queryFields\r\n            value: queryFields\r\n            description: Enable the extraction of additional fields via the queryFields query parameter.\r\n    DocumentBarcode:\r\n      required:\r\n        - kind\r\n        - value\r\n        - span\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        kind:\r\n          $ref: '#/components/schemas/DocumentBarcodeKind'\r\n        value:\r\n          type: string\r\n          description: Barcode value.\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the barcode, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\r\n        span:\r\n          $ref: '#/components/schemas/DocumentSpan'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the barcode.\r\n          format: float\r\n      description: A barcode object.\r\n    DocumentBarcodeKind:\r\n      enum:\r\n        - QRCode\r\n        - PDF417\r\n        - UPCA\r\n        - UPCE\r\n        - Code39\r\n        - Code128\r\n        - EAN8\r\n        - EAN13\r\n        - DataBar\r\n        - Code93\r\n        - Codabar\r\n        - DataBarExpanded\r\n        - ITF\r\n        - MicroQRCode\r\n        - Aztec\r\n        - DataMatrix\r\n        - MaxiCode\r\n      type: string\r\n      description: Barcode kind.\r\n      x-ms-enum:\r\n        name: DocumentBarcodeKind\r\n        modelAsString: true\r\n        values:\r\n          - name: QRCode\r\n            value: QRCode\r\n            description: 'QR code, as defined in ISO/IEC 18004:2015.'\r\n          - name: PDF417\r\n            value: PDF417\r\n            description: 'PDF417, as defined in ISO 15438.'\r\n          - name: UPCA\r\n            value: UPCA\r\n            description: GS1 12-digit Universal Product Code.\r\n          - name: UPCE\r\n            value: UPCE\r\n            description: GS1 6-digit Universal Product Code.\r\n          - name: Code39\r\n            value: Code39\r\n            description: 'Code 39 barcode, as defined in ISO/IEC 16388:2007.'\r\n          - name: Code128\r\n            value: Code128\r\n            description: 'Code 128 barcode, as defined in ISO/IEC 15417:2007.'\r\n          - name: EAN8\r\n            value: EAN8\r\n            description: GS1 8-digit International Article Number (European Article Number).\r\n          - name: EAN13\r\n            value: EAN13\r\n            description: GS1 13-digit International Article Number (European Article Number).\r\n          - name: DataBar\r\n            value: DataBar\r\n            description: GS1 DataBar barcode.\r\n          - name: Code93\r\n            value: Code93\r\n            description: 'Code 93 barcode, as defined in ANSI/AIM BC5-1995.'\r\n          - name: Codabar\r\n            value: Codabar\r\n            description: 'Codabar barcode, as defined in ANSI/AIM BC3-1995.'\r\n          - name: DataBarExpanded\r\n            value: DataBarExpanded\r\n            description: GS1 DataBar Expanded barcode.\r\n          - name: ITF\r\n            value: ITF\r\n            description: 'Interleaved 2 of 5 barcode, as defined in ANSI/AIM BC2-1995.'\r\n          - name: MicroQRCode\r\n            value: MicroQRCode\r\n            description: 'Micro QR code, as defined in ISO/IEC 23941:2022.'\r\n          - name: Aztec\r\n            value: Aztec\r\n            description: 'Aztec code, as defined in ISO/IEC 24778:2008.'\r\n          - name: DataMatrix\r\n            value: DataMatrix\r\n            description: 'Data matrix code, as defined in ISO/IEC 16022:2006.'\r\n          - name: MaxiCode\r\n            value: MaxiCode\r\n            description: 'MaxiCode, as defined in ISO/IEC 16023:2000.'\r\n    DocumentBuildMode:\r\n      enum:\r\n        - template\r\n        - neural\r\n      type: string\r\n      description: Custom document model build mode.\r\n      x-ms-enum:\r\n        name: DocumentBuildMode\r\n        modelAsString: true\r\n        values:\r\n          - name: template\r\n            value: template\r\n            description: Target documents with similar visual templates.\r\n          - name: neural\r\n            value: neural\r\n            description: Support documents with diverse visual templates.\r\n    DocumentCaption:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Content of the caption.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the caption.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the caption in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: Child elements of the caption.\r\n      description: A caption object describing a table or figure.\r\n    DocumentClassifierBuildOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentClassifierDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentClassifierBuild\r\n    DocumentClassifierCopyToOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentClassifierDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentClassifierCopyTo\r\n    DocumentClassifierDetails:\r\n      required:\r\n        - classifierId\r\n        - createdDateTime\r\n        - apiVersion\r\n        - docTypes\r\n      type: object\r\n      properties:\r\n        classifierId:\r\n          maxLength: 64\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document classifier name.\r\n          x-ms-mutability:\r\n            - read\r\n            - create\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document classifier description.\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document classifier was created.\r\n          format: date-time\r\n        expirationDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document classifier will expire.\r\n          format: date-time\r\n        modifiedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document model was last modified.\r\n          format: date-time\r\n          readOnly: true\r\n        apiVersion:\r\n          type: string\r\n          description: API version used to create this document classifier.\r\n        baseClassifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Base classifierId on top of which the classifier was trained.\r\n        docTypes:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/ClassifierDocumentTypeDetails'\r\n          description: List of document types to classify against.\r\n        warnings:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\r\n          description: List of warnings encountered while building the classifier.\r\n          x-ms-identifiers: [ ]\r\n      description: Document classifier info.\r\n    DocumentContentFormat:\r\n      enum:\r\n        - text\r\n        - markdown\r\n      type: string\r\n      description: Format of the content in analyzed result.\r\n      x-ms-enum:\r\n        name: DocumentContentFormat\r\n        modelAsString: true\r\n        values:\r\n          - name: text\r\n            value: text\r\n            description: Plain text representation of the document content without any formatting.\r\n          - name: markdown\r\n            value: markdown\r\n            description: \"Markdown representation of the document content with section headings, tables,\\netc.\"\r\n    DocumentElement:\r\n      type: string\r\n      description: \"An JSON pointer referencing an element of the document, such as paragraph,\\ntable, section, etc.\"\r\n    DocumentField:\r\n      required:\r\n        - type\r\n      type: object\r\n      properties:\r\n        type:\r\n          $ref: '#/components/schemas/DocumentFieldType'\r\n        valueString:\r\n          type: string\r\n          description: String value.\r\n        valueDate:\r\n          type: string\r\n          description: Date value in YYYY-MM-DD format (ISO 8601).\r\n          format: date\r\n        valueTime:\r\n          type: string\r\n          description: Time value in hh:mm:ss format (ISO 8601).\r\n          format: time\r\n        valuePhoneNumber:\r\n          type: string\r\n          description: Phone number value in E.164 format (ex. +19876543210).\r\n        valueNumber:\r\n          type: number\r\n          description: Floating point value.\r\n          format: double\r\n        valueInteger:\r\n          type: integer\r\n          description: Integer value.\r\n          format: int64\r\n        valueSelectionMark:\r\n          $ref: '#/components/schemas/DocumentSelectionMarkState'\r\n        valueSignature:\r\n          $ref: '#/components/schemas/DocumentSignatureType'\r\n        valueCountryRegion:\r\n          type: string\r\n          description: 3-letter country code value (ISO 3166-1 alpha-3).\r\n        valueArray:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentField'\r\n          description: Array of field values.\r\n          x-ms-identifiers: [ ]\r\n        valueObject:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentField'\r\n          description: Dictionary of named field values.\r\n        valueCurrency:\r\n          $ref: '#/components/schemas/CurrencyValue'\r\n        valueAddress:\r\n          $ref: '#/components/schemas/AddressValue'\r\n        valueBoolean:\r\n          type: boolean\r\n          description: Boolean value.\r\n        valueSelectionGroup:\r\n          type: array\r\n          items:\r\n            type: string\r\n          description: Selection group value.\r\n        content:\r\n          type: string\r\n          description: Field content.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the field.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the field in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the field.\r\n          format: float\r\n      description: An object representing the content and location of a field value.\r\n    DocumentFieldSchema:\r\n      required:\r\n        - type\r\n      type: object\r\n      properties:\r\n        type:\r\n          $ref: '#/components/schemas/DocumentFieldType'\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Field description.\r\n        example:\r\n          type: string\r\n          description: Example field content.\r\n        items:\r\n          $ref: '#/components/schemas/DocumentFieldSchema'\r\n        properties:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentFieldSchema'\r\n          description: Named sub-fields of the object field.\r\n      description: Description of the field semantic schema using a JSON Schema style syntax.\r\n    DocumentFieldType:\r\n      enum:\r\n        - string\r\n        - date\r\n        - time\r\n        - phoneNumber\r\n        - number\r\n        - integer\r\n        - selectionMark\r\n        - countryRegion\r\n        - signature\r\n        - array\r\n        - object\r\n        - currency\r\n        - address\r\n        - boolean\r\n        - selectionGroup\r\n      type: string\r\n      description: Semantic data type of the field value.\r\n      x-ms-enum:\r\n        name: DocumentFieldType\r\n        modelAsString: true\r\n        values:\r\n          - name: string\r\n            value: string\r\n            description: Plain text.\r\n          - name: date\r\n            value: date\r\n            description: 'Date, normalized to ISO 8601 (YYYY-MM-DD) format.'\r\n          - name: time\r\n            value: time\r\n            description: 'Time, normalized to ISO 8601 (hh:mm:ss) format.'\r\n          - name: phoneNumber\r\n            value: phoneNumber\r\n            description: 'Phone number, normalized to E.164 (+{CountryCode}{SubscriberNumber}) format.'\r\n          - name: number\r\n            value: number\r\n            description: 'Floating point number, normalized to double precision floating point.'\r\n          - name: integer\r\n            value: integer\r\n            description: 'Integer number, normalized to 64-bit signed integer.'\r\n          - name: selectionMark\r\n            value: selectionMark\r\n            description: Is field selected?\r\n          - name: countryRegion\r\n            value: countryRegion\r\n            description: 'Country/region, normalized to ISO 3166-1 alpha-3 format (ex. USA).'\r\n          - name: signature\r\n            value: signature\r\n            description: Is signature present?\r\n          - name: array\r\n            value: array\r\n            description: List of subfields of the same type.\r\n          - name: object\r\n            value: object\r\n            description: Named list of subfields of potentially different types.\r\n          - name: currency\r\n            value: currency\r\n            description: Currency amount with optional currency symbol and unit.\r\n          - name: address\r\n            value: address\r\n            description: Parsed address.\r\n          - name: boolean\r\n            value: boolean\r\n            description: 'Boolean value, normalized to true or false.'\r\n          - name: selectionGroup\r\n            value: selectionGroup\r\n            description: Array of selected string values.\r\n    DocumentFigure:\r\n      required:\r\n        - spans\r\n      type: object\r\n      properties:\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the figure.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the figure in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: 'Child elements of the figure, excluding any caption or footnotes.'\r\n        caption:\r\n          $ref: '#/components/schemas/DocumentCaption'\r\n        footnotes:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentFootnote'\r\n          description: List of footnotes associated with the figure.\r\n          x-ms-identifiers: [ ]\r\n        id:\r\n          type: string\r\n          description: Figure ID.\r\n      description: An object representing a figure in the document.\r\n    DocumentFontStyle:\r\n      enum:\r\n        - normal\r\n        - italic\r\n      type: string\r\n      description: Font style.\r\n      x-ms-enum:\r\n        name: DocumentFontStyle\r\n        modelAsString: true\r\n        values:\r\n          - name: normal\r\n            value: normal\r\n            description: Characters are represented normally.\r\n          - name: italic\r\n            value: italic\r\n            description: Characters are visually slanted to the right.\r\n    DocumentFontWeight:\r\n      enum:\r\n        - normal\r\n        - bold\r\n      type: string\r\n      description: Font weight.\r\n      x-ms-enum:\r\n        name: DocumentFontWeight\r\n        modelAsString: true\r\n        values:\r\n          - name: normal\r\n            value: normal\r\n            description: Characters are represented normally.\r\n          - name: bold\r\n            value: bold\r\n            description: Characters are represented with thicker strokes.\r\n    DocumentFootnote:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Content of the footnote.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the footnote.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the footnote in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: Child elements of the footnote.\r\n      description: A footnote object describing a table or figure.\r\n    DocumentFormula:\r\n      required:\r\n        - kind\r\n        - value\r\n        - span\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        kind:\r\n          $ref: '#/components/schemas/DocumentFormulaKind'\r\n        value:\r\n          type: string\r\n          description: LaTex expression describing the formula.\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the formula, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\r\n        span:\r\n          $ref: '#/components/schemas/DocumentSpan'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the formula.\r\n          format: float\r\n      description: A formula object.\r\n    DocumentFormulaKind:\r\n      enum:\r\n        - inline\r\n        - display\r\n      type: string\r\n      description: Formula kind.\r\n      x-ms-enum:\r\n        name: DocumentFormulaKind\r\n        modelAsString: true\r\n        values:\r\n          - name: inline\r\n            value: inline\r\n            description: A formula embedded within the content of a paragraph.\r\n          - name: display\r\n            value: display\r\n            description: A formula in display mode that takes up an entire line.\r\n    DocumentIntelligenceError:\r\n      required:\r\n        - code\r\n        - message\r\n      type: object\r\n      properties:\r\n        code:\r\n          type: string\r\n          description: One of a server-defined set of error codes.\r\n        message:\r\n          type: string\r\n          description: A human-readable representation of the error.\r\n        target:\r\n          type: string\r\n          description: The target of the error.\r\n        details:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceError'\r\n          description: An array of details about specific errors that led to this reported error.\r\n          x-ms-identifiers: [ ]\r\n        innererror:\r\n          $ref: '#/components/schemas/DocumentIntelligenceInnerError'\r\n      description: The error object.\r\n    DocumentIntelligenceErrorResponse:\r\n      required:\r\n        - error\r\n      type: object\r\n      properties:\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n      description: Error response object.\r\n    DocumentIntelligenceInnerError:\r\n      type: object\r\n      properties:\r\n        code:\r\n          type: string\r\n          description: One of a server-defined set of error codes.\r\n        message:\r\n          type: string\r\n          description: A human-readable representation of the error.\r\n        innererror:\r\n          $ref: '#/components/schemas/DocumentIntelligenceInnerError'\r\n      description: An object containing more specific information about the error.\r\n    DocumentIntelligenceOperationDetails:\r\n      required:\r\n        - operationId\r\n        - status\r\n        - createdDateTime\r\n        - lastUpdatedDateTime\r\n        - kind\r\n        - resourceLocation\r\n      type: object\r\n      properties:\r\n        operationId:\r\n          type: string\r\n          description: Operation ID\r\n          x-ms-mutability:\r\n            - read\r\n            - create\r\n        status:\r\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\r\n        percentCompleted:\r\n          maximum: 100\r\n          minimum: 0\r\n          type: integer\r\n          description: Operation progress (0-100).\r\n          format: int32\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the operation was created.\r\n          format: date-time\r\n        lastUpdatedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the status was last updated.\r\n          format: date-time\r\n        kind:\r\n          $ref: '#/components/schemas/OperationKind'\r\n        resourceLocation:\r\n          type: string\r\n          description: URL of the resource targeted by this operation.\r\n          format: uri\r\n        apiVersion:\r\n          type: string\r\n          description: API version used to create this operation.\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n      description: Operation info.\r\n      discriminator:\r\n        propertyName: kind\r\n    DocumentIntelligenceOperationStatus:\r\n      enum:\r\n        - notStarted\r\n        - running\r\n        - failed\r\n        - succeeded\r\n        - canceled\r\n        - skipped\r\n\r\n      type: string\r\n      description: Operation status.\r\n      x-ms-enum:\r\n        name: DocumentIntelligenceOperationStatus\r\n        modelAsString: true\r\n        values:\r\n          - name: notStarted\r\n            value: notStarted\r\n            description: The operation has not started yet.\r\n          - name: running\r\n            value: running\r\n            description: The operation is in progress.\r\n          - name: failed\r\n            value: failed\r\n            description: The operation has failed.\r\n          - name: succeeded\r\n            value: succeeded\r\n            description: The operation has succeeded.\r\n          - name: canceled\r\n            value: canceled\r\n            description: The operation has been canceled.\r\n          - name: skipped\r\n            value: skipped\r\n            description: The operation has been skipped.\r\n    DocumentIntelligenceResourceDetails:\r\n      required:\r\n        - customDocumentModels\r\n      type: object\r\n      properties:\r\n        customDocumentModels:\r\n          $ref: '#/components/schemas/CustomDocumentModelsDetails'\r\n      description: General information regarding the current resource.\r\n    DocumentIntelligenceWarning:\r\n      required:\r\n        - code\r\n        - message\r\n      type: object\r\n      properties:\r\n        code:\r\n          type: string\r\n          description: One of a server-defined set of warning codes.\r\n        message:\r\n          type: string\r\n          description: A human-readable representation of the warning.\r\n        target:\r\n          type: string\r\n          description: The target of the error.\r\n      description: The error object.\r\n    DocumentKeyValueElement:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Concatenated content of the key-value element in reading order.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the key-value element.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the key-value element in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n      description: An object representing the field key or value in a key-value pair.\r\n    DocumentKeyValuePair:\r\n      required:\r\n        - key\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        key:\r\n          $ref: '#/components/schemas/DocumentKeyValueElement'\r\n        value:\r\n          $ref: '#/components/schemas/DocumentKeyValueElement'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the key-value pair.\r\n          format: float\r\n      description: \"An object representing a form field with distinct field label (key) and field\\nvalue (may be empty).\"\r\n    DocumentLanguage:\r\n      required:\r\n        - locale\r\n        - spans\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        locale:\r\n          type: string\r\n          description: \"Detected language.  Value may an ISO 639-1 language code (ex. \\\"en\\\", \\\"fr\\\")\\nor BCP 47 language tag (ex. \\\"zh-Hans\\\").\"\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: \"Location of the text elements in the concatenated content the language applies\\nto.\"\r\n          x-ms-identifiers: [ ]\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly identifying the language.\r\n          format: float\r\n      description: An object representing the detected language for a given text span.\r\n    DocumentLine:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Concatenated content of the contained elements in reading order.\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the line, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the line in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n      description: \"A content line object consisting of an adjacent sequence of content elements,\\nsuch as words and selection marks.\"\r\n    DocumentModelBuildOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentModelDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentModelBuild\r\n    DocumentModelComposeOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentModelDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentModelCompose\r\n    DocumentModelCopyToOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentModelDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentModelCopyTo\r\n    DocumentModelDetails:\r\n      required:\r\n        - modelId\r\n        - createdDateTime\r\n      type: object\r\n      properties:\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document model name.\r\n          x-ms-mutability:\r\n            - read\r\n            - create\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document model was created.\r\n          format: date-time\r\n          readOnly: true\r\n        expirationDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document model will expire.\r\n          format: date-time\r\n          readOnly: true\r\n        modifiedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document model was last modified.\r\n          format: date-time\r\n          readOnly: true\r\n        apiVersion:\r\n          type: string\r\n          description: API version used to create this document model.\r\n          readOnly: true\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n        buildMode:\r\n          $ref: '#/components/schemas/DocumentBuildMode'\r\n        azureBlobSource:\r\n          $ref: '#/components/schemas/AzureBlobContentSource'\r\n        azureBlobFileListSource:\r\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\r\n        classifierId:\r\n          type: string\r\n          description: 'For composed models, the custom classifier to split and classify the input file.'\r\n        split:\r\n          enum:\r\n            - auto\r\n            - none\r\n            - perPage\r\n          type: string\r\n          description: 'For composed models, the file splitting behavior.'\r\n          default: none\r\n          x-ms-enum:\r\n            name: SplitMode\r\n            modelAsString: true\r\n            values:\r\n              - name: auto\r\n                value: auto\r\n                description: Automatically split file into documents.\r\n              - name: none\r\n                value: none\r\n                description: Treat the entire file as a single document.\r\n              - name: perPage\r\n                value: perPage\r\n                description: Treat each page in the file as a separate document.\r\n        docTypes:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentTypeDetails'\r\n          description: Supported document types.\r\n          readOnly: true\r\n        warnings:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\r\n          description: List of warnings encountered while building the model.\r\n          readOnly: true\r\n          x-ms-identifiers: [ ]\r\n        trainingHours:\r\n          type: number\r\n          description: Number of V100-equivalent GPU hours consumed for model training.\r\n          format: float\r\n          readOnly: true\r\n      description: Document model info.\r\n    DocumentPage:\r\n      required:\r\n        - pageNumber\r\n        - spans\r\n      type: object\r\n      properties:\r\n        pageNumber:\r\n          minimum: 1\r\n          type: integer\r\n          description: 1-based page number in the input document.\r\n          format: int32\r\n        angle:\r\n          maximum: 180\r\n          type: number\r\n          description: \"The general orientation of the content in clockwise direction, measured in\\ndegrees between (-180, 180].\"\r\n          format: float\r\n        width:\r\n          minimum: 0\r\n          type: number\r\n          description: 'The width of the image/PDF in pixels/inches, respectively.'\r\n          format: float\r\n        height:\r\n          minimum: 0\r\n          type: number\r\n          description: 'The height of the image/PDF in pixels/inches, respectively.'\r\n          format: float\r\n        unit:\r\n          $ref: '#/components/schemas/LengthUnit'\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the page in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        words:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentWord'\r\n          description: Extracted words from the page.\r\n          x-ms-identifiers: [ ]\r\n        selectionMarks:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSelectionMark'\r\n          description: Extracted selection marks from the page.\r\n          x-ms-identifiers: [ ]\r\n        lines:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentLine'\r\n          description: \"Extracted lines from the page, potentially containing both textual and visual\\nelements.\"\r\n          x-ms-identifiers: [ ]\r\n        barcodes:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentBarcode'\r\n          description: Extracted barcodes from the page.\r\n          x-ms-identifiers: [ ]\r\n        formulas:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentFormula'\r\n          description: Extracted formulas from the page.\r\n          x-ms-identifiers: [ ]\r\n      description: Content and layout elements extracted from a page from the input.\r\n    DocumentParagraph:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        role:\r\n          $ref: '#/components/schemas/ParagraphRole'\r\n        content:\r\n          type: string\r\n          description: Concatenated content of the paragraph in reading order.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the paragraph.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the paragraph in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n      description: \"A paragraph object consisting with contiguous lines generally with common\\nalignment and spacing.\"\r\n    DocumentSection:\r\n      required:\r\n        - spans\r\n      type: object\r\n      properties:\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the section in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: Child elements of the section.\r\n      description: An object representing a section in the document.\r\n    DocumentSelectionMark:\r\n      required:\r\n        - state\r\n        - span\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        state:\r\n          $ref: '#/components/schemas/DocumentSelectionMarkState'\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the selection mark, with coordinates specified relative\\nto the top-left of the page. The numbers represent the x, y values of the\\npolygon vertices, clockwise from the left (-180 degrees inclusive) relative\\nto the element orientation.\"\r\n        span:\r\n          $ref: '#/components/schemas/DocumentSpan'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the selection mark.\r\n          format: float\r\n      description: \"A selection mark object representing check boxes, radio buttons, and other\\nelements indicating a selection.\"\r\n    DocumentSelectionMarkState:\r\n      enum:\r\n        - selected\r\n        - unselected\r\n      type: string\r\n      description: State of the selection mark.\r\n      x-ms-enum:\r\n        name: DocumentSelectionMarkState\r\n        modelAsString: true\r\n        values:\r\n          - name: selected\r\n            value: selected\r\n            description: \"The selection mark is selected, often indicated by a check  or cross X inside\\nthe selection mark.\"\r\n          - name: unselected\r\n            value: unselected\r\n            description: The selection mark is not selected.\r\n    DocumentSignatureType:\r\n      enum:\r\n        - signed\r\n        - unsigned\r\n      type: string\r\n      description: Presence of signature.\r\n      x-ms-enum:\r\n        name: DocumentSignatureType\r\n        modelAsString: true\r\n        values:\r\n          - name: signed\r\n            value: signed\r\n            description: A signature is detected.\r\n          - name: unsigned\r\n            value: unsigned\r\n            description: No signatures are detected.\r\n    DocumentSpan:\r\n      required:\r\n        - offset\r\n        - length\r\n      type: object\r\n      properties:\r\n        offset:\r\n          minimum: 0\r\n          type: integer\r\n          description: Zero-based index of the content represented by the span.\r\n          format: int32\r\n        length:\r\n          minimum: 0\r\n          type: integer\r\n          description: Number of characters in the content represented by the span.\r\n          format: int32\r\n      description: \"Contiguous region of the concatenated content property, specified as an offset\\nand length.\"\r\n    DocumentStyle:\r\n      required:\r\n        - spans\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        isHandwritten:\r\n          type: boolean\r\n          description: Is content handwritten?\r\n        similarFontFamily:\r\n          type: string\r\n          description: \"Visually most similar font from among the set of supported font families, with\\nfallback fonts following CSS convention (ex. 'Arial, sans-serif').\"\r\n        fontStyle:\r\n          $ref: '#/components/schemas/DocumentFontStyle'\r\n        fontWeight:\r\n          $ref: '#/components/schemas/DocumentFontWeight'\r\n        color:\r\n          pattern: '^#[0-9a-f]{6}$'\r\n          type: string\r\n          description: 'Foreground color in #rrggbb hexadecimal format.'\r\n        backgroundColor:\r\n          pattern: '^#[0-9a-f]{6}$'\r\n          type: string\r\n          description: 'Background color in #rrggbb hexadecimal format..'\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the text elements in the concatenated content the style applies to.\r\n          x-ms-identifiers: [ ]\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly identifying the style.\r\n          format: float\r\n      description: An object representing observed text styles.\r\n    DocumentTable:\r\n      required:\r\n        - rowCount\r\n        - columnCount\r\n        - cells\r\n        - spans\r\n      type: object\r\n      properties:\r\n        rowCount:\r\n          minimum: 1\r\n          type: integer\r\n          description: Number of rows in the table.\r\n          format: int32\r\n        columnCount:\r\n          minimum: 1\r\n          type: integer\r\n          description: Number of columns in the table.\r\n          format: int32\r\n        cells:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentTableCell'\r\n          description: Cells contained within the table.\r\n          x-ms-identifiers: [ ]\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the table.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the table in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        caption:\r\n          $ref: '#/components/schemas/DocumentCaption'\r\n        footnotes:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentFootnote'\r\n          description: List of footnotes associated with the table.\r\n          x-ms-identifiers: [ ]\r\n      description: A table object consisting table cells arranged in a rectangular layout.\r\n    DocumentTableCell:\r\n      required:\r\n        - rowIndex\r\n        - columnIndex\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        kind:\r\n          enum:\r\n            - content\r\n            - rowHeader\r\n            - columnHeader\r\n            - stubHead\r\n            - description\r\n          type: string\r\n          description: Table cell kind.\r\n          default: content\r\n          x-ms-enum:\r\n            name: DocumentTableCellKind\r\n            modelAsString: true\r\n            values:\r\n              - name: content\r\n                value: content\r\n                description: Contains the main content/data.\r\n              - name: rowHeader\r\n                value: rowHeader\r\n                description: Describes the content of the row.\r\n              - name: columnHeader\r\n                value: columnHeader\r\n                description: Describes the content of the column.\r\n              - name: stubHead\r\n                value: stubHead\r\n                description: 'Describes the row headers, usually located at the top left corner of a table.'\r\n              - name: description\r\n                value: description\r\n                description: Describes the content in (parts of) the table.\r\n        rowIndex:\r\n          type: integer\r\n          description: Row index of the cell.\r\n          format: int32\r\n        columnIndex:\r\n          type: integer\r\n          description: Column index of the cell.\r\n          format: int32\r\n        rowSpan:\r\n          minimum: 1\r\n          type: integer\r\n          description: Number of rows spanned by this cell.\r\n          format: int32\r\n          default: 1\r\n        columnSpan:\r\n          minimum: 1\r\n          type: integer\r\n          description: Number of columns spanned by this cell.\r\n          format: int32\r\n          default: 1\r\n        content:\r\n          type: string\r\n          description: Concatenated content of the table cell in reading order.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the table cell.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the table cell in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: Child elements of the table cell.\r\n      description: An object representing the location and content of a table cell.\r\n    DocumentTypeDetails:\r\n      type: object\r\n      properties:\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        buildMode:\r\n          $ref: '#/components/schemas/DocumentBuildMode'\r\n        fieldSchema:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentFieldSchema'\r\n          description: Description of the document semantic schema using a JSON Schema style syntax.\r\n        fieldConfidence:\r\n          type: object\r\n          additionalProperties:\r\n            type: number\r\n            format: float\r\n          description: Estimated confidence for each field.\r\n        modelId:\r\n          maxLength: 64\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Document model to use for analyzing documents with specified type.\r\n        confidenceThreshold:\r\n          type: number\r\n          description: Only perform analysis if docType confidence is above threshold.\r\n          format: float\r\n        features:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentAnalysisFeature'\r\n          description: List of optional analysis features.\r\n        queryFields:\r\n          type: array\r\n          items:\r\n            type: string\r\n          description: 'List of additional fields to extract.  Ex. \"NumberOfGuests,StoreNumber\"'\r\n        maxDocumentsToAnalyze:\r\n          type: integer\r\n          description: Maximum number of documents of specified type to analyze.  Default=all.\r\n          format: int32\r\n      description: Document type info.\r\n    DocumentWord:\r\n      required:\r\n        - content\r\n        - span\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Text content of the word.\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the word, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\r\n        span:\r\n          $ref: '#/components/schemas/DocumentSpan'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the word.\r\n          format: float\r\n      description: \"A word object consisting of a contiguous sequence of characters.  For non-space\\ndelimited languages, such as Chinese, Japanese, and Korean, each character is\\nrepresented as its own word.\"\r\n    LengthUnit:\r\n      enum:\r\n        - pixel\r\n        - inch\r\n      type: string\r\n      description: 'The unit used by the width, height, and polygon properties. For images, the unit is \"pixel\". For PDF, the unit is \"inch\".'\r\n      x-ms-enum:\r\n        name: LengthUnit\r\n        modelAsString: true\r\n        values:\r\n          - name: pixel\r\n            value: pixel\r\n            description: Length unit for image files.\r\n          - name: inch\r\n            value: inch\r\n            description: Length unit for PDF files.\r\n    ModelCopyAuthorization:\r\n      required:\r\n        - targetResourceId\r\n        - targetResourceRegion\r\n        - targetModelId\r\n        - targetModelLocation\r\n        - accessToken\r\n        - expirationDateTime\r\n      type: object\r\n      properties:\r\n        targetResourceId:\r\n          type: string\r\n          description: ID of the target Azure resource where the document model should be copied to.\r\n        targetResourceRegion:\r\n          type: string\r\n          description: \"Location of the target Azure resource where the document model should be copied\\nto.\"\r\n        targetModelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Identifier of the target document model.\r\n        targetModelLocation:\r\n          type: string\r\n          description: URL of the copied document model in the target account.\r\n          format: uri\r\n        accessToken:\r\n          type: string\r\n          description: Token used to authorize the request.\r\n        expirationDateTime:\r\n          type: string\r\n          description: Date/time when the access token expires.\r\n          format: date-time\r\n      description: \"Authorization to copy a document model to the specified target resource and\\nmodelId.\"\r\n    OperationKind:\r\n      enum:\r\n        - documentModelBuild\r\n        - documentModelCompose\r\n        - documentModelCopyTo\r\n        - documentClassifierCopyTo\r\n        - documentClassifierBuild\r\n      type: string\r\n      description: Type of operation.\r\n      x-ms-enum:\r\n        name: OperationKind\r\n        modelAsString: true\r\n        values:\r\n          - name: documentModelBuild\r\n            value: documentModelBuild\r\n            description: Build a new custom document model.\r\n          - name: documentModelCompose\r\n            value: documentModelCompose\r\n            description: Compose a new custom document model from existing models.\r\n          - name: documentModelCopyTo\r\n            value: documentModelCopyTo\r\n            description: \"Copy an existing document model to potentially a different resource, region, or\\nsubscription.\"\r\n          - name: documentClassifierCopyTo\r\n            value: documentClassifierCopyTo\r\n            description: \"Copy an existing document classifier to potentially a different resource, region, or\\nsubscription.\"\r\n          - name: documentClassifierBuild\r\n            value: documentClassifierBuild\r\n            description: Build a new custom classifier model.\r\n    PagedAnalyzeBatchOperation:\r\n      required:\r\n        - value\r\n      type: object\r\n      properties:\r\n        value:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/AnalyzeBatchOperation'\r\n          description: The AnalyzeBatchOperation items on this page\r\n          x-ms-identifiers: [ ]\r\n        nextLink:\r\n          type: string\r\n          description: The link to the next page of items\r\n          format: uri\r\n      description: Paged collection of AnalyzeBatchOperation items\r\n    PagedDocumentClassifierDetails:\r\n      required:\r\n        - value\r\n      type: object\r\n      properties:\r\n        value:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentClassifierDetails'\r\n          description: The DocumentClassifierDetails items on this page\r\n          x-ms-identifiers: [ ]\r\n        nextLink:\r\n          type: string\r\n          description: The link to the next page of items\r\n          format: uri\r\n      description: Paged collection of DocumentClassifierDetails items\r\n    PagedDocumentIntelligenceOperationDetails:\r\n      required:\r\n        - value\r\n      type: object\r\n      properties:\r\n        value:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n          description: The DocumentIntelligenceOperationDetails items on this page\r\n          x-ms-identifiers: [ ]\r\n        nextLink:\r\n          type: string\r\n          description: The link to the next page of items\r\n          format: uri\r\n      description: Paged collection of DocumentIntelligenceOperationDetails items\r\n    PagedDocumentModelDetails:\r\n      required:\r\n        - value\r\n      type: object\r\n      properties:\r\n        value:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentModelDetails'\r\n          description: The DocumentModelDetails items on this page\r\n          x-ms-identifiers: [ ]\r\n        nextLink:\r\n          type: string\r\n          description: The link to the next page of items\r\n          format: uri\r\n      description: Paged collection of DocumentModelDetails items\r\n    ParagraphRole:\r\n      enum:\r\n        - pageHeader\r\n        - pageFooter\r\n        - pageNumber\r\n        - title\r\n        - sectionHeading\r\n        - footnote\r\n        - formulaBlock\r\n      type: string\r\n      description: Semantic role of the paragraph.\r\n      x-ms-enum:\r\n        name: ParagraphRole\r\n        modelAsString: true\r\n        values:\r\n          - name: pageHeader\r\n            value: pageHeader\r\n            description: Text near the top edge of the page.\r\n          - name: pageFooter\r\n            value: pageFooter\r\n            description: Text near the bottom edge of the page.\r\n          - name: pageNumber\r\n            value: pageNumber\r\n            description: Page number.\r\n          - name: title\r\n            value: title\r\n            description: Top-level title describing the entire document.\r\n          - name: sectionHeading\r\n            value: sectionHeading\r\n            description: Sub heading describing a section of the document.\r\n          - name: footnote\r\n            value: footnote\r\n            description: A note usually placed after the main content on a page.\r\n          - name: formulaBlock\r\n            value: formulaBlock\r\n            description: 'A block of formulas, often with shared alignment.'\r\n    StringIndexType:\r\n      enum:\r\n        - textElements\r\n        - unicodeCodePoint\r\n        - utf16CodeUnit\r\n      type: string\r\n      description: Method used to compute string offset and length.\r\n      x-ms-enum:\r\n        name: StringIndexType\r\n        modelAsString: true\r\n        values:\r\n          - name: textElements\r\n            value: textElements\r\n            description: \"User-perceived display character, or grapheme cluster, as defined by Unicode\\n8.0.0.\"\r\n          - name: unicodeCodePoint\r\n            value: unicodeCodePoint\r\n            description: Character unit represented by a single unicode code point.  Used by Python 3.\r\n          - name: utf16CodeUnit\r\n            value: utf16CodeUnit\r\n            description: \"Character unit represented by a 16-bit Unicode code unit.  Used by JavaScript,\\nJava, and .NET.\"\r\n    Input:\r\n      type: object\r\n    DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ImagePngResp:\r\n      type: file\r\n    DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ApplicationJ:\r\n      type: file\r\n    DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationPdfResponse:\r\n      type: file\r\n    DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationJsonResponse:\r\n      type: file\r\n  securitySchemes:\r\n    apiKeyHeader:\r\n      type: apiKey\r\n      name: Ocp-Apim-Subscription-Key\r\n      in: header\r\n    apiKeyQuery:\r\n      type: apiKey\r\n      name: subscription-key\r\n      in: query\r\nsecurity:\r\n  - apiKeyHeader: [ ]\r\n  - apiKeyQuery: [ ]",
            "$fxv#8": "<policies>\r\n    <inbound>\r\n        <base />\r\n        <!-- AAD Authorization -->\r\n        <!-- Enabled if entra-validate named value is set to true -->\r\n        <include-fragment fragment-id=\"aad-auth\" />\r\n\r\n        <set-header name=\"api-key\" exists-action=\"delete\" />\r\n        \r\n        <!-- Setting cache keys -->\r\n        <set-variable name=\"deployment-id\" value=\"@{\r\n            var modelId = context.Request.MatchedParameters.GetValueOrDefault(\"modelId\", \"\");\r\n            var classifierId = context.Request.MatchedParameters.GetValueOrDefault(\"classifierId\", \"\");\r\n            \r\n            if (!string.IsNullOrEmpty(modelId))\r\n            {\r\n                return modelId;\r\n            }\r\n            else if (!string.IsNullOrEmpty(classifierId))\r\n            {\r\n                return classifierId;\r\n            }\r\n            else\r\n            {\r\n                return \"Document-Intelligence\";\r\n            }\r\n        }\" />\r\n        \r\n        <set-variable name=\"routesCacheKey\" value=\"@((string)context.Variables[\"deployment-id\"] + \"Routes\" + context.Deployment.Region + context.Api.Revision)\" />\r\n        <set-variable name=\"oaClustersCacheKey\" value=\"@(\"aiDocIntelInstance\" + context.Deployment.Region + context.Api.Revision)\" />\r\n        <cache-lookup-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-DOCINTELL\"))\" variable-name=\"oaClusters\" />\r\n        <!-- If we can't find the configuration cached, it will be loaded -->\r\n        <choose>\r\n            <when condition=\"@(context.Variables.ContainsKey(\"oaClusters\") == false)\">\r\n                <set-variable name=\"oaClusters\" value=\"@{\r\n                        // route is an Azure Document Intelligence endpoint\r\n                        JArray routes = new JArray();\r\n\r\n                        // cluster is a group of routes that are capable of serving a specific model name\r\n                        JArray clusters = new JArray();\r\n\r\n                        // Update the below if condition when using multiple APIM gateway regions/SHGW to get different configurations for each region\r\n                        if(context.Deployment.Region == \"ALL\" || true)\r\n                        {\r\n                            // Adding all Azure Document Intelligence endpoints routes (which are set as APIM Backend)\r\n                            routes.Add(new JObject()\r\n                            {\r\n                                { \"name\", \"Doc-Intelligence-EUS\" },\r\n                                { \"location\", \"East US\" },\r\n                                { \"backend-id\", \"REPLACE-BACKEND-ID\" },\r\n                                { \"priority\", 1},\r\n                                { \"isThrottling\", false }, \r\n                                { \"retryAfter\", DateTime.MinValue } \r\n                            });\r\n\r\n                            // For each model, create a cluster with the routes that can serve it\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-read\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-layout\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-healthInsuranceCard.us\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-invoice\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-receipt\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n\r\n                            clusters.Add(new JObject()\r\n                            {\r\n                                { \"deploymentName\", \"prebuilt-idDocument\" },\r\n                                { \"routes\", new JArray(routes[0]) }\r\n                            });\r\n                        }\r\n                        else\r\n                        {\r\n                            //No clusters found for selected region, either return error (default behavior) or set default cluster in the else section\r\n                        }\r\n                        \r\n                        return clusters;   \r\n                    }\" />\r\n                <!-- Add cluster configurations to cache -->\r\n                <cache-store-value key=\"@((string)context.Variables.GetValueOrDefault<string>(\"oaClustersCacheKey\", \"ALL-DOCINTELL\"))\" value=\"@((JArray)context.Variables[\"oaClusters\"])\" duration=\"86400\" />\r\n            </when>\r\n        </choose>\r\n        <include-fragment fragment-id=\"validate-routes\" />\r\n        <authentication-managed-identity resource=\"{{cognitiveServicesAudience}}\" output-token-variable-name=\"msi-access-token\" client-id=\"{{uami-client-id}}\" ignore-error=\"false\" />\r\n        <set-header name=\"Authorization\" exists-action=\"override\">\r\n            <value>@(\"Bearer \" + (string)context.Variables[\"msi-access-token\"])</value>\r\n        </set-header>\r\n    </inbound>\r\n    <backend>\r\n        <include-fragment fragment-id=\"backend-routing\" />\r\n    </backend>\r\n    <outbound>\r\n        <base />\r\n        <set-variable name=\"idPrefix\" value=\"doc-Intel\" />\r\n        <set-variable name=\"targetService\" value=\"AI-Document-Intelligence\" />\r\n        <set-variable name=\"model\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-Document-Intelligence-Model\"))\" />\r\n        <set-variable name=\"deploymentName\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-DOCUMENT-INTELLIGENCE\"))\" />\r\n\r\n        <!-- Store original response body -->\r\n        <set-variable name=\"responseBody\" value=\"@(context.Response.Body.As<string>())\" />\r\n\r\n        <!-- Attempt to parse JSON and set variables -->\r\n        <set-variable name=\"isValidJson\" value=\"@{\r\n            try \r\n            {\r\n                var responseJson = JObject.Parse((string)context.Variables[\"responseBody\"]);\r\n                return true;\r\n            }\r\n            catch\r\n            {\r\n                return false;\r\n            }\r\n        }\" />\r\n\r\n        <choose>\r\n            <when condition=\"@((bool)context.Variables[\"isValidJson\"])\">\r\n                <set-variable name=\"numberOfPages\" value=\"@{\r\n                    try \r\n                    {\r\n                        var parsedBody = (JObject)context.Variables[\"parsedBody\"];\r\n                        var pages = parsedBody.SelectToken(\"analyzeResult.pages\");\r\n                        return pages != null ? pages.Count() : 1;\r\n                    }\r\n                    catch\r\n                    {\r\n                        return 1;\r\n                    }\r\n                }\" />\r\n\r\n                <set-variable name=\"modelId\" value=\"@{\r\n                    try \r\n                    {\r\n                        var parsedBody = (JObject)context.Variables[\"parsedBody\"];\r\n                        var modelId = parsedBody.SelectToken(\"analyzeResult.modelId\");\r\n                        return modelId != null ? modelId.ToString() : \"Document-Intelligence\";\r\n                    }\r\n                    catch\r\n                    {\r\n                        return \"Document-Intelligence\";\r\n                    }\r\n                }\" />\r\n            </when>\r\n        </choose>\r\n\r\n        <!-- Add dynamic header transformation -->\r\n        <set-header name=\"operation-location\" exists-action=\"override\">\r\n            <value>@{\r\n                var originalLocation = context.Response.Headers.GetValueOrDefault(\"operation-location\",\"\");\r\n                if (!string.IsNullOrEmpty(originalLocation)) {\r\n                    var uri = new Uri(originalLocation);\r\n                    return originalLocation.Replace(\r\n                        uri.Host,\r\n                        context.Request.OriginalUrl.Host\r\n                    );\r\n                }\r\n                return originalLocation;\r\n            }</value>\r\n        </set-header>\r\n\r\n        <include-fragment fragment-id=\"ai-usage\" />\r\n\r\n        <!-- Return response body -->\r\n        <set-body>@((string)context.Variables[\"responseBody\"])</set-body>\r\n    </outbound>\r\n    <on-error>\r\n        <base />\r\n        <set-variable name=\"service-name\" value=\"Azure Document Intelligence\" />\r\n        <set-variable name=\"target-deployment\" value=\"@((string)context.Variables.GetValueOrDefault<string>(\"deployment-id\", \"AI-Document-Intelligence-Model\"))\" />\r\n        \r\n        <!-- <include-fragment fragment-id=\"throttling-events\" /> -->\r\n    </on-error>\r\n</policies>",
            "$fxv#9": "openapi: 3.0.1\r\ninfo:\r\n  title: Azure Document Intelligence\r\n  description: 'Extracts content, layout, and structured data from documents.'\r\n  version: '1.0'\r\nservers:\r\n  - url: https://REPLACED-BY-POLICY/documentintelligence\r\npaths:\r\n  /documentClassifiers:\r\n    get:\r\n      summary: DocumentClassifiers_ListClassifiers\r\n      description: List all document classifiers.\r\n      operationId: DocumentClassifiers_ListClassifiers\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/PagedDocumentClassifierDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentClassifiers/{classifierId}':\r\n    get:\r\n      summary: DocumentClassifiers_GetClassifier\r\n      description: Gets detailed document classifier information.\r\n      operationId: DocumentClassifiers_GetClassifier\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentClassifierDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n    delete:\r\n      summary: DocumentClassifiers_DeleteClassifier\r\n      description: Deletes document classifier.\r\n      operationId: DocumentClassifiers_DeleteClassifier\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '204':\r\n          description: 'There is no content to send for this request, but the headers may be useful. '\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentClassifiers/{classifierId}:analyze':\r\n    post:\r\n      summary: DocumentClassifiers_ClassifyDocumentFromStream\r\n      description: \"Classifies document with document classifier. This operation can be used in two ways:\\n1. With a binary document stream in the request body (current endpoint)\\n2. With a ClassifyDocumentRequest object containing URL or base64-encoded document (add '_overload=classifyDocument' query parameter)\"\r\n      operationId: DocumentClassifiers_ClassifyDocumentFromStream\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\r\n        - $ref: '#/components/parameters/SplitParameter'\r\n        - $ref: '#/components/parameters/PagesParameter'\r\n        - name: _overload\r\n          in: query\r\n          description: Optional parameter to specify the operation variant. Use 'classifyDocument' for URL or base64 encoded document input.\r\n          schema:\r\n            enum:\r\n              - classifyDocument\r\n            type: string\r\n      requestBody:\r\n        description: Input content. Can be either a binary document stream or a ClassifyDocumentRequest object depending on the _overload parameter.\r\n        content:\r\n          application/octet-stream:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/pdf:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/jpeg:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/png:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/tiff:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/bmp:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          image/heif:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          text/html:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/vnd.openxmlformats-officedocument.wordprocessingml.document:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/vnd.openxmlformats-officedocument.presentationml.presentation:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of AnalyzeOperation\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentClassifiers/{classifierId}:copyTo':\r\n    post:\r\n      summary: DocumentClassifiers_CopyClassifierTo\r\n      description: 'Copies document classifier to the target resource, region, and classifierId.'\r\n      operationId: DocumentClassifiers_CopyClassifierTo\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Copy to request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/ClassifierCopyAuthorization'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentClassifierCopyToOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentClassifiers/{classifierId}/analyzeResults/{resultId}':\r\n    get:\r\n      summary: DocumentClassifiers_GetClassifyResult\r\n      description: Gets the result of document classifier.\r\n      operationId: DocumentClassifiers_GetClassifyResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ClassifierIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/AnalyzeOperation'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentClassifiers:authorizeCopy:\r\n    post:\r\n      summary: DocumentClassifiers_AuthorizeClassifierCopy\r\n      description: \"Generates authorization to copy a document classifier to this location with\\nspecified classifierId and optional description.\"\r\n      operationId: DocumentClassifiers_AuthorizeClassifierCopy\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Authorize copy request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/AuthorizeClassifierCopyRequest'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/ClassifierCopyAuthorization'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentClassifiers:build:\r\n    post:\r\n      summary: DocumentClassifiers_BuildClassifier\r\n      description: Builds a custom document classifier.\r\n      operationId: DocumentClassifiers_BuildClassifier\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Build request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/BuildDocumentClassifierRequest'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentClassifierBuildOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentModels:\r\n    get:\r\n      summary: DocumentModels_ListModels\r\n      description: List all document models\r\n      operationId: DocumentModels_ListModels\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/PagedDocumentModelDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}:analyze':\r\n    post:\r\n      summary: DocumentModels_AnalyzeDocument\r\n      description: \"Analyzes document with document model. This operation can be used in two ways:\\n1. With a binary document stream in the request body (when _overload is not specified)\\n2. With an AnalyzeDocumentRequest object containing URL or base64-encoded document (add '_overload=analyzeDocument' query parameter)\"\r\n      operationId: DocumentModels_AnalyzeDocument\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/PagesParameter'\r\n        - $ref: '#/components/parameters/LocaleParameter'\r\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\r\n        - $ref: '#/components/parameters/FeaturesParameter'\r\n        - $ref: '#/components/parameters/QueryFieldsParameter'\r\n        - $ref: '#/components/parameters/OutputContentFormatParameter'\r\n        - $ref: '#/components/parameters/OutputParameter'\r\n        - name: _overload\r\n          in: query\r\n          description: Optional parameter to specify the operation variant. Use 'analyzeDocument' for URL or base64 encoded document input.\r\n          schema:\r\n            enum:\r\n              - analyzeDocument\r\n            type: string\r\n      requestBody:\r\n        description: Input content. Can be either a binary document stream or an AnalyzeDocumentRequest object depending on the _overload parameter.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/Input'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of AnalyzeOperation\r\n              schema:\r\n                type: string\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}:analyzeBatch':\r\n    post:\r\n      summary: DocumentModels_AnalyzeBatchDocuments\r\n      description: Analyzes batch documents with document model.\r\n      operationId: DocumentModels_AnalyzeBatchDocuments\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/PagesParameter'\r\n        - $ref: '#/components/parameters/LocaleParameter'\r\n        - $ref: '#/components/parameters/StringIndexTypeParameter'\r\n        - $ref: '#/components/parameters/FeaturesParameter'\r\n        - $ref: '#/components/parameters/QueryFieldsParameter'\r\n        - $ref: '#/components/parameters/OutputContentFormatParameter'\r\n        - $ref: '#/components/parameters/OutputParameter'\r\n      requestBody:\r\n        description: Analyze batch request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/AnalyzeBatchDocumentsRequest'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of AnalyzeBatchOperation\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}':\r\n    get:\r\n      summary: DocumentModels_GetModel\r\n      description: Gets detailed document model information.\r\n      operationId: DocumentModels_GetModel\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n    delete:\r\n      summary: DocumentModels_DeleteModel\r\n      description: Deletes document model.\r\n      operationId: DocumentModels_DeleteModel\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '204':\r\n          description: 'There is no content to send for this request, but the headers may be useful. '\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}:copyTo':\r\n    post:\r\n      summary: DocumentModels_CopyModelTo\r\n      description: 'Copies document model to the target resource, region, and modelId.'\r\n      operationId: DocumentModels_CopyModelTo\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Copy to request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/ModelCopyAuthorization'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentModelCopyToOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeBatchResults':\r\n    get:\r\n      summary: DocumentModels_ListAnalyzeBatchResults\r\n      description: List batch document analysis results.\r\n      operationId: DocumentModels_ListAnalyzeBatchResults\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/PagedAnalyzeBatchOperation'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeBatchResults/{resultId}':\r\n    get:\r\n      summary: DocumentModels_GetAnalyzeBatchResult\r\n      description: Gets the result of batch document analysis.\r\n      operationId: DocumentModels_GetAnalyzeBatchResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/AnalyzeBatchOperation'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n    delete:\r\n      summary: DocumentModels_DeleteAnalyzeBatchResult\r\n      description: Mark the batch document analysis result for deletion.\r\n      operationId: DocumentModels_DeleteAnalyzeBatchResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '204':\r\n          description: 'There is no content to send for this request, but the headers may be useful.'\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeResults/{resultId}':\r\n    get:\r\n      summary: DocumentModels_GetAnalyzeResult\r\n      description: Gets the result of document analysis.\r\n      operationId: DocumentModels_GetAnalyzeResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/AnalyzeOperation'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n    delete:\r\n      summary: DocumentModels_DeleteAnalyzeResult\r\n      description: Mark the result of document analysis for deletion.\r\n      operationId: DocumentModels_DeleteAnalyzeResult\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '204':\r\n          description: 'There is no content to send for this request, but the headers may be useful.'\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeResults/{resultId}/figures/{figureId}':\r\n    get:\r\n      summary: DocumentModels_GetAnalyzeResultFigure\r\n      description: Gets the generated cropped image of specified figure from document analysis.\r\n      operationId: DocumentModels_GetAnalyzeResultFigure\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/FigureIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            image/png:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ImagePngResp'\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ApplicationJ'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/documentModels/{modelId}/analyzeResults/{resultId}/pdf':\r\n    get:\r\n      summary: DocumentModels_GetAnalyzeResultPdf\r\n      description: Gets the generated searchable PDF output from document analysis.\r\n      operationId: DocumentModels_GetAnalyzeResultPdf\r\n      parameters:\r\n        - $ref: '#/components/parameters/ModelIdParameter'\r\n        - $ref: '#/components/parameters/ResultIdParameter'\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/pdf:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationPdfResponse'\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationJsonResponse'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentModels:authorizeCopy:\r\n    post:\r\n      summary: DocumentModels_AuthorizeModelCopy\r\n      description: \"Generates authorization to copy a document model to this location with\\nspecified modelId and optional description.\"\r\n      operationId: DocumentModels_AuthorizeModelCopy\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Authorize copy request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/AuthorizeCopyRequest'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/ModelCopyAuthorization'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentModels:build:\r\n    post:\r\n      summary: DocumentModels_BuildModel\r\n      description: Builds a custom document analysis model.\r\n      operationId: DocumentModels_BuildModel\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Build request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/BuildDocumentModelRequest'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentModelBuildOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /documentModels:compose:\r\n    post:\r\n      summary: DocumentModels_ComposeModel\r\n      description: Creates a new document model from document types of existing document models.\r\n      operationId: DocumentModels_ComposeModel\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      requestBody:\r\n        description: Compose request parameters.\r\n        content:\r\n          application/json:\r\n            schema:\r\n              $ref: '#/components/schemas/ComposeDocumentModelRequest'\r\n      responses:\r\n        '202':\r\n          description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n          headers:\r\n            Operation-Location:\r\n              description: The location of an instance of DocumentModelComposeOperationDetails\r\n              schema:\r\n                type: string\r\n                format: uri\r\n            Retry-After:\r\n              description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n              schema:\r\n                type: integer\r\n                format: int32\r\n          content:\r\n            application/json: { }\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /info:\r\n    get:\r\n      summary: MiscellaneousOperations_GetResourceDetails\r\n      description: Return information about the current resource.\r\n      operationId: MiscellaneousOperations_GetResourceDetails\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentIntelligenceResourceDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  /operations:\r\n    get:\r\n      summary: MiscellaneousOperations_ListOperations\r\n      description: Lists all operations.\r\n      operationId: MiscellaneousOperations_ListOperations\r\n      parameters:\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/PagedDocumentIntelligenceOperationDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\n  '/operations/{operationId}':\r\n    get:\r\n      summary: MiscellaneousOperations_GetOperation\r\n      description: \"Gets operation info. Different operation types can be retrieved:\\n1. General operation: no _overload parameter needed\\n2. Document Model Build operation: use _overload=getDocumentModelBuildOperation\\n3. Document Model Compose operation: use _overload=getDocumentModelComposeOperation\\n4. Document Model Copy To operation: use _overload=getDocumentModelCopyToOperation\\n5. Document Classifier Copy To operation: use _overload=getDocumentClassifierCopyToOperation\\n6. Document Classifier Build operation: use _overload=getDocumentClassifierBuildOperation\"\r\n      operationId: MiscellaneousOperations_GetOperation\r\n      parameters:\r\n        - name: operationId\r\n          in: path\r\n          description: Operation ID\r\n          required: true\r\n          schema:\r\n            type: string\r\n        - $ref: '#/components/parameters/ApiVersionParameter'\r\n        - name: _overload\r\n          in: query\r\n          description: Optional parameter to specify the operation type to retrieve.\r\n          schema:\r\n            enum:\r\n              - getOperation\r\n              - getDocumentModelBuildOperation\r\n              - getDocumentModelComposeOperation\r\n              - getDocumentModelCopyToOperation\r\n              - getDocumentClassifierCopyToOperation\r\n              - getDocumentClassifierBuildOperation\r\n            type: string\r\n        - $ref: '#/components/parameters/ClientRequestIdParameter'\r\n      responses:\r\n        '200':\r\n          description: The request has succeeded.\r\n          headers:\r\n            x-ms-client-request-id:\r\n              $ref: '#/components/headers/ClientRequestIdHeader'\r\n          content:\r\n            application/json:\r\n              schema:\r\n                $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n        '500':\r\n          $ref: '#/components/responses/ErrorResponse'\r\ncomponents:\r\n  parameters:\r\n    ApiVersionParameter:\r\n      name: api-version\r\n      in: query\r\n      description: The API version to use for this operation.\r\n      required: true\r\n      schema:\r\n        minLength: 1\r\n        type: string\r\n    ClientRequestIdParameter:\r\n      name: x-ms-client-request-id\r\n      in: header\r\n      description: 'An opaque, globally-unique, client-generated string identifier for the request.'\r\n      schema:\r\n        type: string\r\n        format: uuid\r\n    ClassifierIdParameter:\r\n      name: classifierId\r\n      in: path\r\n      description: Unique document classifier name.\r\n      required: true\r\n      schema:\r\n        maxLength: 64\r\n        pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n        type: string\r\n    ModelIdParameter:\r\n      name: modelId\r\n      in: path\r\n      description: Unique document model name.\r\n      required: true\r\n      schema:\r\n        maxLength: 64\r\n        pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n        type: string\r\n    ResultIdParameter:\r\n      name: resultId\r\n      in: path\r\n      description: Operation result ID.\r\n      required: true\r\n      schema:\r\n        type: string\r\n        format: uuid\r\n    PagesParameter:\r\n      name: pages\r\n      in: query\r\n      description: '1-based page numbers to analyze. Ex. \"1-3,5,7-9\"'\r\n      schema:\r\n        pattern: '^(\\d+(-\\d+)?)(,\\s*(\\d+(-\\d+)?))*$'\r\n        type: string\r\n    StringIndexTypeParameter:\r\n      name: stringIndexType\r\n      in: query\r\n      description: Method used to compute string offset and length.\r\n      schema:\r\n        enum:\r\n          - textElements\r\n          - unicodeCodePoint\r\n          - utf16CodeUnit\r\n        type: string\r\n        default: textElements\r\n    SplitParameter:\r\n      name: split\r\n      in: query\r\n      description: Document splitting mode.\r\n      schema:\r\n        enum:\r\n          - auto\r\n          - none\r\n          - perPage\r\n        type: string\r\n        default: none\r\n    LocaleParameter:\r\n      name: locale\r\n      in: query\r\n      description: \"Locale hint for text recognition and document analysis.  Value may contain only\\nthe language code (ex. \\\"en\\\", \\\"fr\\\") or BCP 47 language tag (ex. \\\"en-US\\\").\"\r\n      schema:\r\n        type: string\r\n    FeaturesParameter:\r\n      name: features\r\n      in: query\r\n      description: List of optional analysis features.\r\n      schema:\r\n        type: array\r\n        items:\r\n          enum:\r\n            - ocrHighResolution\r\n            - languages\r\n            - barcodes\r\n            - formulas\r\n            - keyValuePairs\r\n            - styleFont\r\n            - queryFields\r\n          type: string\r\n          x-ms-enum:\r\n            name: DocumentAnalysisFeature\r\n            modelAsString: true\r\n            values:\r\n              - name: ocrHighResolution\r\n                value: ocrHighResolution\r\n                description: Perform OCR at a higher resolution to handle documents with fine print.\r\n              - name: languages\r\n                value: languages\r\n                description: Enable the detection of the text content language.\r\n              - name: barcodes\r\n                value: barcodes\r\n                description: Enable the detection of barcodes in the document.\r\n              - name: formulas\r\n                value: formulas\r\n                description: Enable the detection of mathematical expressions in the document.\r\n              - name: keyValuePairs\r\n                value: keyValuePairs\r\n                description: Enable the detection of general key value pairs (form fields) in the document.\r\n              - name: styleFont\r\n                value: styleFont\r\n                description: Enable the recognition of various font styles.\r\n              - name: queryFields\r\n                value: queryFields\r\n                description: Enable the extraction of additional fields via the queryFields query parameter.\r\n    QueryFieldsParameter:\r\n      name: queryFields\r\n      in: query\r\n      description: 'List of additional fields to extract.  Ex. \"NumberOfGuests,StoreNumber\"'\r\n      schema:\r\n        type: array\r\n        items:\r\n          type: string\r\n    OutputContentFormatParameter:\r\n      name: outputContentFormat\r\n      in: query\r\n      description: Format of the analyze result top-level content.\r\n      schema:\r\n        enum:\r\n          - text\r\n          - markdown\r\n        type: string\r\n        default: text\r\n    OutputParameter:\r\n      name: output\r\n      in: query\r\n      description: Additional outputs to generate during analysis.\r\n      schema:\r\n        type: array\r\n        items:\r\n          enum:\r\n            - pdf\r\n            - figures\r\n          type: string\r\n          x-ms-enum:\r\n            name: AnalyzeOutputOption\r\n            modelAsString: true\r\n            values:\r\n              - name: pdf\r\n                value: pdf\r\n                description: Generate searchable PDF output.\r\n              - name: figures\r\n                value: figures\r\n                description: Generate cropped images of detected figures.\r\n    FigureIdParameter:\r\n      name: figureId\r\n      in: path\r\n      description: Figure ID.\r\n      required: true\r\n      schema:\r\n        type: string\r\n  headers:\r\n    ClientRequestIdHeader:\r\n      description: 'An opaque, globally-unique, client-generated string identifier for the request.'\r\n      schema:\r\n        type: string\r\n        format: uuid\r\n  responses:\r\n    ErrorResponse:\r\n      description: An unexpected error response.\r\n      content:\r\n        application/json:\r\n          schema:\r\n            $ref: '#/components/schemas/DocumentIntelligenceErrorResponse'\r\n    NoContentResponse:\r\n      description: 'There is no content to send for this request, but the headers may be useful.'\r\n      headers:\r\n        x-ms-client-request-id:\r\n          $ref: '#/components/headers/ClientRequestIdHeader'\r\n      content:\r\n        application/json: {}\r\n    AcceptedResponse:\r\n      description: 'The request has been accepted for processing, but processing has not yet completed.'\r\n      headers:\r\n        Operation-Location:\r\n          description: The location of an instance of the operation\r\n          schema:\r\n            type: string\r\n            format: uri\r\n        Retry-After:\r\n          description: The Retry-After header can indicate how long the client should wait before polling the operation status.\r\n          schema:\r\n            type: integer\r\n            format: int32\r\n      content:\r\n        application/json: {}\r\n  schemas:\r\n    AddressValue:\r\n      type: object\r\n      properties:\r\n        houseNumber:\r\n          type: string\r\n          description: House or building number.\r\n        poBox:\r\n          type: string\r\n          description: Post office box number.\r\n        road:\r\n          type: string\r\n          description: Street name.\r\n        city:\r\n          type: string\r\n          description: 'Name of city, town, village, etc.'\r\n        state:\r\n          type: string\r\n          description: First-level administrative division.\r\n        postalCode:\r\n          type: string\r\n          description: Postal code used for mail sorting.\r\n        countryRegion:\r\n          type: string\r\n          description: Country/region.\r\n        streetAddress:\r\n          type: string\r\n          description: 'Street-level address, excluding city, state, countryRegion, and postalCode.'\r\n        unit:\r\n          type: string\r\n          description: Apartment or office number\r\n        cityDistrict:\r\n          type: string\r\n          description: \"Districts or boroughs within a city, such as Brooklyn in New York City or City\\nof Westminster in London.\"\r\n        stateDistrict:\r\n          type: string\r\n          description: Second-level administrative division used in certain locales.\r\n        suburb:\r\n          type: string\r\n          description: 'Unofficial neighborhood name, like Chinatown.'\r\n        house:\r\n          type: string\r\n          description: 'Build name, such as World Trade Center.'\r\n        level:\r\n          type: string\r\n          description: 'Floor number, such as 3F.'\r\n      description: Address field value.\r\n    AnalyzeBatchDocumentsRequest:\r\n      required:\r\n        - resultContainerUrl\r\n      type: object\r\n      properties:\r\n        azureBlobSource:\r\n          $ref: '#/components/schemas/AzureBlobContentSource'\r\n        azureBlobFileListSource:\r\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\r\n        resultContainerUrl:\r\n          type: string\r\n          description: Azure Blob Storage container URL where analyze result files will be stored.\r\n          format: uri\r\n        resultPrefix:\r\n          type: string\r\n          description: Blob name prefix of result files.\r\n        overwriteExisting:\r\n          type: boolean\r\n          description: Overwrite existing analyze result files?\r\n          default: false\r\n      description: Batch document analysis parameters.\r\n    AnalyzeBatchOperation:\r\n      required:\r\n        - status\r\n        - createdDateTime\r\n        - lastUpdatedDateTime\r\n      type: object\r\n      properties:\r\n        resultId:\r\n          $ref: '#/components/schemas/Azure.Core.uuid'\r\n        status:\r\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the operation was submitted.\r\n          format: date-time\r\n        lastUpdatedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the status was last updated.\r\n          format: date-time\r\n        percentCompleted:\r\n          maximum: 100\r\n          minimum: 0\r\n          type: integer\r\n          description: Operation progress (0-100).\r\n          format: int32\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n        result:\r\n          $ref: '#/components/schemas/AnalyzeBatchResult'\r\n      description: Status and result of the analyze batch operation.\r\n    AnalyzeBatchOperationDetail:\r\n      required:\r\n        - status\r\n        - sourceUrl\r\n      type: object\r\n      properties:\r\n        status:\r\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\r\n        sourceUrl:\r\n          type: string\r\n          description: URL of the source document.\r\n          format: uri\r\n        resultUrl:\r\n          type: string\r\n          description: URL of the analyze result JSON.\r\n          format: uri\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n      description: Operation detail for a document in a batch analysis.\r\n    AnalyzeBatchResult:\r\n      required:\r\n        - succeededCount\r\n        - failedCount\r\n        - skippedCount\r\n      type: object\r\n      properties:\r\n        succeededCount:\r\n          type: integer\r\n          description: Number of documents that completed with status succeeded.\r\n          format: int32\r\n        failedCount:\r\n          type: integer\r\n          description: Number of documents that completed with status failed.\r\n          format: int32\r\n        skippedCount:\r\n          type: integer\r\n          description: Number of documents that completed with status skipped.\r\n          format: int32\r\n        details:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/AnalyzeBatchOperationDetail'\r\n          description: Operation detail for each document in the batch.\r\n          x-ms-identifiers: [ ]\r\n      description: Batch document analysis result.\r\n    AnalyzeDocumentRequest:\r\n      type: object\r\n      properties:\r\n        urlSource:\r\n          type: string\r\n          description: Document URL to analyze.  Either urlSource or base64Source must be specified.\r\n          format: uri\r\n        base64Source:\r\n          type: string\r\n          description: \"Base64 encoding of the document to analyze.  Either urlSource or base64Source\\nmust be specified.\"\r\n          format: byte\r\n      description: Document analysis parameters.\r\n    AnalyzeOperation:\r\n      required:\r\n        - status\r\n        - createdDateTime\r\n        - lastUpdatedDateTime\r\n      type: object\r\n      properties:\r\n        status:\r\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the analyze operation was submitted.\r\n          format: date-time\r\n        lastUpdatedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the status was last updated.\r\n          format: date-time\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n        analyzeResult:\r\n          $ref: '#/components/schemas/AnalyzeResult'\r\n      description: Status and result of the analyze operation.\r\n    AnalyzeResult:\r\n      required:\r\n        - apiVersion\r\n        - modelId\r\n        - stringIndexType\r\n        - content\r\n        - pages\r\n      type: object\r\n      properties:\r\n        apiVersion:\r\n          type: string\r\n          description: API version used to produce this result.\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Document model ID used to produce this result.\r\n        stringIndexType:\r\n          $ref: '#/components/schemas/StringIndexType'\r\n        contentFormat:\r\n          $ref: '#/components/schemas/DocumentContentFormat'\r\n        content:\r\n          type: string\r\n          description: \"Concatenate string representation of all textual and visual elements in reading\\norder.\"\r\n        pages:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentPage'\r\n          description: Analyzed pages.\r\n          x-ms-identifiers: [ ]\r\n        paragraphs:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentParagraph'\r\n          description: Extracted paragraphs.\r\n          x-ms-identifiers: [ ]\r\n        tables:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentTable'\r\n          description: Extracted tables.\r\n          x-ms-identifiers: [ ]\r\n        figures:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentFigure'\r\n          description: Extracted figures.\r\n        sections:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSection'\r\n          description: Extracted sections.\r\n          x-ms-identifiers: [ ]\r\n        keyValuePairs:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentKeyValuePair'\r\n          description: Extracted key-value pairs.\r\n          x-ms-identifiers: [ ]\r\n        styles:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentStyle'\r\n          description: Extracted font styles.\r\n          x-ms-identifiers: [ ]\r\n        languages:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentLanguage'\r\n          description: Detected languages.\r\n          x-ms-identifiers: [ ]\r\n        documents:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/AnalyzedDocument'\r\n          description: Extracted documents.\r\n          x-ms-identifiers: [ ]\r\n        warnings:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\r\n          description: List of warnings encountered.\r\n          x-ms-identifiers: [ ]\r\n      description: Document analysis result.\r\n    AnalyzedDocument:\r\n      required:\r\n        - docType\r\n        - spans\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        docType:\r\n          maxLength: 64\r\n          minLength: 2\r\n          type: string\r\n          description: Document type.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the document.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the document in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        fields:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentField'\r\n          description: Dictionary of named field values.\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the document.\r\n          format: float\r\n      description: An object describing the location and semantic content of a document.\r\n    AuthorizeClassifierCopyRequest:\r\n      required:\r\n        - classifierId\r\n      type: object\r\n      properties:\r\n        classifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document classifier name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document classifier description.\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document classifier.\r\n      description: Request body to authorize document classifier copy.\r\n    AuthorizeCopyRequest:\r\n      required:\r\n        - modelId\r\n      type: object\r\n      properties:\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document model name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n      description: Request body to authorize document model copy.\r\n    Azure.Core.uuid:\r\n      type: string\r\n      description: Universally Unique Identifier\r\n      format: uuid\r\n    AzureBlobContentSource:\r\n      required:\r\n        - containerUrl\r\n      type: object\r\n      properties:\r\n        containerUrl:\r\n          type: string\r\n          description: Azure Blob Storage container URL.\r\n          format: uri\r\n        prefix:\r\n          type: string\r\n          description: Blob name prefix.\r\n      description: Azure Blob Storage content.\r\n    AzureBlobFileListContentSource:\r\n      required:\r\n        - containerUrl\r\n        - fileList\r\n      type: object\r\n      properties:\r\n        containerUrl:\r\n          type: string\r\n          description: Azure Blob Storage container URL.\r\n          format: uri\r\n        fileList:\r\n          type: string\r\n          description: Path to a JSONL file within the container specifying a subset of documents.\r\n      description: File list in Azure Blob Storage.\r\n    BoundingRegion:\r\n      required:\r\n        - pageNumber\r\n        - polygon\r\n      type: object\r\n      properties:\r\n        pageNumber:\r\n          minimum: 1\r\n          type: integer\r\n          description: 1-based page number of page containing the bounding region.\r\n          format: int32\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon on the page, or the entire page if not specified.\\nCoordinates specified relative to the top-left of the page. The numbers\\nrepresent the x, y values of the polygon vertices, clockwise from the left\\n(-180 degrees inclusive) relative to the element orientation.\"\r\n      description: Bounding polygon on a specific page of the input.\r\n    BuildDocumentClassifierRequest:\r\n      required:\r\n        - classifierId\r\n        - docTypes\r\n      type: object\r\n      properties:\r\n        classifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document classifier name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document classifier description.\r\n        baseClassifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Base classifierId on top of which to train the classifier.\r\n        docTypes:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/ClassifierDocumentTypeDetails'\r\n          description: List of document types to classify against.\r\n        allowOverwrite:\r\n          type: boolean\r\n          description: Allow overwriting an existing classifier with the same name.\r\n          default: false\r\n      description: Request body to build a new custom document classifier.\r\n    BuildDocumentModelRequest:\r\n      required:\r\n        - modelId\r\n        - buildMode\r\n      type: object\r\n      properties:\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document model name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        buildMode:\r\n          $ref: '#/components/schemas/DocumentBuildMode'\r\n        azureBlobSource:\r\n          $ref: '#/components/schemas/AzureBlobContentSource'\r\n        azureBlobFileListSource:\r\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n        maxTrainingHours:\r\n          type: number\r\n          description: Max number of V100-equivalent GPU hours to use for model training.  Default=0.5.\r\n          format: float\r\n          default: 0.5\r\n        allowOverwrite:\r\n          type: boolean\r\n          description: Allow overwriting an existing model with the same name.\r\n          default: false\r\n      description: Request body to build a new custom document model.\r\n    ClassifierCopyAuthorization:\r\n      required:\r\n        - targetResourceId\r\n        - targetResourceRegion\r\n        - targetClassifierId\r\n        - targetClassifierLocation\r\n        - accessToken\r\n        - expirationDateTime\r\n      type: object\r\n      properties:\r\n        targetResourceId:\r\n          type: string\r\n          description: ID of the target Azure resource where the document classifier should be copied to.\r\n        targetResourceRegion:\r\n          type: string\r\n          description: \"Location of the target Azure resource where the document classifier should be copied\\nto.\"\r\n        targetClassifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Identifier of the target document classifier.\r\n        targetClassifierLocation:\r\n          type: string\r\n          description: URL of the copied document classifier in the target account.\r\n          format: uri\r\n        accessToken:\r\n          type: string\r\n          description: Token used to authorize the request.\r\n        expirationDateTime:\r\n          type: string\r\n          description: Date/time when the access token expires.\r\n          format: date-time\r\n      description: \"Authorization to copy a document classifier to the specified target resource and\\nclassifierId.\"\r\n    ClassifierDocumentTypeDetails:\r\n      type: object\r\n      properties:\r\n        sourceKind:\r\n          $ref: '#/components/schemas/ContentSourceKind'\r\n        azureBlobSource:\r\n          $ref: '#/components/schemas/AzureBlobContentSource'\r\n        azureBlobFileListSource:\r\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\r\n      description: Classifier document type info.\r\n    ClassifyDocumentRequest:\r\n      type: object\r\n      properties:\r\n        urlSource:\r\n          type: string\r\n          description: Document URL to classify.  Either urlSource or base64Source must be specified.\r\n          format: uri\r\n        base64Source:\r\n          type: string\r\n          description: \"Base64 encoding of the document to classify.  Either urlSource or base64Source\\nmust be specified.\"\r\n          format: byte\r\n      description: Document classification parameters.\r\n    ComposeDocumentModelRequest:\r\n      required:\r\n        - modelId\r\n        - classifierId\r\n        - docTypes\r\n      type: object\r\n      properties:\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document model name.\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        classifierId:\r\n          type: string\r\n          description: Custom classifier to split and classify the input file.\r\n        split:\r\n          enum:\r\n            - auto\r\n            - none\r\n            - perPage\r\n          type: string\r\n          description: File splitting behavior.\r\n          default: none\r\n          x-ms-enum:\r\n            name: SplitMode\r\n            modelAsString: true\r\n            values:\r\n              - name: auto\r\n                value: auto\r\n                description: Automatically split file into documents.\r\n              - name: none\r\n                value: none\r\n                description: Treat the entire file as a single document.\r\n              - name: perPage\r\n                value: perPage\r\n                description: Treat each page in the file as a separate document.\r\n        docTypes:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentTypeDetails'\r\n          description: Dictionary mapping supported docTypes to the corresponding document models.\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n      description: Request body to create a composed document model from component document models.\r\n    ContentSourceKind:\r\n      enum:\r\n        - url\r\n        - base64\r\n        - azureBlob\r\n        - azureBlobFileList\r\n      type: string\r\n      description: Type of content source.\r\n      x-ms-enum:\r\n        name: ContentSourceKind\r\n        modelAsString: true\r\n        values:\r\n          - name: url\r\n            value: url\r\n            description: Content at a specific URL.\r\n          - name: base64\r\n            value: base64\r\n            description: Content represented via Base64 encoding.\r\n          - name: azureBlob\r\n            value: azureBlob\r\n            description: Files in a path within an Azure Blob Storage container.\r\n          - name: azureBlobFileList\r\n            value: azureBlobFileList\r\n            description: A file list specifying individual files in an Azure Blob Storage container.\r\n    CurrencyValue:\r\n      required:\r\n        - amount\r\n      type: object\r\n      properties:\r\n        amount:\r\n          type: number\r\n          description: Currency amount.\r\n          format: double\r\n        currencySymbol:\r\n          type: string\r\n          description: 'Currency symbol label, if any.'\r\n        currencyCode:\r\n          type: string\r\n          description: 'Resolved currency code (ISO 4217), if any.'\r\n      description: Currency field value.\r\n    CustomDocumentModelsDetails:\r\n      required:\r\n        - count\r\n        - limit\r\n      type: object\r\n      properties:\r\n        count:\r\n          type: integer\r\n          description: Number of custom document models in the current resource.\r\n          format: int32\r\n        limit:\r\n          type: integer\r\n          description: Maximum number of custom document models supported in the current resource.\r\n          format: int32\r\n      description: Details regarding custom document models.\r\n    DocumentAnalysisFeature:\r\n      enum:\r\n        - ocrHighResolution\r\n        - languages\r\n        - barcodes\r\n        - formulas\r\n        - keyValuePairs\r\n        - styleFont\r\n        - queryFields\r\n      type: string\r\n      description: Document analysis features to enable.\r\n      x-ms-enum:\r\n        name: DocumentAnalysisFeature\r\n        modelAsString: true\r\n        values:\r\n          - name: ocrHighResolution\r\n            value: ocrHighResolution\r\n            description: Perform OCR at a higher resolution to handle documents with fine print.\r\n          - name: languages\r\n            value: languages\r\n            description: Enable the detection of the text content language.\r\n          - name: barcodes\r\n            value: barcodes\r\n            description: Enable the detection of barcodes in the document.\r\n          - name: formulas\r\n            value: formulas\r\n            description: Enable the detection of mathematical expressions in the document.\r\n          - name: keyValuePairs\r\n            value: keyValuePairs\r\n            description: Enable the detection of general key value pairs (form fields) in the document.\r\n          - name: styleFont\r\n            value: styleFont\r\n            description: Enable the recognition of various font styles.\r\n          - name: queryFields\r\n            value: queryFields\r\n            description: Enable the extraction of additional fields via the queryFields query parameter.\r\n    DocumentBarcode:\r\n      required:\r\n        - kind\r\n        - value\r\n        - span\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        kind:\r\n          $ref: '#/components/schemas/DocumentBarcodeKind'\r\n        value:\r\n          type: string\r\n          description: Barcode value.\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the barcode, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\r\n        span:\r\n          $ref: '#/components/schemas/DocumentSpan'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the barcode.\r\n          format: float\r\n      description: A barcode object.\r\n    DocumentBarcodeKind:\r\n      enum:\r\n        - QRCode\r\n        - PDF417\r\n        - UPCA\r\n        - UPCE\r\n        - Code39\r\n        - Code128\r\n        - EAN8\r\n        - EAN13\r\n        - DataBar\r\n        - Code93\r\n        - Codabar\r\n        - DataBarExpanded\r\n        - ITF\r\n        - MicroQRCode\r\n        - Aztec\r\n        - DataMatrix\r\n        - MaxiCode\r\n      type: string\r\n      description: Barcode kind.\r\n      x-ms-enum:\r\n        name: DocumentBarcodeKind\r\n        modelAsString: true\r\n        values:\r\n          - name: QRCode\r\n            value: QRCode\r\n            description: 'QR code, as defined in ISO/IEC 18004:2015.'\r\n          - name: PDF417\r\n            value: PDF417\r\n            description: 'PDF417, as defined in ISO 15438.'\r\n          - name: UPCA\r\n            value: UPCA\r\n            description: GS1 12-digit Universal Product Code.\r\n          - name: UPCE\r\n            value: UPCE\r\n            description: GS1 6-digit Universal Product Code.\r\n          - name: Code39\r\n            value: Code39\r\n            description: 'Code 39 barcode, as defined in ISO/IEC 16388:2007.'\r\n          - name: Code128\r\n            value: Code128\r\n            description: 'Code 128 barcode, as defined in ISO/IEC 15417:2007.'\r\n          - name: EAN8\r\n            value: EAN8\r\n            description: GS1 8-digit International Article Number (European Article Number).\r\n          - name: EAN13\r\n            value: EAN13\r\n            description: GS1 13-digit International Article Number (European Article Number).\r\n          - name: DataBar\r\n            value: DataBar\r\n            description: GS1 DataBar barcode.\r\n          - name: Code93\r\n            value: Code93\r\n            description: 'Code 93 barcode, as defined in ANSI/AIM BC5-1995.'\r\n          - name: Codabar\r\n            value: Codabar\r\n            description: 'Codabar barcode, as defined in ANSI/AIM BC3-1995.'\r\n          - name: DataBarExpanded\r\n            value: DataBarExpanded\r\n            description: GS1 DataBar Expanded barcode.\r\n          - name: ITF\r\n            value: ITF\r\n            description: 'Interleaved 2 of 5 barcode, as defined in ANSI/AIM BC2-1995.'\r\n          - name: MicroQRCode\r\n            value: MicroQRCode\r\n            description: 'Micro QR code, as defined in ISO/IEC 23941:2022.'\r\n          - name: Aztec\r\n            value: Aztec\r\n            description: 'Aztec code, as defined in ISO/IEC 24778:2008.'\r\n          - name: DataMatrix\r\n            value: DataMatrix\r\n            description: 'Data matrix code, as defined in ISO/IEC 16022:2006.'\r\n          - name: MaxiCode\r\n            value: MaxiCode\r\n            description: 'MaxiCode, as defined in ISO/IEC 16023:2000.'\r\n    DocumentBuildMode:\r\n      enum:\r\n        - template\r\n        - neural\r\n      type: string\r\n      description: Custom document model build mode.\r\n      x-ms-enum:\r\n        name: DocumentBuildMode\r\n        modelAsString: true\r\n        values:\r\n          - name: template\r\n            value: template\r\n            description: Target documents with similar visual templates.\r\n          - name: neural\r\n            value: neural\r\n            description: Support documents with diverse visual templates.\r\n    DocumentCaption:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Content of the caption.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the caption.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the caption in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: Child elements of the caption.\r\n      description: A caption object describing a table or figure.\r\n    DocumentClassifierBuildOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentClassifierDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentClassifierBuild\r\n    DocumentClassifierCopyToOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentClassifierDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentClassifierCopyTo\r\n    DocumentClassifierDetails:\r\n      required:\r\n        - classifierId\r\n        - createdDateTime\r\n        - apiVersion\r\n        - docTypes\r\n      type: object\r\n      properties:\r\n        classifierId:\r\n          maxLength: 64\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document classifier name.\r\n          x-ms-mutability:\r\n            - read\r\n            - create\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document classifier description.\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document classifier was created.\r\n          format: date-time\r\n        expirationDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document classifier will expire.\r\n          format: date-time\r\n        modifiedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document model was last modified.\r\n          format: date-time\r\n          readOnly: true\r\n        apiVersion:\r\n          type: string\r\n          description: API version used to create this document classifier.\r\n        baseClassifierId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Base classifierId on top of which the classifier was trained.\r\n        docTypes:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/ClassifierDocumentTypeDetails'\r\n          description: List of document types to classify against.\r\n        warnings:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\r\n          description: List of warnings encountered while building the classifier.\r\n          x-ms-identifiers: [ ]\r\n      description: Document classifier info.\r\n    DocumentContentFormat:\r\n      enum:\r\n        - text\r\n        - markdown\r\n      type: string\r\n      description: Format of the content in analyzed result.\r\n      x-ms-enum:\r\n        name: DocumentContentFormat\r\n        modelAsString: true\r\n        values:\r\n          - name: text\r\n            value: text\r\n            description: Plain text representation of the document content without any formatting.\r\n          - name: markdown\r\n            value: markdown\r\n            description: \"Markdown representation of the document content with section headings, tables,\\netc.\"\r\n    DocumentElement:\r\n      type: string\r\n      description: \"An JSON pointer referencing an element of the document, such as paragraph,\\ntable, section, etc.\"\r\n    DocumentField:\r\n      required:\r\n        - type\r\n      type: object\r\n      properties:\r\n        type:\r\n          $ref: '#/components/schemas/DocumentFieldType'\r\n        valueString:\r\n          type: string\r\n          description: String value.\r\n        valueDate:\r\n          type: string\r\n          description: Date value in YYYY-MM-DD format (ISO 8601).\r\n          format: date\r\n        valueTime:\r\n          type: string\r\n          description: Time value in hh:mm:ss format (ISO 8601).\r\n          format: time\r\n        valuePhoneNumber:\r\n          type: string\r\n          description: Phone number value in E.164 format (ex. +19876543210).\r\n        valueNumber:\r\n          type: number\r\n          description: Floating point value.\r\n          format: double\r\n        valueInteger:\r\n          type: integer\r\n          description: Integer value.\r\n          format: int64\r\n        valueSelectionMark:\r\n          $ref: '#/components/schemas/DocumentSelectionMarkState'\r\n        valueSignature:\r\n          $ref: '#/components/schemas/DocumentSignatureType'\r\n        valueCountryRegion:\r\n          type: string\r\n          description: 3-letter country code value (ISO 3166-1 alpha-3).\r\n        valueArray:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentField'\r\n          description: Array of field values.\r\n          x-ms-identifiers: [ ]\r\n        valueObject:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentField'\r\n          description: Dictionary of named field values.\r\n        valueCurrency:\r\n          $ref: '#/components/schemas/CurrencyValue'\r\n        valueAddress:\r\n          $ref: '#/components/schemas/AddressValue'\r\n        valueBoolean:\r\n          type: boolean\r\n          description: Boolean value.\r\n        valueSelectionGroup:\r\n          type: array\r\n          items:\r\n            type: string\r\n          description: Selection group value.\r\n        content:\r\n          type: string\r\n          description: Field content.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the field.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the field in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the field.\r\n          format: float\r\n      description: An object representing the content and location of a field value.\r\n    DocumentFieldSchema:\r\n      required:\r\n        - type\r\n      type: object\r\n      properties:\r\n        type:\r\n          $ref: '#/components/schemas/DocumentFieldType'\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Field description.\r\n        example:\r\n          type: string\r\n          description: Example field content.\r\n        items:\r\n          $ref: '#/components/schemas/DocumentFieldSchema'\r\n        properties:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentFieldSchema'\r\n          description: Named sub-fields of the object field.\r\n      description: Description of the field semantic schema using a JSON Schema style syntax.\r\n    DocumentFieldType:\r\n      enum:\r\n        - string\r\n        - date\r\n        - time\r\n        - phoneNumber\r\n        - number\r\n        - integer\r\n        - selectionMark\r\n        - countryRegion\r\n        - signature\r\n        - array\r\n        - object\r\n        - currency\r\n        - address\r\n        - boolean\r\n        - selectionGroup\r\n      type: string\r\n      description: Semantic data type of the field value.\r\n      x-ms-enum:\r\n        name: DocumentFieldType\r\n        modelAsString: true\r\n        values:\r\n          - name: string\r\n            value: string\r\n            description: Plain text.\r\n          - name: date\r\n            value: date\r\n            description: 'Date, normalized to ISO 8601 (YYYY-MM-DD) format.'\r\n          - name: time\r\n            value: time\r\n            description: 'Time, normalized to ISO 8601 (hh:mm:ss) format.'\r\n          - name: phoneNumber\r\n            value: phoneNumber\r\n            description: 'Phone number, normalized to E.164 (+{CountryCode}{SubscriberNumber}) format.'\r\n          - name: number\r\n            value: number\r\n            description: 'Floating point number, normalized to double precision floating point.'\r\n          - name: integer\r\n            value: integer\r\n            description: 'Integer number, normalized to 64-bit signed integer.'\r\n          - name: selectionMark\r\n            value: selectionMark\r\n            description: Is field selected?\r\n          - name: countryRegion\r\n            value: countryRegion\r\n            description: 'Country/region, normalized to ISO 3166-1 alpha-3 format (ex. USA).'\r\n          - name: signature\r\n            value: signature\r\n            description: Is signature present?\r\n          - name: array\r\n            value: array\r\n            description: List of subfields of the same type.\r\n          - name: object\r\n            value: object\r\n            description: Named list of subfields of potentially different types.\r\n          - name: currency\r\n            value: currency\r\n            description: Currency amount with optional currency symbol and unit.\r\n          - name: address\r\n            value: address\r\n            description: Parsed address.\r\n          - name: boolean\r\n            value: boolean\r\n            description: 'Boolean value, normalized to true or false.'\r\n          - name: selectionGroup\r\n            value: selectionGroup\r\n            description: Array of selected string values.\r\n    DocumentFigure:\r\n      required:\r\n        - spans\r\n      type: object\r\n      properties:\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the figure.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the figure in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: 'Child elements of the figure, excluding any caption or footnotes.'\r\n        caption:\r\n          $ref: '#/components/schemas/DocumentCaption'\r\n        footnotes:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentFootnote'\r\n          description: List of footnotes associated with the figure.\r\n          x-ms-identifiers: [ ]\r\n        id:\r\n          type: string\r\n          description: Figure ID.\r\n      description: An object representing a figure in the document.\r\n    DocumentFontStyle:\r\n      enum:\r\n        - normal\r\n        - italic\r\n      type: string\r\n      description: Font style.\r\n      x-ms-enum:\r\n        name: DocumentFontStyle\r\n        modelAsString: true\r\n        values:\r\n          - name: normal\r\n            value: normal\r\n            description: Characters are represented normally.\r\n          - name: italic\r\n            value: italic\r\n            description: Characters are visually slanted to the right.\r\n    DocumentFontWeight:\r\n      enum:\r\n        - normal\r\n        - bold\r\n      type: string\r\n      description: Font weight.\r\n      x-ms-enum:\r\n        name: DocumentFontWeight\r\n        modelAsString: true\r\n        values:\r\n          - name: normal\r\n            value: normal\r\n            description: Characters are represented normally.\r\n          - name: bold\r\n            value: bold\r\n            description: Characters are represented with thicker strokes.\r\n    DocumentFootnote:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Content of the footnote.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the footnote.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the footnote in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: Child elements of the footnote.\r\n      description: A footnote object describing a table or figure.\r\n    DocumentFormula:\r\n      required:\r\n        - kind\r\n        - value\r\n        - span\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        kind:\r\n          $ref: '#/components/schemas/DocumentFormulaKind'\r\n        value:\r\n          type: string\r\n          description: LaTex expression describing the formula.\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the formula, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\r\n        span:\r\n          $ref: '#/components/schemas/DocumentSpan'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the formula.\r\n          format: float\r\n      description: A formula object.\r\n    DocumentFormulaKind:\r\n      enum:\r\n        - inline\r\n        - display\r\n      type: string\r\n      description: Formula kind.\r\n      x-ms-enum:\r\n        name: DocumentFormulaKind\r\n        modelAsString: true\r\n        values:\r\n          - name: inline\r\n            value: inline\r\n            description: A formula embedded within the content of a paragraph.\r\n          - name: display\r\n            value: display\r\n            description: A formula in display mode that takes up an entire line.\r\n    DocumentIntelligenceError:\r\n      required:\r\n        - code\r\n        - message\r\n      type: object\r\n      properties:\r\n        code:\r\n          type: string\r\n          description: One of a server-defined set of error codes.\r\n        message:\r\n          type: string\r\n          description: A human-readable representation of the error.\r\n        target:\r\n          type: string\r\n          description: The target of the error.\r\n        details:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceError'\r\n          description: An array of details about specific errors that led to this reported error.\r\n          x-ms-identifiers: [ ]\r\n        innererror:\r\n          $ref: '#/components/schemas/DocumentIntelligenceInnerError'\r\n      description: The error object.\r\n    DocumentIntelligenceErrorResponse:\r\n      required:\r\n        - error\r\n      type: object\r\n      properties:\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n      description: Error response object.\r\n    DocumentIntelligenceInnerError:\r\n      type: object\r\n      properties:\r\n        code:\r\n          type: string\r\n          description: One of a server-defined set of error codes.\r\n        message:\r\n          type: string\r\n          description: A human-readable representation of the error.\r\n        innererror:\r\n          $ref: '#/components/schemas/DocumentIntelligenceInnerError'\r\n      description: An object containing more specific information about the error.\r\n    DocumentIntelligenceOperationDetails:\r\n      required:\r\n        - operationId\r\n        - status\r\n        - createdDateTime\r\n        - lastUpdatedDateTime\r\n        - kind\r\n        - resourceLocation\r\n      type: object\r\n      properties:\r\n        operationId:\r\n          type: string\r\n          description: Operation ID\r\n          x-ms-mutability:\r\n            - read\r\n            - create\r\n        status:\r\n          $ref: '#/components/schemas/DocumentIntelligenceOperationStatus'\r\n        percentCompleted:\r\n          maximum: 100\r\n          minimum: 0\r\n          type: integer\r\n          description: Operation progress (0-100).\r\n          format: int32\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the operation was created.\r\n          format: date-time\r\n        lastUpdatedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the status was last updated.\r\n          format: date-time\r\n        kind:\r\n          $ref: '#/components/schemas/OperationKind'\r\n        resourceLocation:\r\n          type: string\r\n          description: URL of the resource targeted by this operation.\r\n          format: uri\r\n        apiVersion:\r\n          type: string\r\n          description: API version used to create this operation.\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n        error:\r\n          $ref: '#/components/schemas/DocumentIntelligenceError'\r\n      description: Operation info.\r\n      discriminator:\r\n        propertyName: kind\r\n    DocumentIntelligenceOperationStatus:\r\n      enum:\r\n        - notStarted\r\n        - running\r\n        - failed\r\n        - succeeded\r\n        - canceled\r\n        - skipped\r\n\r\n      type: string\r\n      description: Operation status.\r\n      x-ms-enum:\r\n        name: DocumentIntelligenceOperationStatus\r\n        modelAsString: true\r\n        values:\r\n          - name: notStarted\r\n            value: notStarted\r\n            description: The operation has not started yet.\r\n          - name: running\r\n            value: running\r\n            description: The operation is in progress.\r\n          - name: failed\r\n            value: failed\r\n            description: The operation has failed.\r\n          - name: succeeded\r\n            value: succeeded\r\n            description: The operation has succeeded.\r\n          - name: canceled\r\n            value: canceled\r\n            description: The operation has been canceled.\r\n          - name: skipped\r\n            value: skipped\r\n            description: The operation has been skipped.\r\n    DocumentIntelligenceResourceDetails:\r\n      required:\r\n        - customDocumentModels\r\n      type: object\r\n      properties:\r\n        customDocumentModels:\r\n          $ref: '#/components/schemas/CustomDocumentModelsDetails'\r\n      description: General information regarding the current resource.\r\n    DocumentIntelligenceWarning:\r\n      required:\r\n        - code\r\n        - message\r\n      type: object\r\n      properties:\r\n        code:\r\n          type: string\r\n          description: One of a server-defined set of warning codes.\r\n        message:\r\n          type: string\r\n          description: A human-readable representation of the warning.\r\n        target:\r\n          type: string\r\n          description: The target of the error.\r\n      description: The error object.\r\n    DocumentKeyValueElement:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Concatenated content of the key-value element in reading order.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the key-value element.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the key-value element in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n      description: An object representing the field key or value in a key-value pair.\r\n    DocumentKeyValuePair:\r\n      required:\r\n        - key\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        key:\r\n          $ref: '#/components/schemas/DocumentKeyValueElement'\r\n        value:\r\n          $ref: '#/components/schemas/DocumentKeyValueElement'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the key-value pair.\r\n          format: float\r\n      description: \"An object representing a form field with distinct field label (key) and field\\nvalue (may be empty).\"\r\n    DocumentLanguage:\r\n      required:\r\n        - locale\r\n        - spans\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        locale:\r\n          type: string\r\n          description: \"Detected language.  Value may an ISO 639-1 language code (ex. \\\"en\\\", \\\"fr\\\")\\nor BCP 47 language tag (ex. \\\"zh-Hans\\\").\"\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: \"Location of the text elements in the concatenated content the language applies\\nto.\"\r\n          x-ms-identifiers: [ ]\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly identifying the language.\r\n          format: float\r\n      description: An object representing the detected language for a given text span.\r\n    DocumentLine:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Concatenated content of the contained elements in reading order.\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the line, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the line in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n      description: \"A content line object consisting of an adjacent sequence of content elements,\\nsuch as words and selection marks.\"\r\n    DocumentModelBuildOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentModelDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentModelBuild\r\n    DocumentModelComposeOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentModelDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentModelCompose\r\n    DocumentModelCopyToOperationDetails:\r\n      type: object\r\n      allOf:\r\n        - $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n      properties:\r\n        result:\r\n          $ref: '#/components/schemas/DocumentModelDetails'\r\n      description: Get Operation response object.\r\n      x-ms-discriminator-value: documentModelCopyTo\r\n    DocumentModelDetails:\r\n      required:\r\n        - modelId\r\n        - createdDateTime\r\n      type: object\r\n      properties:\r\n        modelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Unique document model name.\r\n          x-ms-mutability:\r\n            - read\r\n            - create\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        createdDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document model was created.\r\n          format: date-time\r\n          readOnly: true\r\n        expirationDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document model will expire.\r\n          format: date-time\r\n          readOnly: true\r\n        modifiedDateTime:\r\n          type: string\r\n          description: Date and time (UTC) when the document model was last modified.\r\n          format: date-time\r\n          readOnly: true\r\n        apiVersion:\r\n          type: string\r\n          description: API version used to create this document model.\r\n          readOnly: true\r\n        tags:\r\n          type: object\r\n          additionalProperties:\r\n            type: string\r\n          description: List of key-value tag attributes associated with the document model.\r\n        buildMode:\r\n          $ref: '#/components/schemas/DocumentBuildMode'\r\n        azureBlobSource:\r\n          $ref: '#/components/schemas/AzureBlobContentSource'\r\n        azureBlobFileListSource:\r\n          $ref: '#/components/schemas/AzureBlobFileListContentSource'\r\n        classifierId:\r\n          type: string\r\n          description: 'For composed models, the custom classifier to split and classify the input file.'\r\n        split:\r\n          enum:\r\n            - auto\r\n            - none\r\n            - perPage\r\n          type: string\r\n          description: 'For composed models, the file splitting behavior.'\r\n          default: none\r\n          x-ms-enum:\r\n            name: SplitMode\r\n            modelAsString: true\r\n            values:\r\n              - name: auto\r\n                value: auto\r\n                description: Automatically split file into documents.\r\n              - name: none\r\n                value: none\r\n                description: Treat the entire file as a single document.\r\n              - name: perPage\r\n                value: perPage\r\n                description: Treat each page in the file as a separate document.\r\n        docTypes:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentTypeDetails'\r\n          description: Supported document types.\r\n          readOnly: true\r\n        warnings:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceWarning'\r\n          description: List of warnings encountered while building the model.\r\n          readOnly: true\r\n          x-ms-identifiers: [ ]\r\n        trainingHours:\r\n          type: number\r\n          description: Number of V100-equivalent GPU hours consumed for model training.\r\n          format: float\r\n          readOnly: true\r\n      description: Document model info.\r\n    DocumentPage:\r\n      required:\r\n        - pageNumber\r\n        - spans\r\n      type: object\r\n      properties:\r\n        pageNumber:\r\n          minimum: 1\r\n          type: integer\r\n          description: 1-based page number in the input document.\r\n          format: int32\r\n        angle:\r\n          maximum: 180\r\n          type: number\r\n          description: \"The general orientation of the content in clockwise direction, measured in\\ndegrees between (-180, 180].\"\r\n          format: float\r\n        width:\r\n          minimum: 0\r\n          type: number\r\n          description: 'The width of the image/PDF in pixels/inches, respectively.'\r\n          format: float\r\n        height:\r\n          minimum: 0\r\n          type: number\r\n          description: 'The height of the image/PDF in pixels/inches, respectively.'\r\n          format: float\r\n        unit:\r\n          $ref: '#/components/schemas/LengthUnit'\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the page in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        words:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentWord'\r\n          description: Extracted words from the page.\r\n          x-ms-identifiers: [ ]\r\n        selectionMarks:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSelectionMark'\r\n          description: Extracted selection marks from the page.\r\n          x-ms-identifiers: [ ]\r\n        lines:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentLine'\r\n          description: \"Extracted lines from the page, potentially containing both textual and visual\\nelements.\"\r\n          x-ms-identifiers: [ ]\r\n        barcodes:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentBarcode'\r\n          description: Extracted barcodes from the page.\r\n          x-ms-identifiers: [ ]\r\n        formulas:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentFormula'\r\n          description: Extracted formulas from the page.\r\n          x-ms-identifiers: [ ]\r\n      description: Content and layout elements extracted from a page from the input.\r\n    DocumentParagraph:\r\n      required:\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        role:\r\n          $ref: '#/components/schemas/ParagraphRole'\r\n        content:\r\n          type: string\r\n          description: Concatenated content of the paragraph in reading order.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the paragraph.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the paragraph in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n      description: \"A paragraph object consisting with contiguous lines generally with common\\nalignment and spacing.\"\r\n    DocumentSection:\r\n      required:\r\n        - spans\r\n      type: object\r\n      properties:\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the section in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: Child elements of the section.\r\n      description: An object representing a section in the document.\r\n    DocumentSelectionMark:\r\n      required:\r\n        - state\r\n        - span\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        state:\r\n          $ref: '#/components/schemas/DocumentSelectionMarkState'\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the selection mark, with coordinates specified relative\\nto the top-left of the page. The numbers represent the x, y values of the\\npolygon vertices, clockwise from the left (-180 degrees inclusive) relative\\nto the element orientation.\"\r\n        span:\r\n          $ref: '#/components/schemas/DocumentSpan'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the selection mark.\r\n          format: float\r\n      description: \"A selection mark object representing check boxes, radio buttons, and other\\nelements indicating a selection.\"\r\n    DocumentSelectionMarkState:\r\n      enum:\r\n        - selected\r\n        - unselected\r\n      type: string\r\n      description: State of the selection mark.\r\n      x-ms-enum:\r\n        name: DocumentSelectionMarkState\r\n        modelAsString: true\r\n        values:\r\n          - name: selected\r\n            value: selected\r\n            description: \"The selection mark is selected, often indicated by a check  or cross X inside\\nthe selection mark.\"\r\n          - name: unselected\r\n            value: unselected\r\n            description: The selection mark is not selected.\r\n    DocumentSignatureType:\r\n      enum:\r\n        - signed\r\n        - unsigned\r\n      type: string\r\n      description: Presence of signature.\r\n      x-ms-enum:\r\n        name: DocumentSignatureType\r\n        modelAsString: true\r\n        values:\r\n          - name: signed\r\n            value: signed\r\n            description: A signature is detected.\r\n          - name: unsigned\r\n            value: unsigned\r\n            description: No signatures are detected.\r\n    DocumentSpan:\r\n      required:\r\n        - offset\r\n        - length\r\n      type: object\r\n      properties:\r\n        offset:\r\n          minimum: 0\r\n          type: integer\r\n          description: Zero-based index of the content represented by the span.\r\n          format: int32\r\n        length:\r\n          minimum: 0\r\n          type: integer\r\n          description: Number of characters in the content represented by the span.\r\n          format: int32\r\n      description: \"Contiguous region of the concatenated content property, specified as an offset\\nand length.\"\r\n    DocumentStyle:\r\n      required:\r\n        - spans\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        isHandwritten:\r\n          type: boolean\r\n          description: Is content handwritten?\r\n        similarFontFamily:\r\n          type: string\r\n          description: \"Visually most similar font from among the set of supported font families, with\\nfallback fonts following CSS convention (ex. 'Arial, sans-serif').\"\r\n        fontStyle:\r\n          $ref: '#/components/schemas/DocumentFontStyle'\r\n        fontWeight:\r\n          $ref: '#/components/schemas/DocumentFontWeight'\r\n        color:\r\n          pattern: '^#[0-9a-f]{6}$'\r\n          type: string\r\n          description: 'Foreground color in #rrggbb hexadecimal format.'\r\n        backgroundColor:\r\n          pattern: '^#[0-9a-f]{6}$'\r\n          type: string\r\n          description: 'Background color in #rrggbb hexadecimal format..'\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the text elements in the concatenated content the style applies to.\r\n          x-ms-identifiers: [ ]\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly identifying the style.\r\n          format: float\r\n      description: An object representing observed text styles.\r\n    DocumentTable:\r\n      required:\r\n        - rowCount\r\n        - columnCount\r\n        - cells\r\n        - spans\r\n      type: object\r\n      properties:\r\n        rowCount:\r\n          minimum: 1\r\n          type: integer\r\n          description: Number of rows in the table.\r\n          format: int32\r\n        columnCount:\r\n          minimum: 1\r\n          type: integer\r\n          description: Number of columns in the table.\r\n          format: int32\r\n        cells:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentTableCell'\r\n          description: Cells contained within the table.\r\n          x-ms-identifiers: [ ]\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the table.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the table in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        caption:\r\n          $ref: '#/components/schemas/DocumentCaption'\r\n        footnotes:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentFootnote'\r\n          description: List of footnotes associated with the table.\r\n          x-ms-identifiers: [ ]\r\n      description: A table object consisting table cells arranged in a rectangular layout.\r\n    DocumentTableCell:\r\n      required:\r\n        - rowIndex\r\n        - columnIndex\r\n        - content\r\n        - spans\r\n      type: object\r\n      properties:\r\n        kind:\r\n          enum:\r\n            - content\r\n            - rowHeader\r\n            - columnHeader\r\n            - stubHead\r\n            - description\r\n          type: string\r\n          description: Table cell kind.\r\n          default: content\r\n          x-ms-enum:\r\n            name: DocumentTableCellKind\r\n            modelAsString: true\r\n            values:\r\n              - name: content\r\n                value: content\r\n                description: Contains the main content/data.\r\n              - name: rowHeader\r\n                value: rowHeader\r\n                description: Describes the content of the row.\r\n              - name: columnHeader\r\n                value: columnHeader\r\n                description: Describes the content of the column.\r\n              - name: stubHead\r\n                value: stubHead\r\n                description: 'Describes the row headers, usually located at the top left corner of a table.'\r\n              - name: description\r\n                value: description\r\n                description: Describes the content in (parts of) the table.\r\n        rowIndex:\r\n          type: integer\r\n          description: Row index of the cell.\r\n          format: int32\r\n        columnIndex:\r\n          type: integer\r\n          description: Column index of the cell.\r\n          format: int32\r\n        rowSpan:\r\n          minimum: 1\r\n          type: integer\r\n          description: Number of rows spanned by this cell.\r\n          format: int32\r\n          default: 1\r\n        columnSpan:\r\n          minimum: 1\r\n          type: integer\r\n          description: Number of columns spanned by this cell.\r\n          format: int32\r\n          default: 1\r\n        content:\r\n          type: string\r\n          description: Concatenated content of the table cell in reading order.\r\n        boundingRegions:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/BoundingRegion'\r\n          description: Bounding regions covering the table cell.\r\n          x-ms-identifiers: [ ]\r\n        spans:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentSpan'\r\n          description: Location of the table cell in the reading order concatenated content.\r\n          x-ms-identifiers: [ ]\r\n        elements:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentElement'\r\n          description: Child elements of the table cell.\r\n      description: An object representing the location and content of a table cell.\r\n    DocumentTypeDetails:\r\n      type: object\r\n      properties:\r\n        description:\r\n          maxLength: 4096\r\n          type: string\r\n          description: Document model description.\r\n        buildMode:\r\n          $ref: '#/components/schemas/DocumentBuildMode'\r\n        fieldSchema:\r\n          type: object\r\n          additionalProperties:\r\n            $ref: '#/components/schemas/DocumentFieldSchema'\r\n          description: Description of the document semantic schema using a JSON Schema style syntax.\r\n        fieldConfidence:\r\n          type: object\r\n          additionalProperties:\r\n            type: number\r\n            format: float\r\n          description: Estimated confidence for each field.\r\n        modelId:\r\n          maxLength: 64\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Document model to use for analyzing documents with specified type.\r\n        confidenceThreshold:\r\n          type: number\r\n          description: Only perform analysis if docType confidence is above threshold.\r\n          format: float\r\n        features:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentAnalysisFeature'\r\n          description: List of optional analysis features.\r\n        queryFields:\r\n          type: array\r\n          items:\r\n            type: string\r\n          description: 'List of additional fields to extract.  Ex. \"NumberOfGuests,StoreNumber\"'\r\n        maxDocumentsToAnalyze:\r\n          type: integer\r\n          description: Maximum number of documents of specified type to analyze.  Default=all.\r\n          format: int32\r\n      description: Document type info.\r\n    DocumentWord:\r\n      required:\r\n        - content\r\n        - span\r\n        - confidence\r\n      type: object\r\n      properties:\r\n        content:\r\n          type: string\r\n          description: Text content of the word.\r\n        polygon:\r\n          type: array\r\n          items:\r\n            type: number\r\n            format: float\r\n          description: \"Bounding polygon of the word, with coordinates specified relative to the\\ntop-left of the page. The numbers represent the x, y values of the polygon\\nvertices, clockwise from the left (-180 degrees inclusive) relative to the\\nelement orientation.\"\r\n        span:\r\n          $ref: '#/components/schemas/DocumentSpan'\r\n        confidence:\r\n          maximum: 1\r\n          minimum: 0\r\n          type: number\r\n          description: Confidence of correctly extracting the word.\r\n          format: float\r\n      description: \"A word object consisting of a contiguous sequence of characters.  For non-space\\ndelimited languages, such as Chinese, Japanese, and Korean, each character is\\nrepresented as its own word.\"\r\n    LengthUnit:\r\n      enum:\r\n        - pixel\r\n        - inch\r\n      type: string\r\n      description: 'The unit used by the width, height, and polygon properties. For images, the unit is \"pixel\". For PDF, the unit is \"inch\".'\r\n      x-ms-enum:\r\n        name: LengthUnit\r\n        modelAsString: true\r\n        values:\r\n          - name: pixel\r\n            value: pixel\r\n            description: Length unit for image files.\r\n          - name: inch\r\n            value: inch\r\n            description: Length unit for PDF files.\r\n    ModelCopyAuthorization:\r\n      required:\r\n        - targetResourceId\r\n        - targetResourceRegion\r\n        - targetModelId\r\n        - targetModelLocation\r\n        - accessToken\r\n        - expirationDateTime\r\n      type: object\r\n      properties:\r\n        targetResourceId:\r\n          type: string\r\n          description: ID of the target Azure resource where the document model should be copied to.\r\n        targetResourceRegion:\r\n          type: string\r\n          description: \"Location of the target Azure resource where the document model should be copied\\nto.\"\r\n        targetModelId:\r\n          pattern: '^[a-zA-Z0-9][a-zA-Z0-9._~-]{1,63}$'\r\n          type: string\r\n          description: Identifier of the target document model.\r\n        targetModelLocation:\r\n          type: string\r\n          description: URL of the copied document model in the target account.\r\n          format: uri\r\n        accessToken:\r\n          type: string\r\n          description: Token used to authorize the request.\r\n        expirationDateTime:\r\n          type: string\r\n          description: Date/time when the access token expires.\r\n          format: date-time\r\n      description: \"Authorization to copy a document model to the specified target resource and\\nmodelId.\"\r\n    OperationKind:\r\n      enum:\r\n        - documentModelBuild\r\n        - documentModelCompose\r\n        - documentModelCopyTo\r\n        - documentClassifierCopyTo\r\n        - documentClassifierBuild\r\n      type: string\r\n      description: Type of operation.\r\n      x-ms-enum:\r\n        name: OperationKind\r\n        modelAsString: true\r\n        values:\r\n          - name: documentModelBuild\r\n            value: documentModelBuild\r\n            description: Build a new custom document model.\r\n          - name: documentModelCompose\r\n            value: documentModelCompose\r\n            description: Compose a new custom document model from existing models.\r\n          - name: documentModelCopyTo\r\n            value: documentModelCopyTo\r\n            description: \"Copy an existing document model to potentially a different resource, region, or\\nsubscription.\"\r\n          - name: documentClassifierCopyTo\r\n            value: documentClassifierCopyTo\r\n            description: \"Copy an existing document classifier to potentially a different resource, region, or\\nsubscription.\"\r\n          - name: documentClassifierBuild\r\n            value: documentClassifierBuild\r\n            description: Build a new custom classifier model.\r\n    PagedAnalyzeBatchOperation:\r\n      required:\r\n        - value\r\n      type: object\r\n      properties:\r\n        value:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/AnalyzeBatchOperation'\r\n          description: The AnalyzeBatchOperation items on this page\r\n          x-ms-identifiers: [ ]\r\n        nextLink:\r\n          type: string\r\n          description: The link to the next page of items\r\n          format: uri\r\n      description: Paged collection of AnalyzeBatchOperation items\r\n    PagedDocumentClassifierDetails:\r\n      required:\r\n        - value\r\n      type: object\r\n      properties:\r\n        value:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentClassifierDetails'\r\n          description: The DocumentClassifierDetails items on this page\r\n          x-ms-identifiers: [ ]\r\n        nextLink:\r\n          type: string\r\n          description: The link to the next page of items\r\n          format: uri\r\n      description: Paged collection of DocumentClassifierDetails items\r\n    PagedDocumentIntelligenceOperationDetails:\r\n      required:\r\n        - value\r\n      type: object\r\n      properties:\r\n        value:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentIntelligenceOperationDetails'\r\n          description: The DocumentIntelligenceOperationDetails items on this page\r\n          x-ms-identifiers: [ ]\r\n        nextLink:\r\n          type: string\r\n          description: The link to the next page of items\r\n          format: uri\r\n      description: Paged collection of DocumentIntelligenceOperationDetails items\r\n    PagedDocumentModelDetails:\r\n      required:\r\n        - value\r\n      type: object\r\n      properties:\r\n        value:\r\n          type: array\r\n          items:\r\n            $ref: '#/components/schemas/DocumentModelDetails'\r\n          description: The DocumentModelDetails items on this page\r\n          x-ms-identifiers: [ ]\r\n        nextLink:\r\n          type: string\r\n          description: The link to the next page of items\r\n          format: uri\r\n      description: Paged collection of DocumentModelDetails items\r\n    ParagraphRole:\r\n      enum:\r\n        - pageHeader\r\n        - pageFooter\r\n        - pageNumber\r\n        - title\r\n        - sectionHeading\r\n        - footnote\r\n        - formulaBlock\r\n      type: string\r\n      description: Semantic role of the paragraph.\r\n      x-ms-enum:\r\n        name: ParagraphRole\r\n        modelAsString: true\r\n        values:\r\n          - name: pageHeader\r\n            value: pageHeader\r\n            description: Text near the top edge of the page.\r\n          - name: pageFooter\r\n            value: pageFooter\r\n            description: Text near the bottom edge of the page.\r\n          - name: pageNumber\r\n            value: pageNumber\r\n            description: Page number.\r\n          - name: title\r\n            value: title\r\n            description: Top-level title describing the entire document.\r\n          - name: sectionHeading\r\n            value: sectionHeading\r\n            description: Sub heading describing a section of the document.\r\n          - name: footnote\r\n            value: footnote\r\n            description: A note usually placed after the main content on a page.\r\n          - name: formulaBlock\r\n            value: formulaBlock\r\n            description: 'A block of formulas, often with shared alignment.'\r\n    StringIndexType:\r\n      enum:\r\n        - textElements\r\n        - unicodeCodePoint\r\n        - utf16CodeUnit\r\n      type: string\r\n      description: Method used to compute string offset and length.\r\n      x-ms-enum:\r\n        name: StringIndexType\r\n        modelAsString: true\r\n        values:\r\n          - name: textElements\r\n            value: textElements\r\n            description: \"User-perceived display character, or grapheme cluster, as defined by Unicode\\n8.0.0.\"\r\n          - name: unicodeCodePoint\r\n            value: unicodeCodePoint\r\n            description: Character unit represented by a single unicode code point.  Used by Python 3.\r\n          - name: utf16CodeUnit\r\n            value: utf16CodeUnit\r\n            description: \"Character unit represented by a 16-bit Unicode code unit.  Used by JavaScript,\\nJava, and .NET.\"\r\n    Input:\r\n      type: object\r\n    DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ImagePngResp:\r\n      type: file\r\n    DocumentModelsModelIdAnalyzeResultsResultIdFiguresFigureIdGet200ApplicationJ:\r\n      type: file\r\n    DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationPdfResponse:\r\n      type: file\r\n    DocumentModelsModelIdAnalyzeResultsResultIdPdfGet200ApplicationJsonResponse:\r\n      type: file\r\n  securitySchemes:\r\n    apiKeyHeader:\r\n      type: apiKey\r\n      name: Ocp-Apim-Subscription-Key\r\n      in: header\r\n    apiKeyQuery:\r\n      type: apiKey\r\n      name: subscription-key\r\n      in: query\r\nsecurity:\r\n  - apiKeyHeader: [ ]\r\n  - apiKeyQuery: [ ]",
            "isV2SKU": "[or(equals(parameters('sku'), 'StandardV2'), equals(parameters('sku'), 'PremiumV2'))]",
            "apimPublicNetworkAccess": "[if(parameters('apimV2PublicNetworkAccess'), 'Enabled', 'Disabled')]",
            "openAiApiBackendId": "openai-backend",
            "openAiApiUamiNamedValue": "uami-client-id",
            "openAiApiEntraNamedValue": "entra-auth",
            "openAiApiClientNamedValue": "client-id",
            "openAiApiTenantNamedValue": "tenant-id",
            "openAiApiAudienceNamedValue": "audience",
            "apiManagementMinApiVersion": "2021-08-01",
            "apiManagementMinApiVersionV2": "2024-05-01",
            "apimZones": "[if(and(equals(parameters('sku'), 'Premium'), greater(parameters('skuCount'), 1)), if(equals(parameters('skuCount'), 2), createArray('1', '2'), createArray('1', '2', '3')), createArray())]"
          },
          "resources": [
            {
              "type": "Microsoft.ApiManagement/service",
              "apiVersion": "2024-05-01",
              "name": "[parameters('name')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('name')))]",
              "sku": {
                "name": "[parameters('sku')]",
                "capacity": "[if(equals(parameters('sku'), 'Consumption'), 0, if(equals(parameters('sku'), 'Developer'), 1, parameters('skuCount')))]"
              },
              "identity": {
                "type": "SystemAssigned, UserAssigned",
                "userAssignedIdentities": {
                  "[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('managedIdentityName')))]": {}
                }
              },
              "properties": {
                "publisherEmail": "[parameters('publisherEmail')]",
                "publisherName": "[parameters('publisherName')]",
                "virtualNetworkType": "[if(variables('isV2SKU'), 'External', parameters('apimNetworkType'))]",
                "publicNetworkAccess": "[if(variables('isV2SKU'), variables('apimPublicNetworkAccess'), 'Enabled')]",
                "virtualNetworkConfiguration": "[if(or(not(equals(parameters('apimNetworkType'), 'None')), variables('isV2SKU')), createObject('subnetResourceId', parameters('apimSubnetId')), null())]",
                "apiVersionConstraint": {
                  "minApiVersion": "[if(variables('isV2SKU'), variables('apiManagementMinApiVersionV2'), variables('apiManagementMinApiVersion'))]"
                },
                "customProperties": "[if(equals(parameters('sku'), 'Consumption'), createObject(), createObject('Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_GCM_SHA256', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA256', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA256', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_256_CBC_SHA', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TLS_RSA_WITH_AES_128_CBC_SHA', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Ciphers.TripleDes168', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls10', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Tls11', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Protocols.Ssl30', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls10', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Tls11', 'false', 'Microsoft.WindowsAzure.ApiManagement.Gateway.Security.Backend.Protocols.Ssl30', 'false'))]"
              },
              "zones": "[variables('apimZones')]"
            },
            {
              "type": "Microsoft.ApiManagement/service/products",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'oai-retail-assistant')]",
              "properties": {
                "displayName": "OAI-Retail-Assistant",
                "description": "Offering OpenAI services for the retail and e-commerce platforms assistant.",
                "subscriptionRequired": true,
                "approvalRequired": true,
                "subscriptionsLimit": 200,
                "state": "published",
                "terms": "By subscribing to this product, you agree to the terms and conditions."
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/products/apiLinks",
              "apiVersion": "2023-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), 'oai-retail-assistant', 'retail-product-openai-api')]",
              "properties": {
                "apiId": "[reference(resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api'), '2025-04-01').outputs.id.value]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api')]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-retail-assistant')]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/products/policies",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}/{2}', parameters('name'), 'oai-retail-assistant', 'policy')]",
              "properties": {
                "value": "[variables('$fxv#11')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api')]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-retail-assistant')]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/subscriptions",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'oai-retail-assistant-sub-01')]",
              "properties": {
                "displayName": "AI-Retail-Internal-Subscription",
                "state": "active",
                "scope": "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-retail-assistant')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-retail-assistant')]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/products",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'oai-hr-assistant')]",
              "properties": {
                "displayName": "OAI-HR-Assistant",
                "description": "Offering OpenAI services for the internal HR platforms.",
                "subscriptionRequired": true,
                "approvalRequired": true,
                "subscriptionsLimit": 200,
                "state": "published",
                "terms": "By subscribing to this product, you agree to the terms and conditions."
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/products/apiLinks",
              "apiVersion": "2023-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), 'oai-hr-assistant', 'hr-product-openai-api')]",
              "properties": {
                "apiId": "[reference(resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api'), '2025-04-01').outputs.id.value]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api')]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-hr-assistant')]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/products/policies",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}/{2}', parameters('name'), 'oai-hr-assistant', 'policy')]",
              "properties": {
                "value": "[variables('$fxv#12')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api')]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-hr-assistant')]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/subscriptions",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'oai-hr-assistant-sub-01')]",
              "properties": {
                "displayName": "OAI-HR-Assistant-Sub-01",
                "state": "active",
                "scope": "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-hr-assistant')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-hr-assistant')]"
              ]
            },
            {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/products",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'oai-hr-pii-assistant')]",
              "properties": {
                "displayName": "OAI-HR-PII-Assistant",
                "description": "Offering OpenAI services for the internal HR platforms with PII anonymization processing.",
                "subscriptionRequired": true,
                "approvalRequired": true,
                "subscriptionsLimit": 200,
                "state": "published",
                "terms": "By subscribing to this product, you agree to the terms and conditions."
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/backends', parameters('name'), 'content-safety-backend')]",
                "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('name'), 'pii-usage-eventhub-logger')]",
                "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('name'), 'usage-eventhub-logger')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'pii-anonymization')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'pii-deanonymization')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'pii-state-saving')]"
              ]
            },
            {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/products/apiLinks",
              "apiVersion": "2023-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), 'oai-hr-pii-assistant', 'hr-pii-product-openai-api')]",
              "properties": {
                "apiId": "[reference(resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api'), '2025-04-01').outputs.id.value]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api')]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-hr-pii-assistant')]"
              ]
            },
            {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/products/policies",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}/{2}', parameters('name'), 'oai-hr-pii-assistant', 'policy')]",
              "properties": {
                "value": "[variables('$fxv#13')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api')]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-hr-pii-assistant')]"
              ]
            },
            {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/subscriptions",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'oai-hr-pii-assistant-sub-01')]",
              "properties": {
                "displayName": "OAI-HR-PII-Assistant-Sub-01",
                "state": "active",
                "scope": "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-hr-pii-assistant')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-hr-pii-assistant')]"
              ]
            },
            {
              "condition": "[parameters('enableAzureAISearch')]",
              "type": "Microsoft.ApiManagement/service/products",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'src-hr-assistant')]",
              "properties": {
                "displayName": "SRC-HR-Assistant",
                "description": "Offering AI Search services for the HR systems.",
                "subscriptionRequired": true,
                "approvalRequired": true,
                "subscriptionsLimit": 200,
                "state": "published",
                "terms": "By subscribing to this product, you agree to the terms and conditions."
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "condition": "[parameters('enableAzureAISearch')]",
              "type": "Microsoft.ApiManagement/service/products/apiLinks",
              "apiVersion": "2023-05-01-preview",
              "name": "[format('{0}/{1}/{2}', parameters('name'), 'src-hr-assistant', 'src-hr-product-ai-search-api')]",
              "properties": {
                "apiId": "[reference(resourceId('Microsoft.Resources/deployments', 'azure-ai-search-index-api'), '2025-04-01').outputs.id.value]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azure-ai-search-index-api')]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'src-hr-assistant')]"
              ]
            },
            {
              "condition": "[parameters('enableAzureAISearch')]",
              "type": "Microsoft.ApiManagement/service/products/policies",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}/{2}', parameters('name'), 'src-hr-assistant', 'policy')]",
              "properties": {
                "value": "[variables('$fxv#14')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'src-hr-assistant')]"
              ]
            },
            {
              "condition": "[parameters('enableAzureAISearch')]",
              "type": "Microsoft.ApiManagement/service/subscriptions",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'src-hr-assistant-sub-01')]",
              "properties": {
                "displayName": "SRC-HR-Assistant-Sub-01",
                "state": "active",
                "scope": "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'src-hr-assistant')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'src-hr-assistant')]"
              ]
            },
            {
              "copy": {
                "name": "openAiBackends",
                "count": "[length(parameters('openAiUris'))]"
              },
              "type": "Microsoft.ApiManagement/service/backends",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), format('{0}-{1}', variables('openAiApiBackendId'), copyIndex()))]",
              "properties": {
                "description": "[variables('openAiApiBackendId')]",
                "url": "[parameters('openAiUris')[copyIndex()]]",
                "protocol": "http",
                "tls": {
                  "validateCertificateChain": true,
                  "validateCertificateName": true
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "copy": {
                "name": "aiSearchBackends",
                "count": "[length(parameters('aiSearchInstances'))]"
              },
              "condition": "[parameters('enableAzureAISearch')]",
              "type": "Microsoft.ApiManagement/service/backends",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), parameters('aiSearchInstances')[copyIndex()].name)]",
              "properties": {
                "description": "[parameters('aiSearchInstances')[copyIndex()].description]",
                "url": "[parameters('aiSearchInstances')[copyIndex()].url]",
                "protocol": "http",
                "tls": {
                  "validateCertificateChain": true,
                  "validateCertificateName": true
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/backends",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'content-safety-backend')]",
              "properties": {
                "description": "Content Safety Service Backend",
                "url": "[parameters('contentSafetyServiceUrl')]",
                "protocol": "http",
                "tls": {
                  "validateCertificateChain": true,
                  "validateCertificateName": true
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), variables('openAiApiUamiNamedValue'))]",
              "properties": {
                "displayName": "[variables('openAiApiUamiNamedValue')]",
                "secret": true,
                "value": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('managedIdentityName')), '2018-11-30').clientId]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), variables('openAiApiEntraNamedValue'))]",
              "properties": {
                "displayName": "[variables('openAiApiEntraNamedValue')]",
                "secret": false,
                "value": "[parameters('entraAuth')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), variables('openAiApiClientNamedValue'))]",
              "properties": {
                "displayName": "[variables('openAiApiClientNamedValue')]",
                "secret": true,
                "value": "[parameters('clientAppId')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), variables('openAiApiTenantNamedValue'))]",
              "properties": {
                "displayName": "[variables('openAiApiTenantNamedValue')]",
                "secret": true,
                "value": "[parameters('tenantId')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), variables('openAiApiAudienceNamedValue'))]",
              "properties": {
                "displayName": "[variables('openAiApiAudienceNamedValue')]",
                "secret": true,
                "value": "[parameters('audience')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'piiServiceUrl')]",
              "properties": {
                "displayName": "piiServiceUrl",
                "secret": false,
                "value": "[parameters('aiLanguageServiceUrl')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'piiServiceKey')]",
              "properties": {
                "displayName": "piiServiceKey",
                "secret": true,
                "value": "replace-with-language-service-key-if-needed"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'contentSafetyServiceUrl')]",
              "properties": {
                "displayName": "contentSafetyServiceUrl",
                "secret": false,
                "value": "[parameters('contentSafetyServiceUrl')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'cognitiveServicesAudience')]",
              "properties": {
                "displayName": "cognitiveServicesAudience",
                "value": "[parameters('cognitiveServicesAudience')]",
                "secret": false
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/namedValues",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'searchServiceAudience')]",
              "properties": {
                "displayName": "searchServiceAudience",
                "value": "[parameters('searchServiceAudience')]",
                "secret": false
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'aad-auth')]",
              "properties": {
                "value": "[variables('$fxv#15')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), variables('openAiApiAudienceNamedValue'))]",
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), variables('openAiApiClientNamedValue'))]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), variables('openAiApiEntraNamedValue'))]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), variables('openAiApiTenantNamedValue'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'validate-routes')]",
              "properties": {
                "value": "[variables('$fxv#16')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'backend-routing')]",
              "properties": {
                "value": "[variables('$fxv#17')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'openai-usage')]",
              "properties": {
                "value": "[variables('$fxv#18')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('name'), 'usage-eventhub-logger')]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'openai-usage-streaming')]",
              "properties": {
                "value": "[variables('$fxv#19')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'ai-usage')]",
              "properties": {
                "value": "[variables('$fxv#20')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('name'), 'usage-eventhub-logger')]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'throttling-events')]",
              "properties": {
                "value": "[variables('$fxv#21')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'dynamic-throttling-assignment')]",
              "properties": {
                "value": "[variables('$fxv#22')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'pii-anonymization')]",
              "properties": {
                "value": "[variables('$fxv#23')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), 'cognitiveServicesAudience')]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), 'piiServiceKey')]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), 'piiServiceUrl')]"
              ]
            },
            {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'pii-deanonymization')]",
              "properties": {
                "value": "[variables('$fxv#24')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/policyFragments",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'pii-state-saving')]",
              "properties": {
                "value": "[variables('$fxv#25')]",
                "format": "rawxml"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('name'), 'pii-usage-eventhub-logger')]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/loggers",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'appinsights-logger')]",
              "properties": {
                "credentials": {
                  "instrumentationKey": "[reference(resourceId('Microsoft.Insights/components', parameters('applicationInsightsName')), '2020-02-02').InstrumentationKey]"
                },
                "description": "Application Insights logger for API observability",
                "isBuffered": false,
                "loggerType": "applicationInsights",
                "resourceId": "[resourceId('Microsoft.Insights/components', parameters('applicationInsightsName'))]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/diagnostics",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'applicationinsights')]",
              "properties": {
                "alwaysLog": "allErrors",
                "httpCorrelationProtocol": "Legacy",
                "verbosity": "information",
                "logClientIp": true,
                "loggerId": "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('name'), 'appinsights-logger')]",
                "metrics": true,
                "sampling": {
                  "samplingType": "fixed",
                  "percentage": 100
                },
                "frontend": {
                  "request": {
                    "body": {
                      "bytes": 0
                    }
                  },
                  "response": {
                    "body": {
                      "bytes": 0
                    }
                  }
                },
                "backend": {
                  "request": {
                    "body": {
                      "bytes": 0
                    }
                  },
                  "response": {
                    "body": {
                      "bytes": 0
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/loggers', parameters('name'), 'appinsights-logger')]",
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/loggers",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'usage-eventhub-logger')]",
              "properties": {
                "loggerType": "azureEventHub",
                "description": "Event Hub logger for OpenAI usage metrics",
                "credentials": {
                  "name": "[parameters('eventHubName')]",
                  "endpointAddress": "[replace(parameters('eventHubEndpoint'), 'https://', '')]",
                  "identityClientId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('managedIdentityName')), '2018-11-30').clientId]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "condition": "[parameters('enablePIIAnonymization')]",
              "type": "Microsoft.ApiManagement/service/loggers",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'pii-usage-eventhub-logger')]",
              "properties": {
                "loggerType": "azureEventHub",
                "description": "Event Hub logger for PII usage metrics and logs",
                "credentials": {
                  "name": "[parameters('eventHubPIIName')]",
                  "endpointAddress": "[replace(parameters('eventHubPIIEndpoint'), 'https://', '')]",
                  "identityClientId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('managedIdentityName')), '2018-11-30').clientId]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/users",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'ai-retail-dev-user')]",
              "properties": {
                "firstName": "Retail AI",
                "lastName": "Developer",
                "email": "myuser@example.com",
                "state": "active"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.ApiManagement/service/subscriptions",
              "apiVersion": "2022-08-01",
              "name": "[format('{0}/{1}', parameters('name'), 'retail-ai-dev-user-subscription')]",
              "properties": {
                "displayName": "Retail AI Dev User Subscription",
                "ownerId": "[format('/users/{0}', resourceId('Microsoft.ApiManagement/service/users', parameters('name'), 'ai-retail-dev-user'))]",
                "state": "active",
                "allowTracing": true,
                "scope": "[format('/products/{0}', resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-retail-assistant'))]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/users', parameters('name'), 'ai-retail-dev-user')]",
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/products', parameters('name'), 'oai-retail-assistant')]"
              ]
            },
            {
              "condition": "[and(variables('isV2SKU'), parameters('usePrivateEndpoint'))]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('name'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "Gateway"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('apimV2PrivateDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('apimV2PrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[parameters('privateEndpointSubnetId')]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "azure-openai-service-api",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "azure-openai-service-api"
                  },
                  "path": {
                    "value": "openai"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "Azure OpenAI API"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "api-key"
                  },
                  "openApiSpecification": {
                    "value": "[string(variables('$fxv#0'))]"
                  },
                  "apiDescription": {
                    "value": "Azure OpenAI API"
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#1')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "7749918016312021393"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'aad-auth')]",
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'backend-routing')]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), 'cognitiveServicesAudience')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'dynamic-throttling-assignment')]",
                "openAiBackends",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'openai-usage')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'openai-usage-streaming')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'throttling-events')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'validate-routes')]"
              ]
            },
            {
              "condition": "[parameters('enableAzureAISearch')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "azure-ai-search-index-api",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "azure-ai-search-index-api"
                  },
                  "path": {
                    "value": "search"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "Azure AI Search Index API (index services)"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "api-key"
                  },
                  "openApiSpecification": {
                    "value": "[variables('$fxv#2')]"
                  },
                  "apiDescription": {
                    "value": "Azure AI Search Index Client APIs"
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#3')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "7749918016312021393"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'aad-auth')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'ai-usage')]",
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'backend-routing')]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), 'searchServiceAudience')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'throttling-events')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'validate-routes')]"
              ]
            },
            {
              "condition": "[parameters('enableAIModelInference')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "ai-model-inference-api",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "ai-model-inference-api"
                  },
                  "path": {
                    "value": "models"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "AI Model Inference API"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "api-key"
                  },
                  "openApiSpecification": {
                    "value": "[variables('$fxv#4')]"
                  },
                  "apiDescription": {
                    "value": "Access to AI inference models published through Azure AI Foundry"
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#5')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "7749918016312021393"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'aad-auth')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'ai-usage')]",
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'backend-routing')]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), 'cognitiveServicesAudience')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'throttling-events')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'validate-routes')]"
              ]
            },
            {
              "condition": "[parameters('enableOpenAIRealtime')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "openai-realtime-ws-api",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "openai-realtime-ws-api"
                  },
                  "path": {
                    "value": "openai/realtime"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "Azure OpenAI Realtime API"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "api-key"
                  },
                  "openApiSpecification": {
                    "value": "NA"
                  },
                  "apiDescription": {
                    "value": "Access Azure OpenAI Realtime API for real-time voice and text conversion."
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#6')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  },
                  "serviceUrl": {
                    "value": "wss://to-be-replaced-by-policy"
                  },
                  "apiType": {
                    "value": "websocket"
                  },
                  "apiProtocols": {
                    "value": [
                      "wss"
                    ]
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "7749918016312021393"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'aad-auth')]",
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'backend-routing')]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), 'cognitiveServicesAudience')]",
                "openAiBackends",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'openai-usage')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'openai-usage-streaming')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'validate-routes')]"
              ]
            },
            {
              "condition": "[parameters('enableDocumentIntelligence')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "document-intelligence-api-legacy",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "document-intelligence-api-legacy"
                  },
                  "path": {
                    "value": "formrecognizer"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "Document Intelligence API (Legacy)"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "Ocp-Apim-Subscription-Key"
                  },
                  "openApiSpecification": {
                    "value": "[variables('$fxv#7')]"
                  },
                  "apiDescription": {
                    "value": "Uses (/formrecognizer) url path. Extracts content, layout, and structured data from documents."
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#8')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "7749918016312021393"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'aad-auth')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'ai-usage')]",
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'backend-routing')]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), 'cognitiveServicesAudience')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'throttling-events')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'validate-routes')]"
              ]
            },
            {
              "condition": "[parameters('enableDocumentIntelligence')]",
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "document-intelligence-api",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "serviceName": {
                    "value": "[parameters('name')]"
                  },
                  "apiName": {
                    "value": "document-intelligence-api"
                  },
                  "path": {
                    "value": "documentintelligence"
                  },
                  "apiRevision": {
                    "value": "1"
                  },
                  "apiDispalyName": {
                    "value": "Document Intelligence API"
                  },
                  "subscriptionRequired": "[if(parameters('entraAuth'), createObject('value', false()), createObject('value', true()))]",
                  "subscriptionKeyName": {
                    "value": "Ocp-Apim-Subscription-Key"
                  },
                  "openApiSpecification": {
                    "value": "[variables('$fxv#9')]"
                  },
                  "apiDescription": {
                    "value": "Uses (/documentintelligence) url path. Extracts content, layout, and structured data from documents."
                  },
                  "policyDocument": {
                    "value": "[variables('$fxv#10')]"
                  },
                  "enableAPIDeployment": {
                    "value": true
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "7749918016312021393"
                    }
                  },
                  "parameters": {
                    "apiName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The name of the API"
                      }
                    },
                    "apiDispalyName": {
                      "type": "string",
                      "minLength": 1,
                      "maxLength": 63,
                      "metadata": {
                        "description": "The display name of the API"
                      }
                    },
                    "openApiSpecification": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The contents of the OpenAPI definition"
                      }
                    },
                    "policyDocument": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The XML Policy document for the API"
                      }
                    },
                    "serviceName": {
                      "type": "string",
                      "minLength": 1,
                      "metadata": {
                        "description": "The name of the API Management service to deploy the API to."
                      }
                    },
                    "apiDescription": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The API description (if blank, use the name of the API)"
                      }
                    },
                    "path": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The relative path for the API (if different to the API name)"
                      }
                    },
                    "serviceUrl": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "The (optional) service URL"
                      }
                    },
                    "subscriptionRequired": {
                      "type": "bool",
                      "defaultValue": true,
                      "metadata": {
                        "description": "Set to true if a subscription is required"
                      }
                    },
                    "apiRevision": {
                      "type": "string",
                      "defaultValue": "1",
                      "metadata": {
                        "description": "API Revision number. Default is 1"
                      }
                    },
                    "subscriptionKeyName": {
                      "type": "string",
                      "defaultValue": "",
                      "metadata": {
                        "description": "Ability to override the subscription key name. Default is Ocp-Apim-Subscription-Key"
                      }
                    },
                    "enableAPIDeployment": {
                      "type": "bool",
                      "defaultValue": true
                    },
                    "apiType": {
                      "type": "string",
                      "defaultValue": "http",
                      "allowedValues": [
                        "http",
                        "soap",
                        "graphql",
                        "websocket"
                      ],
                      "metadata": {
                        "description": "The type of the API"
                      }
                    },
                    "apiProtocols": {
                      "type": "array",
                      "defaultValue": [
                        "https"
                      ],
                      "allowedValues": [
                        "http",
                        "https",
                        "ws",
                        "wss"
                      ],
                      "metadata": {
                        "description": "The protocols supported by the API"
                      }
                    }
                  },
                  "variables": {
                    "contentFormat": "[if(startsWith(parameters('openApiSpecification'), '{'), 'openapi+json', 'openapi')]",
                    "isWebSotcketAPI": "[or(contains(parameters('apiProtocols'), 'ws'), contains(parameters('apiProtocols'), 'wss'))]"
                  },
                  "resources": [
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "format": "[if(not(equals(parameters('openApiSpecification'), 'NA')), variables('contentFormat'), null())]",
                        "value": "[if(not(equals(parameters('openApiSpecification'), 'NA')), parameters('openApiSpecification'), null())]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI'))]",
                      "type": "Microsoft.ApiManagement/service/apis",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}', parameters('serviceName'), parameters('apiName'))]",
                      "properties": {
                        "path": "[if(equals(parameters('path'), ''), parameters('apiName'), parameters('path'))]",
                        "apiRevision": "[parameters('apiRevision')]",
                        "description": "[if(equals(parameters('apiDescription'), ''), parameters('apiName'), parameters('apiDescription'))]",
                        "displayName": "[parameters('apiDispalyName')]",
                        "subscriptionRequired": "[parameters('subscriptionRequired')]",
                        "subscriptionKeyParameterNames": {
                          "header": "[if(empty(parameters('subscriptionKeyName')), 'Ocp-Apim-Subscription-Key', parameters('subscriptionKeyName'))]"
                        },
                        "type": "[parameters('apiType')]",
                        "protocols": "[parameters('apiProtocols')]",
                        "serviceUrl": "[if(equals(parameters('serviceUrl'), ''), 'https://to-be-replaced-by-policy', parameters('serviceUrl'))]"
                      }
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), variables('isWebSotcketAPI')), not(equals(parameters('policyDocument'), 'NA')))]",
                      "type": "Microsoft.ApiManagement/service/apis/operations/policies",
                      "apiVersion": "2024-06-01-preview",
                      "name": "[format('{0}/{1}/{2}/{3}', parameters('serviceName'), parameters('apiName'), 'onHandshake', 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    },
                    {
                      "condition": "[and(and(parameters('enableAPIDeployment'), not(equals(parameters('policyDocument'), 'NA'))), not(variables('isWebSotcketAPI')))]",
                      "type": "Microsoft.ApiManagement/service/apis/policies",
                      "apiVersion": "2022-08-01",
                      "name": "[format('{0}/{1}/{2}', parameters('serviceName'), parameters('apiName'), 'policy')]",
                      "properties": {
                        "format": "rawxml",
                        "value": "[parameters('policyDocument')]"
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "id": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '')]"
                    },
                    "path": {
                      "type": "string",
                      "value": "[if(parameters('enableAPIDeployment'), reference(resourceId('Microsoft.ApiManagement/service/apis', parameters('serviceName'), parameters('apiName')), '2022-08-01').path, '')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'aad-auth')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'ai-usage')]",
                "[resourceId('Microsoft.ApiManagement/service', parameters('name'))]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'backend-routing')]",
                "[resourceId('Microsoft.ApiManagement/service/namedValues', parameters('name'), 'cognitiveServicesAudience')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'throttling-events')]",
                "[resourceId('Microsoft.ApiManagement/service/policyFragments', parameters('name'), 'validate-routes')]"
              ]
            }
          ],
          "outputs": {
            "apimName": {
              "type": "string",
              "metadata": {
                "description": "The name of the deployed API Management service."
              },
              "value": "[parameters('name')]"
            },
            "apimOpenaiApiPath": {
              "type": "string",
              "metadata": {
                "description": "The path for the OpenAI API in the deployed API Management service."
              },
              "value": "[reference(resourceId('Microsoft.Resources/deployments', 'azure-openai-service-api'), '2025-04-01').outputs.path.value]"
            },
            "apimGatewayUrl": {
              "type": "string",
              "metadata": {
                "description": "Gateway URL for the deployed API Management resource."
              },
              "value": "[reference(resourceId('Microsoft.ApiManagement/service', parameters('name')), '2024-05-01').gatewayUrl]"
            }
          }
        }
      },
      "dependsOn": [
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim-managed-identity')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'ai-content-safety')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'ai-language-service')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'monitoring')]",
        "openAis",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "cosmos-db",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "accountName": "[if(not(empty(parameters('cosmosDbAccountName'))), createObject('value', parameters('cosmosDbAccountName')), createObject('value', format('{0}{1}', variables('abbrs').documentDBDatabaseAccounts, variables('resourceToken'))))]",
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "vNetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetName.value))]",
          "cosmosDnsZoneName": {
            "value": "[variables('cosmosDbPrivateDnsZoneName')]"
          },
          "cosmosPrivateEndpointName": "[if(not(empty(parameters('cosmosDbPrivateEndpointName'))), createObject('value', parameters('cosmosDbPrivateEndpointName')), createObject('value', format('{0}pe-{1}', variables('abbrs').documentDBDatabaseAccounts, variables('resourceToken'))))]",
          "privateEndpointSubnetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.privateEndpointSubnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.privateEndpointSubnetName.value))]",
          "vNetRG": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetRG.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetRG.value))]",
          "dnsZoneRG": "[if(not(parameters('useExistingVnet')), createObject('value', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), createObject('value', parameters('dnsZoneRG')))]",
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]",
          "throughput": {
            "value": "[parameters('cosmosDbRUs')]"
          },
          "publicAccess": {
            "value": "[parameters('cosmosDbPublicAccess')]"
          },
          "cosmosDbSuffix": "[if(variables('isGov'), createObject('value', 'documents.azure.us'), createObject('value', 'documents.azure.com'))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "13537580105485806349"
            }
          },
          "parameters": {
            "accountName": {
              "type": "string",
              "metadata": {
                "description": "Azure Cosmos DB account name, max length 44 characters"
              }
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]",
              "metadata": {
                "description": "Location for the Azure Cosmos DB account."
              }
            },
            "primaryRegion": {
              "type": "string",
              "defaultValue": "[parameters('location')]",
              "metadata": {
                "description": "The primary region for the Azure Cosmos DB account."
              }
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "defaultConsistencyLevel": {
              "type": "string",
              "defaultValue": "Session",
              "allowedValues": [
                "Eventual",
                "ConsistentPrefix",
                "Session",
                "BoundedStaleness",
                "Strong"
              ],
              "metadata": {
                "description": "The default consistency level of the Cosmos DB account."
              }
            },
            "maxStalenessPrefix": {
              "type": "int",
              "defaultValue": 100000,
              "minValue": 10,
              "maxValue": 2147483647,
              "metadata": {
                "description": "Max stale requests. Required for BoundedStaleness. Valid ranges, Single Region: 10 to 2147483647. Multi Region: 100000 to 2147483647."
              }
            },
            "maxIntervalInSeconds": {
              "type": "int",
              "defaultValue": 300,
              "minValue": 5,
              "maxValue": 86400,
              "metadata": {
                "description": "Max lag time (minutes). Required for BoundedStaleness. Valid ranges, Single Region: 5 to 84600. Multi Region: 300 to 86400."
              }
            },
            "systemManagedFailover": {
              "type": "bool",
              "defaultValue": true,
              "allowedValues": [
                true,
                false
              ],
              "metadata": {
                "description": "Enable system managed failover for regions"
              }
            },
            "databaseName": {
              "type": "string",
              "defaultValue": "ai-usage-db",
              "metadata": {
                "description": "The name for the database"
              }
            },
            "containerName": {
              "type": "string",
              "defaultValue": "ai-usage-container",
              "metadata": {
                "description": "The name for the container"
              }
            },
            "pricingContainerName": {
              "type": "string",
              "defaultValue": "model-pricing",
              "metadata": {
                "description": "The name for the container"
              }
            },
            "piiUsageContainerName": {
              "type": "string",
              "defaultValue": "pii-usage-container",
              "metadata": {
                "description": "The name for the container"
              }
            },
            "streamingExportConfigContainerName": {
              "type": "string",
              "defaultValue": "streaming-export-config",
              "metadata": {
                "description": "The name for the container"
              }
            },
            "throughput": {
              "type": "int",
              "defaultValue": 400,
              "minValue": 400,
              "maxValue": 1000000,
              "metadata": {
                "description": "The throughput for the container"
              }
            },
            "cosmosPrivateEndpointName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "cosmosDnsZoneName": {
              "type": "string"
            },
            "publicAccess": {
              "type": "string",
              "defaultValue": "Disabled"
            },
            "cosmosDbSuffix": {
              "type": "string",
              "defaultValue": "documents.azure.com"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            }
          },
          "variables": {
            "consistencyPolicy": {
              "Eventual": {
                "defaultConsistencyLevel": "Eventual"
              },
              "ConsistentPrefix": {
                "defaultConsistencyLevel": "ConsistentPrefix"
              },
              "Session": {
                "defaultConsistencyLevel": "Session"
              },
              "BoundedStaleness": {
                "defaultConsistencyLevel": "BoundedStaleness",
                "maxStalenessPrefix": "[parameters('maxStalenessPrefix')]",
                "maxIntervalInSeconds": "[parameters('maxIntervalInSeconds')]"
              },
              "Strong": {
                "defaultConsistencyLevel": "Strong"
              }
            },
            "locations": [
              {
                "locationName": "[parameters('primaryRegion')]",
                "failoverPriority": 0,
                "isZoneRedundant": false
              }
            ]
          },
          "resources": [
            {
              "type": "Microsoft.DocumentDB/databaseAccounts",
              "apiVersion": "2024-02-15-preview",
              "name": "[toLower(parameters('accountName'))]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('accountName')))]",
              "kind": "GlobalDocumentDB",
              "properties": {
                "consistencyPolicy": "[variables('consistencyPolicy')[parameters('defaultConsistencyLevel')]]",
                "locations": "[variables('locations')]",
                "databaseAccountOfferType": "Standard",
                "enableAutomaticFailover": "[parameters('systemManagedFailover')]",
                "disableKeyBasedMetadataWriteAccess": true,
                "publicNetworkAccess": "[parameters('publicAccess')]"
              }
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}', toLower(parameters('accountName')), parameters('databaseName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('databaseName')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts', toLower(parameters('accountName')))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}/{2}', toLower(parameters('accountName')), parameters('databaseName'), parameters('containerName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('containerName')]",
                  "partitionKey": {
                    "paths": [
                      "/productName"
                    ],
                    "kind": "Hash"
                  },
                  "indexingPolicy": {
                    "indexingMode": "consistent",
                    "automatic": true
                  }
                },
                "options": {
                  "throughput": "[parameters('throughput')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}/{2}', toLower(parameters('accountName')), parameters('databaseName'), parameters('pricingContainerName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('pricingContainerName')]",
                  "partitionKey": {
                    "paths": [
                      "/model"
                    ],
                    "kind": "Hash"
                  },
                  "indexingPolicy": {
                    "indexingMode": "consistent",
                    "automatic": true
                  }
                },
                "options": {
                  "throughput": "[parameters('throughput')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}/{2}', toLower(parameters('accountName')), parameters('databaseName'), parameters('streamingExportConfigContainerName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('streamingExportConfigContainerName')]",
                  "partitionKey": {
                    "paths": [
                      "/type"
                    ],
                    "kind": "Hash"
                  },
                  "indexingPolicy": {
                    "indexingMode": "consistent",
                    "automatic": true
                  }
                },
                "options": {
                  "throughput": "[parameters('throughput')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers",
              "apiVersion": "2024-02-15-preview",
              "name": "[format('{0}/{1}/{2}', toLower(parameters('accountName')), parameters('databaseName'), parameters('piiUsageContainerName'))]",
              "properties": {
                "resource": {
                  "id": "[parameters('piiUsageContainerName')]",
                  "partitionKey": {
                    "paths": [
                      "/type"
                    ],
                    "kind": "Hash"
                  },
                  "indexingPolicy": {
                    "indexingMode": "consistent",
                    "automatic": true
                  }
                },
                "options": {
                  "throughput": "[parameters('throughput')]"
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-privateEndpoint', parameters('accountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "sql"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('cosmosDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('cosmosPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.DocumentDB/databaseAccounts', toLower(parameters('accountName')))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.DocumentDB/databaseAccounts', toLower(parameters('accountName')))]"
              ]
            }
          ],
          "outputs": {
            "location": {
              "type": "string",
              "value": "[parameters('location')]"
            },
            "cosmosDbAccountName": {
              "type": "string",
              "value": "[toLower(parameters('accountName'))]"
            },
            "cosmosDbDatabaseName": {
              "type": "string",
              "value": "[parameters('databaseName')]"
            },
            "cosmosDbContainerName": {
              "type": "string",
              "value": "[parameters('containerName')]"
            },
            "cosmosDbPiiUsageContainerName": {
              "type": "string",
              "value": "[parameters('piiUsageContainerName')]"
            },
            "cosmosDbPricingContainerName": {
              "type": "string",
              "value": "[parameters('pricingContainerName')]"
            },
            "cosmosDbStreamingExportConfigContainerName": {
              "type": "string",
              "value": "[parameters('streamingExportConfigContainerName')]"
            },
            "resourceId": {
              "type": "string",
              "value": "[resourceId('Microsoft.DocumentDB/databaseAccounts/sqlDatabases', toLower(parameters('accountName')), parameters('databaseName'))]"
            },
            "cosmosDbEndpoint": {
              "type": "string",
              "value": "[format('https://{0}.{1}:443/', toLower(parameters('accountName')), parameters('cosmosDbSuffix'))]"
            }
          }
        }
      },
      "dependsOn": [
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    },
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "storage",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "storageAccountName": "[if(not(empty(parameters('storageAccountName'))), createObject('value', parameters('storageAccountName')), createObject('value', format('funcusage{0}', variables('resourceToken'))))]",
          "functionAppManagedIdentityName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'usage-managed-identity'), '2025-04-01').outputs.managedIdentityName.value]"
          },
          "vNetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetName.value))]",
          "privateEndpointSubnetName": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.privateEndpointSubnetName.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.privateEndpointSubnetName.value))]",
          "storageBlobDnsZoneName": {
            "value": "[variables('storageBlobPrivateDnsZoneName')]"
          },
          "storageFileDnsZoneName": {
            "value": "[variables('storageFilePrivateDnsZoneName')]"
          },
          "storageTableDnsZoneName": {
            "value": "[variables('storageTablePrivateDnsZoneName')]"
          },
          "storageQueueDnsZoneName": {
            "value": "[variables('storageQueuePrivateDnsZoneName')]"
          },
          "storageBlobPrivateEndpointName": "[if(not(empty(parameters('storageBlobPrivateEndpointName'))), createObject('value', parameters('storageBlobPrivateEndpointName')), createObject('value', format('{0}blob-pe-{1}', variables('abbrs').storageStorageAccounts, variables('resourceToken'))))]",
          "storageFilePrivateEndpointName": "[if(not(empty(parameters('storageFilePrivateEndpointName'))), createObject('value', parameters('storageFilePrivateEndpointName')), createObject('value', format('{0}file-pe-{1}', variables('abbrs').storageStorageAccounts, variables('resourceToken'))))]",
          "storageTablePrivateEndpointName": "[if(not(empty(parameters('storageTablePrivateEndpointName'))), createObject('value', parameters('storageTablePrivateEndpointName')), createObject('value', format('{0}table-pe-{1}', variables('abbrs').storageStorageAccounts, variables('resourceToken'))))]",
          "storageQueuePrivateEndpointName": "[if(not(empty(parameters('storageQueuePrivateEndpointName'))), createObject('value', parameters('storageQueuePrivateEndpointName')), createObject('value', format('{0}queue-pe-{1}', variables('abbrs').storageStorageAccounts, variables('resourceToken'))))]",
          "functionContentShareName": {
            "value": "[parameters('functionContentShareName')]"
          },
          "logicContentShareName": {
            "value": "[parameters('logicContentShareName')]"
          },
          "vNetRG": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.vnetRG.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.vnetRG.value))]",
          "dnsZoneRG": "[if(not(parameters('useExistingVnet')), createObject('value', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), createObject('value', parameters('dnsZoneRG')))]",
          "dnsSubscriptionId": "[if(not(empty(parameters('dnsSubscriptionId'))), createObject('value', parameters('dnsSubscriptionId')), createObject('value', subscription().subscriptionId))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "3476947490102291154"
            }
          },
          "parameters": {
            "storageAccountName": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "functionAppManagedIdentityName": {
              "type": "string"
            },
            "vNetName": {
              "type": "string"
            },
            "privateEndpointSubnetName": {
              "type": "string"
            },
            "storageBlobDnsZoneName": {
              "type": "string"
            },
            "storageBlobPrivateEndpointName": {
              "type": "string"
            },
            "storageFileDnsZoneName": {
              "type": "string"
            },
            "storageFilePrivateEndpointName": {
              "type": "string"
            },
            "storageTableDnsZoneName": {
              "type": "string"
            },
            "storageTablePrivateEndpointName": {
              "type": "string"
            },
            "storageQueueDnsZoneName": {
              "type": "string"
            },
            "storageQueuePrivateEndpointName": {
              "type": "string"
            },
            "dnsZoneRG": {
              "type": "string"
            },
            "dnsSubscriptionId": {
              "type": "string"
            },
            "vNetRG": {
              "type": "string"
            },
            "provisionFunctionShare": {
              "type": "bool",
              "defaultValue": true
            },
            "provisionLogicShare": {
              "type": "bool",
              "defaultValue": true
            },
            "functionContentShareName": {
              "type": "string"
            },
            "logicContentShareName": {
              "type": "string"
            },
            "storageAccountType": {
              "type": "string",
              "defaultValue": "Standard_LRS",
              "allowedValues": [
                "Standard_LRS",
                "Standard_GRS",
                "Standard_RAGRS"
              ],
              "metadata": {
                "description": "Storage Account type"
              }
            }
          },
          "variables": {
            "storageBlobDataOwnerRoleId": "[subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'b7e6dc6d-f1e8-4753-8033-0f276bb0955b')]"
          },
          "resources": [
            {
              "type": "Microsoft.Storage/storageAccounts",
              "apiVersion": "2022-05-01",
              "name": "[parameters('storageAccountName')]",
              "location": "[parameters('location')]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('storageAccountName')))]",
              "sku": {
                "name": "[parameters('storageAccountType')]"
              },
              "kind": "StorageV2",
              "properties": {
                "supportsHttpsTrafficOnly": true,
                "publicNetworkAccess": "Disabled",
                "allowBlobPublicAccess": false,
                "accessTier": "Hot",
                "networkAcls": {
                  "bypass": "None",
                  "defaultAction": "Deny"
                }
              }
            },
            {
              "condition": "[parameters('provisionFunctionShare')]",
              "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
              "apiVersion": "2022-05-01",
              "name": "[format('{0}/default/{1}', parameters('storageAccountName'), parameters('functionContentShareName'))]",
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "condition": "[parameters('provisionLogicShare')]",
              "type": "Microsoft.Storage/storageAccounts/fileServices/shares",
              "apiVersion": "2022-05-01",
              "name": "[format('{0}/default/{1}', parameters('storageAccountName'), parameters('logicContentShareName'))]",
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "scope": "[format('Microsoft.Storage/storageAccounts/{0}', parameters('storageAccountName'))]",
              "name": "[guid(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), parameters('functionAppManagedIdentityName'), variables('storageBlobDataOwnerRoleId'))]",
              "properties": {
                "principalId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('functionAppManagedIdentityName')), '2018-11-30').principalId]",
                "roleDefinitionId": "[variables('storageBlobDataOwnerRoleId')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-blob-privateEndpoint', parameters('storageAccountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "blob"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('storageBlobDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('storageBlobPrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-file-privateEndpoint', parameters('storageAccountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "file"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('storageFileDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('storageFilePrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-table-privateEndpoint', parameters('storageAccountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "table"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('storageTableDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('storageTablePrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "[format('{0}-queue-privateEndpoint', parameters('storageAccountName'))]",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "groupIds": {
                    "value": [
                      "queue"
                    ]
                  },
                  "dnsZoneName": {
                    "value": "[parameters('storageQueueDnsZoneName')]"
                  },
                  "name": {
                    "value": "[parameters('storageQueuePrivateEndpointName')]"
                  },
                  "privateLinkServiceId": {
                    "value": "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  },
                  "dnsZoneRG": {
                    "value": "[parameters('dnsZoneRG')]"
                  },
                  "privateEndpointSubnetId": {
                    "value": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, parameters('vNetRG')), 'Microsoft.Network/virtualNetworks/subnets', parameters('vNetName'), parameters('privateEndpointSubnetName'))]"
                  },
                  "dnsSubId": {
                    "value": "[parameters('dnsSubscriptionId')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "1709357513214781151"
                    }
                  },
                  "parameters": {
                    "name": {
                      "type": "string"
                    },
                    "privateLinkServiceId": {
                      "type": "string"
                    },
                    "groupIds": {
                      "type": "array"
                    },
                    "dnsZoneName": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    },
                    "privateEndpointSubnetId": {
                      "type": "string"
                    },
                    "dnsZoneRG": {
                      "type": "string"
                    },
                    "dnsSubId": {
                      "type": "string"
                    },
                    "enableDnsIntegration": {
                      "type": "bool",
                      "defaultValue": "[not(empty(parameters('dnsZoneRG')))]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Network/privateEndpoints",
                      "apiVersion": "2022-09-01",
                      "name": "[parameters('name')]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "subnet": {
                          "id": "[parameters('privateEndpointSubnetId')]"
                        },
                        "privateLinkServiceConnections": [
                          {
                            "name": "[parameters('name')]",
                            "properties": {
                              "privateLinkServiceId": "[parameters('privateLinkServiceId')]",
                              "groupIds": "[parameters('groupIds')]"
                            }
                          }
                        ]
                      }
                    },
                    {
                      "condition": "[and(parameters('enableDnsIntegration'), not(empty(parameters('dnsZoneName'))))]",
                      "type": "Microsoft.Network/privateEndpoints/privateDnsZoneGroups",
                      "apiVersion": "2022-09-01",
                      "name": "[format('{0}/{1}', parameters('name'), 'privateDnsZoneGroup')]",
                      "properties": {
                        "privateDnsZoneConfigs": [
                          {
                            "name": "default",
                            "properties": {
                              "privateDnsZoneId": "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', parameters('dnsSubId'), parameters('dnsZoneRG')), 'Microsoft.Network/privateDnsZones', parameters('dnsZoneName'))]"
                            }
                          }
                        ]
                      },
                      "dependsOn": [
                        "[resourceId('Microsoft.Network/privateEndpoints', parameters('name'))]"
                      ]
                    }
                  ],
                  "outputs": {
                    "privateEndpointName": {
                      "type": "string",
                      "value": "[parameters('name')]"
                    }
                  }
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName'))]"
              ]
            }
          ],
          "outputs": {
            "storageAccountName": {
              "type": "string",
              "value": "[parameters('storageAccountName')]"
            }
          }
        }
      },
      "dependsOn": [
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'usage-managed-identity')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    },
    {
      "condition": "[parameters('provisionFunctionApp')]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "usageFunctionApp",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "functionAppName": "[if(not(empty(parameters('usageProcessingFunctionAppName'))), createObject('value', parameters('usageProcessingFunctionAppName')), createObject('value', format('{0}usage-{1}', variables('abbrs').webSitesFunctions, variables('resourceToken'))))]",
          "azdserviceName": {
            "value": "usageProcessingFunctionApp"
          },
          "storageAccountName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'storage'), '2025-04-01').outputs.storageAccountName.value]"
          },
          "functionAppIdentityName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'usage-managed-identity'), '2025-04-01').outputs.managedIdentityName.value]"
          },
          "applicationInsightsName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'monitoring'), '2025-04-01').outputs.funcApplicationInsightsName.value]"
          },
          "eventHubNamespaceName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub'), '2025-04-01').outputs.eventHubNamespaceName.value]"
          },
          "eventHubName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub'), '2025-04-01').outputs.eventHubName.value]"
          },
          "cosmosDBEndpoint": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db'), '2025-04-01').outputs.cosmosDbEndpoint.value]"
          },
          "cosmosDatabaseName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db'), '2025-04-01').outputs.cosmosDbDatabaseName.value]"
          },
          "cosmosContainerName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db'), '2025-04-01').outputs.cosmosDbContainerName.value]"
          },
          "functionAppSubnetId": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.functionAppSubnetId.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.functionAppSubnetId.value))]",
          "functionContentShareName": {
            "value": "[parameters('functionContentShareName')]"
          },
          "storageEndpointSuffix": {
            "value": "[variables('storageEndpointSuffix')]"
          },
          "serviceBusSuffix": {
            "value": "[variables('serviceBusSuffix')]"
          }
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "17158343422646938441"
            }
          },
          "parameters": {
            "functionAppName": {
              "type": "string"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "azdserviceName": {
              "type": "string"
            },
            "storageAccountName": {
              "type": "string"
            },
            "functionContentShareName": {
              "type": "string"
            },
            "functionAppIdentityName": {
              "type": "string"
            },
            "applicationInsightsName": {
              "type": "string"
            },
            "eventHubNamespaceName": {
              "type": "string"
            },
            "eventHubName": {
              "type": "string"
            },
            "functionAppSubnetId": {
              "type": "string"
            },
            "cosmosDBEndpoint": {
              "type": "string"
            },
            "cosmosDatabaseName": {
              "type": "string"
            },
            "cosmosContainerName": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "storageEndpointSuffix": {
              "type": "string",
              "defaultValue": "core.windows.net"
            },
            "serviceBusSuffix": {
              "type": "string",
              "defaultValue": "servicebus.windows.net"
            }
          },
          "variables": {
            "functionPlanOS": "Linux",
            "functionRuntime": "dotnet-isolated",
            "dotnetFrameworkVersion": "8.0",
            "linuxFxVersion": "DOTNET-ISOLATED|8.0",
            "isReserved": "[equals(variables('functionPlanOS'), 'Linux')]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/serverfarms",
              "apiVersion": "2023-12-01",
              "name": "[format('hosting-plan-{0}', parameters('functionAppName'))]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', format('hosting-plan-{0}', parameters('functionAppName'))))]",
              "location": "[parameters('location')]",
              "sku": {
                "name": "EP1",
                "tier": "ElasticPremium",
                "family": "EP"
              },
              "kind": "elastic",
              "properties": {
                "maximumElasticWorkerCount": 10,
                "reserved": "[variables('isReserved')]"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2023-12-01",
              "name": "[parameters('functionAppName')]",
              "location": "[parameters('location')]",
              "kind": "functionapp,linux",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('azdserviceName')))]",
              "identity": {
                "type": "UserAssigned",
                "userAssignedIdentities": {
                  "[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('functionAppIdentityName')))]": {}
                }
              },
              "properties": {
                "enabled": true,
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', format('hosting-plan-{0}', parameters('functionAppName')))]",
                "reserved": "[variables('isReserved')]",
                "virtualNetworkSubnetId": "[parameters('functionAppSubnetId')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', format('hosting-plan-{0}', parameters('functionAppName')))]"
              ]
            },
            {
              "type": "Microsoft.Web/sites/networkConfig",
              "apiVersion": "2023-12-01",
              "name": "[format('{0}/{1}', parameters('functionAppName'), 'virtualNetwork')]",
              "properties": {
                "subnetResourceId": "[parameters('functionAppSubnetId')]",
                "swiftSupported": true
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('functionAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2023-12-01",
              "name": "[format('{0}/{1}', parameters('functionAppName'), 'web')]",
              "properties": {
                "linuxFxVersion": "[variables('linuxFxVersion')]",
                "detailedErrorLoggingEnabled": true,
                "vnetRouteAllEnabled": true,
                "ftpsState": "FtpsOnly",
                "minTlsVersion": "1.2",
                "scmMinTlsVersion": "1.2",
                "minimumElasticInstanceCount": 1,
                "publicNetworkAccess": "Enabled",
                "functionsRuntimeScaleMonitoringEnabled": true,
                "netFrameworkVersion": "[variables('dotnetFrameworkVersion')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('functionAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2023-12-01",
              "name": "[format('{0}/{1}', parameters('functionAppName'), 'appsettings')]",
              "properties": {
                "APPLICATIONINSIGHTS_CONNECTION_STRING": "[reference(resourceId('Microsoft.Insights/components', parameters('applicationInsightsName')), '2020-02-02').ConnectionString]",
                "AzureWebJobsStorage": "[format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix={2}', parameters('storageAccountName'), listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2023-05-01').keys[0].value, parameters('storageEndpointSuffix'))]",
                "FUNCTIONS_EXTENSION_VERSION": "~4",
                "FUNCTIONS_WORKER_RUNTIME": "[variables('functionRuntime')]",
                "WEBSITE_CONTENTAZUREFILECONNECTIONSTRING": "[format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix={2}', parameters('storageAccountName'), listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2023-05-01').keys[0].value, parameters('storageEndpointSuffix'))]",
                "WEBSITE_CONTENTSHARE": "[parameters('functionContentShareName')]",
                "WEBSITE_VNET_ROUTE_ALL": "1",
                "WEBSITE_CONTENTOVERVNET": "1",
                "EventHubConnection__clientId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('functionAppIdentityName')), '2023-01-31').clientId]",
                "EventHubConnection__credential": "managedidentity",
                "EventHubConnection__fullyQualifiedNamespace": "[format('{0}.{1}', parameters('eventHubNamespaceName'), parameters('serviceBusSuffix'))]",
                "EventHubName": "[parameters('eventHubName')]",
                "CosmosAccountEndpoint": "[parameters('cosmosDBEndpoint')]",
                "CosmosDatabaseName": "[parameters('cosmosDatabaseName')]",
                "CosmosContainerName": "[parameters('cosmosContainerName')]",
                "CosmosManagedIdentityId": "[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', parameters('functionAppIdentityName')), '2023-01-31').clientId]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('functionAppName'))]"
              ]
            }
          ]
        }
      },
      "dependsOn": [
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'monitoring')]",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'storage')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'usage-managed-identity')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    },
    {
      "condition": "[parameters('provisionLogicApp')]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2025-04-01",
      "name": "usageLogicApp",
      "resourceGroup": "[if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))]",
      "properties": {
        "expressionEvaluationOptions": {
          "scope": "inner"
        },
        "mode": "Incremental",
        "parameters": {
          "location": {
            "value": "[parameters('location')]"
          },
          "tags": {
            "value": "[parameters('tags')]"
          },
          "logicAppName": "[if(not(empty(parameters('usageProcessingLogicAppName'))), createObject('value', parameters('usageProcessingLogicAppName')), createObject('value', format('{0}usage-{1}', variables('abbrs').logicWorkflows, variables('resourceToken'))))]",
          "azdserviceName": {
            "value": "usageProcessingLogicApp"
          },
          "storageAccountName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'storage'), '2025-04-01').outputs.storageAccountName.value]"
          },
          "applicationInsightsName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'monitoring'), '2025-04-01').outputs.funcApplicationInsightsName.value]"
          },
          "skuFamily": {
            "value": "WS"
          },
          "skuName": {
            "value": "WS1"
          },
          "skuCapaicty": {
            "value": "[parameters('logicAppsSkuCapacityUnits')]"
          },
          "skuSize": {
            "value": "WS1"
          },
          "skuTier": {
            "value": "WorkflowStandard"
          },
          "isReserved": {
            "value": false
          },
          "cosmosDbAccountName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db'), '2025-04-01').outputs.cosmosDbAccountName.value]"
          },
          "eventHubName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub'), '2025-04-01').outputs.eventHubName.value]"
          },
          "eventHubNamespaceName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub'), '2025-04-01').outputs.eventHubNamespaceName.value]"
          },
          "cosmosDBDatabaseName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db'), '2025-04-01').outputs.cosmosDbDatabaseName.value]"
          },
          "cosmosDBContainerConfigName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db'), '2025-04-01').outputs.cosmosDbStreamingExportConfigContainerName.value]"
          },
          "cosmosDBContainerUsageName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db'), '2025-04-01').outputs.cosmosDbContainerName.value]"
          },
          "cosmosDBContainerPIIName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db'), '2025-04-01').outputs.cosmosDbPiiUsageContainerName.value]"
          },
          "eventHubPIIName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub'), '2025-04-01').outputs.eventHubPIIName.value]"
          },
          "apimAppInsightsName": {
            "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'monitoring'), '2025-04-01').outputs.applicationInsightsName.value]"
          },
          "functionAppSubnetId": "[if(parameters('useExistingVnet'), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting'), '2025-04-01').outputs.functionAppSubnetId.value), createObject('value', reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet'), '2025-04-01').outputs.functionAppSubnetId.value))]",
          "fileShareName": {
            "value": "[parameters('logicContentShareName')]"
          },
          "storageEndpointSuffix": {
            "value": "[variables('storageEndpointSuffix')]"
          },
          "serviceBusSuffix": {
            "value": "[variables('serviceBusSuffix')]"
          },
          "portalUrl": {
            "value": "[variables('portalUrl')]"
          },
          "msPortalUrl": "[if(variables('isGov'), createObject('value', 'https://ms.portal.azure.us'), createObject('value', 'https://ms.portal.azure.com'))]"
        },
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "bicep",
              "version": "0.38.33.27573",
              "templateHash": "15749863463390447695"
            }
          },
          "parameters": {
            "logicAppName": {
              "type": "string"
            },
            "tags": {
              "type": "object",
              "defaultValue": {}
            },
            "azdserviceName": {
              "type": "string"
            },
            "storageAccountName": {
              "type": "string"
            },
            "fileShareName": {
              "type": "string"
            },
            "applicationInsightsName": {
              "type": "string"
            },
            "location": {
              "type": "string",
              "defaultValue": "[resourceGroup().location]"
            },
            "skuName": {
              "type": "string"
            },
            "skuFamily": {
              "type": "string"
            },
            "skuSize": {
              "type": "string"
            },
            "skuCapaicty": {
              "type": "int"
            },
            "skuTier": {
              "type": "string"
            },
            "isReserved": {
              "type": "bool"
            },
            "cosmosDbAccountName": {
              "type": "string"
            },
            "functionAppSubnetId": {
              "type": "string"
            },
            "dotnetFrameworkVersion": {
              "type": "string",
              "defaultValue": "v6.0"
            },
            "storageEndpointSuffix": {
              "type": "string",
              "defaultValue": "core.windows.net"
            },
            "serviceBusSuffix": {
              "type": "string",
              "defaultValue": "servicebus.windows.net"
            },
            "portalUrl": {
              "type": "string",
              "defaultValue": "https://portal.azure.com"
            },
            "msPortalUrl": {
              "type": "string",
              "defaultValue": "https://ms.portal.azure.com"
            },
            "eventHubNamespaceName": {
              "type": "string"
            },
            "eventHubName": {
              "type": "string"
            },
            "eventHubPIIName": {
              "type": "string"
            },
            "cosmosDBDatabaseName": {
              "type": "string"
            },
            "cosmosDBContainerConfigName": {
              "type": "string"
            },
            "cosmosDBContainerUsageName": {
              "type": "string"
            },
            "cosmosDBContainerPIIName": {
              "type": "string"
            },
            "apimAppInsightsName": {
              "type": "string"
            }
          },
          "variables": {
            "docDbAccNativeContributorRoleDefinitionId": "00000000-0000-0000-0000-000000000002",
            "eventHubsDataOwnerRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', 'f526a384-b230-433a-b45c-95f59c4a2dec')]",
            "azureMonitorLogsRoleDefinitionId": "[resourceId('Microsoft.Authorization/roleDefinitions', '43d0d8ad-25c7-4714-9337-8ba259a9fe05')]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/serverfarms",
              "apiVersion": "2024-04-01",
              "name": "[format('hosting-plan-{0}', parameters('logicAppName'))]",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', format('hosting-plan-{0}', parameters('logicAppName'))))]",
              "location": "[parameters('location')]",
              "sku": {
                "name": "[parameters('skuName')]",
                "tier": "[parameters('skuTier')]",
                "family": "[parameters('skuFamily')]",
                "size": "[parameters('skuSize')]",
                "capacity": "[parameters('skuCapaicty')]"
              },
              "kind": "elastic",
              "properties": {
                "maximumElasticWorkerCount": 20,
                "reserved": "[parameters('isReserved')]"
              }
            },
            {
              "type": "Microsoft.Web/sites",
              "apiVersion": "2024-04-01",
              "name": "[parameters('logicAppName')]",
              "location": "[parameters('location')]",
              "kind": "functionapp,workflowapp",
              "tags": "[union(parameters('tags'), createObject('azd-service-name', parameters('azdserviceName')))]",
              "identity": {
                "type": "SystemAssigned"
              },
              "properties": {
                "enabled": true,
                "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', format('hosting-plan-{0}', parameters('logicAppName')))]",
                "reserved": "[parameters('isReserved')]",
                "virtualNetworkSubnetId": "[parameters('functionAppSubnetId')]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms', format('hosting-plan-{0}', parameters('logicAppName')))]"
              ]
            },
            {
              "type": "Microsoft.Web/sites/networkConfig",
              "apiVersion": "2024-04-01",
              "name": "[format('{0}/{1}', parameters('logicAppName'), 'virtualNetwork')]",
              "properties": {
                "subnetResourceId": "[parameters('functionAppSubnetId')]",
                "swiftSupported": true
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2024-04-01",
              "name": "[format('{0}/{1}', parameters('logicAppName'), 'web')]",
              "properties": {
                "detailedErrorLoggingEnabled": true,
                "vnetRouteAllEnabled": true,
                "ftpsState": "FtpsOnly",
                "minTlsVersion": "1.2",
                "scmMinTlsVersion": "1.2",
                "minimumElasticInstanceCount": 1,
                "publicNetworkAccess": "Enabled",
                "functionsRuntimeScaleMonitoringEnabled": true,
                "netFrameworkVersion": "[parameters('dotnetFrameworkVersion')]",
                "preWarmedInstanceCount": 1,
                "cors": {
                  "allowedOrigins": [
                    "[parameters('portalUrl')]",
                    "[parameters('msPortalUrl')]"
                  ],
                  "supportCredentials": false
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Web/sites/config",
              "apiVersion": "2024-04-01",
              "name": "[format('{0}/{1}', parameters('logicAppName'), 'appsettings')]",
              "properties": {
                "APPLICATIONINSIGHTS_CONNECTION_STRING": "[reference(resourceId('Microsoft.Insights/components', parameters('applicationInsightsName')), '2020-02-02').ConnectionString]",
                "AzureWebJobsStorage": "[format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix={2}', parameters('storageAccountName'), listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2023-05-01').keys[0].value, parameters('storageEndpointSuffix'))]",
                "FUNCTIONS_EXTENSION_VERSION": "~4",
                "FUNCTIONS_WORKER_RUNTIME": "node",
                "WEBSITE_NODE_DEFAULT_VERSION": "~20",
                "WEBSITE_CONTENTAZUREFILECONNECTIONSTRING": "[format('DefaultEndpointsProtocol=https;AccountName={0};AccountKey={1};EndpointSuffix={2}', parameters('storageAccountName'), listKeys(resourceId('Microsoft.Storage/storageAccounts', parameters('storageAccountName')), '2023-05-01').keys[0].value, parameters('storageEndpointSuffix'))]",
                "WEBSITE_CONTENTSHARE": "[parameters('fileShareName')]",
                "WEBSITE_VNET_ROUTE_ALL": "0",
                "WEBSITE_CONTENTOVERVNET": "1",
                "eventHub_fullyQualifiedNamespace": "[format('{0}.{1}', parameters('eventHubNamespaceName'), parameters('serviceBusSuffix'))]",
                "eventHub_name": "[parameters('eventHubName')]",
                "eventHub_pii_name": "[parameters('eventHubPIIName')]",
                "APP_KIND": "workflowapp",
                "AzureFunctionsJobHost_extensionBundle": "Microsoft.Azure.Functions.ExtensionBundle.Workflows",
                "CosmosDBAccount": "[parameters('cosmosDbAccountName')]",
                "CosmosDBDatabase": "[parameters('cosmosDBDatabaseName')]",
                "CosmosDBContainerConfig": "[parameters('cosmosDBContainerConfigName')]",
                "CosmosDBContainerUsage": "[parameters('cosmosDBContainerUsageName')]",
                "CosmosDBContainerPII": "[parameters('cosmosDBContainerPIIName')]",
                "AzureCosmosDB_connectionString": "[listConnectionStrings(resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName')), '2024-02-15-preview').connectionStrings[0].connectionString]",
                "AppInsights_SubscriptionId": "[subscription().subscriptionId]",
                "AppInsights_ResourceGroup": "[resourceGroup().name]",
                "AppInsights_Name": "[parameters('apimAppInsightsName')]",
                "AzureMonitor_Resource_Id": "[reference(resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn'), '2025-04-01').outputs.resourceId.value]",
                "AzureMonitor_Api_Id": "[reference(resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn'), '2025-04-01').outputs.apiId.value]",
                "AzureMonitor_ConnectRuntime_Url": "[reference(resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn'), '2025-04-01').outputs.connectRuntimeUrl.value]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn')]",
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.DocumentDB/databaseAccounts/sqlRoleAssignments",
              "apiVersion": "2023-04-15",
              "name": "[format('{0}/{1}', parameters('cosmosDbAccountName'), guid(variables('docDbAccNativeContributorRoleDefinitionId'), parameters('logicAppName'), resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName'))))]",
              "properties": {
                "principalId": "[reference(resourceId('Microsoft.Web/sites', parameters('logicAppName')), '2024-04-01', 'full').identity.principalId]",
                "roleDefinitionId": "[format('/{0}/sqlRoleDefinitions/{1}', resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName')), variables('docDbAccNativeContributorRoleDefinitionId'))]",
                "scope": "[resourceId('Microsoft.DocumentDB/databaseAccounts', parameters('cosmosDbAccountName'))]"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(parameters('logicAppName'), variables('eventHubsDataOwnerRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('eventHubsDataOwnerRoleDefinitionId')]",
                "principalId": "[reference(resourceId('Microsoft.Web/sites', parameters('logicAppName')), '2024-04-01', 'full').identity.principalId]",
                "principalType": "ServicePrincipal"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Authorization/roleAssignments",
              "apiVersion": "2022-04-01",
              "name": "[guid(parameters('logicAppName'), variables('azureMonitorLogsRoleDefinitionId'))]",
              "properties": {
                "roleDefinitionId": "[variables('azureMonitorLogsRoleDefinitionId')]",
                "principalId": "[reference(resourceId('Microsoft.Web/sites', parameters('logicAppName')), '2024-04-01', 'full').identity.principalId]",
                "principalType": "ServicePrincipal"
              },
              "dependsOn": [
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "azuremonitorlogs-conn",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "connection_name": {
                    "value": "azuremonitorlogs"
                  },
                  "display_name": {
                    "value": "conn-azure-monitor"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "connection_name": {
                      "type": "string"
                    },
                    "display_name": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string"
                    }
                  },
                  "variables": {},
                  "resources": [
                    {
                      "type": "Microsoft.Web/connections",
                      "name": "[parameters('connection_name')]",
                      "apiVersion": "[providers('Microsoft.Web','connections').apiVersions[0]]",
                      "location": "[parameters('location')]",
                      "kind": "V2",
                      "properties": {
                        "alternativeParameterValues": {},
                        "api": {
                          "id": "[subscriptionResourceId('Microsoft.Web/locations/managedApis', parameters('location'), parameters('connection_name'))]"
                        },
                        "authenticatedUser": {},
                        "connectionState": "Enabled",
                        "customParameterValues": {},
                        "displayName": "[parameters('display_name')]",
                        "parameterValueSet": {
                          "name": "managedIdentityAuth",
                          "values": {}
                        }
                      }
                    }
                  ],
                  "outputs": {
                    "connectRuntimeUrl": {
                      "type": "string",
                      "value": "[reference(resourceId('Microsoft.Web/connections', parameters('connection_name')), '2016-06-01').connectionRuntimeUrl]"
                    },
                    "resourceId": {
                      "type": "string",
                      "value": "[resourceId('Microsoft.Web/connections', parameters('connection_name'))]"
                    },
                    "apiId": {
                      "type": "string",
                      "value": "[subscriptionResourceId('Microsoft.Web/locations/managedApis', parameters('location'), parameters('connection_name'))]"
                    }
                  }
                }
              }
            },
            {
              "type": "Microsoft.Resources/deployments",
              "apiVersion": "2025-04-01",
              "name": "azuremonitorlogs-access",
              "properties": {
                "expressionEvaluationOptions": {
                  "scope": "inner"
                },
                "mode": "Incremental",
                "parameters": {
                  "connectionName": {
                    "value": "azuremonitorlogs"
                  },
                  "accessPolicyName": {
                    "value": "azuremonitorlogs-access"
                  },
                  "identityPrincipalId": {
                    "value": "[reference(resourceId('Microsoft.Web/sites', parameters('logicAppName')), '2024-04-01', 'full').identity.principalId]"
                  },
                  "location": {
                    "value": "[parameters('location')]"
                  }
                },
                "template": {
                  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                  "contentVersion": "1.0.0.0",
                  "metadata": {
                    "_generator": {
                      "name": "bicep",
                      "version": "0.38.33.27573",
                      "templateHash": "15218314424387427578"
                    }
                  },
                  "parameters": {
                    "connectionName": {
                      "type": "string"
                    },
                    "accessPolicyName": {
                      "type": "string"
                    },
                    "identityPrincipalId": {
                      "type": "string"
                    },
                    "location": {
                      "type": "string",
                      "defaultValue": "[resourceGroup().location]"
                    }
                  },
                  "resources": [
                    {
                      "type": "Microsoft.Web/connections/accessPolicies",
                      "apiVersion": "2016-06-01",
                      "name": "[format('{0}/{1}', parameters('connectionName'), parameters('accessPolicyName'))]",
                      "location": "[parameters('location')]",
                      "properties": {
                        "principal": {
                          "type": "ActiveDirectory",
                          "identity": {
                            "tenantId": "[subscription().tenantId]",
                            "objectId": "[parameters('identityPrincipalId')]"
                          }
                        }
                      }
                    }
                  ]
                }
              },
              "dependsOn": [
                "[resourceId('Microsoft.Resources/deployments', 'azuremonitorlogs-conn')]",
                "[resourceId('Microsoft.Web/sites', parameters('logicAppName'))]"
              ]
            }
          ]
        }
      },
      "dependsOn": [
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'cosmos-db')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'event-hub')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'monitoring')]",
        "[subscriptionResourceId('Microsoft.Resources/resourceGroups', if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName'))))]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'storage')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnet')]",
        "[extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'vnetExisting')]"
      ]
    }
  ],
  "outputs": {
    "APIM_NAME": {
      "type": "string",
      "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim'), '2025-04-01').outputs.apimName.value]"
    },
    "APIM_AOI_PATH": {
      "type": "string",
      "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim'), '2025-04-01').outputs.apimOpenaiApiPath.value]"
    },
    "APIM_GATEWAY_URL": {
      "type": "string",
      "value": "[reference(extensionResourceId(format('/subscriptions/{0}/resourceGroups/{1}', subscription().subscriptionId, if(not(empty(parameters('resourceGroupName'))), parameters('resourceGroupName'), format('{0}{1}', variables('abbrs').resourcesResourceGroups, parameters('environmentName')))), 'Microsoft.Resources/deployments', 'apim'), '2025-04-01').outputs.apimGatewayUrl.value]"
    }
  }
}